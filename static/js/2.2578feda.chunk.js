(this.webpackJsonp=this.webpackJsonp||[]).push([[2],{260:function(e,t,n){"use strict";n.r(t),n.d(t,"useThemeColor",(function(){return O})),n.d(t,"Text",(function(){return g})),n.d(t,"View",(function(){return p}));var r=n(10),o=n.n(r),i=n(69),c=n.n(i),a=(n(0),n(259)),l=n(41),u=n(265),s=n(114),d=n(12),f=["style","lightColor","darkColor"],b=["style","lightColor","darkColor"];function j(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?j(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):j(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function O(e,t){var n=Object(s.default)(),r=e[n];return r||u.default[n][t]}function g(e){var t=e.style,n=e.lightColor,r=e.darkColor,o=c()(e,f),i=O({light:n,dark:r},"text");return Object(d.jsx)(a.default,h({style:[{color:i},t]},o))}function p(e){var t=e.style,n=e.lightColor,r=e.darkColor,o=c()(e,b),i=O({light:n,dark:r},"background");return Object(d.jsx)(l.default,h({style:[{backgroundColor:i},t]},o))}},265:function(e,t,n){"use strict";n.r(t);t.default={light:{text:"#000",background:"#fff",tint:"#2f95dc",tabIconDefault:"#ccc",tabIconSelected:"#2f95dc",hoverColor:"rgb(242,242,242)",buttonBackgroundColor:"#f6f8fa",header:"#f6f8fa",headerBottomColor:"rgb(216, 216, 216)",buttonBorderColor:"rgba(27,31,36,0.15)",iconColor:"black"},dark:{text:"#fff",background:"#000",tint:"#fff",tabIconDefault:"#ccc",tabIconSelected:"#fff",hoverColor:"#010409",buttonBackgroundColor:"#010409",header:"#010409",headerBottomColor:"rgb(40, 40, 40)",buttonBorderColor:"rgba(229,225,220,0.15)",iconColor:"white"},borderColor:"#d0d7de",focus:"#0065A4"}},276:function(e,t,n){"use strict";n.r(t),n.d(t,"ModalsProvider",(function(){return j}));var r=n(10),o=n.n(r),i=n(17),c=n.n(i),a=n(0),l=n(528),u=n(286),s=n(12);function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var b=Object(a.createContext)({setModal:function(){}}),j=function(e){var t=e.children,n=e.modals,r=Object(a.useState)([]),o=c()(r,2),i=o[0],d=o[1],j=Object(u.default)(),h=Object(a.useState)("none"),O=c()(h,2),g=O[0],p=O[1];return Object(a.useEffect)((function(){0==i.filter((function(e){return e.visible})).length&&p("landscape"==j?"fade":"slide")}),[j]),Object(a.useEffect)((function(){d(n.map((function(e){return{Component:e,props:null,visible:!1}})))}),[n]),Object(s.jsxs)(b.Provider,{value:{setModal:function(e,t){var n=i.map((function(n){return null==e?f(f({},n),{},{visible:!1}):n.Component==e?{Component:e,props:null!==t?t:n.props,visible:null!==t}:n}));d(n)}},children:[t,i.map((function(e,t){var n=e.Component,r=e.props,o=e.visible;return Object(s.jsx)(l.default,{animationType:g,visible:o,transparent:!0,children:Object(s.jsx)(n,f({},r))},t)}))]})};t.default=function(){return Object(a.useContext)(b)}},279:function(e,t,n){"use strict";n.r(t);var r=n(10),o=n.n(r),i=n(17),c=n.n(i),a=n(0),l=n(259),u=n(31),s=n(375),d=n(265),f=n(114),b=n(12);function j(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?j(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):j(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var O=function(e){var t=Object(a.useState)(!1),n=c()(t,2),r=n[0],o=n[1];return Object(b.jsx)(s.default,{onPress:function(){return e.onPress()},onHoverIn:function(){return o(!0)},onHoverOut:function(){return o(!1)},disabled:e.disabled,style:[{paddingVertical:5,paddingHorizontal:16},e.style,r||e.disabled?{backgroundColor:e.color,borderColor:e.borderColor}:{}],children:e.children?e.children:Object(b.jsx)(l.default,{selectable:!1,style:[{fontSize:14},e.textStyle],children:e.title})})};t.default=function(e){var t=Object(f.default)(),n=h(h({color:d.default[t].hoverColor,borderColor:"light"==t?d.default[t].buttonBorderColor:"#7d8590"},e),{},{style:[g.style,{backgroundColor:d.default[t].buttonBackgroundColor,borderColor:d.default[t].buttonBorderColor},e.style],textStyle:[g.text,{color:d.default[t].text},e.textStyle]});return Object(b.jsx)(O,h({},n))};var g=u.default.create({style:{borderRadius:6,borderWidth:1},text:{textAlign:"center",fontWeight:"600"}})},286:function(e,t,n){"use strict";n.r(t),n.d(t,"ResizeContextProvider",(function(){return b})),n.d(t,"default",(function(){return j}));var r=n(17),o=n.n(r),i=n(0),c=n(42),a=n(327),l=n(143),u=n.n(l),s=n(12),d=function(e){return e.height>=e.width?"portrait":"landscape"},f=Object(i.createContext)(d(c.default.get("window"))),b=function(e){var t=e.children,n=u()(),r=Object(a.default)(),c=r.width,l=r.height,b=Object(i.useState)(d({width:c,height:l})),j=o()(b,2),h=j[0],O=j[1];return Object(i.useEffect)((function(){O(d({width:c,height:l}))}),[c,l]),Object(s.jsx)(f.Provider,{value:n.isMobile()?"portrait":h,children:t})};function j(){return Object(i.useContext)(f)}},314:function(e,t,n){"use strict";n.r(t),n.d(t,"avatarFromChannel",(function(){return s}));var r=n(10),o=n.n(r),i=(n(0),n(718)),c=n(12),a=function(e,t,n){return Math.floor(e%(n-t)+t)},l=function(e){var t=function(e,t){for(var n=t||0,r=0;r<e.length;r++)n=e.charCodeAt(r)+((n<<5)-n);return n=Math.abs(n),"hsl("+a(n,0,360)+", "+a(n,0,100)+"%, "+a(n,25,75)+"%)"}(e.name,e.userId);return Object(c.jsx)(i.Avatar.Text,{style:{backgroundColor:t},size:e.size,label:e.name.split(" ").map((function(e){return e[0]})).join().toUpperCase()})};function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e,t){var n,r=e.name;return e.member_count<3&&(n=1==e.member_count||(null==t?void 0:t.id)==e.subowner.id?e.owner:e.subowner,r=r.length>0?r:n.name),{avatar:n,name:r}}t.default=function(e){return Object(c.jsx)(l,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e))}},318:function(e,t,n){"use strict";n.r(t),n.d(t,"BottomSheet",(function(){return c}));n(0);var r=n(319),o=n(286),i=n(12);t.default=function(e){var t=Object(o.default)();return Object(i.jsx)(r.default,{autoScale:!0,outerContainerStyle:{flex:1,alignSelf:"center",backgroundColor:"#8888",flexShrink:1,width:"100%"},containerStyle:{flex:1,margin:0,justifyContent:"center",alignItems:"center"},bodyStyle:"landscape"==t?{width:"90%",height:"90%",padding:"5%"}:{width:"100%",height:"100%",maxWidth:1080},children:e.children})};var c=function(e){return Object(i.jsx)(r.default,{autoScale:!0,outerContainerStyle:{flex:1,alignSelf:"center",backgroundColor:"#8888",width:"100%"},containerStyle:{flex:1,margin:0,justifyContent:"flex-end"},children:e.children})}},319:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return a}));n(0);var r=n(260),o=n(31),i=n(265),c=n(12);function a(e){return Object(c.jsx)(r.View,{style:[l.outerContainer,e.autoScale?{}:l.outerContainerFill,e.outerContainerStyle],children:Object(c.jsxs)(r.View,{style:[l.container,e.containerStyle],children:[e.withSeparator?Object(c.jsx)(r.View,{style:l.separator,lightColor:"#ddd",darkColor:"rgba(255,255,255, 0.3)"}):void 0,e.title?Object(c.jsxs)(r.View,{style:l.titleView,children:[Object(c.jsx)(r.Text,{style:[l.title,e.titleStyle],children:e.title}),Object(c.jsx)(r.Text,{style:l.subtitle,children:e.subtitle})]}):void 0,Object(c.jsx)(r.View,{style:[l.bodyView,e.bodyStyle],children:e.children})]})})}var l=o.default.create({outerContainer:{alignItems:"stretch",backgroundColor:"transparent"},outerContainerFill:{width:"100%",maxWidth:1080},container:{marginHorizontal:20,marginVertical:10,backgroundColor:"transparent"},titleView:{width:"100%",flexDirection:"row",backgroundColor:"transparent",marginBottom:5},title:{flex:1,fontSize:16},subtitle:{flex:1,fontSize:12,textAlign:"right",marginTop:4},separator:{marginBottom:0,height:1,width:"100%"},bodyView:{width:"100%",padding:20,alignItems:"center",justifyContent:"center",borderWidth:1,borderColor:i.default.borderColor,borderRadius:6}})},337:function(e,t,n){"use strict";n.r(t);var r=n(0),o=n(295);t.default=function(e,t){var n=Object(o.useNavigation)();Object(r.useEffect)((function(){var t=function(t){t.preventDefault(),e()};return n.addListener("beforeRemove",t),function(){n.removeListener("beforeRemove",t)}}),t)}},349:function(e,t,n){"use strict";n.r(t),n.d(t,"WebSocketInternalProvider",(function(){return j})),n.d(t,"WebSocketProvider",(function(){return h}));var r=n(17),o=n.n(r),i=n(0),c=n(742),a=n.n(c),l=n(53),u=n(40),s=n(441),d=n(12),f={lastJsonMessage:void 0,sendJsonMessage:function(){}},b=Object(i.createContext)(f),j=function(e){var t=e.children,n=e.path,r=e.Context,c=e.useBackground,b=Object(i.useState)(null),j=o()(b,2),h=j[0],O=j[1],g=Object(i.useState)(c||"active"==s.default.currentState),p=o()(g,2),y=p[0],x=p[1],v=a()(l.websockerURL+"/"+n,{shouldReconnect:function(e){return!0},protocols:h?["Authorization",h]:void 0,onOpen:function(e){console.log("success websocket connection("+n+")")},onClose:function(e){console.log("closed websocket connection("+n+")")}},y&&null!=h),m=v.lastJsonMessage,w=v.sendJsonMessage;return Object(i.useEffect)((function(){u.default.getItem("Authorization").then(O);var e=s.default.addEventListener("change",(function(e){return x(c||"active"==e)}));return function(){return e.remove()}}),[]),Object(d.jsx)(r.Provider,{value:null!=h?{lastJsonMessage:m,sendJsonMessage:w}:f,children:t})},h=function(e){var t=e.disable,n=e.children;return t?Object(d.jsx)(d.Fragment,{children:n}):Object(d.jsx)(j,{path:"messenger/ws/",Context:b,children:n})};t.default=function(){return Object(i.useContext)(b)}},458:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return g})),n.d(t,"useMessengerContentMutation",(function(){return p}));var r=n(4),o=n.n(r),i=n(45),c=n.n(i),a=n(10),l=n.n(a),u=n(0),s=n(72),d=n(73),f=n(349),b=n(459);function j(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?j(Object(n),!0).forEach((function(t){l()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):j(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var O=function(e,t){var n=0;e.forEach((function(e){n!=t.length&&(e.current.forEach((function(e){n!=t.length&&e.id==t[n].id&&(e.timer=t[n].timer,e.is_archive=t[n].is_archive,n+=1)})),e.current=e.current.filter((function(e){return!e.is_archive})))}))};function g(e){var t=Object(s.useQueryClient)(),n=Object(s.useInfiniteQuery)(["MessengerContentList",e],function(){var t=o()((function*(t){var n=t.pageParam;return Object(d.getMessengerContentList)(e,n).then((function(e){return{current:e}}))}));return function(e){return t.apply(this,arguments)}}(),{select:function(e){return e.pages.length>1&&(e.pages[e.pages.length-2].next=e.pages[e.pages.length-1]),e},getNextPageParam:function(e){return null!=e&&e.current.length?e.current[e.current.length-1].id:void 0},refetchOnReconnect:!1,refetchOnWindowFocus:function(n){var r=new Date(n.state.dataUpdatedAt).toISOString(),o=h({},n.state.data);return Object(d.getNewMessengerContentList)(e,r).then((function(n){if(o.pages){var r=o.pages[0].current[0].id||0,i=n.filter((function(e){return e.id>r&&0==e.is_archive})),a=n.filter((function(e){return e.id<=r})),l=i.findIndex((function(e){return e.timer}))>=0||a.length>0;o.pages[0].current=[].concat(c()(i),c()(o.pages[0].current)),O(o.pages,a),l&&t.invalidateQueries(["TimerMessageContentList",e])}})),!1}}),r=n.data,i=n.fetchNextPage,a=Object(f.default)().lastJsonMessage;return Object(u.useEffect)((function(){null!=a&&a.data.channel==e&&("next_message"==a.type&&t.setQueryData(["MessengerContentList",e],(function(e){return null!=e&&e.pages[0].current&&(null==e?void 0:e.pages[0].current[0].id)!=a.data.id&&(e.pages[0].current=[a.data].concat(c()(null==e?void 0:e.pages[0].current))),h({},e||{pages:[],pageParams:[]})})),"update_message"==a.type&&t.setQueryData(["MessengerContentList",e],(function(e){return(null==e?void 0:e.pages)&&O(e.pages,[a.data]),h({},e||{pages:[],pageParams:[]})})))}),[a]),{data:r,fetchNextPage:i}}function p(e){var t=Object(b.default)().dispatch,n=Object(s.useMutation)((function(e){return Object(d.postMessage)(e,t)}),{onSuccess:function(){}}),r=Object(s.useMutation)(d.patchMessengerContent);return{create:n.mutate,patch:r.mutate}}},459:function(e,t,n){"use strict";n.r(t),n.d(t,"UploadContextProvider",(function(){return h})),n.d(t,"default",(function(){return O}));var r=n(17),o=n.n(r),i=n(10),c=n.n(i),a=n(45),l=n.n(a),u=n(0),s=n(12);function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach((function(t){c()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var b=Object(u.createContext)({upload:{},dispatch:function(){}}),j=function(e,t){var n=l()(e[t.channel]||[]),r=n.findIndex((function(e){return e.filename==t.filename}));return r>=0?n[r]={filename:t.filename,progress:t.progress}:n.push({filename:t.filename,progress:t.progress}),f(f({},e),{},c()({},t.channel,n.filter((function(e){return(e.progress||0)<1}))))},h=function(e){var t=e.children,n=Object(u.useReducer)(j,{}),r=o()(n,2),i=r[0],c=r[1];return Object(s.jsx)(b.Provider,{value:{upload:i,dispatch:c},children:t})};function O(){return Object(u.useContext)(b)}},610:function(e,t,n){"use strict";n.r(t);var r=n(10),o=n.n(r),i=n(17),c=n.n(i),a=n(0),l=n(275),u=n(1155),s=n(260),d=n(12);function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var j=/> .*(\n([ ]+.*\n?)*)?/,h=/> .*\n?/,O=function(e){return Object(d.jsx)(u.default,{linkDefault:!0,style:{wordBreak:"break-word"},linkStyle:{color:"#12b886"},onPress:e.onPressLink,children:Object(d.jsx)(s.Text,{selectable:e.selectable,style:e.textStyle,children:e.children})})},g=function(e){var t=Object(a.useState)(!1),n=c()(t,2),r=n[0],o=n[1];return Object(d.jsxs)(s.View,{style:{flexDirection:"row"},children:[Object(d.jsx)(l.default,{onPress:function(){return o(!r)},children:Object(d.jsx)(s.Text,{children:r?"\u25bc  ":"\u25b6  "})}),Object(d.jsxs)(s.View,{children:[Object(d.jsx)(O,b(b({},e),{},{children:e.title})),r&&Object(d.jsx)(p,b(b({},e),{},{content:e.body}))]})]})},p=function(e){for(var t=""+e.content,n=[],r=function(){var r=t.match(j);if(null==r)n.push(Object(d.jsx)(O,b(b({},e),{},{children:t}),n.length)),t="";else{n.push(Object(d.jsx)(O,b(b({},e),{},{children:t.slice(0,r.index)}),n.length));var o=r[0].match(h),i=r[0].slice(null==o?void 0:o[0].length).split("\n"),c=i[0].length-i[0].trimStart().length,a=i.map((function(e){var t=e.length-e.trimStart().length;return"".repeat(Math.max(0,t-c))+e.trimStart()})).join("\n");n.push(Object(d.jsx)(g,b(b({},e),{},{title:(null==o?void 0:o[0].slice(2))||"",body:a}),n.length)),t=t.slice((r.index||0)+r[0].length)}};t.length>0;)r();return Object(d.jsx)(d.Fragment,{children:n})};t.default=p},611:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return p}));n(0);var r=n(607),o=n.n(r),i=n(279),c=n(276),a=n(260),l=n(94),u=n(318),s=n(292),d=n(265),f=n(116),b=n(114),j=n(458),h=n(337),O=n(612),g=n(12);function p(e){var t=e.content,n=e.isOwner,r=e.sendToScreen,y=t.message_set[0],x=t.attatchment_set.filter((function(e){return"editor"==e.type})),v=x.length>0?x[0]:void 0,m=v?v.title.concat("\r\n",v.description.replaceAll(O.regexForStripHTML,"")):y.content,w=Object(l.default)().lang,P=Object(c.default)().setModal,C=Object(b.default)(),S=Object(j.useMessengerContentMutation)(),D=function(){P(p,null)};return Object(h.default)(D,[]),Object(g.jsxs)(u.BottomSheet,{children:[Object(g.jsxs)(a.View,{style:{flexDirection:"row",width:"100%"},children:[Object(g.jsx)(a.View,{style:{flex:1,flexDirection:"row"},children:Object(g.jsx)(s.TouchableOpacity,{onPress:D,children:Object(g.jsx)(f.Ionicons,{size:20,name:"arrow-back",color:d.default[C].text})})}),Object(g.jsx)(a.View,{style:{flex:1},children:Object(g.jsx)(a.Text,{style:{fontSize:20,textAlign:"center"},children:w("Message")})}),Object(g.jsx)(a.View,{style:{flex:1}})]}),Object(g.jsx)(a.View,{style:{marginBottom:20,height:1,width:"100%"},lightColor:"#ddd",darkColor:"rgba(255,255,255, 0.3)"}),Object(g.jsx)(i.default,{style:{height:40,width:"100%",maxWidth:320,justifyContent:"center"},title:w("copy"),onPress:function(){o.a.setString(m),D()}}),v&&r&&Object(g.jsx)(i.default,{style:{height:40,width:"100%",maxWidth:320,justifyContent:"center"},title:w("move to editor"),onPress:function(){r({value:v.title,editorValue:v.description}),D()}}),n&&t.timer&&Object(g.jsx)(i.default,{style:{height:40,width:"100%",maxWidth:320,justifyContent:"center"},textStyle:{color:"red"},title:w("delete timer"),onPress:function(){S.patch({id:t.id,timer:null}),D()}}),n&&Object(g.jsx)(i.default,{style:{height:40,width:"100%",maxWidth:320,justifyContent:"center"},textStyle:{color:"red"},title:w("delete"),onPress:function(){S.patch({id:t.id,is_archive:!0}),D()}})]})}},612:function(e,t,n){"use strict";n.r(t),n.d(t,"regexForStripHTML",(function(){return d}));var r=n(0),o=n.n(r),i=n(319),c=n(260),a=n(114),l=n(265),u=n(12),s=o.a.lazy((function(){return n.e(5).then(n.t.bind(null,995,7))})),d=/<\/?[^>]*>/gi;t.default=o.a.memo((function(e){var t=e.content,n=Object(a.default)();return Object(u.jsxs)(c.View,{children:[Object(u.jsx)(c.Text,{style:{fontSize:18,fontWeight:"600",minWidth:140},children:t.title}),Object(u.jsx)(i.default,{containerStyle:{width:"100%",margin:0},bodyStyle:{borderWidth:0,borderRadius:0,borderTopWidth:1,padding:0,alignItems:"flex-start"},children:Object(u.jsx)(r.Suspense,{fallback:Object(u.jsx)(c.Text,{children:t.description.replaceAll(d,"")}),children:Object(u.jsx)(s,{contentWidth:320,source:{html:t.description},baseStyle:{color:l.default[n].text}})})})]})}))},721:function(e,t,n){"use strict";n.r(t);var r=n(10),o=n.n(r),i=n(0),c=n.n(i),a=n(41),l=n(275),u=n(292),s=n(458),d=n(119),f=n(276),b=n(260),j=n(314),h=n(278),O=n(336),g=n(319),p=n(12),y=function(e){var t=e.link,n=e.isMobile,r=e.touchableRef;return Object(p.jsx)(g.default,{containerStyle:{marginHorizontal:0},bodyStyle:{padding:0},children:Object(p.jsxs)(u.TouchableOpacity,{onPress:function(){return r.current()&&O.default.openURL(t.url)},onLongPress:function(){},style:{width:"100%",flexDirection:"row"},children:[t.image_url?Object(p.jsx)(h.default,{source:{uri:t.image_url},resizeMode:"cover",style:{width:"100%",maxWidth:n?120:150,maxHeight:n?120:150,borderWidth:1}}):void 0,Object(p.jsxs)(b.View,{style:{flex:1,marginHorizontal:20},children:[Object(p.jsx)(b.Text,{style:{fontSize:18},children:t.title}),Object(p.jsx)(b.Text,{style:{fontSize:14},children:t.description}),Object(p.jsx)(b.Text,{style:{fontSize:12},children:t.url})]})]})})},x=n(116),v=n(114),m=n(265);function w(e){var t=0==e?0:Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,t)).toFixed(2)+" "+["B","kB","MB","GB","TB"][t]}var P=function(e){var t=e.file,n=e.isMobile,r=e.showBorder,o=e.touchableRef,i=Object(v.default)();return Object(p.jsx)(g.default,{containerStyle:{marginHorizontal:0},bodyStyle:r?{padding:10}:{borderWidth:0,padding:0},children:Object(p.jsxs)(u.TouchableOpacity,{onPress:function(){return o.current()&&O.default.openURL(t.file)},onLongPress:function(){},style:{flexDirection:"row",alignItems:"flex-start",width:"100%"},children:[t.thumbnail?Object(p.jsx)(h.default,{source:{uri:t.thumbnail},resizeMode:"cover",style:{width:n?120:150,height:n?120:150,borderWidth:1}}):Object(p.jsx)(x.FontAwesome,{name:"file-o",size:20,color:m.default[i].iconColor}),Object(p.jsxs)(b.View,{style:{flex:1,marginHorizontal:10},children:[Object(p.jsx)(b.Text,{style:{fontSize:18},children:t.filename}),Object(p.jsx)(b.Text,{style:{fontSize:14},children:w(t.filesize)})]})]})})},C=n(611),S=n(724),D=n(4),M=n.n(D),k=n(72),T=n(73);var z=n(612),E=n(610);function L(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function I(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?L(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):L(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var V=c.a.memo((function(e){for(var t,n=Object(i.useRef)(Date.now()),r=Object(i.useRef)((function(){return Date.now()-n.current>350})),o=Object(d.default)(),c=e.next;null!=(u=c)&&u.next&&0==c.current.length;){var u;c=c.next}var s=null==(t=c)?void 0:t.current[0];return Object(p.jsx)(a.default,{style:{flexDirection:e.reverse?"column-reverse":"column"},onTouchMove:function(){n.current=Date.now()},children:e.current.map((function(t,n){var i=n+1<e.current.length?e.current[n+1]:s,c=t.created.slice(0,16),u=c.slice(0,10),d=null==t.user,f=void 0==i||t.user!=i.user||c!=i.created.slice(0,16),h=e.ownerId==t.user,O=void 0==i||u!=i.created.slice(0,10),x=t.message_set[0];return d?Object(p.jsx)(a.default,{style:{flexDirection:"row",justifyContent:"center",width:"100%",marginVertical:5},children:Object(p.jsx)(b.Text,{children:x.content})},t.id):Object(p.jsxs)(a.default,{children:[O?Object(p.jsx)(a.default,{style:{flexDirection:"row",justifyContent:"center",width:"100%"},children:Object(p.jsx)(b.Text,{children:u})}):void 0,Object(p.jsxs)(a.default,{style:{flexDirection:"row",justifyContent:h?"space-between":"flex-start",width:"100%"},children:[f&&!h?Object(p.jsx)(a.default,{style:{marginTop:3,marginLeft:12},children:Object(p.jsx)(j.default,{name:t.name,userId:t.user,size:36})}):Object(p.jsx)(a.default,{style:{width:48}}),Object(p.jsx)(g.default,{autoScale:!0,outerContainerStyle:{maxWidth:"90%"},title:f?t.name:void 0,titleStyle:{flex:void 0},bodyStyle:{padding:10},subtitle:""+c.slice(11),children:Object(p.jsxs)(l.default,{onLongPress:null==e.getOnPress?void 0:e.getOnPress(t),children:[t.timer&&Object(p.jsxs)(a.default,{style:{flexDirection:"row",alignItems:"stretch"},children:[Object(p.jsx)(b.Text,{style:{fontSize:12},children:"\u231a"}),Object(p.jsx)(b.Text,{style:{fontSize:12},selectable:!o,children:Object(S.timerToString)(t.timer)})]}),Object(p.jsx)(E.default,{selectable:!o,textStyle:{textAlign:h?"right":"left"},onPressLink:r.current()?void 0:function(){},content:x.content}),t.attatchment_set.map((function(e,t){return"editor"==e.type?Object(p.jsx)(z.default,{content:e},t):"file"==e.type?Object(p.jsx)(P,{file:e,isMobile:o,showBorder:!1,touchableRef:r},t):"link"==e.type?Object(p.jsx)(y,{link:e,isMobile:o,touchableRef:r},t):void 0}))]})})]},t.id)]},t.id)}))})}));t.default=function(e){var t=Object(i.useRef)(0),n=e.auth?Object(s.default)(e.channel_id):function(e){var t=Object(k.useInfiniteQuery)(["ViewerContentList",e],function(){var t=M()((function*(t){var n=t.pageParam;return Object(T.getMessengerContentList)(e,n,!0).then((function(e){return{current:e}}))}));return function(e){return t.apply(this,arguments)}}(),{select:function(e){return e.pages.length>1&&(e.pages[e.pages.length-2].next=e.pages[e.pages.length-1]),e},getNextPageParam:function(e){return null!=e&&e.current.length?e.current[e.current.length-1].id:void 0},refetchOnReconnect:!1,refetchOnWindowFocus:!1});return{data:t.data,fetchNextPage:t.fetchNextPage}}(e.channel_id),r=n.data,o=n.fetchNextPage;console.log(o);var c=Object(i.useMemo)((function(){var t,n;return null==(t=e.auth)||null==(n=t.user)?void 0:n.id}),[e.auth]),a=Object(f.default)().setModal,l=function(t){return function(){return a(C.default,{content:t,isOwner:c==t.user,sendToScreen:e.sendToScreen})}},d=Object(i.useCallback)((function(t){var n=t.item;t.index;return Object(p.jsx)(V,I(I({},n),{},{ownerId:c,reverse:e.reverse,getOnPress:l}))}),[c]);return Object(p.jsx)(u.FlatList,{style:{flexDirection:e.reverse?"column-reverse":"column"},contentContainerStyle:{padding:10,flexGrow:1,flexDirection:e.reverse?"column-reverse":"column"},data:null==r?void 0:r.pages,renderItem:d,onScroll:function(n){n.nativeEvent.contentSize.height-t.current+(e.reverse?1:-1)*n.nativeEvent.contentOffset.y<1&&o()},onLayout:function(e){t.current=e.nativeEvent.layout.height}})}},724:function(e,t,n){"use strict";n.r(t),n.d(t,"timerFormat",(function(){return v})),n.d(t,"timerToString",(function(){return w}));var r=n(17),o=n.n(r),i=n(0),c=n(365),a=n.n(c),l=n(41),u=n(275),s=n(260),d=n(45),f=n.n(d),b=n(4),j=n.n(b),h=n(72),O=n(73),g=n(349);var p=n(314),y=n(610),x=n(12);function v(e){return m(a()(e),a()())}function m(e,t){return e.year()!=t.year()?e.format("YYYY.MM"):e.month()!=t.month()||e.date()!=t.date()?e.format("MM.DD"):e.format("HH:mm")}function w(e){return a()(e).format("YYYY.MM.DD HH:mm")}var P=function(e){var t=a()(e.data.created),n=a()(e.data.timer),r=t.diff(e.now)/t.diff(n),o=e.data.message_set[0];return Object(x.jsx)(u.default,{onPress:function(){return e.setExpand(e.isExpand?void 0:e.data.id)},children:Object(x.jsxs)(l.default,{style:{backgroundColor:"lightgray",borderRadius:20,overflow:"hidden",margin:5},children:[Object(x.jsx)(l.default,{style:{backgroundColor:"darkgray",position:"absolute",width:100*r+"%",height:"100%"}}),e.isExpand?Object(x.jsxs)(l.default,{style:{paddingVertical:5,paddingHorizontal:5,maxWidth:270},children:[Object(x.jsxs)(l.default,{style:{flexDirection:"row"},children:[Object(x.jsx)(p.default,{name:e.data.name,userId:e.data.user,size:20}),Object(x.jsx)(l.default,{style:{paddingHorizontal:5},children:Object(x.jsx)(s.Text,{children:e.data.name})})]}),e.data.timer&&Object(x.jsxs)(l.default,{style:{flexDirection:"row",alignItems:"stretch"},children:[Object(x.jsx)(s.Text,{children:"\u231a"}),Object(x.jsx)(s.Text,{selectable:!0,children:w(e.data.timer)})]}),Object(x.jsx)(y.default,{selectable:!0,content:o.preview_content||o.content})]}):Object(x.jsxs)(l.default,{style:{paddingVertical:5,paddingHorizontal:5,flexDirection:"row"},children:[Object(x.jsx)(p.default,{name:e.data.name,userId:e.data.user,size:20}),Object(x.jsx)(l.default,{style:{paddingHorizontal:5},children:Object(x.jsx)(s.Text,{children:m(n,e.now)})})]})]})})};t.default=function(e){var t=function(e){var t=Object(h.useQueryClient)(),n=Object(h.useQuery)(["TimerMessageContentList",e],j()((function*(){return yield Object(O.getTimerMessageContentList)(e,a()().toISOString())})),{refetchOnReconnect:!1,refetchOnWindowFocus:!1}).data,r=Object(g.default)().lastJsonMessage;Object(i.useEffect)((function(){null!=r&&r.data.channel==e&&("next_message"==r.type&&r.data.timer&&a()()<a()(r.data.timer)&&t.setQueryData(["TimerMessageContentList",e],(function(e){return[].concat(f()(e||[]),[r.data])})),"update_message"==r.type&&t.setQueryData(["TimerMessageContentList",e],(function(e){return f()((null==e?void 0:e.filter((function(e){return e.id!=r.data.id||null!=r.data.timer&&!r.data.is_archive})))||[])})))}),[r]);var o=Object(i.useMemo)((function(){return null==n?void 0:n.sort((function(e,t){return(e.timer||"")>(t.timer||"")?1:-1}))}),[n]);return Object(i.useEffect)((function(){var n;if(null!=o&&null!=(n=o[0])&&n.timer){var r=o[0].id,i=Math.min(a()(o[0].timer).diff(a()()),Number.MAX_VALUE),c=setTimeout((function(){t.setQueryData(["TimerMessageContentList",e],(function(e){return(e||[]).filter((function(e){return e.id!=r||a()(e.timer).diff(a()())>0}))}))}),i);return function(){return clearTimeout(c)}}}),[o]),o}(e.channel_id),n=Object(i.useState)(a()()),r=o()(n,2),c=r[0],u=r[1],s=Object(i.useState)(),d=o()(s,2),b=d[0],p=d[1];return Object(i.useEffect)((function(){var e=setTimeout((function(){u(a()())}),2e3);return function(){return clearTimeout(e)}}),[c]),Object(x.jsx)(l.default,{style:{flexDirection:"row",paddingTop:5,paddingHorizontal:20},children:null==t?void 0:t.map((function(e,t){return Object(x.jsx)(P,{data:e,now:c,isExpand:e.id==b,setExpand:p},t)}))})}}}]);
//# sourceMappingURL=2.2578feda.chunk.js.map