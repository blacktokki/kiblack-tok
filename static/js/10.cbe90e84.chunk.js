(this.webpackJsonp=this.webpackJsonp||[]).push([[10],{1149:function(e,t,n){"use strict";n.r(t);var r=n(17),i=n.n(r),o=n(617),c=n(717),a=n(0),l=n(41),s=n(117),u=n(286),d=n(31),f=n(259),j=n(278),b=n(114),O=n(94),h=n(12);function g(e){var t=e.navigation,n=Object(O.default)().lang,r=Object(b.default)().auth;return Object(h.jsxs)(l.default,{style:p.container,children:[Object(h.jsx)(f.default,{style:p.title,children:n("This screen doesn't exist.")}),Object(h.jsx)(j.default,{onPress:function(){return t.replace(r.user?"HomeScreen":"LoginScreen")},style:p.link,children:Object(h.jsx)(f.default,{style:p.linkText,children:n("Go to home screen!")})})]})}var p=d.default.create({container:{flex:1,backgroundColor:"#fff",alignItems:"center",justifyContent:"center",padding:20},title:{fontSize:20,fontWeight:"bold"},link:{marginTop:15,paddingVertical:15},linkText:{fontSize:14,color:"#2e78b7"}}),m=n(523),x=n(190),y=n(609),v=n(399),w=n(265),S=n(471),C=n(275),P=n(406),k=n(473),E=n(262),_=n(328),M=n(346),D=n(313),T=n(115),R=n(408),I=n(361),V=n(476),z=function(){var e=Object(b.default)().auth,t=Object(C.default)().setModal,n=Object(I.default)(e);return Object(h.jsx)(l.default,{style:{flex:1},children:null==n?void 0:n.map((function(e,n){return Object(h.jsx)(k.default,{containerStyle:{marginHorizontal:0},bodyStyle:{alignItems:"flex-start"},onPress:function(){return t(V.default,{id:e.id})},children:Object(h.jsx)(E.Text,{style:{marginLeft:20},children:e.name})},n)}))})},L=function(){var e=Object(b.default)().auth,t=Object(_.useMessengerChannelSorted)(e);return Object(h.jsx)(l.default,{style:{flex:1},children:null==t?void 0:t.map((function(t,n){var r=Object(D.avatarFromChannel)(t,e.user).name;return Object(h.jsx)(k.default,{containerStyle:{marginHorizontal:0},bodyStyle:{alignItems:"flex-start"},onPress:function(){return Object(M.navigate)("ChatScreen",{id:t.id})},children:Object(h.jsx)(E.Text,{style:{marginLeft:20},children:r})},n)}))})},B=function(e){var t=e.auth,n=Object(x.default)().colors,r=Object(T.default)(),o=Object(u.default)(),c=Object(_.useMessengerChannelSorted)(t),d=Object(a.useState)(),f=i()(d,2),j=f[0],b=f[1],O=Object(C.default)().setModal,g=[function(){var e;return O(R.default,null!=(e=t.user)&&e.is_guest?{id:t.user.id}:{})},function(){return O(P.default,{type:"messenger"})}],p=function(e){var t=w.default[e].iconColor;return{MemberTab:{title:"member",component:z,icon:Object(h.jsx)(s.MaterialCommunityIcons,{size:32,color:t,style:{marginBottom:-3},name:"account"})},ChatTab:{title:"chat",component:L,icon:Object(h.jsx)(s.Ionicons,{size:30,color:t,style:{marginBottom:-3},name:"chatbox"})}}}(r);return Object(a.useEffect)((function(){void 0===j&&c&&b(c.length>0?1:0)}),[c]),Object(h.jsx)(l.default,{style:"landscape"==o?[A.tabBar,{backgroundColor:w.default[r].background,borderTopColor:n.border}]:{width:0},pointerEvents:"auto",children:"landscape"==o&&t.user&&void 0!==j&&Object(h.jsxs)(h.Fragment,{children:[Object(h.jsx)(y.default,{userId:t.user.id,username:t.user.username,name:t.user.name}),Object(h.jsx)(l.default,{style:{flexDirection:"row-reverse"},children:Object(h.jsx)(v.default,{title:"+",textStyle:{fontSize:20},style:{borderRadius:20},onPress:g[j]})}),Object(h.jsx)(l.default,{accessibilityRole:"tablist",style:A.content,children:Object.keys(p).length>1?Object(h.jsx)(S.default,{tabs:p,tabBarPosition:"top",onTab:b,index:j}):Object(h.jsx)(l.default,{style:{borderTopWidth:1,flex:1,borderColor:n.border},children:Object.values(p).map((function(e){var t=e.component;return Object(h.jsx)(t,{},e.title)}))})})]})})},A=d.default.create({tabBar:{width:240,elevation:8,borderRightWidth:1,borderColor:w.default.borderColor},content:{flex:1,flexDirection:"row"},tab:{flex:1,alignItems:"center"},label:{textAlign:"center",backgroundColor:"transparent"}}),F=n(347),U=n(457),H=n(291),W=n(610),G=n(120),N=n(720),Q=n(571),J=n(606),K=n(607),Y=[N.default,V.default,P.default,Q.default,J.default,K.default,R.default],$=n(279),q=n(456),Z=Object(o.default)();t.default=function(){var e=Object(u.default)(),t=Object(G.default)(),n=Object(b.default)().auth,r=Object(T.default)(),o=Object(O.default)(),d=o.lang,f=o.locale,j=Object(a.useMemo)((function(){return void 0===n.user?[]:(console.log("current user: ",n.user),Object.entries(null===n.user?m.login:m.main))}),[n,f]),p=Object(a.useMemo)((function(){return void 0===n.user||null===n.user?[]:Y}),[n]),x="light"==r?{}:{backgroundColor:"#010409"};return void 0!==n.user?Object(h.jsx)(l.default,{style:{flexDirection:"row",flex:1},children:Object(h.jsx)(q.UploadContextProvider,{children:Object(h.jsxs)(C.ModalsProvider,{modals:p,children:[n.user?Object(h.jsx)(B,{auth:n}):void 0,Object(h.jsx)(l.default,{style:[{flex:1},x],children:Object(h.jsx)(F.WebSocketProvider,{disable:null===n.user||void 0===n.user,children:Object(h.jsx)(W.FirebaseProvider,{user:n.user,children:Object(h.jsxs)(Z.Navigator,{screenOptions:function(n){var i=n.navigation,o=n.route;return{headerStyle:{backgroundColor:w.default[r].header,height:t?50:void 0},headerTitleStyle:{color:w.default[r].text},headerLeft:function(){return function(e,t,n,r,i){var o=-1==["HomeScreen","LoginScreen"].findIndex((function(e){return e==t.name})),c=function(){e.canGoBack()?e.goBack():o&&e.replace("HomeScreen")};return"portrait"==n&&o?Object(h.jsx)(H.TouchableOpacity,{onPress:c,disabled:!i,children:Object(h.jsx)($.default,{title:"",color:i?w.default[r].buttonBackgroundColor:w.default[r].hoverColor,onPress:c,disabled:i,style:{width:32,height:32,margin:16,paddingVertical:1,paddingHorizontal:4},children:Object(h.jsx)(s.Ionicons,{size:24,color:w.default[r].iconColor,name:"arrow-back"})})}):null}(i,o,e,r,t)},headerRight:function(){return Object(h.jsx)(U.default,{})},headerLeftContainerStyle:{backgroundColor:w.default[r].header,borderBottomWidth:1,borderColor:w.default[r].headerBottomColor},cardStyle:[{flexShrink:1},x],animationEnabled:"portrait"==e,cardStyleInterpolator:c.CardStyleInterpolators.forHorizontalIOS}},children:[j.map((function(e){var t=i()(e,2),n=t[0],r=t[1];return Object(h.jsx)(Z.Screen,{name:n,component:r.component,options:{title:d(r.title)}},n)})),Object(h.jsx)(Z.Screen,{name:"NotFound",component:g,options:{title:"Oops!"}})]})})})})]})})}):Object(h.jsx)(h.Fragment,{})}},328:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return O})),n.d(t,"useMessengerChannelSorted",(function(){return h})),n.d(t,"useMessengerChannelMutation",(function(){return g}));var r=n(10),i=n.n(r),o=n(45),c=n.n(o),a=n(4),l=n.n(a),s=n(0),u=n(71),d=n(72),f=n(347);function j(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?j(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):j(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function O(e){var t=Object(u.useQueryClient)(),n=Object(f.default)().lastJsonMessage,r=Object(u.useQuery)("MessengerChannelList",l()((function*(){var t;return yield Object(d.getMessengerChannelList)(null==e||null==(t=e.user)?void 0:t.id)}))).data;return Object(s.useEffect)((function(){if(null!=n&&("enter"==n.type&&t.setQueryData("MessengerChannelList",(function(e){return(null!=e&&e.find((function(e){return e.id==n.data.id}))?e:[n.data].concat(c()(e||[]))).sort((function(e,t){return e.id-t.id}))})),"next_message"==n.type)){var e=n.data;t.setQueryData("MessengerChannelList",(function(t){return(t||[]).map((function(t){var n;return t.id==e.channel?b(b({},t),{},{last_message:{content:null==(n=e.message_set[0])?void 0:n.content,created:e.created}}):t}))}))}}),[n]),r}function h(e){var t=O(e);return null==t?void 0:t.sort((function(e,t){var n,r;return((null==(n=e.last_message)?void 0:n.created)||"")<((null==(r=t.last_message)?void 0:r.created)||"")?1:-1}))}function g(){var e=Object(u.useQueryClient)(),t=Object(u.useMutation)(d.postChannel,{onSuccess:function(){return e.invalidateQueries("MessengerChannelList")}}),n=Object(u.useMutation)(d.putChannel,{onSuccess:function(){return e.invalidateQueries("MessengerChannelList")}}),r=Object(u.useMutation)(d.postDirectChannel,{onSuccess:function(){return e.invalidateQueries("MessengerChannelList")}});return{create:t.mutateAsync,update:n.mutateAsync,direct:r.mutateAsync}}},346:function(e,t,n){"use strict";n.r(t),function(e){n.d(t,"navigate",(function(){return v})),n.d(t,"default",(function(){return C}));var r=n(17),i=n.n(r),o=n(0),c=n(412),a=n(99),l=n(716),s=n(719),u=n(620),d=n(124),f=n(617),j=n(717),b=n(286),O=n(741),h=n(523),g=n(853),p=n(1149),m=n(12);Object(l.enableScreens)();var x,y=o.createRef();function v(e,t){var n,r;t&&(null==(n=y.current)||n.navigate(e,t)),null==(r=y.current)||r.navigate(e)}try{var w,S;x=null==(w=e)||null==(S=w.versions)?void 0:S.electron}catch(M){x=void 0}function C(){var e=Object(c.default)(),t=Object(a.useColorScheme)(),n="no-preference"==t?e:t;return Object(m.jsx)(s.default,{ref:y,documentTitle:{formatter:function(e,t){return"TOKKI TOK"}},linking:x?void 0:g.default,theme:"dark"===n?u.default:d.default,children:Object(m.jsx)(b.ResizeContextProvider,{children:Object(m.jsx)(k,{})})})}var P=Object(f.default)();function k(){var e=Object(b.default)();return Object(O.default)(),Object(m.jsxs)(P.Navigator,{mode:"modal",headerMode:"screen",screenOptions:{cardStyle:{backgroundColor:"white"},animationEnabled:!0,cardStyleInterpolator:j.CardStyleInterpolators.forVerticalIOS},children:[Object(m.jsx)(P.Screen,{name:"Main",component:p.default,options:{headerShown:!1}}),Object.entries(h.modal).map((function(t){var n=i()(t,2),r=n[0],o=n[1];return Object(m.jsx)(P.Screen,{name:r,component:o.component,options:{title:o.title,gestureDirection:"landscape"==e?"vertical-inverted":"vertical"}},r)}))]})}Object(O.replaceInviteeState)(window.location);var E=["setNativeProps","useNativeDriver"],_=console.warn;console.warn=function(e){var t=!0;(e instanceof Object||E.some((function(t){return e.includes(t)})))&&(t=!1),t&&_(e)}}.call(this,n(125))},361:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return l})),n.d(t,"useUserMembershipMutation",(function(){return s}));var r=n(4),i=n.n(r),o=n(71),c=n(72),a=n(114);function l(e){return Object(o.useQuery)(["UserMembershipList",null==e?void 0:e.groupId],i()((function*(){return null!=e&&e.groupId?yield Object(c.getUserMembershipList)(null==e?void 0:e.groupId):[]}))).data}function s(){var e=Object(o.useQueryClient)(),t=Object(a.default)(),n=t.auth,r=t.dispatch,i=Object(o.useMutation)(c.postUser,{onSuccess:function(){e.invalidateQueries("UserMembershipList")}}),l=Object(o.useMutation)(c.patchUser,{onSuccess:function(t,i){var o;i.id==(null==(o=n.user)?void 0:o.id)?i.username&&i.password?r({type:"LOGIN_REQUEST",username:i.username,password:i.password}):r({type:"REFRESH"}):e.invalidateQueries("UserMembershipList")}}),s=Object(o.useMutation)(c.deleteUser,{onSuccess:function(t,i){var o;e.invalidateQueries("UserMembershipList"),i==(null==(o=n.user)?void 0:o.id)&&r({type:"LOGOUT_REQUEST"})}});return{create:i.mutateAsync,update:l.mutateAsync,delete:s.mutateAsync}}},380:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return a})),n.d(t,"useMessengerMemberMutation",(function(){return l}));var r=n(4),i=n.n(r),o=n(71),c=n(72);function a(e){return Object(o.useQuery)(["MessengerMemberList",e],i()((function*(){return yield Object(c.getMessengerMemberList)(e)}))).data}function l(){var e=Object(o.useQueryClient)(),t=Object(o.useMutation)(c.postBulkMessengerMember,{onSuccess:function(){e.invalidateQueries("MessengerMemberList")}}),n=Object(o.useMutation)(c.deleteMessengerMember,{onSuccess:function(){e.invalidateQueries("MessengerChannelList"),e.invalidateQueries("MessengerMemberList")}});return{invite:t.mutateAsync,leave:n.mutateAsync}}},399:function(e,t,n){"use strict";n.r(t);var r=n(10),i=n.n(r),o=(n(0),n(31)),c=n(279),a=n(12);function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}t.default=function(e){return Object(a.jsx)(c.default,s(s({},e),{},{style:[u.style,e.style]}))};var u=o.default.create({style:{borderRadius:6,backgroundColor:"transparent",borderWidth:0}})},406:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return x}));var r=n(17),i=n.n(r),o=n(0),c=n(31),a=n(262),l=n(279),s=n(114),u=n(346),d=n(328),f=n(600),j=n(275),b=n(94),O=n(318),h=n(380),g=n(313),p=n(336),m=n(12);function x(e){var t=e.id,n=e.member_id,r=e.type,c=Object(b.default)().lang,v=Object(s.default)().auth,w=Object(j.default)().setModal,S=Object(d.default)(v),C=Object(d.useMessengerChannelMutation)(),P=Object(h.useMessengerMemberMutation)(),k=null==S?void 0:S.find((function(e){return e.id==t})),E=Object(o.useState)(""),_=i()(E,2),M=_[0],D=_[1],T=Object(o.useState)(""),R=i()(T,2),I=R[0],V=R[1],z=function(){w(x,null)};return Object(o.useEffect)((function(){if(k){var e=Object(g.avatarFromChannel)(k,v.user).name;D(e),V((null==k?void 0:k.description)||"")}}),[null==k?void 0:k.id]),Object(p.default)(z,[]),Object(m.jsx)(O.default,{children:Object(m.jsxs)(a.View,{style:{justifyContent:"space-between",flex:1,width:"100%"},children:[Object(m.jsxs)(a.View,{style:{width:"100%"},children:[Object(m.jsx)(a.Text,{style:{fontSize:20},children:c(t?"Chat Setting":"New chat")}),Object(m.jsx)(a.View,{style:y.separator,lightColor:"#ddd",darkColor:"rgba(255,255,255, 0.3)"}),Object(m.jsx)(f.default,{name:c("Channel Name"),value:M,setValue:D,width:"60%"}),Object(m.jsx)(f.default,{name:c("Description"),value:I,setValue:V,multiline:!0,width:"60%"})]}),Object(m.jsxs)(a.View,{style:{width:"100%",flexDirection:"row"},children:[n&&Object(m.jsx)(a.View,{style:{flexDirection:"row",justifyContent:"flex-start"},children:Object(m.jsx)(l.default,{title:c("leave"),style:{marginHorizontal:5},textStyle:{color:"red"},onPress:function(){return P.leave(n).then(z)}})}),Object(m.jsxs)(a.View,{style:{flex:1,flexDirection:"row",justifyContent:"flex-end"},children:[Object(m.jsx)(l.default,{title:c("save"),onPress:function(){var e;if(null!=v&&null!=(e=v.user)&&e.id&&v.groupId){var n,i={id:t,name:M,description:I,type:r,owner:null==v||null==(n=v.user)?void 0:n.id,group:v.groupId};(t?C.update(i):C.create(i)).then((function(e){return Object(u.navigate)("Main",{screen:"messenger"==e.type?"ChatScreen":"BoardScreen",params:{id:e.id}})}))}}}),Object(m.jsx)(l.default,{title:c("cancel"),style:{marginHorizontal:5},onPress:z})]})]})]})})}var y=c.default.create({field:{width:"50%",flexDirection:"row",padding:10},separator:{marginBottom:20,height:1,width:"100%"}})},408:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return m}));var r=n(17),i=n.n(r),o=n(0),c=n(31),a=n(94),l=n(361),s=n(114),u=n(318),d=n(275),f=n(262),j=n(470),b=n(279),O=n(601),h=n(599),g=n(12),p=function(e){var t=Object(a.default)().lang;return e.message?Object(g.jsx)(f.View,{style:x.form_error,children:Object(g.jsx)(f.Text,{style:x.form_error_text,children:t(e.message)})}):Object(g.jsx)(g.Fragment,{})};function m(e){var t=e.id,n=Object(a.default)().lang,r=Object(s.default)().auth,c=Object(d.default)().setModal,y=Object(o.useState)(""),v=i()(y,2),w=v[0],S=v[1],C=Object(o.useState)(""),P=i()(C,2),k=P[0],E=P[1],_=Object(o.useState)(""),M=i()(_,2),D=M[0],T=M[1],R=Object(o.useState)(""),I=i()(R,2),V=I[0],z=I[1],L=Object(o.useState)(!1),B=i()(L,2),A=B[0],F=(B[1],Object(o.useState)({})),U=i()(F,2),H=U[0],W=U[1],G=Object(l.default)(r),N=Object(h.default)(w),Q=Object(l.useUserMembershipMutation)(),J=null==G?void 0:G.find((function(e){return e.id==t})),K=J&&!1===J.is_guest;Object(o.useEffect)((function(){J&&(S(J.username),E(J.name))}),[null==J?void 0:J.id]);var Y=function(){c(m,null)};return Object(g.jsx)(u.default,{children:Object(g.jsxs)(f.View,{style:{justifyContent:"space-between",flex:1,width:"100%"},children:[Object(g.jsxs)(f.View,{style:{flex:1,width:"100%"},children:[Object(g.jsx)(f.Text,{style:{fontSize:20},children:n(K?"Edit User":"Create User")}),Object(g.jsx)(f.View,{style:x.separator,lightColor:"#ddd",darkColor:"rgba(255,255,255, 0.3)"}),Object(g.jsxs)(j.default,{name:n("Username"),width:"60%",children:[K?Object(g.jsx)(f.Text,{style:{fontSize:16},children:w}):Object(g.jsx)(O.default,{value:w,setValue:function(e){return S(e)},keyboardType:"email-address"}),Object(g.jsx)(p,{message:H.username})]}),Object(g.jsxs)(j.default,{name:n("Name"),width:"60%",children:[Object(g.jsx)(O.default,{value:k,setValue:function(e){return E(e)}}),Object(g.jsx)(p,{message:H.name})]}),Object(g.jsxs)(j.default,{name:n("Password"),width:"60%",children:[Object(g.jsx)(O.default,{value:D,secureTextEntry:!0,setValue:function(e){return T(e)}}),Object(g.jsx)(p,{message:H.password})]}),Object(g.jsxs)(j.default,{name:n("Check Password"),width:"60%",children:[Object(g.jsx)(O.default,{value:V,secureTextEntry:!0,setValue:function(e){return z(e)}}),Object(g.jsx)(p,{message:H.checkPassword})]})]}),Object(g.jsxs)(f.View,{style:{width:"100%",flexDirection:"row"},children:[t&&Object(g.jsx)(f.View,{style:{flexDirection:"row",justifyContent:"flex-start"},children:Object(g.jsx)(b.default,{title:n("delete account"),style:{marginHorizontal:5},textStyle:{color:"red"},onPress:function(){return Q.delete(t).then(Y)}})}),Object(g.jsxs)(f.View,{style:{flex:1,flexDirection:"row",justifyContent:"flex-end"},children:[Object(g.jsx)(b.default,{title:n("save"),onPress:function(){var e={};((null==N?void 0:N.length)||0)>0&&!K&&(e.username="The username is already in use."),(w.length<10||w.length>64)&&(e.username="Set 10-64 characters."),(k.length<1||k.length>64)&&(e.name="Set 1-64 characters."),/^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*#?&])[A-Za-z\d@$!%*#?&]{10,64}$/.test(D)||K&&0==D.length||(e.password="Set 10-64 characters with a combination of letters/numbers/valid special characters."),D!=V&&(e.checkPassword="Incorrect between password and check password."),Object.keys(e).length>0?W(e):t?Q.update({id:t,name:k,username:K?void 0:w,is_guest:!1,password:D.length>0?D:void 0}).then((function(){var e;(t!=(null==(e=r.user)?void 0:e.id)||(null==J?void 0:J.is_guest))&&Y()})):(null==r?void 0:r.groupId)&&Q.create({username:w,name:k,password:D,is_guest:!1,is_staff:A,inviteGroupId:r.groupId}).then(Y)}}),Object(g.jsx)(b.default,{title:n("cancel"),style:{marginHorizontal:5},onPress:Y})]})]})]})})}var x=c.default.create({form_error:{height:22,width:"100%"},form_error_text:{textAlignVertical:"center",color:"red",fontSize:13},separator:{marginBottom:20,height:1,width:"100%"}})},457:function(e,t,n){"use strict";n.r(t);var r=n(10),i=n.n(r),o=n(45),c=n.n(o),a=(n(0),n(399)),l=n(114),s=n(286),u=n(41),d=n(275),f=n(571),j=n(94),b=n(115),O=n(265),h=n(12);function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}t.default=function(e){var t=Object(j.default)().lang,n=Object(b.default)(),r=Object(l.default)(),i=r.auth,o=r.dispatch,g=Object(d.default)().setModal,m=Object(s.default)(),x=[{title:t("sign out"),onPress:function(){var e;null!=i&&null!=(e=i.user)&&e.is_guest?g(f.default,{type:"GUEST_LOGOUT"}):o({type:"LOGOUT_REQUEST"})}}],y=(e.extra?[].concat(c()(e.extra),x):x).filter((function(e){return e.windowType==m||void 0==e.windowType}));return Object(h.jsx)(u.default,{style:{flexDirection:"row"},children:y.map((function(e,t){return Object(h.jsx)(a.default,p(p({},e),{},{textStyle:{color:O.default[n].text},color:"#gray"}),t)}))})}},470:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return a}));var r=n(0),i=n(262),o=n(286),c=n(12);function a(e){var t=Object(o.default)(),n=Object(r.useMemo)((function(){return"landscape"==t?{flexDirection:"row",alignItems:"center",justifyContent:"space-between"}:{flexDirection:"column",alignItems:"flex-start"}}),[t]);return Object(c.jsxs)(i.View,{style:[{paddingVertical:"landscape"==t?15:5,width:"100%"},n],children:[Object(c.jsx)(i.Text,{style:["landscape"==t?{flex:1}:{width:"100%"},{paddingHorizontal:15,fontSize:16},e.textStyle],children:e.name}),Object(c.jsx)(i.View,{style:["landscape"==t?{flex:6}:{width:"100%"},{paddingHorizontal:15}],children:Object(c.jsx)(i.View,{style:{width:e.width},children:e.children})})]})}},471:function(e,t,n){"use strict";n.r(t);var r=n(10),i=n.n(r),o=n(45),c=n.n(o),a=n(17),l=n.n(a),s=n(0),u=n.n(s),d=n(1160),f=n(836),j=n(1157),b=n(265),O=n(115),h=n(94),g=n(12);function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}t.default=function(e){var t=Object(h.default)().lang,n=u.a.useState(e.index||0),r=l()(n,2),o=r[0],a=r[1],s=Object(O.default)(),p=Object.entries(e.tabs),x=e.onTab,y=Object.assign.apply(Object,[{}].concat(c()(p.map((function(e){var t=l()(e,2),n=t[0],r=t[1];return i()({},n,r.icon)})))));return Object(g.jsx)(d.TabView,{renderTabBar:function(e){return Object(g.jsx)(f.TabBar,m(m({},e),{},{indicatorStyle:{backgroundColor:"#2196F3"},style:{backgroundColor:b.default[s].background},activeColor:b.default[s].text,inactiveColor:b.default[s].text,renderIcon:function(e){return y[e.route.key]},onTabPress:function(e){return null==x?void 0:x(p.findIndex((function(t){var n=l()(t,2),r=n[0];n[1];return r==e.route.key})))}}))},navigationState:{index:o,routes:p.map((function(e){var n=l()(e,2),r=n[0],i=n[1];return{key:r,title:t(i.title)}}))},onIndexChange:a,renderScene:Object(j.SceneMap)(Object.assign.apply(Object,[{}].concat(c()(p.map((function(e){var t=l()(e,2),n=t[0],r=t[1];return i()({},n,r.component)})))))),tabBarPosition:e.tabBarPosition})}},473:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return d}));var r=n(17),i=n.n(r),o=n(0),c=n(262),a=n(31),l=n(372),s=n(265),u=n(12);function d(e){var t=o.useState(!1),n=i()(t,2),r=n[0],a=n[1];return Object(u.jsx)(l.default,{style:[f.outerContainer,e.outerContainerStyle,r?{backgroundColor:"rgb(242,242,242)"}:{}],onPressIn:function(){return a(!0)},onPress:function(){return null==e.onPress?void 0:e.onPress()},onPressOut:function(){return a(!1)},children:Object(u.jsx)(c.View,{style:[f.container,e.containerStyle],children:Object(u.jsx)(c.View,{style:[f.bodyView,e.bodyStyle],children:Object(u.jsx)(u.Fragment,{children:e.children})})})})}var f=a.default.create({outerContainer:{width:"100%",maxWidth:1080,alignItems:"stretch"},container:{marginHorizontal:20,backgroundColor:"transparent"},bodyView:{width:"100%",padding:10,minHeight:40,alignItems:"center",justifyContent:"center",borderBottomWidth:1,borderColor:s.default.borderColor,backgroundColor:"transparent"}})},476:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return x}));var r=n(0),i=n(609),o=n(114),c=n(361),a=n(328),l=n(279),s=n(346),u=n(275),d=n(262),f=n(94),j=n(117),b=n(291),O=n(265),h=n(115),g=n(318),p=n(336),m=n(12);function x(e){var t,n=e.id,y=Object(f.default)().lang,v=Object(h.default)(),w=Object(o.default)().auth,S=Object(u.default)().setModal,C=Object(c.default)(w),P=null==C?void 0:C.find((function(e){return e.id==n})),k=w.user&&P&&(null==(t=w.user)?void 0:t.id)==(null==P?void 0:P.id),E=Object(a.useMessengerChannelMutation)(),_=function(){S(x,null)};return Object(r.useEffect)((function(){n&&P||!C||_()}),[C]),Object(p.default)(_,[]),P?Object(m.jsxs)(g.BottomSheet,{children:[Object(m.jsxs)(d.View,{style:{flexDirection:"row",width:"100%"},children:[Object(m.jsx)(d.View,{style:{flex:1,flexDirection:"row"},children:Object(m.jsx)(b.TouchableOpacity,{onPress:_,children:Object(m.jsx)(j.Ionicons,{size:20,name:"arrow-back",color:O.default[v].text})})}),Object(m.jsx)(d.View,{style:{flex:1},children:Object(m.jsx)(d.Text,{style:{fontSize:20,textAlign:"center"},children:y("profile")})}),Object(m.jsx)(d.View,{style:{flex:1}})]}),Object(m.jsx)(d.View,{style:{marginBottom:20,height:1,width:"100%"},lightColor:"#ddd",darkColor:"rgba(255,255,255, 0.3)"}),Object(m.jsx)(i.default,{username:P.username,name:P.name,userId:P.id}),Object(m.jsx)(l.default,{title:y(k?"Chat with me":"1:1 Chat"),onPress:function(){var e;if(null!=w&&null!=(e=w.user)&&e.id&&w.groupId){var t,n={name:"",type:"messenger",owner:null==w||null==(t=w.user)?void 0:t.id,group:w.groupId,subowner:k?void 0:P.id};E.direct(n).then((function(e){return Object(s.navigate)("Main",{screen:"ChatScreen",params:{id:e.id}})}))}}})]}):Object(m.jsx)(m.Fragment,{})}},523:function(e,t,n){"use strict";n.r(t),n.d(t,"main",(function(){return Ve})),n.d(t,"login",(function(){return ze})),n.d(t,"modal",(function(){return Le}));var r=n(17),i=n.n(r),o=n(0),c=n.n(o),a=n(259),l=n(290),s=n(278),u=n(41),d=n(31),f=n(114),j=n(94),b=n(335),O=n(15),h=n(291),g=n(117),p=n(265),m=n(12),x="web"==O.default.OS?function(e){location.href=e}:b.default.openURL,y=function(e){return Object(m.jsxs)(u.default,{style:v.footer_buttons,children:[Object(m.jsx)(s.default,{style:v.footer_button,onPress:function(){return x("https://github.com/blacktokki/tokki-tok")},children:Object(m.jsx)(g.AntDesign,{name:"github",size:24,color:p.default[e.theme].iconColor})}),Object(m.jsx)(s.default,{style:v.footer_button,onPress:function(){return b.default.openURL("mailto:ydh051541@naver.com")},children:Object(m.jsx)(g.AntDesign,{name:"mail",size:24,color:p.default[e.theme].iconColor})})]})},v=d.default.create({footer_buttons:{width:"100%",flexDirection:"row",justifyContent:"flex-end",paddingBottom:20,paddingRight:20},footer_button:{alignItems:"center",justifyContent:"center",width:38,height:38,marginHorizontal:12,borderWidth:1,borderColor:"#E7E7E7",borderRadius:60}});var w=d.default.create({login_container:{flex:1,backgroundColor:"#FFF"},login_header:{alignItems:"center",paddingTop:30,paddingBottom:50,backgroundColor:"#208AEC"},login_header_logo:{width:220,resizeMode:"contain"},login_header_text:{marginTop:15,color:"#f0f0f0",fontSize:16},login_header_text_bold:{color:"#fff",fontWeight:"bold"},login_wrapper:{flex:1,justifyContent:"space-between",paddingTop:40,borderTopRightRadius:12,borderTopLeftRadius:12,backgroundColor:"#fff",alignItems:"center"},form:{width:"100%",maxWidth:320},form_error:{height:22,width:"100%"},form_error_text:{textAlignVertical:"center",color:"red",fontSize:13},form_input:{height:44,paddingHorizontal:20,marginBottom:20,backgroundColor:"#EDF0F7",borderRadius:50},button:{alignItems:"center",justifyContent:"center",height:44,backgroundColor:"#0065A4",borderRadius:50},button_label:{color:"#fff",fontSize:16},login_social:{width:"100%",maxWidth:280,marginTop:20},login_social_separator:{flexDirection:"row",alignItems:"center"},login_social_separator_line:{flex:1,width:"100%",height:1,backgroundColor:"#E0E0E0"},login_social_separator_text:{marginHorizontal:10,color:"#808080",fontSize:16},login_social_buttons:{flexDirection:"row",justifyContent:"center",marginTop:20},login_social_button:{alignItems:"center",justifyContent:"center",width:60,height:60,marginHorizontal:12,borderWidth:1,borderColor:"#E7E7E7",borderRadius:60},login_social_icon:{width:38,height:38,resizeMode:"contain"},login_social_facebook:{backgroundColor:"#4267B2",borderColor:"#4267B2"},login_footer_text:{flexDirection:"row",alignItems:"center",color:"#808080",fontSize:14},guest_footer_text:{flexDirection:"row",alignSelf:"center",color:"#808080",fontSize:15,margin:15},login_footer_link:{color:"#208AEC",fontSize:15,fontWeight:"bold"}}),S=n(279),C=n(455),P=n(457),k=n(380),E=n(115),_=n(262),M=n(328),D=n(120),T=n(313),R=n(45),I=n.n(R),V=n(347),z=Object(o.createContext)({lastJsonMessage:void 0,sendJsonMessage:function(){}}),L=function(e){var t=e.disable,n=e.children;return t?Object(m.jsx)(m.Fragment,{}):Object(m.jsx)(V.WebSocketInternalProvider,{path:"messenger/ws/rtc/",Context:z,useBackground:!0,children:n})},B=function(){return Object(o.useContext)(z)},A=n(360),F=n(4),U=n.n(F),H=n(376),W=n(53);console.log(W.TURN_SERVER?"use turn server":"use stun server");var G={iceServers:[W.TURN_SERVER?JSON.parse(W.TURN_SERVER):{urls:"stun:stun.l.google.com:19302"}]},N={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0,VoiceActivityDetection:!0}},Q={audio:!0,video:{framerate:30}},J=function(e,t){var n=t.data.rtcMessage,r=new H.RTCIceCandidate(n);e&&(console.log("ICE candidate Added"),e.addIceCandidate(r))},K=function(e,t,n,r){e.candidate&&t({type:"ICEcandidate",receiver:n,data:{target:r,rtcMessage:e.candidate}})},Y=function(){var e=U()((function*(e,t,n,r,i){n&&e.pc.addStream(n);var o=function(e){var t=e.sdp.split("\r\n");return t.forEach((function(e,n){/^a=fmtp:\d*/.test(e)?t[n]=e+";x-google-max-bitrate=8000;x-google-min-bitrate=8000;x-google-start-bitrate=8000":/^a=mid:(0|video)/.test(e)&&(t[n]+="\r\nb=AS:8000")})),new H.RTCSessionDescription({type:e.type,sdp:t.join("\r\n")})}(yield e.pc.createOffer(N));yield e.pc.setLocalDescription(o),t({type:"call",receiver:e.receiver,data:{target:r,name:null==i?void 0:i.name,rtcMessage:o}})}));return function(t,n,r,i,o){return e.apply(this,arguments)}}(),$=d.default.create({container:{flex:1},cam:{flex:1,height:"100%"},bottonContainer:{position:"absolute",bottom:0,justifyContent:"flex-end"},buttonBar:{flexDirection:"row",justifyContent:"space-around"},label:{backgroundColor:"#0008",color:"white",paddingHorizontal:5}}),q=function(e){var t,n=B(),r=n.lastJsonMessage,l=function(e){var t=Object(o.useRef)({}),n=Object(o.useState)(),r=i()(n,2),a=r[0],l=r[1],s=Object(o.useState)(),u=i()(s,2),d=u[0],f=u[1],j=Object(o.useMemo)((function(){return!!d}),[d]),b=Object(o.useCallback)(c.a.memo((function(e){var t=e.style;return d?Object(m.jsx)(H.RTCView,{stream:d,style:t,videoProps:{height:"100%"}}):Object(m.jsx)(m.Fragment,{})})),[d]);return{start:Object(o.useCallback)(function(){var n=U()((function*(n,r,o){if(console.log("start"),!d||void 0!==o)try{var c;c="camera"==o?yield H.mediaDevices.getUserMedia(Q):"display"==o?yield H.mediaDevices.getDisplayMedia(Q):r||(yield H.mediaDevices.getUserMedia(Q).catch((function(e){return H.mediaDevices.getDisplayMedia(Q)}))),f(c),Object.entries(t.current).map((function(t){var r=i()(t,2),o=(r[0],r[1]);Y(o,e,c,"guest",n)}))}catch(a){console.error(a)}}));return function(e,t,r){return n.apply(this,arguments)}}(),[d]),stop:Object(o.useCallback)((function(){console.log("stop"),d&&(d.getTracks().map((function(e){return e.stop()})),f(void 0))}),[d]),websocketOnMessage:function(){var n=U()((function*(n,r){var i=n.type;if("connection"==i&&l(n.data.channel_name),"start"==i&&"host"==n.data.target){console.log("1 start");var o=new H.RTCPeerConnection(G);o.addEventListener("icecandidate",(function(t){return K(t,e,n.sender,"guest")})),t.current[n.sender]={pc:o,receiver:n.sender},Y(t.current[n.sender],e,d,"guest",r)}if("answer"==i&&"host"==n.data.target){console.log("3 answer");var c=t.current[n.sender].pc,a=new H.RTCSessionDescription(n.data.rtcMessage);yield c.setRemoteDescription(a)}if("ICEcandidate"==i&&"host"==n.data.target){var s=t.current[n.sender].pc;J(s,n)}}));return function(e,t){return n.apply(this,arguments)}}(),CustomRTCView:b,isPlay:j,sender:a}}(n.sendJsonMessage),s=l.start,d=l.stop,f=l.websocketOnMessage,j=l.CustomRTCView,b=l.isPlay;return Object(o.useEffect)((function(){e.user&&r&&f(r,e.user)}),[r,e.user]),Object(o.useEffect)((function(){return e.mode&&!b?e.user&&s(e.user,void 0,e.mode):null===e.mode&&b&&d(),function(){b&&d()}}),[b,e.user,e.mode]),Object(m.jsxs)(u.default,{style:$.container,children:[Object(m.jsx)(j,{style:$.cam}),Object(m.jsxs)(u.default,{style:$.bottonContainer,children:[Object(m.jsx)(u.default,{style:$.buttonBar}),Object(m.jsx)(u.default,{style:{flexDirection:"row"},children:Object(m.jsx)(a.default,{style:$.label,children:null==(t=e.user)?void 0:t.name})}),Object(m.jsxs)(u.default,{style:$.buttonBar,children:[void 0===e.mode&&!b&&Object(m.jsx)(A.default,{title:"Start",onPress:function(){return e.user&&s(e.user)}}),void 0===e.mode&&b&&Object(m.jsx)(A.default,{title:"Stop",onPress:d})]})]})]})},Z=function(e){var t=Object(o.useState)(""),n=i()(t,2),r=n[0],s=n[1],d=B(),f=d.lastJsonMessage,j=function(e){var t=Object(o.useRef)({}),n=Object(o.useState)(),r=i()(n,2),a=r[0],l=r[1],s=Object(o.useState)(),u=i()(s,2),d=u[0],f=u[1],j=Object(o.useCallback)(c.a.memo((function(e){return d?Object(m.jsx)(H.RTCView,{stream:d,style:e,videoProps:{height:"100%"}}):Object(m.jsx)(m.Fragment,{})})),[d]),b=Object(o.useMemo)((function(){return!!d}),[d]),O=Object(o.useCallback)((function(n){console.log("start"),t.current.pc||(t.current.pc=new H.RTCPeerConnection(G),t.current.receiver=n),d||e({type:"start",receiver:n,data:{target:"host"}})}),[d]),h=function(){console.log("stop"),t.current.pc&&(f(void 0),t.current.pc.close(),t.current.pc=void 0,t.current.receiver=void 0,clearInterval(t.current.statsInterval))};return{start:O,stop:h,websocketOnMessage:function(){var n=U()((function*(n){var r,i,o,c,s=n.type;if("start"==s&&"guest"==n.data.target&&n.sender==(null==(r=t.current)?void 0:r.receiver)){console.log("(remote)1 start");var u=t.current.pc;l({name:n.data.name}),u.addEventListener("icecandidate",(function(t){return K(t,e,n.sender,"host")})),u.addEventListener("iceconnectionstatechange",(function(e){if("connected"==t.current.pc.iceConnectionState){var n=!1;t.current.statsInterval=setInterval(U()((function*(){var e=yield t.current.pc.getStats(null),r="",i=void 0;e.forEach((function(e){"inbound-rtp"===e.type&&"video"===e.kind&&(Object.keys(e).forEach((function(t){r+=t+": "+e[t]+"\n"})),i=e.framesPerSecond)})),console.log(n,i),void 0!=i?n=!0:n&&h(),console.log((new Date).toTimeString().split(" ")[0],r)})),1e3)}else"failed"==t.current.pc.iceConnectionState&&h()})),u.addTransceiver("video",{direction:"recvonly"}),yield Y({pc:t.current.pc,receiver:n.sender},e,d,"host",a)}if("answer"==s&&"guest"==n.data.target&&n.sender==(null==(i=t.current)?void 0:i.receiver)){console.log("(remote)3 answer");var j=new H.RTCSessionDescription(n.data.rtcMessage);yield t.current.pc.setRemoteDescription(j);var b=t.current.pc.getRemoteStreams();f(b[b.length-1]),e({type:"end",receiver:t.current.receiver,data:{}})}if("call"==s&&n.sender==(null==(o=t.current)?void 0:o.receiver)){console.log("2 call");var O=t.current.pc;if(l({name:n.data.name}),!O)return;O.addEventListener("icecandidate",(function(t){return K(t,e,n.sender,"host")}));var g=new H.RTCSessionDescription(n.data.rtcMessage);yield O.setRemoteDescription(g);var p=yield O.createAnswer(N);yield O.setLocalDescription(p),e({type:"answer",receiver:t.current.receiver,data:{target:"host",rtcMessage:O.localDescription}});var m=t.current.pc.getRemoteStreams();f(m[m.length-1])}"ICEcandidate"==s&&"guest"==n.data.target&&n.sender==(null==(c=t.current)?void 0:c.receiver)&&J(t.current.pc,n)}));return function(e){return n.apply(this,arguments)}}(),CustomRTCView:j,user:a,isPlay:b}}(d.sendJsonMessage),b=j.start,O=j.stop,h=j.websocketOnMessage,g=j.CustomRTCView,p=j.isPlay,x=j.user;return Object(o.useEffect)((function(){f&&h(f)}),[f]),Object(o.useEffect)((function(){return e.receiver&&b(e.receiver),function(){return O()}}),[e.receiver]),Object(m.jsxs)(u.default,{style:$.container,children:[Object(m.jsx)(g,{style:$.cam}),Object(m.jsxs)(u.default,{style:$.bottonContainer,children:[Object(m.jsx)(u.default,{style:$.buttonBar}),Object(m.jsx)(u.default,{style:{flexDirection:"row"},children:e.receiver||p?Object(m.jsx)(a.default,{style:$.label,children:(null==x?void 0:x.name)||"loading..."}):Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(a.default,{style:{borderWidth:1},children:"Receiver:\xa0"}),Object(m.jsx)(l.default,{style:{borderWidth:1,flex:1},value:r,onChangeText:s})]})}),Object(m.jsxs)(u.default,{style:$.buttonBar,children:[void 0===e.receiver&&!p&&Object(m.jsx)(A.default,{title:"Start",onPress:function(){return b(r)}}),void 0===e.receiver&&p&&Object(m.jsx)(A.default,{title:"Stop",onPress:O})]})]})]})},X=n(286),ee=function(e){return Object(m.jsx)(u.default,{style:[{maxWidth:e.scale,maxHeight:e.scale,borderWidth:1,borderColor:p.default.borderColor,backgroundColor:"gray",flexDirection:"row",flexGrow:1},void 0==e.focusGuest||e.focusGuest==e.receiver?{height:"100%"}:{maxWidth:0,height:0}],children:Object(m.jsx)(h.TouchableOpacity,{style:{flex:1},containerStyle:{flex:1,justifyContent:"center"},onPress:function(){return e.setFocusGuest(e.focusGuest?void 0:e.receiver)},children:e.children})})},te=function(e){var t,n=e.channel_id,r=e.disable,c=e.setDisable,a=Object(f.default)().auth,l=Object(D.default)(),s=Object(o.useState)(null),d=i()(s,2),j=d[0],b=d[1],O=Object(o.useState)([]),h=i()(O,2),x=h[0],y=h[1],v=Object(o.useState)(),w=i()(v,2),C=w[0],P=w[1],k=Object(X.default)(),E=B(),M=E.lastJsonMessage,T=E.sendJsonMessage;Object(o.useEffect)((function(){if(null!=M&&("connection"==M.type&&T({type:"broadcast",data:{channel_id:n}}),"broadcast_guest"!=M.type&&"broadcast_host"!=M.type||y([].concat(I()(x),[M.sender])),"broadcast_disconnect"==M.type)){var e=M.sender;x.find((function(t){return t==e}))&&y(x.filter((function(t){return t!=e})))}}),[M]);var R=C?"100%":100/Math.max(2,Math.ceil(Math.sqrt(x.length+1)))+"%",V=function(e){b(j!=e?e:null)};return void 0!==M?Object(m.jsxs)(_.View,{style:[{aspectRatio:r?0:16/9,borderColor:p.default.borderColor,borderRadius:10},"landscape"==k?{flexShrink:1,flexGrow:0,height:"100%",borderLeftWidth:1,paddingBottom:65}:{maxHeight:"36%",width:"100%",borderBottomWidth:1}],children:[Object(m.jsxs)(u.default,{style:{aspectRatio:C?void 0:16/9,backgroundColor:"white",flexWrap:"wrap",flexDirection:"row",width:"100%",height:"100%"},children:[x.map((function(e,t){return Object(m.jsx)(ee,{scale:R,focusGuest:C,setFocusGuest:P,receiver:e,children:Object(m.jsx)(Z,{receiver:e})})})),Object(m.jsx)(ee,{scale:R,focusGuest:C,setFocusGuest:P,receiver:null==(t=a.user)?void 0:t.name,children:Object(m.jsx)(q,{user:a.user,mode:j})})]}),Object(m.jsxs)(_.View,{style:[{position:"absolute",alignItems:"center",justifyContent:"flex-end",width:"100%",flexDirection:"row"},"landscape"==k?{bottom:0,paddingTop:15,paddingBottom:10,paddingHorizontal:19}:{backgroundColor:"transparent"}],children:[Object(m.jsx)(S.default,{title:"\u23fa\ufe0f",style:{height:40,paddingTop:8},onPress:function(){return V("camera")}}),!l&&Object(m.jsx)(S.default,{title:"\ud83d\udda5\ufe0f",style:{height:40,paddingTop:8},onPress:function(){return V("display")}}),Object(m.jsx)(S.default,{title:"",style:{height:40,paddingTop:8},onPress:function(){return c(!0)},children:Object(m.jsx)(g.Ionicons,{size:20,name:"arrow-back",color:"deepskyblue"})})]})]}):Object(m.jsx)(m.Fragment,{})},ne=c.a.memo((function(e){var t=e.channel_id,n=e.disable,r=e.setDisable;return Object(m.jsx)(L,{disable:n,children:Object(m.jsx)(te,{channel_id:t,disable:n,setDisable:r})})})),re=n(275),ie=n(720),oe=n(606),ce=n(721),ae=n(406),le=n(456),se=function(e){return Object(m.jsxs)(u.default,{style:{backgroundColor:"lightgray",borderRadius:20,overflow:"hidden",margin:5},children:[Object(m.jsx)(u.default,{style:{backgroundColor:"darkgray",position:"absolute",width:100*(e.data.progress||0)+"%",height:"100%"}}),Object(m.jsxs)(u.default,{style:{paddingVertical:5,paddingHorizontal:5,flexDirection:"row"},children:[Object(m.jsx)(_.Text,{children:"\ud83d\udce4"}),Object(m.jsx)(u.default,{style:{paddingHorizontal:5},children:Object(m.jsx)(_.Text,{children:e.data.filename})})]})]})},ue=function(e){var t=Object(le.default)().upload,n=Object(o.useState)(),r=i()(n,2),c=r[0],a=r[1],l=t[e.channel_id];return Object(m.jsx)(u.default,{style:{flexDirection:"row",paddingTop:5,paddingHorizontal:((null==l?void 0:l.length)||0)>0?20:0},children:null==l?void 0:l.map((function(e,t){return Object(m.jsx)(se,{data:e,index:t,isExpand:t==c,setExpand:a},t)}))})},de=n(718),fe=n(1148),je=n(850),be=function(e){return Object(m.jsx)(fe.Editor,{tinymceScriptSrc:"/tokki-tok/tinymce/tinymce.min.js",onInit:function(t,n){null==e.onReady||e.onReady()},onEditorChange:e.setValue,init:{plugins:je.plugins,toolbar:je.toolbar,height:"100%",skin:"light"==e.theme?"oxide":"oxide-dark",content_css:"light"==e.theme?"default":"dark",menubar:!1,branding:!1,statusbar:!1,block_formats:"\uc81c\ubaa91=h2;\uc81c\ubaa92=h3;\uc81c\ubaa93=h4;\ubcf8\ubb38=p;",fontsize_formats:"11pt 14pt 18pt 24pt"},value:e.value})},Oe=function(e){var t=Object(o.useState)(!1),n=i()(t,2),r=n[0],c=n[1];return Object(o.useEffect)((function(){e.active||c(!1)}),[e.active]),e.active?Object(m.jsxs)(u.default,{style:{flex:1,height:"100%"},children:[!r&&e.children,Object(m.jsx)(be,{theme:e.theme,value:e.value,setValue:e.setValue,onReady:function(){r||(c(!0),null==e.onReady||e.onReady())}})]}):Object(m.jsx)(m.Fragment,{children:e.children})};var he=n(303),ge=n(263),pe=n(471),me=n(399),xe=n(361),ye=n(473),ve=n(603),we=n(476),Se=n(346),Ce=n(319),Pe=n(99),ke=n(610),Ee=n(408),_e=function(e){var t=e.title,n=e.children,r=Object(E.default)(),i=p.default[r].text;return Object(m.jsxs)(Ce.default,{bodyStyle:{alignItems:"flex-start",backgroundColor:"light"==r?"transparent":"black"},children:[Object(m.jsx)(a.default,{style:{fontSize:20,color:i,fontWeight:"600"},children:t}),n]})},Me=function(){var e,t=Object(j.default)(),n=t.lang,r=t.locale,o=t.setLocale,c=Object(re.default)().setModal,a=Object(f.default)().auth,l=Object(E.default)(),s=Object(Pe.useColorScheme)(),d=Object(ke.default)(),b=d.enable,O=d.setEnable,h=p.default[l].text;return Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(_e,{title:n("* Notification Settings"),children:Object(m.jsx)(u.default,{style:{flexDirection:"row"},children:[[n("On"),!0],[n("Off"),!1]].map((function(e){var t=i()(e,2),n=t[0],r=t[1];return Object(m.jsx)(me.default,{title:n||"",textStyle:{fontSize:16,color:h,textDecorationLine:b==r?"underline":"none"},style:{borderRadius:20},onPress:function(){O(r)}},n)}))})}),Object(m.jsx)(_e,{title:n("* Language Settings"),children:Object(m.jsx)(u.default,{style:{flexDirection:"row"},children:[[n("Auto"),"auto"],["\ud55c\uad6d\uc5b4","ko"],["English","en"]].map((function(e){var t=i()(e,2),n=t[0],c=t[1];return Object(m.jsx)(me.default,{title:n||"",textStyle:{fontSize:16,color:h,textDecorationLine:r==c?"underline":"none"},style:{borderRadius:20},onPress:function(){return o(c)}},n)}))})}),Object(m.jsx)(_e,{title:n("* Skin Settings"),children:Object(m.jsx)(u.default,{style:{flexDirection:"row"},children:[[n("Auto"),"no-preference"],[n("Light"),"light"],[n("Dark"),"dark"]].map((function(e){var t=i()(e,2),n=t[0],r=t[1];return Object(m.jsx)(me.default,{title:n,textStyle:{fontSize:16,color:h,textDecorationLine:s==r?"underline":"none"},style:{borderRadius:20},onPress:function(){return Object(E.setColorScheme)(r)}},n)}))})}),!(null!=(e=a.user)&&e.is_guest)&&Object(m.jsx)(Ce.default,{bodyStyle:{alignItems:"flex-start",backgroundColor:"light"==l?"transparent":"black"},children:Object(m.jsx)(me.default,{title:n("> Account Settings"),textStyle:{fontSize:20,color:h},style:{paddingLeft:0,borderRadius:20},onPress:function(){var e;return c(Ee.default,{id:null==(e=a.user)?void 0:e.id})}})})]})},De=function(){var e=Object(f.default)().auth,t=Object(E.default)(),n=Object(re.default)().setModal,r=Object(xe.default)(e),i=c.a.useMemo((function(){return r&&r.map((function(e,t){return Object(m.jsx)(ve.default,{member:e,onPress:function(){return n(we.default,{id:e.id})}},t)}))}),[r]);return Object(m.jsx)(he.default,{style:{flex:1,backgroundColor:p.default[t].background},children:i})},Te=function(){var e=Object(f.default)().auth,t=Object(M.useMessengerChannelSorted)(e),n=Object(E.default)(),r=(new Date).toISOString().slice(0,10);return Object(m.jsx)(he.default,{style:{flex:1,backgroundColor:p.default[n].background},children:null==t?void 0:t.map((function(t,i){var o,c,a,l,s=Object(T.avatarFromChannel)(t,e.user),d=s.avatar,f=s.name,j=null==(o=t.last_message)?void 0:o.created.slice(0,10),b=(null==(c=t.last_message)?void 0:c.preview_content)||(null==(a=t.last_message)?void 0:a.content)||"";return Object(m.jsxs)(ye.default,{bodyStyle:{flexDirection:"row",justifyContent:"space-between"},onPress:function(){return Object(Se.navigate)("ChatScreen",{id:t.id})},children:[Object(m.jsxs)(u.default,{style:{flexDirection:"row",flexShrink:1},children:[d?Object(m.jsx)(u.default,{style:{marginRight:20},children:Object(m.jsx)(T.default,{name:d.name,size:44,userId:d.id})}):Object(m.jsx)(g.FontAwesome,{size:40,color:p.default[n].iconColor,style:{marginBottom:-3,marginRight:20},name:"users"}),Object(m.jsxs)(u.default,{children:[Object(m.jsxs)(u.default,{style:{flexDirection:"row"},children:[Object(m.jsx)(_.Text,{style:{fontSize:18},children:f}),Object(m.jsx)(_.Text,{style:{fontSize:18,opacity:.4,paddingLeft:5},children:t.member_count})]}),Object(m.jsx)(_.Text,{style:{fontSize:16,opacity:.4},children:b.replaceAll("\n"," ")})]})]}),Object(m.jsxs)(u.default,{children:[Object(m.jsx)(_.Text,{style:{fontSize:14,opacity:.4,textAlign:"right"},children:j==r?null==(l=t.last_message)?void 0:l.created.slice(11,16):j}),Object(m.jsx)(_.Text,{style:{fontSize:14,textAlign:"right"},children:t.unread_count?t.unread_count:" "})]})]},i)}))})},Re=function(){var e=Object(E.default)();return Object(m.jsx)(he.default,{style:{flex:1,backgroundColor:p.default[e].background},children:Object(m.jsx)(Me,{})})},Ie=function(e){var t=p.default[e].iconColor;return{OneTab:{title:"member",component:De,icon:Object(m.jsx)(g.MaterialCommunityIcons,{size:32,color:t,style:{marginBottom:-3},name:"account"})},TwoTab:{title:"chat",component:Te,icon:Object(m.jsx)(g.Ionicons,{size:30,color:t,style:{marginBottom:-3},name:"chatbox"})},FourTab:{title:"config",component:Re,icon:Object(m.jsx)(g.SimpleLineIcons,{size:30,color:t,style:{marginBottom:-3},name:"options"})}}};var Ve={HomeScreen:{title:"home",component:function(e){var t,n=e.navigation,r=e.route,c=Object(j.default)(),a=c.lang,l=c.locale,s=Object(X.default)(),d=Object(E.default)(),b=Object(re.default)().setModal,O=Object(f.default)().auth,h=Object(o.useState)("landscape"==s),g=i()(h,2),x=g[0],v=g[1],w=p.default[d].text,S=[{title:a("member"),headerRight:function(){return Object(m.jsx)(P.default,{extra:[{title:a("create"),onPress:function(){var e;return b(Ee.default,null!=(e=O.user)&&e.is_guest?{id:O.user.id}:{})}}]})}},{title:a("chat"),headerRight:function(){return Object(m.jsx)(P.default,{extra:[{title:a("create"),onPress:function(){return b(ae.default,{type:"messenger"})}}]})}},{title:a("config"),headerRight:function(){return Object(m.jsx)(P.default,{})}}];return Object(o.useLayoutEffect)((function(){var e,t=0|(null==r||null==(e=r.params)?void 0:e.tab);n.setOptions("portrait"==s?S[t]:{title:a("home"),headerRight:function(){return Object(m.jsx)(P.default,{})}})}),[n,r,s,l]),Object(o.useEffect)((function(){v("landscape"==s)}),[s]),x?Object(m.jsxs)(he.default,{contentContainerStyle:{flex:1,alignItems:"center"},children:[Object(m.jsxs)(u.default,{style:{flexGrow:1,width:"80%",marginTop:72},children:[Object(m.jsx)(ge.default,{style:{fontSize:32,color:w},children:"Tokki Tok"}),Object(m.jsx)(u.default,{style:{backgroundColor:p.default.borderColor,height:1,width:"100%"}}),Object(m.jsx)(u.default,{style:{height:24}}),Object(m.jsx)(Ce.default,{bodyStyle:{alignItems:"flex-start",backgroundColor:"light"==d?"transparent":"black"},children:Object(m.jsx)(me.default,{title:a("+ New chat"),textStyle:{fontSize:20,color:w},style:{paddingLeft:0,borderRadius:20},onPress:function(){return b(ae.default,{type:"messenger"})}})}),Object(m.jsx)(Me,{})]}),Object(m.jsx)(y,{theme:d})]}):Object(m.jsx)(pe.default,{tabs:Ie(d),tabBarPosition:"bottom",index:parseInt((null==(t=r.params)?void 0:t.tab)||0),onTab:function(e){n.setParams({tab:e})}})},path:"home"},ChatScreen:{title:"chat",component:function(e){var t,n,r=e.navigation,c=e.route,a=Object(j.default)(),l=a.lang,s=a.locale,d=Object(D.default)(),b=null==c||null==(t=c.params)?void 0:t.id,x=Object(o.useRef)(null),y=Object(f.default)().auth,v=Object(re.default)().setModal,w=null==(n=Object(M.default)(y))?void 0:n.find((function(e){return e.id==parseInt(b)})),R=w?Object(T.avatarFromChannel)(w,y.user):void 0,I=Object(k.default)(b),V=Object(o.useMemo)((function(){var e;return null==I||null==(e=I.find((function(e){var t;return e.user==(null==(t=y.user)?void 0:t.id)})))?void 0:e.id}),[y,I]),z=Object(X.default)(),L=Object(o.useState)(""),B=i()(L,2),A=B[0],F=B[1],U=Object(o.useState)(""),H=i()(U,2),W=H[0],G=H[1],N=Object(o.useState)(),Q=i()(N,2),J=Q[0],K=Q[1],Y=Object(o.useState)(null),$=i()(Y,2),q=$[0],Z=$[1],ee=Object(o.useState)(!1),te=i()(ee,2),le=te[0],se=te[1],fe=Object(o.useState)(!1),je=i()(fe,2),be=je[0],he=je[1],ge=Object(o.useState)(!1),pe=i()(ge,2),me=pe[0],xe=pe[1],ye=Object(o.useState)(),ve=i()(ye,2),we=ve[0],Se=ve[1],Ce=Object(o.useMemo)((function(){return be?1:A.split("\n").length}),[A,be]),Pe=Object(E.default)(),ke=function(){if(A.length>0){var e,t;if(me)Ee.create({channel:b,user:null==(e=y.user)?void 0:e.id,content:"",timer:J,editor:{title:A,content:W}});else Ee.create({channel:b,user:null==(t=y.user)?void 0:t.id,content:A,timer:J});K(void 0),he(!1),F(""),Z(!0),me&&(G(""),xe(!1))}};Object(o.useEffect)((function(){we&&(xe(!1),F(A.concat(A.length>0?"\n":"",we.value)),G(W.concat("\r\n",we.editorValue)),Se(void 0),xe(!0))}),[we,A,W]);var Ee=Object(C.useMessengerContentMutation)();Object(o.useLayoutEffect)((function(){r.setOptions({headerRight:function(){return Object(m.jsx)(P.default,{extra:[{title:l("invite"),onPress:function(){return v(ie.default,{id:b})}},{title:l("setting"),onPress:function(){return v(ae.default,{id:b,type:"messenger",member_id:V})}}]})},title:null==R?void 0:R.name,headerShown:!("portrait"==z&&me)})}),[r,c,V,s,z,me]);var _e=function(){r.canGoBack()?r.goBack():r.navigate("HomeScreen",{tab:2})};return Object(o.useEffect)((function(){v(null,null),b||_e()}),[c]),Object(o.useEffect)((function(){(null===I||void 0!=I&&void 0==I.find((function(e){var t;return e.user==(null==(t=y.user)?void 0:t.id)})))&&_e()}),[I]),Object(o.useEffect)((function(){q&&(null==x.current.focus||x.current.focus(),Z(!1))}),[q]),Object(o.useEffect)((function(){if(null==q&&!d){var e=setTimeout((function(){return Z(!0)}),500);return function(){return clearTimeout(e)}}})),Object(m.jsxs)(u.default,{style:[{flex:1,alignItems:"center"},"landscape"==z?{flexDirection:"row-reverse",minWidth:480}:{flexDirection:"column"}],children:[Object(m.jsx)(ne,{channel_id:b,setDisable:function(e){return se(!e)},disable:!le}),Object(m.jsxs)(u.default,{style:[le?{flexShrink:1}:{flex:1},"landscape"==z?{minWidth:320,height:"100%"}:{width:"100%"}],children:[Object(m.jsx)(de.default,{channel_id:b,auth:y,reverse:!0,sendToScreen:Se}),Object(m.jsxs)(u.default,{style:{position:"absolute",flexDirection:"row"},children:[Object(m.jsx)(ue,{channel_id:b}),Object(m.jsx)(ce.default,{channel_id:b})]}),Object(m.jsxs)(_.View,{style:[{bottom:0,width:"100%",paddingTop:15,paddingBottom:10,paddingHorizontal:19},me?{height:"landscape"==z?"50%":"100%"}:{}],children:[Object(m.jsxs)(u.default,{style:{alignItems:"center",width:"100%",flexDirection:"row"},children:[Object(m.jsx)(S.default,{title:"",style:{height:"100%",paddingTop:8,borderTopRightRadius:0,borderBottomRightRadius:0,justifyContent:"center"},onPress:function(){me?xe(!1):he(!be)},children:Object(m.jsx)(u.default,{style:{top:-2},children:Object(m.jsx)(g.Entypo,{name:me||be?"cross":"plus",size:24,color:p.default[Pe].text})})}),J&&Object(m.jsx)(S.default,{style:{height:"100%",paddingTop:8,borderRadius:0},title:"\u231a"+Object(ce.timerFormat)(J),onPress:function(){v(oe.default,{datetime:J,callback:function(e){return K(e)}}),he(!1)}}),Object(m.jsx)(h.TextInput,{ref:x,value:A,onChangeText:F,onKeyPress:function(e){if(!d){var t=e;t.shiftKey||"Enter"!==t.key||(ke(),t.preventDefault())}},style:{flex:1,borderWidth:1,minHeight:41,borderColor:p.default.borderColor,backgroundColor:p.default[Pe].background,color:p.default[Pe].text,paddingVertical:1,paddingHorizontal:3},onFocus:function(){return he(!1)},multiline:!0,numberOfLines:Ce}),Object(m.jsx)(S.default,{style:{height:"100%",paddingTop:8,borderTopLeftRadius:0,borderBottomLeftRadius:0,justifyContent:"center"},title:"\ud83d\udcac",onPress:ke})]}),Object(m.jsx)(Oe,{theme:Pe,active:me,value:W,setValue:G,onReady:function(){return he(!1)}}),be&&Object(m.jsxs)(u.default,{style:{alignItems:"center",width:"100%",flexDirection:"row",paddingTop:15,paddingBottom:5},children:[Object(m.jsx)(S.default,{style:{height:80,flex:1,justifyContent:"center",marginRight:15},title:"\ud83d\udce4\n "+l("File"),onPress:function(){return new Promise((function(e,t){if("web"==O.default.OS){var n=document.createElement("input");n.type="file",n.onchange=function(t){e(t.target.files[0])},n.onabort=t,n.onerror=t,n.click()}else e(void 0)})).then((function(e){var t;Ee.create({channel:b,user:null==(t=y.user)?void 0:t.id,content:"",file:e}),he(!1)}))}}),Object(m.jsx)(S.default,{style:{height:80,flex:1,justifyContent:"center",marginRight:15},title:"\u270f\ufe0f\n "+l("Editor"),onPress:function(){xe(!me),me&&he(!1)}}),Object(m.jsx)(S.default,{style:{height:80,flex:1,justifyContent:"center",marginRight:15},title:"\u231a\n "+l("Timer"),onPress:function(){v(oe.default,{datetime:J,callback:function(e){return K(e)}}),he(!1)}}),Object(m.jsx)(S.default,{style:{height:80,flex:1,justifyContent:"center"},title:"\ud83d\udcf9\n "+l("Video Call"),onPress:function(){se(!le),he(!1)},disabled:le})]})]})]})]})},path:"chat"}},ze={LoginScreen:{path:"login",title:"Sign in",component:function(e){var t=e.navigation,n=(e.route,Object(j.default)().lang),r=Object(o.useState)(""),c=i()(r,2),d=c[0],b=c[1],O=Object(o.useState)(""),h=i()(O,2),g=h[0],p=h[1],x=Object(f.default)(),v=x.error,S=x.dispatch,C=function(){return S({type:"LOGIN_REQUEST",username:d,password:g})};return Object(o.useEffect)((function(){t.setOptions({headerRight:void 0})}),[t]),Object(m.jsxs)(u.default,{style:w.login_container,children:[Object(m.jsxs)(u.default,{style:w.login_wrapper,children:[Object(m.jsxs)(u.default,{style:w.form,children:[v&&Object(m.jsx)(u.default,{style:w.form_error,children:Object(m.jsx)(a.default,{style:w.form_error_text,children:n(v)})}),Object(m.jsx)(l.default,{style:w.form_input,value:d,placeholder:n("Username"),onChangeText:function(e){return b(e)},autoCapitalize:"none",keyboardType:"email-address",onSubmitEditing:C}),Object(m.jsx)(l.default,{style:w.form_input,value:g,placeholder:n("Password"),secureTextEntry:!0,onChangeText:function(e){return p(e)},onSubmitEditing:C}),Object(m.jsx)(s.default,{onPress:C,children:Object(m.jsx)(u.default,{style:w.button,children:Object(m.jsx)(a.default,{style:w.button_label,children:n("Sign in")})})}),Object(m.jsx)(s.default,{onPress:function(){return S({type:"LOGIN_GUEST"})},children:Object(m.jsx)(a.default,{style:w.guest_footer_text,children:n("Sign in as guest")})})]}),Object(m.jsxs)(u.default,{style:w.login_social,children:[Object(m.jsxs)(u.default,{style:w.login_social_separator,children:[Object(m.jsx)(u.default,{style:w.login_social_separator_line}),Object(m.jsx)(a.default,{style:w.login_social_separator_text,children:"*"}),Object(m.jsx)(u.default,{style:w.login_social_separator_line})]}),Object(m.jsx)(u.default,{style:w.login_social_buttons})]})]}),Object(m.jsx)(y,{theme:"light"})]})}},DemoScreen:{title:"",component:function(e){var t=e.navigation,n=Object(f.default)().dispatch;return Object(o.useLayoutEffect)((function(){t.setOptions({headerRight:void 0}),n({type:"LOGIN_GUEST"})}),[]),Object(m.jsx)(m.Fragment,{})},path:"demo"}},Le={}},571:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return d}));n(0);var r=n(114),i=n(279),o=n(275),c=n(262),a=n(94),l=n(318),s=n(336),u=n(12);function d(e){var t=e.type,n=Object(a.default)().lang,f=Object(o.default)().setModal,j=Object(r.default)().dispatch,b=function(){f(d,null)},O={GUEST_LOGOUT:{message:"Guest users cannot reconnect after logging out. Please create an account or log in.",title:"sign out",onPress:function(){return j({type:"LOGOUT_REQUEST"})}}};return Object(s.default)(b,[]),Object(u.jsxs)(l.BottomSheet,{children:[Object(u.jsx)(c.Text,{children:n(O[t].message)}),Object(u.jsxs)(c.View,{style:{width:"100%",flexDirection:"row",justifyContent:"flex-end"},children:[Object(u.jsx)(i.default,{title:n(O[t].title),onPress:O[t].onPress}),Object(u.jsx)(i.default,{title:n("cancel"),onPress:function(){return b()}})]})]})}},599:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return a}));var r=n(4),i=n.n(r),o=n(71),c=n(72);function a(e){return Object(o.useQuery)(["UserMembershipList",e],i()((function*(){return e?yield Object(c.getExternalMembershipList)(e):[]}))).data}},600:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return u}));var r=n(10),i=n.n(r),o=(n(0),n(601)),c=n(470),a=n(12);function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function u(e){return Object(a.jsx)(c.default,{name:e.name,width:e.width,textStyle:e.textStyle,children:Object(a.jsx)(o.default,s({},e))})}},601:function(e,t,n){"use strict";n.r(t);var r=n(17),i=n.n(r),o=n(0),c=n(290),a=n(265),l=n(115),s=n(12);t.default=function(e){var t=Object(o.useState)(),n=i()(t,2),r=n[0],u=n[1],d=e.minHeight||30,f=Object(l.default)();return Object(s.jsx)(c.default,{style:[{borderColor:"#d0d7de",fontSize:16,borderWidth:1,borderRadius:6,paddingHorizontal:10,paddingVertical:3,backgroundColor:a.default[f].background,color:a.default[f].text,height:e.multiline?r:d},e.style],placeholder:e.placeholder,editable:!e.disabled,keyboardType:e.keyboardType,secureTextEntry:e.secureTextEntry,value:e.value,onChangeText:e.setValue,onContentSizeChange:e.multiline?function(e){return u(Math.max(e.nativeEvent.contentSize.height,d)+2)}:void 0,onBlur:function(){return null==e.onBlur?void 0:e.onBlur(e.value)},onEndEditing:function(){return null==e.onEndEditing?void 0:e.onEndEditing(e.value)},multiline:e.multiline})}},603:function(e,t,n){"use strict";n.r(t);n(0);var r=n(473),i=n(313),o=n(262),c=n(12);t.default=function(e){var t=e.member,n=e.onPress;return Object(c.jsxs)(r.default,{bodyStyle:{flexDirection:"row",justifyContent:"flex-start"},onPress:n,children:[Object(c.jsx)(o.View,{style:{marginTop:4,marginRight:12},children:Object(c.jsx)(i.default,{name:t.name,userId:t.id,size:44})}),Object(c.jsx)(o.Text,{style:{fontSize:20,fontWeight:"400"},children:t.name})]},t.id)}},606:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return T}));var r=n(10),i=n.n(r),o=n(17),c=n.n(o),a=n(45),l=n.n(a),s=n(0),u=n.n(s),d=n(279),f=n(275),j=n(262),b=n(94),O=n(117),h=n(291),g=n(265),p=n(115),m=n(318),x=n(362),y=n.n(x),v=n(336),w=n(12);function S(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function C(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?S(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):S(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var P=["AM","PM"].map((function(e){return{label:e,value:e}})),k=l()(Array(12).keys()).map((function(e,t){return(t+1).toString().padStart(2,"0")})).map((function(e){return{label:e,value:e}})),E=l()(Array(12).keys()).map((function(e,t){return(5*t).toString().padStart(2,"0")})).map((function(e){return{label:e,value:e}})),_=function(e){for(var t=e.clone().startOf("month").add(-1,"month"),n=e.clone().endOf("month").add(1,"month"),r=y()().startOf("day"),i=[];t<=n&&t<r;)i.push(t.format("YYYY-MM-DD")),t=t.add(1,"day");return i},M=u.a.lazy((function(){return Promise.all([n.e(7),n.e(11)]).then(n.bind(null,907))})),D=u.a.lazy((function(){return n.e(12).then(n.bind(null,1147))}));function T(e){var t=e.datetime,n=e.callback,r=t?y()(t):function(){var e=y()(),t=parseInt(e.format("mm"))%5;return e.add(5-t,"minute")}(),i=Object(b.default)(),o=i.lang,a=i.locale,l=Object(p.default)(),u=Object(s.useState)(r.format("YYYY-MM-DD")),x=c()(u,2),S=x[0],R=x[1],I=Object(s.useState)(r.locale("en").format("A")),V=c()(I,2),z=V[0],L=V[1],B=Object(s.useState)(r.format("hh")),A=c()(B,2),F=A[0],U=A[1],H=Object(s.useState)(r.format("mm")),W=c()(H,2),G=W[0],N=W[1],Q=Object(s.useState)(_(r)),J=c()(Q,2),K=J[0],Y=J[1],$=Object(f.default)().setModal,q=function(){$(T,null)};return Object(v.default)(q,[]),Object(w.jsxs)(m.BottomSheet,{children:[Object(w.jsxs)(j.View,{style:{flexDirection:"row",width:"100%"},children:[Object(w.jsx)(j.View,{style:{flex:1,flexDirection:"row"},children:Object(w.jsx)(h.TouchableOpacity,{onPress:q,children:Object(w.jsx)(O.Ionicons,{size:20,name:"arrow-back",color:g.default[l].text})})}),Object(w.jsx)(j.View,{style:{flex:1},children:Object(w.jsx)(j.Text,{style:{fontSize:20,textAlign:"center"},children:o("Date & Time")})}),Object(w.jsx)(j.View,{style:{flex:1}})]}),Object(w.jsx)(j.View,{style:{marginBottom:20,height:1,width:"100%"},lightColor:"#ddd",darkColor:"rgba(255,255,255, 0.3)"}),Object(w.jsxs)(s.Suspense,{fallback:Object(w.jsx)(w.Fragment,{}),children:[Object(w.jsx)(M,{locale:a,style:void 0,setDate:R,disableAllTouchEventsForDisabledDays:!0,onMonthChange:function(e){return Y(_(y()(e.dateString)))},markedDates:C(C({},K.reduce((function(e,t){return e[t]={disabled:!0},e}),{})),(S?[S]:[]).reduce((function(e,t){return e[t]={selected:!0},e}),{}))}),Object(w.jsxs)(j.View,{style:{flexDirection:"row",paddingVertical:10,width:400,height:50},children:[Object(w.jsx)(D,{value:z,setValue:L,values:P}),Object(w.jsx)(j.Text,{style:{fontSize:20},children:" "}),Object(w.jsx)(D,{value:F,setValue:U,values:k}),Object(w.jsx)(j.Text,{style:{fontSize:20},children:" : "}),Object(w.jsx)(D,{value:G,setValue:N,values:E})]})]}),Object(w.jsxs)(j.View,{style:{flexDirection:"row"},children:[Object(w.jsx)(d.default,{title:o("save"),onPress:function(){null==n||n(y()(S+" "+F+":"+G+" "+z).toISOString()),q()}}),Object(w.jsx)(d.default,{title:o("cancel"),onPress:function(){null==n||n(void 0),q()}})]})]})}},609:function(e,t,n){"use strict";n.r(t);var r=n(10),i=n.n(r),o=(n(0),n(41)),c=n(262),a=n(313),l=n(12);function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}t.default=function(e){return Object(l.jsxs)(o.default,{style:{width:"100%",height:135,justifyContent:"space-evenly",alignItems:"center"},children:[Object(l.jsx)(a.default,u(u({},e),{},{size:75})),Object(l.jsx)(c.Text,{style:{fontWeight:"bold",fontSize:15},children:e.name}),Object(l.jsx)(c.Text,{style:{fontWeight:"normal",fontSize:14},children:e.username})]})}},610:function(e,t,n){"use strict";n.r(t),n.d(t,"FirebaseProvider",(function(){return w}));var r=n(17),i=n.n(r),o=n(4),c=n.n(o),a=n(10),l=n.n(a),s=n(0),u=n(851),d=(n(1150),n(53)),f=n(105),j=n(12);function b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function O(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(Object(n),!0).forEach((function(t){l()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var h=n(852),g=h.messagingSenderId,p=d.FCM_API_KEY.split("").map((function(e,t){return(e.charCodeAt(0)^g.charCodeAt(t)).toString(16).padStart(2,"0")})).join(""),m=u.default.initializeApp(O(O({},h),{},{apiKey:d.FCM_API_KEY})),x=u.default.messaging(m);x.onMessage((function(e){if("Notification"in window){if("granted"===Notification.permission){var t=JSON.parse(e.data.message_set)[0];new Notification(e.data.channel_name,{body:e.data.name+": "+t.content})}}else alert("This browser does not support desktop notification")}));var y=function(){var e=c()((function*(){if("granted"===(yield Notification.requestPermission())){var e=yield navigator.serviceWorker.register("/tokki-tok/firebase-messaging-sw.js?"+p);console.log("[SW]: SCOPE: ",e.scope);var t=yield x.getToken({serviceWorkerRegistration:e,vapidKey:d.FCM_PUBLIC_VAPID_KEY}).catch(c()((function*(){return yield x.getToken({serviceWorkerRegistration:e,vapidKey:d.FCM_PUBLIC_VAPID_KEY})})));if(window.addEventListener("beforeunload",(function(t){t.preventDefault(),e.unregister()})),t)return t}return null}));return function(){return e.apply(this,arguments)}}(),v=Object(s.createContext)({setEnable:function(){}}),w=function(e){var t=e.user,n=e.children,r=Object(s.useRef)(),o=Object(s.useState)(),c=i()(o,2),a=c[0],l=c[1],u=Object(s.useMemo)((function(){return void 0===a?void 0:!(null==a||!a.token)}),[a]);return Object(s.useEffect)((function(){var e=!0;return t&&(void 0===r.current&&(r.current=null,y().then((function(t){r.current=t,a&&Object(f.putNotification)(O(O({},a),{},{token:r.current})).then((function(t){e&&l(t)}))}))),void 0===a?Object(f.getNotification)(t.id).then((function(t){e&&l(t||null)})):null===a?Object(f.postNotification)({user:t.id,type:"WEB",token:null}).then((function(t){e&&l(t)})):a.token&&r.current&&r.current!=a.token&&Object(f.putNotification)(O(O({},a),{},{token:r.current})).then((function(t){e&&l(t)}))),function(){e=!1}}),[t,a]),Object(j.jsx)(v.Provider,{value:{enable:u,setEnable:function(e){t&&a&&Object(f.putNotification)(O(O({},a),{},{token:e?void 0==r.current?null:r.current:null})).then((function(e){l(e)}))}},children:(void 0!=u||null===t)&&n})};t.default=function(){var e=Object(s.useContext)(v);return{enable:e.enable,setEnable:e.setEnable}}},720:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return L}));var r=n(45),i=n.n(r),o=n(17),c=n.n(o),a=n(0),l=n(262),s=n(114),u=n(361),d=n(279),f=n(380),j=n(275),b=n(599),O=n(600),h=n(10),g=n.n(h);function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach((function(t){g()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var x=function(e,t){switch(t.type){case"SEARCH":return m(m({},e),{},{keyword:t.keyword});case"ENABLE_SEARCH":return m(m({},e),{},{active:!0});case"DISABLE_SEARCH":return m(m({},e),{},{active:!1,keyword:""});default:throw new Error("Unhandled action type: "+t.type)}};var y=n(471),v=n(291),w=n(94),S=n(603),C=n(318),P=n(336),k=n(41),E=n(604),_=n.n(E),M=n(470),D=n(286),T=n(12);function R(e){var t=Object(w.default)().lang,n=Object(D.default)(),r=Object(a.useState)(!1),i=c()(r,2),o=i[0],s=i[1];return Object(T.jsx)(M.default,{name:e.name,width:e.width,textStyle:e.textStyle,children:Object(T.jsxs)(k.default,{style:{flexDirection:"landscape"==n?"row":"column",justifyContent:"space-between"},children:[Object(T.jsx)(k.default,{style:{justifyContent:"center"},children:Object(T.jsx)(l.Text,{style:{fontSize:16},children:e.value})}),Object(T.jsxs)(k.default,{children:[Object(T.jsx)(d.default,{title:t("copy"),onPress:function(){_.a.setString(e.value),s(!0)}}),o&&Object(T.jsx)(l.Text,{style:{fontSize:12,alignSelf:"center",color:"red"},children:t("copied")})]})]})})}var I=function(e){var t=Object(a.useState)(e.selectedRef.current.has(e.item.id)),n=c()(t,2),r=n[0],i=n[1];return Object(T.jsx)(l.View,{style:r?{borderWidth:1,borderColor:"blue"}:{},children:Object(T.jsx)(S.default,{member:e.item,onPress:function(){r?(i(!1),e.selectedRef.current.delete(e.item.id)):(i(!0),e.selectedRef.current.add(e.item.id))}})})},V=function(e){var t,n=e.id,r=e.selectedRef,o=Object(w.default)().lang,b=Object(s.default)().auth,h=Object(j.default)().setModal,g=Object(u.default)(b),p=Object(f.default)(n),m=Object(f.useMessengerMemberMutation)(),y=function(e,t){var n=Object(a.useReducer)(x,{active:!1,keyword:""}),r=c()(n,2),i=r[0],o=r[1],l=Object(a.useMemo)((function(){return i.active?e.filter((function(e){return t(e,i.keyword)})):e}),[i,e]);return{searchState:i,dispatch:o,data:l}}(Object(a.useMemo)((function(){var e=new Set(null==p?void 0:p.map((function(e){return e.user})));return(null==g?void 0:g.filter((function(t){return!e.has(t.id)})))||[]}),[g,p]),(function(e,t){return e.username.includes(t)||e.name.includes(t)})),S=y.data,C=y.dispatch,k=y.searchState,E=function(){h(L,null)};return Object(P.default)(E,[]),Object(T.jsxs)(l.View,{style:{alignItems:"center",flex:1},children:[Object(T.jsxs)(l.View,{style:{width:"100%",flex:1},children:[Object(T.jsx)(O.default,{name:o("Username")+" & "+o("Name"),placeholder:null==(t=b.user)?void 0:t.name,value:k.keyword,setValue:function(e){(null==e?void 0:e.length)>0?(C({type:"ENABLE_SEARCH"}),C({type:"SEARCH",keyword:e})):C({type:"DISABLE_SEARCH"})},width:"80%"}),n&&S&&Object(T.jsx)(v.FlatList,{contentContainerStyle:{flexGrow:1},data:S,renderItem:function(e){var t=e.item;return Object(T.jsx)(I,{item:t,selectedRef:r})}})]}),Object(T.jsxs)(l.View,{style:[{width:"100%",flexDirection:"row",padding:10},{justifyContent:"flex-end"}],children:[Object(T.jsx)(d.default,{title:o("invite"),onPress:function(){m.invite({channel_id:n,user_ids:i()(r.current)}).then(E)}}),Object(T.jsx)(d.default,{title:o("cancel"),onPress:E})]})]})},z=function(e){var t,n=e.id,r=e.selectedRef,o=Object(w.default)().lang,u=Object(a.useState)(""),h=c()(u,2),g=h[0],p=h[1],m=Object(a.useState)(""),x=c()(m,2),y=x[0],S=x[1],C=Object(a.useRef)(),P=Object(s.default)().auth,k=Object(j.default)().setModal,E=Object(f.default)(n),_=Object(b.default)(y),M=Object(a.useMemo)((function(){var e=new Set(null==E?void 0:E.map((function(e){return e.user})));return(null==_?void 0:_.filter((function(t){return!e.has(t.id)})))||[]}),[_,E]),D=Object(f.useMessengerMemberMutation)();Object(a.useEffect)((function(){return C.current=setTimeout((function(){S(g)}),500),function(){C.current&&clearTimeout(C.current)}}),[g]);var V=function(){k(L,null)},z=location.href.replace("chat","invitee");return Object(T.jsxs)(l.View,{style:{alignItems:"center",flex:1},children:[Object(T.jsxs)(l.View,{style:{width:"100%",flex:1,paddingVertical:10},children:[Object(T.jsx)(R,{name:o("invite link"),width:"80%",value:z}),Object(T.jsx)(l.View,{style:{marginVertical:10,height:1,width:"100%"},lightColor:"#ddd",darkColor:"rgba(255,255,255, 0.3)"}),Object(T.jsx)(O.default,{name:o("Username"),placeholder:null==(t=P.user)?void 0:t.username,value:g,setValue:p,width:"80%"}),n&&M&&Object(T.jsx)(v.FlatList,{contentContainerStyle:{flexGrow:1},data:M,renderItem:function(e){var t=e.item;return Object(T.jsx)(I,{item:t,selectedRef:r})}})]}),Object(T.jsxs)(l.View,{style:[{width:"100%",flexDirection:"row",padding:10},{justifyContent:"flex-end"}],children:[Object(T.jsx)(d.default,{title:o("invite"),onPress:function(){D.invite({channel_id:n,user_ids:i()(r.current)}).then(V)}}),Object(T.jsx)(d.default,{title:o("cancel"),onPress:V})]})]})};function L(e){var t=e.id,n=Object(w.default)().lang,r=Object(a.useRef)(new Set),i={group:{title:"Group",component:function(){return Object(T.jsx)(V,{id:t,selectedRef:r})},icon:Object(T.jsx)(T.Fragment,{})},external:{title:"External members",component:function(){return Object(T.jsx)(z,{id:t,selectedRef:r})},icon:Object(T.jsx)(T.Fragment,{})}};return Object(T.jsx)(C.default,{children:Object(T.jsxs)(l.View,{style:{flex:1,width:"100%"},children:[Object(T.jsxs)(l.View,{style:{width:"100%"},children:[Object(T.jsx)(l.Text,{style:{fontSize:20},children:n("invite")}),Object(T.jsx)(l.View,{style:{marginBottom:20,height:1,width:"100%"},lightColor:"#ddd",darkColor:"rgba(255,255,255, 0.3)"})]}),Object(T.jsx)(y.default,{tabs:i,tabBarPosition:"top"})]})})}},741:function(e,t,n){"use strict";n.r(t),n.d(t,"replaceInviteeState",(function(){return u}));var r,i=n(0),o=n(346),c=n(328),a=n(380),l=n(114),s=0,u=function(e){if(void 0!==e&&e.pathname.endsWith("/invitee")){var t=e.search.slice(1).split("&").filter((function(e){return e.startsWith("id=")}));t.length>0&&(r=parseInt(t[0].split("=")[1])),window.history.replaceState(null,"",e.href.split("invitee")[0])}};t.default=function(){var e=Object(l.default)().auth,t=Object(c.default)(e),n=Object(a.useMessengerMemberMutation)();Object(i.useEffect)((function(){if(e.user){if(r&&t){var i=r,c=function(){return Object(o.navigate)("Main",{screen:"ChatScreen",params:{id:i}})};r=void 0,s=1,void 0===t.find((function(e){return e.id==i}))?(console.log("invite processing (channel:"+i+")"),n.invite({channel_id:i,user_ids:[e.user.id]}).then(c)):(console.log("already invite"),c())}}else 1==s&&(s=2)}),[e,t]),Object(i.useEffect)((function(){e.user&&2==s&&Object(o.navigate)("Main",{screen:"HomeScreen"})}),[e.user])}},850:function(e,t,n){editorConfig={plugins:"image link charmap advlist lists paste",toolbar:"fontsizeselect | bold italic underline strikethrough | undo redo | alignleft aligncenter alignright | bullist numlist | link"},e.exports=editorConfig},852:function(e,t,n){firebaseConfig={authDomain:"virtual-metrics-355712.firebaseapp.com",projectId:"virtual-metrics-355712",storageBucket:"virtual-metrics-355712.appspot.com",messagingSenderId:"76003576924",appId:"1:76003576924:web:c8c8a006d07918bbc02a99",measurementId:"G-SEL35L4N5R"},e.exports=firebaseConfig},853:function(e,t,n){"use strict";n.r(t);var r=n(10),i=n.n(r),o=n(1145),c=n(523);function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}Object.values(c.modal).forEach((function(e){return e.path="tokki-tok/"+e.path})),t.default={prefixes:[o.makeUrl("/")],config:{screens:l({Main:{screens:l(l(l({},c.main),c.login),{},{NotFound:"*"}),path:"tokki-tok"}},c.modal)}}},873:function(e,t){}}]);
//# sourceMappingURL=10.cbe90e84.chunk.js.map