(self.webpackChunkweb=self.webpackChunkweb||[]).push([[787],{27378:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>Or,navigate:()=>jr});var r=n(29439),o=n(95004),i=n(70937),a=n(75043),s=n(57018),l=n(35928),c=n(20925),u=n(59924),d=n(91321),f=n(47539),h=n(14584),g=n(89555),p=n(91938),y=n.n(p),x=n(2629),m=function(e){return e.height>=e.width?"portrait":"landscape"},b=(0,o.createContext)(m(h.default.get("window"))),j=function(e){var t=e.children,n=y()(),i=(0,g.default)(),a=i.width,s=i.height,l=(0,o.useState)(m({width:a,height:s})),c=(0,r.default)(l,2),u=c[0],d=c[1];return(0,o.useEffect)((function(){d(m({width:a,height:s}))}),[a,s]),(0,x.jsx)(b.Provider,{value:n.isMobile()?"portrait":u,children:t})};function v(){return(0,o.useContext)(b)}var w=n(4942),O=n(93433),S=n(15861),C=n(51641),P=n(98735),k=n(79764),D=n(93141),E=n(90519),M=n(26666),_={lastJsonMessage:void 0,sendJsonMessage:function(){}},T=(0,o.createContext)(_),z=function(e){var t=e.children,n=e.path,i=e.Context,a=e.useBackground,s=(0,o.useState)(null),l=(0,r.default)(s,2),c=l[0],u=l[1],d=(0,o.useState)(a||"active"==M.default.currentState),f=(0,r.default)(d,2),h=f[0],g=f[1],p=(0,k.default)(D.websockerURL+"/"+n,{shouldReconnect:function(e){return!0},protocols:c?["Authorization",c]:void 0,onOpen:function(e){console.log("success websocket connection("+n+")")},onClose:function(e){console.log("closed websocket connection("+n+")")}},h&&null!=c),y=p.lastJsonMessage,m=p.sendJsonMessage;return(0,o.useEffect)((function(){E.default.getItem("Authorization").then(u);var e=M.default.addEventListener("change",(function(e){return g(a||"active"==e)}));return function(){return e.remove()}}),[]),(0,x.jsx)(i.Provider,{value:null!=c?{lastJsonMessage:y,sendJsonMessage:m}:_,children:t})},I=function(e){var t=e.disable,n=e.children;return t?(0,x.jsx)(x.Fragment,{children:n}):(0,x.jsx)(z,{path:"messenger/ws/",Context:T,children:n})};const R=function(){return(0,o.useContext)(T)};function L(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function B(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?L(Object(n),!0).forEach((function(t){(0,w.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):L(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function A(e){var t=(0,C.useQueryClient)(),n=R().lastJsonMessage,r=(0,C.useQuery)("MessengerChannelList",(0,S.default)((function*(){var t;return yield(0,P.getMessengerChannelList)(null==e||null==(t=e.user)?void 0:t.id)}))).data;return(0,o.useEffect)((function(){if(null!=n&&("enter"==n.type&&t.setQueryData("MessengerChannelList",(function(e){return(null!=e&&e.find((function(e){return e.id==n.data.id}))?e:[n.data].concat((0,O.default)(e||[]))).sort((function(e,t){return e.id-t.id}))})),"next_message"==n.type)){var e=n.data;t.setQueryData("MessengerChannelList",(function(t){return(t||[]).map((function(t){var n;return t.id==e.channel?B(B({},t),{},{last_message:{content:null==(n=e.message_set[0])?void 0:n.content,created:e.created}}):t}))}))}}),[n]),r}function H(e){var t=A(e);return null==t?void 0:t.sort((function(e,t){var n,r;return((null==(n=e.last_message)?void 0:n.created)||"")<((null==(r=t.last_message)?void 0:r.created)||"")?1:-1}))}function W(){var e=(0,C.useQueryClient)(),t=(0,C.useMutation)(P.postChannel,{onSuccess:function(){return e.invalidateQueries("MessengerChannelList")}}),n=(0,C.useMutation)(P.putChannel,{onSuccess:function(){return e.invalidateQueries("MessengerChannelList")}}),r=(0,C.useMutation)(P.postDirectChannel,{onSuccess:function(){return e.invalidateQueries("MessengerChannelList")}});return{create:t.mutateAsync,update:n.mutateAsync,direct:r.mutateAsync}}function V(e){return(0,C.useQuery)(["MessengerMemberList",e],(0,S.default)((function*(){return yield(0,P.getMessengerMemberList)(e)}))).data}function F(){var e=(0,C.useQueryClient)(),t=(0,C.useMutation)(P.postBulkMessengerMember,{onSuccess:function(){e.invalidateQueries("MessengerMemberList")}}),n=(0,C.useMutation)(P.deleteMessengerMember,{onSuccess:function(){e.invalidateQueries("MessengerChannelList"),e.invalidateQueries("MessengerMemberList")}});return{invite:t.mutateAsync,leave:n.mutateAsync}}var U,N=n(94305),G=0;const Q=function(){var e=(0,N.default)().auth,t=A(e),n=F();(0,o.useEffect)((function(){if(e.user){if(U&&t){var r=U,o=function(){return jr("Main",{screen:"ChatScreen",params:{id:r}})};U=void 0,G=1,void 0===t.find((function(e){return e.id==r}))?(console.log("invite processing (channel:"+r+")"),n.invite({channel_id:r,user_ids:[e.user.id]}).then(o)):(console.log("already invite"),o())}}else 1==G&&(G=2)}),[e,t]),(0,o.useEffect)((function(){e.user&&2==G&&jr("Main",{screen:"HomeScreen"})}),[e.user])};var Y=n(1054),J=n(96591),K=n(45288),$=n(39385),q=n(66792),Z=n(56675),X=n(25722),ee=n(22152),te=n(41550),ne=n(8070),re="#2f95dc",oe="#fff";const ie={light:{text:"#000",background:"#fff",tint:re,tabIconDefault:"#ccc",tabIconSelected:re,hoverColor:"rgb(242,242,242)",buttonBackgroundColor:"#f6f8fa",header:"#f6f8fa",headerBottomColor:"rgb(216, 216, 216)",buttonBorderColor:"rgba(27,31,36,0.15)",iconColor:"black"},dark:{text:"#fff",background:"#000",tint:oe,tabIconDefault:"#ccc",tabIconSelected:oe,hoverColor:"#010409",buttonBackgroundColor:"#010409",header:"#010409",headerBottomColor:"rgb(40, 40, 40)",buttonBorderColor:"rgba(229,225,220,0.15)",iconColor:"white"},borderColor:"#d0d7de",focus:"#0065A4"};var ae="web"==ee.default.OS?function(e){location.href=e}:X.default.openURL;const se=function(e){return(0,x.jsxs)($.default,{style:le.footer_buttons,children:[(0,x.jsx)(K.default,{style:le.footer_button,onPress:function(){return ae("https://github.com/blacktokki/tokki-tok")},children:(0,x.jsx)(ne.AntDesign,{name:"github",size:24,color:ie[e.theme].iconColor})}),(0,x.jsx)(K.default,{style:le.footer_button,onPress:function(){return X.default.openURL("mailto:ydh051541@naver.com")},children:(0,x.jsx)(ne.AntDesign,{name:"mail",size:24,color:ie[e.theme].iconColor})})]})};var le=q.default.create({footer_buttons:{width:"100%",flexDirection:"row",justifyContent:"flex-end",paddingBottom:20,paddingRight:20},footer_button:{alignItems:"center",justifyContent:"center",width:38,height:38,marginHorizontal:12,borderWidth:1,borderColor:"#E7E7E7",borderRadius:60}});var ce=q.default.create({login_container:{flex:1,backgroundColor:"#FFF"},login_header:{alignItems:"center",paddingTop:30,paddingBottom:50,backgroundColor:"#208AEC"},login_header_logo:{width:220,resizeMode:"contain"},login_header_text:{marginTop:15,color:"#f0f0f0",fontSize:16},login_header_text_bold:{color:"#fff",fontWeight:"bold"},login_wrapper:{flex:1,justifyContent:"space-between",paddingTop:40,borderTopRightRadius:12,borderTopLeftRadius:12,backgroundColor:"#fff",alignItems:"center"},form:{width:"100%",maxWidth:320},form_error:{height:22,width:"100%"},form_error_text:{textAlignVertical:"center",color:"red",fontSize:13},form_input:{height:44,paddingHorizontal:20,marginBottom:20,backgroundColor:"#EDF0F7",borderRadius:50},button:{alignItems:"center",justifyContent:"center",height:44,backgroundColor:"#0065A4",borderRadius:50},button_label:{color:"#fff",fontSize:16},login_social:{width:"100%",maxWidth:280,marginTop:20},login_social_separator:{flexDirection:"row",alignItems:"center"},login_social_separator_line:{flex:1,width:"100%",height:1,backgroundColor:"#E0E0E0"},login_social_separator_text:{marginHorizontal:10,color:"#808080",fontSize:16},login_social_buttons:{flexDirection:"row",justifyContent:"center",marginTop:20},login_social_button:{alignItems:"center",justifyContent:"center",width:60,height:60,marginHorizontal:12,borderWidth:1,borderColor:"#E7E7E7",borderRadius:60},login_social_icon:{width:38,height:38,resizeMode:"contain"},login_social_facebook:{backgroundColor:"#4267B2",borderColor:"#4267B2"},login_footer_text:{flexDirection:"row",alignItems:"center",color:"#808080",fontSize:14},guest_footer_text:{flexDirection:"row",alignSelf:"center",color:"#808080",fontSize:15,margin:15},login_footer_link:{color:"#208AEC",fontSize:15,fontWeight:"bold"}}),ue=n(45987),de=n(54243),fe=["style","lightColor","darkColor"],he=["style","lightColor","darkColor"];function ge(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function pe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ge(Object(n),!0).forEach((function(t){(0,w.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ge(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ye(e,t){var n=(0,de.default)(),r=e[n];return r||ie[n][t]}function xe(e){var t=e.style,n=e.lightColor,r=e.darkColor,o=(0,ue.default)(e,fe),i=ye({light:n,dark:r},"text");return(0,x.jsx)(Y.default,pe({style:[{color:i},t]},o))}function me(e){var t=e.style,n=e.lightColor,r=e.darkColor,o=(0,ue.default)(e,he),i=ye({light:n,dark:r},"background");return(0,x.jsx)($.default,pe({style:[{backgroundColor:i},t]},o))}function be(e){return(0,x.jsx)(me,{style:[je.outerContainer,e.autoScale?{}:je.outerContainerFill,e.outerContainerStyle],children:(0,x.jsxs)(me,{style:[je.container,e.containerStyle],children:[e.withSeparator?(0,x.jsx)(me,{style:je.separator,lightColor:"#ddd",darkColor:"rgba(255,255,255, 0.3)"}):void 0,e.title?(0,x.jsxs)(me,{style:je.titleView,children:[(0,x.jsx)(xe,{style:[je.title,e.titleStyle],children:e.title}),(0,x.jsx)(xe,{style:je.subtitle,children:e.subtitle})]}):void 0,(0,x.jsx)(me,{style:[je.bodyView,e.bodyStyle],children:e.children})]})})}var je=q.default.create({outerContainer:{alignItems:"stretch",backgroundColor:"transparent"},outerContainerFill:{width:"100%",maxWidth:1080},container:{marginHorizontal:20,marginVertical:10,backgroundColor:"transparent"},titleView:{width:"100%",flexDirection:"row",backgroundColor:"transparent",marginBottom:5},title:{flex:1,fontSize:16},subtitle:{flex:1,fontSize:12,textAlign:"right",marginTop:4},separator:{marginBottom:20,height:1,width:"100%"},bodyView:{width:"100%",padding:20,alignItems:"center",justifyContent:"center",borderWidth:1,borderColor:ie.borderColor,borderRadius:6}}),ve=n(2840);function we(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Oe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?we(Object(n),!0).forEach((function(t){(0,w.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):we(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Se=function(e){var t=(0,o.useState)(!1),n=(0,r.default)(t,2),i=n[0],a=n[1];return(0,x.jsx)(ve.default,{onPress:function(){return e.onPress()},onHoverIn:function(){return a(!0)},onHoverOut:function(){return a(!1)},disabled:e.disabled,style:[{paddingVertical:5,paddingHorizontal:16},e.style,i||e.disabled?{backgroundColor:e.color,borderColor:e.borderColor}:{}],children:e.children?e.children:(0,x.jsx)(Y.default,{selectable:!1,style:[{fontSize:14},e.textStyle],children:e.title})})};const Ce=function(e){var t=(0,de.default)(),n=Oe(Oe({color:ie[t].hoverColor,borderColor:"light"==t?ie[t].buttonBorderColor:"#7d8590"},e),{},{style:[Pe.style,{backgroundColor:ie[t].buttonBackgroundColor,borderColor:ie[t].buttonBorderColor},e.style],textStyle:[Pe.text,{color:ie[t].text},e.textStyle]});return(0,x.jsx)(Se,Oe({},n))};var Pe=q.default.create({style:{borderRadius:6,borderWidth:1},text:{textAlign:"center",fontWeight:"600"}});function ke(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function De(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ke(Object(n),!0).forEach((function(t){(0,w.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ke(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ee=(0,o.createContext)({upload:{},dispatch:function(){}}),Me=function(e,t){var n=(0,O.default)(e[t.channel]||[]),r=n.findIndex((function(e){return e.filename==t.filename}));return r>=0?n[r]={filename:t.filename,progress:t.progress}:n.push({filename:t.filename,progress:t.progress}),De(De({},e),{},(0,w.default)({},t.channel,n.filter((function(e){return(e.progress||0)<1}))))},_e=function(e){var t=e.children,n=(0,o.useReducer)(Me,{}),i=(0,r.default)(n,2),a=i[0],s=i[1];return(0,x.jsx)(Ee.Provider,{value:{upload:a,dispatch:s},children:t})};function Te(){return(0,o.useContext)(Ee)}function ze(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ie(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ze(Object(n),!0).forEach((function(t){(0,w.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ze(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Re=function(e,t){var n=0;e.forEach((function(e){n!=t.length&&(e.current.forEach((function(e){n!=t.length&&e.id==t[n].id&&(e.timer=t[n].timer,e.is_archive=t[n].is_archive,n+=1)})),e.current=e.current.filter((function(e){return!e.is_archive})))}))};function Le(e){var t=Te().dispatch,n=(0,C.useMutation)((function(e){return(0,P.postMessage)(e,t)}),{onSuccess:function(){}}),r=(0,C.useMutation)(P.patchMessengerContent);return{create:n.mutate,patch:r.mutate}}function Be(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ae(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Be(Object(n),!0).forEach((function(t){(0,w.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Be(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const He=function(e){return(0,x.jsx)(Ce,Ae(Ae({},e),{},{style:[We.style,e.style]}))};var We=q.default.create({style:{borderRadius:6,backgroundColor:"transparent",borderWidth:0}}),Ve=n(99294);function Fe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ue(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Fe(Object(n),!0).forEach((function(t){(0,w.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Fe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ne=(0,o.createContext)({setModal:function(){}}),Ge=function(e){var t=e.children,n=e.modals,i=(0,o.useState)([]),a=(0,r.default)(i,2),s=a[0],l=a[1],c=v(),u=(0,o.useState)("none"),d=(0,r.default)(u,2),f=d[0],h=d[1];return(0,o.useEffect)((function(){0==s.filter((function(e){return e.visible})).length&&h("landscape"==c?"fade":"slide")}),[c]),(0,o.useEffect)((function(){l(n.map((function(e){return{Component:e,props:null,visible:!1}})))}),[n]),(0,x.jsxs)(Ne.Provider,{value:{setModal:function(e,t){var n=s.map((function(n){return null==e?Ue(Ue({},n),{},{visible:!1}):n.Component==e?{Component:e,props:null!==t?t:n.props,visible:null!==t}:n}));l(n)}},children:[t,s.map((function(e,t){var n=e.Component,r=e.props,o=e.visible;return(0,x.jsx)(Ve.default,{animationType:f,visible:o,transparent:!0,children:(0,x.jsx)(n,Ue({},r))},t)}))]})};const Qe=function(){return(0,o.useContext)(Ne)},Ye=function(e){var t=v();return(0,x.jsx)(be,{autoScale:!0,outerContainerStyle:{flex:1,alignSelf:"center",backgroundColor:"#8888",flexShrink:1,width:"100%"},containerStyle:{flex:1,margin:0,justifyContent:"center",alignItems:"center"},bodyStyle:"landscape"==t?{width:"90%",height:"90%",padding:"5%"}:{width:"100%",height:"100%",maxWidth:1080},children:e.children})};var Je=function(e){return(0,x.jsx)(be,{autoScale:!0,outerContainerStyle:{flex:1,alignSelf:"center",backgroundColor:"#8888",width:"100%"},containerStyle:{flex:1,margin:0,justifyContent:"flex-end"},children:e.children})},Ke=n(5146);const $e=function(e,t){var n=(0,Ke.useNavigation)();(0,o.useEffect)((function(){var t=function(t){t.preventDefault(),e()};return n.addListener("beforeRemove",t),function(){n.removeListener("beforeRemove",t)}}),t)};function qe(e){var t=e.type,n=(0,Z.default)().lang,r=Qe().setModal,o=(0,N.default)().dispatch,i=function(){r(qe,null)},a={GUEST_LOGOUT:{message:"Guest users cannot reconnect after logging out. Please create an account or log in.",title:"sign out",onPress:function(){return o({type:"LOGOUT_REQUEST"})}}};return $e(i,[]),(0,x.jsxs)(Je,{children:[(0,x.jsx)(xe,{children:n(a[t].message)}),(0,x.jsxs)(me,{style:{width:"100%",flexDirection:"row",justifyContent:"flex-end"},children:[(0,x.jsx)(Ce,{title:n(a[t].title),onPress:a[t].onPress}),(0,x.jsx)(Ce,{title:n("cancel"),onPress:function(){return i()}})]})]})}function Ze(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Xe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ze(Object(n),!0).forEach((function(t){(0,w.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ze(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const et=function(e){var t=(0,Z.default)().lang,n=(0,de.default)(),r=(0,N.default)(),o=r.auth,i=r.dispatch,a=Qe().setModal,s=v(),l=[{title:t("sign out"),onPress:function(){var e;null!=o&&null!=(e=o.user)&&e.is_guest?a(qe,{type:"GUEST_LOGOUT"}):i({type:"LOGOUT_REQUEST"})}}],c=(e.extra?[].concat((0,O.default)(e.extra),l):l).filter((function(e){return e.windowType==s||void 0==e.windowType}));return(0,x.jsx)($.default,{style:{flexDirection:"row"},children:c.map((function(e,t){return(0,x.jsx)(He,Xe(Xe({},e),{},{textStyle:{color:ie[n].text},color:"#gray"}),t)}))})};var tt=n(48162),nt=n(78684),rt=n(43287);const ot=function(e){var t=e.link,n=e.isMobile;return(0,x.jsx)(be,{containerStyle:{marginHorizontal:0},bodyStyle:{padding:0},children:(0,x.jsxs)(te.TouchableOpacity,{onPress:function(){return X.default.openURL(t.url)},onLongPress:function(){},style:{width:"100%",flexDirection:"row"},children:[t.image_url?(0,x.jsx)(rt.default,{source:{uri:t.image_url},resizeMode:"cover",style:{width:"100%",maxWidth:n?120:150,maxHeight:n?120:150,borderWidth:1}}):void 0,(0,x.jsxs)(me,{style:{flex:1,marginHorizontal:20},children:[(0,x.jsx)(xe,{style:{fontSize:18},children:t.title}),(0,x.jsx)(xe,{style:{fontSize:14},children:t.description}),(0,x.jsx)(xe,{style:{fontSize:12},children:t.url})]})]})})};var it=n(34271),at=function(e,t,n){return Math.floor(e%(n-t)+t)};const st=function(e){var t=function(e,t){for(var n=t||0,r=0;r<e.length;r++)n=e.charCodeAt(r)+((n<<5)-n);return n=Math.abs(n),"hsl("+at(n,0,360)+", "+at(n,0,100)+"%, "+at(n,25,75)+"%)"}(e.name,e.userId);return(0,x.jsx)(it.default,{style:{backgroundColor:t},size:e.size,label:e.name.split(" ").map((function(e){return e[0]})).join().toUpperCase()})};function lt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ct(e,t){var n,r=e.name;return e.member_count<3&&(n=1==e.member_count||(null==t?void 0:t.id)==e.subowner.id?e.owner:e.subowner,r=r.length>0?r:n.name),{avatar:n,name:r}}const ut=function(e){return(0,x.jsx)(st,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?lt(Object(n),!0).forEach((function(t){(0,w.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):lt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e))};var dt=(0,o.createContext)({lastJsonMessage:void 0,sendJsonMessage:function(){}}),ft=function(e){var t=e.disable,n=e.children;return t?(0,x.jsx)(x.Fragment,{}):(0,x.jsx)(z,{path:"messenger/ws/rtc/",Context:dt,useBackground:!0,children:n})};const ht=function(){return(0,o.useContext)(dt)};var gt=n(33693),pt=n(47280);console.log(D.TURN_SERVER?"use turn server":"use stun server");var yt={iceServers:[D.TURN_SERVER?JSON.parse(D.TURN_SERVER):{urls:"stun:stun.l.google.com:19302"}]},xt={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0,VoiceActivityDetection:!0}},mt={audio:!0,video:{framerate:30}},bt=function(e,t){var n=t.data.rtcMessage,r=new pt.RTCIceCandidate(n);e&&(console.log("ICE candidate Added"),e.addIceCandidate(r))},jt=function(e,t,n,r){e.candidate&&t({type:"ICEcandidate",receiver:n,data:{target:r,rtcMessage:e.candidate}})},vt=8e3,wt=function(){var e=(0,S.default)((function*(e,t,n,r,o){n&&e.pc.addStream(n);var i=function(e){var t=e.sdp.split("\r\n");return t.forEach((function(e,n){/^a=fmtp:\d*/.test(e)?t[n]=e+";x-google-max-bitrate=8000;x-google-min-bitrate=8000;x-google-start-bitrate="+vt:/^a=mid:(0|video)/.test(e)&&(t[n]+="\r\nb=AS:"+vt)})),new pt.RTCSessionDescription({type:e.type,sdp:t.join("\r\n")})}(yield e.pc.createOffer(xt));yield e.pc.setLocalDescription(i),t({type:"call",receiver:e.receiver,data:{target:r,name:null==o?void 0:o.name,rtcMessage:i}})}));return function(t,n,r,o,i){return e.apply(this,arguments)}}(),Ot=q.default.create({container:{flex:1},cam:{flex:1,height:"100%"},bottonContainer:{position:"absolute",bottom:0,justifyContent:"flex-end"},buttonBar:{flexDirection:"row",justifyContent:"space-around"},label:{backgroundColor:"#0008",color:"white",paddingHorizontal:5}});const St=function(e){var t,n=ht(),i=n.lastJsonMessage,a=function(e){var t=(0,o.useRef)({}),n=(0,o.useState)(),i=(0,r.default)(n,2),a=i[0],s=i[1],l=(0,o.useState)(),c=(0,r.default)(l,2),u=c[0],d=c[1],f=(0,o.useMemo)((function(){return!!u}),[u]),h=(0,o.useCallback)(o.memo((function(e){var t=e.style;return u?(0,x.jsx)(pt.RTCView,{stream:u,style:t,videoProps:{height:"100%"}}):(0,x.jsx)(x.Fragment,{})})),[u]),g=(0,o.useCallback)(function(){var n=(0,S.default)((function*(n,o,i){if(console.log("start"),!u||void 0!==i)try{var a;a="camera"==i?yield pt.mediaDevices.getUserMedia(mt):"display"==i?yield pt.mediaDevices.getDisplayMedia(mt):o||(yield pt.mediaDevices.getUserMedia(mt).catch((function(e){return pt.mediaDevices.getDisplayMedia(mt)}))),d(a),Object.entries(t.current).map((function(t){var o=(0,r.default)(t,2),i=(o[0],o[1]);wt(i,e,a,"guest",n)}))}catch(s){console.error(s)}}));return function(e,t,r){return n.apply(this,arguments)}}(),[u]);return{start:g,stop:(0,o.useCallback)((function(){console.log("stop"),u&&(u.getTracks().map((function(e){return e.stop()})),d(void 0))}),[u]),websocketOnMessage:function(){var n=(0,S.default)((function*(n,r){var o=n.type;if("connection"==o&&s(n.data.channel_name),"start"==o&&"host"==n.data.target){console.log("1 start");var i=new pt.RTCPeerConnection(yt);i.addEventListener("icecandidate",(function(t){return jt(t,e,n.sender,"guest")})),t.current[n.sender]={pc:i,receiver:n.sender},wt(t.current[n.sender],e,u,"guest",r)}if("answer"==o&&"host"==n.data.target){console.log("3 answer");var a=t.current[n.sender].pc,l=new pt.RTCSessionDescription(n.data.rtcMessage);yield a.setRemoteDescription(l)}if("ICEcandidate"==o&&"host"==n.data.target){var c=t.current[n.sender].pc;bt(c,n)}}));return function(e,t){return n.apply(this,arguments)}}(),CustomRTCView:h,isPlay:f,sender:a}}(n.sendJsonMessage),s=a.start,l=a.stop,c=a.websocketOnMessage,u=a.CustomRTCView,d=a.isPlay;return(0,o.useEffect)((function(){e.user&&i&&c(i,e.user)}),[i,e.user]),(0,o.useEffect)((function(){return e.mode&&!d?e.user&&s(e.user,void 0,e.mode):null===e.mode&&d&&l(),function(){d&&l()}}),[d,e.user,e.mode]),(0,x.jsxs)($.default,{style:Ot.container,children:[(0,x.jsx)(u,{style:Ot.cam}),(0,x.jsxs)($.default,{style:Ot.bottonContainer,children:[(0,x.jsx)($.default,{style:Ot.buttonBar}),(0,x.jsx)($.default,{style:{flexDirection:"row"},children:(0,x.jsx)(Y.default,{style:Ot.label,children:null==(t=e.user)?void 0:t.name})}),(0,x.jsxs)($.default,{style:Ot.buttonBar,children:[void 0===e.mode&&!d&&(0,x.jsx)(gt.default,{title:"Start",onPress:function(){return e.user&&s(e.user)}}),void 0===e.mode&&d&&(0,x.jsx)(gt.default,{title:"Stop",onPress:l})]})]})]})},Ct=function(e){var t=(0,o.useState)(""),n=(0,r.default)(t,2),i=n[0],a=n[1],s=ht(),l=s.lastJsonMessage,c=function(e){var t=(0,o.useRef)({}),n=(0,o.useState)(),i=(0,r.default)(n,2),a=i[0],s=i[1],l=(0,o.useState)(),c=(0,r.default)(l,2),u=c[0],d=c[1],f=(0,o.useCallback)(o.memo((function(e){return u?(0,x.jsx)(pt.RTCView,{stream:u,style:e,videoProps:{height:"100%"}}):(0,x.jsx)(x.Fragment,{})})),[u]),h=(0,o.useMemo)((function(){return!!u}),[u]),g=(0,o.useCallback)((function(n){console.log("start"),t.current.pc||(t.current.pc=new pt.RTCPeerConnection(yt),t.current.receiver=n),u||e({type:"start",receiver:n,data:{target:"host"}})}),[u]),p=function(){console.log("stop"),t.current.pc&&(d(void 0),t.current.pc.close(),t.current.pc=void 0,t.current.receiver=void 0,clearInterval(t.current.statsInterval))};return{start:g,stop:p,websocketOnMessage:function(){var n=(0,S.default)((function*(n){var r,o,i,l,c=n.type;if("start"==c&&"guest"==n.data.target&&n.sender==(null==(r=t.current)?void 0:r.receiver)){console.log("(remote)1 start");var f=t.current.pc;s({name:n.data.name}),f.addEventListener("icecandidate",(function(t){return jt(t,e,n.sender,"host")})),f.addEventListener("iceconnectionstatechange",(function(e){if("connected"==t.current.pc.iceConnectionState){var n=!1;t.current.statsInterval=setInterval((0,S.default)((function*(){var e=yield t.current.pc.getStats(null),r="",o=void 0;e.forEach((function(e){"inbound-rtp"===e.type&&"video"===e.kind&&(Object.keys(e).forEach((function(t){r+=t+": "+e[t]+"\n"})),o=e.framesPerSecond)})),console.log(n,o),void 0!=o?n=!0:n&&p(),console.log((new Date).toTimeString().split(" ")[0],r)})),1e3)}else"failed"==t.current.pc.iceConnectionState&&p()})),f.addTransceiver("video",{direction:"recvonly"}),yield wt({pc:t.current.pc,receiver:n.sender},e,u,"host",a)}if("answer"==c&&"guest"==n.data.target&&n.sender==(null==(o=t.current)?void 0:o.receiver)){console.log("(remote)3 answer");var h=new pt.RTCSessionDescription(n.data.rtcMessage);yield t.current.pc.setRemoteDescription(h);var g=t.current.pc.getRemoteStreams();d(g[g.length-1]),e({type:"end",receiver:t.current.receiver,data:{}})}if("call"==c&&n.sender==(null==(i=t.current)?void 0:i.receiver)){console.log("2 call");var y=t.current.pc;if(s({name:n.data.name}),!y)return;y.addEventListener("icecandidate",(function(t){return jt(t,e,n.sender,"host")}));var x=new pt.RTCSessionDescription(n.data.rtcMessage);yield y.setRemoteDescription(x);var m=yield y.createAnswer(xt);yield y.setLocalDescription(m),e({type:"answer",receiver:t.current.receiver,data:{target:"host",rtcMessage:y.localDescription}});var b=t.current.pc.getRemoteStreams();d(b[b.length-1])}"ICEcandidate"==c&&"guest"==n.data.target&&n.sender==(null==(l=t.current)?void 0:l.receiver)&&bt(t.current.pc,n)}));return function(e){return n.apply(this,arguments)}}(),CustomRTCView:f,user:a,isPlay:h}}(s.sendJsonMessage),u=c.start,d=c.stop,f=c.websocketOnMessage,h=c.CustomRTCView,g=c.isPlay,p=c.user;return(0,o.useEffect)((function(){l&&f(l)}),[l]),(0,o.useEffect)((function(){return e.receiver&&u(e.receiver),function(){return d()}}),[e.receiver]),(0,x.jsxs)($.default,{style:Ot.container,children:[(0,x.jsx)(h,{style:Ot.cam}),(0,x.jsxs)($.default,{style:Ot.bottonContainer,children:[(0,x.jsx)($.default,{style:Ot.buttonBar}),(0,x.jsx)($.default,{style:{flexDirection:"row"},children:e.receiver||g?(0,x.jsx)(Y.default,{style:Ot.label,children:(null==p?void 0:p.name)||"loading..."}):(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(Y.default,{style:{borderWidth:1},children:"Receiver:\xa0"}),(0,x.jsx)(J.default,{style:{borderWidth:1,flex:1},value:i,onChangeText:a})]})}),(0,x.jsxs)($.default,{style:Ot.buttonBar,children:[void 0===e.receiver&&!g&&(0,x.jsx)(gt.default,{title:"Start",onPress:function(){return u(i)}}),void 0===e.receiver&&g&&(0,x.jsx)(gt.default,{title:"Stop",onPress:d})]})]})]})};var Pt=function(e){return(0,x.jsx)($.default,{style:[{maxWidth:e.scale,maxHeight:e.scale,borderWidth:1,borderColor:ie.borderColor,backgroundColor:"gray",flexDirection:"row",flexGrow:1},void 0==e.focusGuest||e.focusGuest==e.receiver?{height:"100%"}:{maxWidth:0,height:0}],children:(0,x.jsx)(te.TouchableOpacity,{style:{flex:1},containerStyle:{flex:1,justifyContent:"center"},onPress:function(){return e.setFocusGuest(e.focusGuest?void 0:e.receiver)},children:e.children})})},kt=function(e){var t,n=e.channel_id,i=e.disable,a=e.setDisable,s=(0,N.default)().auth,l=(0,nt.default)(),c=(0,o.useState)(null),u=(0,r.default)(c,2),d=u[0],f=u[1],h=(0,o.useState)([]),g=(0,r.default)(h,2),p=g[0],y=g[1],m=(0,o.useState)(),b=(0,r.default)(m,2),j=b[0],w=b[1],S=v(),C=ht(),P=C.lastJsonMessage,k=C.sendJsonMessage;(0,o.useEffect)((function(){if(null!=P&&("connection"==P.type&&k({type:"broadcast",data:{channel_id:n}}),"broadcast_guest"!=P.type&&"broadcast_host"!=P.type||y([].concat((0,O.default)(p),[P.sender])),"broadcast_disconnect"==P.type)){var e=P.sender;p.find((function(t){return t==e}))&&y(p.filter((function(t){return t!=e})))}}),[P]);var D=j?"100%":100/Math.max(2,Math.ceil(Math.sqrt(p.length+1)))+"%",E=function(e){f(d!=e?e:null)};return void 0!==P?(0,x.jsxs)(me,{style:[{aspectRatio:i?0:16/9,borderColor:ie.borderColor,borderRadius:10},"landscape"==S?{flexShrink:1,flexGrow:0,height:"100%",borderLeftWidth:1,paddingBottom:65}:{maxHeight:"36%",width:"100%",borderBottomWidth:1}],children:[(0,x.jsxs)($.default,{style:{aspectRatio:j?void 0:16/9,backgroundColor:"white",flexWrap:"wrap",flexDirection:"row",width:"100%",height:"100%"},children:[p.map((function(e,t){return(0,x.jsx)(Pt,{scale:D,focusGuest:j,setFocusGuest:w,receiver:e,children:(0,x.jsx)(Ct,{receiver:e})})})),(0,x.jsx)(Pt,{scale:D,focusGuest:j,setFocusGuest:w,receiver:null==(t=s.user)?void 0:t.name,children:(0,x.jsx)(St,{user:s.user,mode:d})})]}),(0,x.jsxs)(me,{style:[{position:"absolute",alignItems:"center",justifyContent:"flex-end",width:"100%",flexDirection:"row"},"landscape"==S?{bottom:0,paddingTop:15,paddingBottom:10,paddingHorizontal:19}:{backgroundColor:"transparent"}],children:[(0,x.jsx)(Ce,{title:"\u23fa\ufe0f",style:{height:40,paddingTop:8},onPress:function(){return E("camera")}}),!l&&(0,x.jsx)(Ce,{title:"\ud83d\udda5\ufe0f",style:{height:40,paddingTop:8},onPress:function(){return E("display")}}),(0,x.jsx)(Ce,{title:"",style:{height:40,paddingTop:8},onPress:function(){return a(!0)},children:(0,x.jsx)(ne.Ionicons,{size:20,name:"arrow-back",color:"deepskyblue"})})]})]}):(0,x.jsx)(x.Fragment,{})};const Dt=o.memo((function(e){var t=e.channel_id,n=e.disable,r=e.setDisable;return(0,x.jsx)(ft,{disable:n,children:(0,x.jsx)(kt,{channel_id:t,disable:n,setDisable:r})})}));function Et(e){var t=0==e?0:Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,t)).toFixed(2)+" "+["B","kB","MB","GB","TB"][t]}const Mt=function(e){var t=e.file,n=e.isMobile,r=e.showBorder,o=(0,de.default)();return(0,x.jsx)(be,{containerStyle:{marginHorizontal:0},bodyStyle:r?{padding:10}:{borderWidth:0,padding:0},children:(0,x.jsxs)(te.TouchableOpacity,{onPress:function(){return X.default.openURL(t.file)},onLongPress:function(){},style:{flexDirection:"row",alignItems:"flex-start",width:"100%"},children:[t.thumbnail?(0,x.jsx)(rt.default,{source:{uri:t.thumbnail},resizeMode:"cover",style:{width:n?120:150,height:n?120:150,borderWidth:1}}):(0,x.jsx)(ne.FontAwesome,{name:"file-o",size:20,color:ie[o].iconColor}),(0,x.jsxs)(me,{style:{flex:1,marginHorizontal:10},children:[(0,x.jsx)(xe,{style:{fontSize:18},children:t.filename}),(0,x.jsx)(xe,{style:{fontSize:14},children:Et(t.filesize)})]})]})})};function _t(e){return(0,C.useQuery)(["UserMembershipList",null==e?void 0:e.groupId],(0,S.default)((function*(){return null!=e&&e.groupId?yield(0,P.getUserMembershipList)(null==e?void 0:e.groupId):[]}))).data}function Tt(e){return(0,C.useQuery)(["UserMembershipList",e],(0,S.default)((function*(){return e?yield(0,P.getExternalMembershipList)(e):[]}))).data}const zt=function(e){var t=(0,o.useState)(),n=(0,r.default)(t,2),i=n[0],a=n[1],s=e.minHeight||30,l=(0,de.default)();return(0,x.jsx)(J.default,{style:[{borderColor:"#d0d7de",fontSize:16,borderWidth:1,borderRadius:6,paddingHorizontal:10,paddingVertical:3,backgroundColor:ie[l].background,color:ie[l].text,height:e.multiline?i:s},e.style],placeholder:e.placeholder,editable:!e.disabled,keyboardType:e.keyboardType,secureTextEntry:e.secureTextEntry,value:e.value,onChangeText:e.setValue,onContentSizeChange:e.multiline?function(e){return a(Math.max(e.nativeEvent.contentSize.height,s)+2)}:void 0,onBlur:function(){return null==e.onBlur?void 0:e.onBlur(e.value)},onEndEditing:function(){return null==e.onEndEditing?void 0:e.onEndEditing(e.value)},multiline:e.multiline})};function It(e){var t=v(),n=(0,o.useMemo)((function(){return"landscape"==t?{flexDirection:"row",alignItems:"center",justifyContent:"space-between"}:{flexDirection:"column",alignItems:"flex-start"}}),[t]);return(0,x.jsxs)(me,{style:[{paddingVertical:"landscape"==t?15:5,width:"100%"},n],children:[(0,x.jsx)(xe,{style:["landscape"==t?{flex:1}:{width:"100%"},{paddingHorizontal:15,fontSize:16},e.textStyle],children:e.name}),(0,x.jsx)(me,{style:["landscape"==t?{flex:6}:{width:"100%"},{paddingHorizontal:15}],children:(0,x.jsx)(me,{style:{width:e.width},children:e.children})})]})}function Rt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Lt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Rt(Object(n),!0).forEach((function(t){(0,w.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Rt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Bt(e){return(0,x.jsx)(It,{name:e.name,width:e.width,textStyle:e.textStyle,children:(0,x.jsx)(zt,Lt({},e))})}function At(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ht(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?At(Object(n),!0).forEach((function(t){(0,w.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):At(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Wt=function(e,t){switch(t.type){case"SEARCH":return Ht(Ht({},e),{},{keyword:t.keyword});case"ENABLE_SEARCH":return Ht(Ht({},e),{},{active:!0});case"DISABLE_SEARCH":return Ht(Ht({},e),{},{active:!1,keyword:""});default:throw new Error("Unhandled action type: "+t.type)}};var Vt=n(27617),Ft=n(36979),Ut=n(98149);function Nt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Gt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Nt(Object(n),!0).forEach((function(t){(0,w.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Nt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const Qt=function(e){var t=(0,Z.default)().lang,n=o.useState(e.index||0),i=(0,r.default)(n,2),a=i[0],s=i[1],l=(0,de.default)(),c=Object.entries(e.tabs),u=e.onTab,d=Object.assign.apply(Object,[{}].concat((0,O.default)(c.map((function(e){var t=(0,r.default)(e,2),n=t[0],o=t[1];return(0,w.default)({},n,o.icon)})))));return(0,x.jsx)(Vt.TabView,{renderTabBar:function(e){return(0,x.jsx)(Ft.TabBar,Gt(Gt({},e),{},{indicatorStyle:{backgroundColor:"#2196F3"},style:{backgroundColor:ie[l].background},activeColor:ie[l].text,inactiveColor:ie[l].text,renderIcon:function(e){return d[e.route.key]},onTabPress:function(e){return null==u?void 0:u(c.findIndex((function(t){var n=(0,r.default)(t,2),o=n[0];n[1];return o==e.route.key})))}}))},navigationState:{index:a,routes:c.map((function(e){var n=(0,r.default)(e,2),o=n[0],i=n[1];return{key:o,title:t(i.title)}}))},onIndexChange:s,renderScene:(0,Ut.SceneMap)(Object.assign.apply(Object,[{}].concat((0,O.default)(c.map((function(e){var t=(0,r.default)(e,2),n=t[0],o=t[1];return(0,w.default)({},n,o.component)})))))),tabBarPosition:e.tabBarPosition})};function Yt(e){var t=o.useState(!1),n=(0,r.default)(t,2),i=n[0],a=n[1];return(0,x.jsx)(ve.default,{style:[Jt.outerContainer,e.outerContainerStyle,i?{backgroundColor:"rgb(242,242,242)"}:{}],onPressIn:function(){return a(!0)},onPress:function(){return null==e.onPress?void 0:e.onPress()},onPressOut:function(){return a(!1)},children:(0,x.jsx)(me,{style:[Jt.container,e.containerStyle],children:(0,x.jsx)(me,{style:[Jt.bodyView,e.bodyStyle],children:(0,x.jsx)(x.Fragment,{children:e.children})})})})}var Jt=q.default.create({outerContainer:{width:"100%",maxWidth:1080,alignItems:"stretch"},container:{marginHorizontal:20,backgroundColor:"transparent"},bodyView:{width:"100%",padding:10,minHeight:40,alignItems:"center",justifyContent:"center",borderBottomWidth:1,borderColor:ie.borderColor,backgroundColor:"transparent"}});const Kt=function(e){var t=e.member,n=e.onPress;return(0,x.jsxs)(Yt,{bodyStyle:{flexDirection:"row",justifyContent:"flex-start"},onPress:n,children:[(0,x.jsx)(me,{style:{marginTop:4,marginRight:12},children:(0,x.jsx)(ut,{name:t.name,userId:t.id,size:44})}),(0,x.jsx)(xe,{style:{fontSize:20,fontWeight:"400"},children:t.name})]},t.id)};var $t=n(93976);function qt(e){var t=(0,Z.default)().lang,n=v(),i=(0,o.useState)(!1),a=(0,r.default)(i,2),s=a[0],l=a[1];return(0,x.jsx)(It,{name:e.name,width:e.width,textStyle:e.textStyle,children:(0,x.jsxs)($.default,{style:{flexDirection:"landscape"==n?"row":"column",justifyContent:"space-between"},children:[(0,x.jsx)($.default,{style:{justifyContent:"center"},children:(0,x.jsx)(xe,{style:{fontSize:16},children:e.value})}),(0,x.jsxs)($.default,{children:[(0,x.jsx)(Ce,{title:t("copy"),onPress:function(){$t.default.setString(e.value),l(!0)}}),s&&(0,x.jsx)(xe,{style:{fontSize:12,alignSelf:"center",color:"red"},children:t("copied")})]})]})})}var Zt=function(e){var t=(0,o.useState)(e.selectedRef.current.has(e.item.id)),n=(0,r.default)(t,2),i=n[0],a=n[1];return(0,x.jsx)(me,{style:i?{borderWidth:1,borderColor:"blue"}:{},children:(0,x.jsx)(Kt,{member:e.item,onPress:function(){i?(a(!1),e.selectedRef.current.delete(e.item.id)):(a(!0),e.selectedRef.current.add(e.item.id))}})})},Xt=function(e){var t,n=e.id,i=e.selectedRef,a=(0,Z.default)().lang,s=(0,N.default)().auth,l=Qe().setModal,c=_t(s),u=V(n),d=F(),f=function(e,t){var n=(0,o.useReducer)(Wt,{active:!1,keyword:""}),i=(0,r.default)(n,2),a=i[0],s=i[1],l=(0,o.useMemo)((function(){return a.active?e.filter((function(e){return t(e,a.keyword)})):e}),[a,e]);return{searchState:a,dispatch:s,data:l}}((0,o.useMemo)((function(){var e=new Set(null==u?void 0:u.map((function(e){return e.user})));return(null==c?void 0:c.filter((function(t){return!e.has(t.id)})))||[]}),[c,u]),(function(e,t){return e.username.includes(t)||e.name.includes(t)})),h=f.data,g=f.dispatch,p=f.searchState,y=function(){l(tn,null)};return $e(y,[]),(0,x.jsxs)(me,{style:{alignItems:"center",flex:1},children:[(0,x.jsxs)(me,{style:{width:"100%",flex:1},children:[(0,x.jsx)(Bt,{name:a("Username")+" & "+a("Name"),placeholder:null==(t=s.user)?void 0:t.name,value:p.keyword,setValue:function(e){(null==e?void 0:e.length)>0?(g({type:"ENABLE_SEARCH"}),g({type:"SEARCH",keyword:e})):g({type:"DISABLE_SEARCH"})},width:"80%"}),n&&h&&(0,x.jsx)(te.FlatList,{contentContainerStyle:{flexGrow:1},data:h,renderItem:function(e){var t=e.item;return(0,x.jsx)(Zt,{item:t,selectedRef:i})}})]}),(0,x.jsxs)(me,{style:[{width:"100%",flexDirection:"row",padding:10},{justifyContent:"flex-end"}],children:[(0,x.jsx)(Ce,{title:a("invite"),onPress:function(){d.invite({channel_id:n,user_ids:(0,O.default)(i.current)}).then(y)}}),(0,x.jsx)(Ce,{title:a("cancel"),onPress:y})]})]})},en=function(e){var t,n=e.id,i=e.selectedRef,a=(0,Z.default)().lang,s=(0,o.useState)(""),l=(0,r.default)(s,2),c=l[0],u=l[1],d=(0,o.useState)(""),f=(0,r.default)(d,2),h=f[0],g=f[1],p=(0,o.useState)(!1),y=(0,r.default)(p,2),m=(y[0],y[1],(0,o.useRef)()),b=(0,N.default)().auth,j=Qe().setModal,v=V(n),w=Tt(h),S=(0,o.useMemo)((function(){var e=new Set(null==v?void 0:v.map((function(e){return e.user})));return(null==w?void 0:w.filter((function(t){return!e.has(t.id)})))||[]}),[w,v]),C=F();(0,o.useEffect)((function(){return m.current=setTimeout((function(){g(c)}),500),function(){m.current&&clearTimeout(m.current)}}),[c]);var P=function(){j(tn,null)},k=location.href.replace("chat","invitee");return(0,x.jsxs)(me,{style:{alignItems:"center",flex:1},children:[(0,x.jsxs)(me,{style:{width:"100%",flex:1,paddingVertical:10},children:[(0,x.jsx)(qt,{name:a("invite link"),width:"80%",value:k}),(0,x.jsx)(me,{style:{marginVertical:10,height:1,width:"100%"},lightColor:"#ddd",darkColor:"rgba(255,255,255, 0.3)"}),(0,x.jsx)(Bt,{name:a("Username"),placeholder:null==(t=b.user)?void 0:t.username,value:c,setValue:u,width:"80%"}),n&&S&&(0,x.jsx)(te.FlatList,{contentContainerStyle:{flexGrow:1},data:S,renderItem:function(e){var t=e.item;return(0,x.jsx)(Zt,{item:t,selectedRef:i})}})]}),(0,x.jsxs)(me,{style:[{width:"100%",flexDirection:"row",padding:10},{justifyContent:"flex-end"}],children:[(0,x.jsx)(Ce,{title:a("invite"),onPress:function(){C.invite({channel_id:n,user_ids:(0,O.default)(i.current)}).then(P)}}),(0,x.jsx)(Ce,{title:a("cancel"),onPress:P})]})]})};function tn(e){var t=e.id,n=(0,Z.default)().lang,r=(0,o.useRef)(new Set),i={group:{title:"Group",component:function(){return(0,x.jsx)(Xt,{id:t,selectedRef:r})},icon:(0,x.jsx)(x.Fragment,{})},external:{title:"External members",component:function(){return(0,x.jsx)(en,{id:t,selectedRef:r})},icon:(0,x.jsx)(x.Fragment,{})}};return(0,x.jsx)(Ye,{children:(0,x.jsxs)(me,{style:{flex:1,width:"100%"},children:[(0,x.jsxs)(me,{style:{width:"100%"},children:[(0,x.jsx)(xe,{style:{fontSize:20},children:n("invite")}),(0,x.jsx)(me,{style:{marginBottom:20,height:1,width:"100%"},lightColor:"#ddd",darkColor:"rgba(255,255,255, 0.3)"})]}),(0,x.jsx)(Qt,{tabs:i,tabBarPosition:"top"})]})})}var nn=n(57438),rn=n.n(nn);function on(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function an(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?on(Object(n),!0).forEach((function(t){(0,w.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):on(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var sn=["AM","PM"].map((function(e){return{label:e,value:e}})),ln=(0,O.default)(Array(12).keys()).map((function(e,t){return(t+1).toString().padStart(2,"0")})).map((function(e){return{label:e,value:e}})),cn=(0,O.default)(Array(12).keys()).map((function(e,t){return(5*t).toString().padStart(2,"0")})).map((function(e){return{label:e,value:e}})),un=function(e){for(var t=e.clone().startOf("month").add(-1,"month"),n=e.clone().endOf("month").add(1,"month"),r=rn()().startOf("day"),o=[];t<=n&&t<r;)o.push(t.format("YYYY-MM-DD")),t=t.add(1,"day");return o},dn=function(){var e=rn()(),t=parseInt(e.format("mm"))%5;return e.add(5-t,"minute")},fn=o.lazy((function(){return Promise.all([n.e(289),n.e(164)]).then(n.bind(n,61164))})),hn=o.lazy((function(){return n.e(88).then(n.bind(n,4088))}));function gn(e){var t=e.datetime,n=e.callback,i=t?rn()(t):dn(),a=(0,Z.default)(),s=a.lang,l=a.locale,c=(0,de.default)(),u=(0,o.useState)(i.format("YYYY-MM-DD")),d=(0,r.default)(u,2),f=d[0],h=d[1],g=(0,o.useState)(i.locale("en").format("A")),p=(0,r.default)(g,2),y=p[0],m=p[1],b=(0,o.useState)(i.format("hh")),j=(0,r.default)(b,2),v=j[0],w=j[1],O=(0,o.useState)(i.format("mm")),S=(0,r.default)(O,2),C=S[0],P=S[1],k=(0,o.useState)(un(i)),D=(0,r.default)(k,2),E=D[0],M=D[1],_=Qe().setModal,T=function(){_(gn,null)};return $e(T,[]),(0,x.jsxs)(Je,{children:[(0,x.jsxs)(me,{style:{flexDirection:"row",width:"100%"},children:[(0,x.jsx)(me,{style:{flex:1,flexDirection:"row"},children:(0,x.jsx)(te.TouchableOpacity,{onPress:T,children:(0,x.jsx)(ne.Ionicons,{size:20,name:"arrow-back",color:ie[c].text})})}),(0,x.jsx)(me,{style:{flex:1},children:(0,x.jsx)(xe,{style:{fontSize:20,textAlign:"center"},children:s("Date & Time")})}),(0,x.jsx)(me,{style:{flex:1}})]}),(0,x.jsx)(me,{style:{marginBottom:20,height:1,width:"100%"},lightColor:"#ddd",darkColor:"rgba(255,255,255, 0.3)"}),(0,x.jsxs)(o.Suspense,{fallback:(0,x.jsx)(x.Fragment,{}),children:[(0,x.jsx)(fn,{locale:l,style:void 0,setDate:h,disableAllTouchEventsForDisabledDays:!0,onMonthChange:function(e){return M(un(rn()(e.dateString)))},markedDates:an(an({},E.reduce((function(e,t){return e[t]={disabled:!0},e}),{})),(f?[f]:[]).reduce((function(e,t){return e[t]={selected:!0},e}),{}))}),(0,x.jsxs)(me,{style:{flexDirection:"row",paddingVertical:10,width:400,height:50},children:[(0,x.jsx)(hn,{value:y,setValue:m,values:sn}),(0,x.jsx)(xe,{style:{fontSize:20},children:" "}),(0,x.jsx)(hn,{value:v,setValue:w,values:ln}),(0,x.jsx)(xe,{style:{fontSize:20},children:" : "}),(0,x.jsx)(hn,{value:C,setValue:P,values:cn})]})]}),(0,x.jsxs)(me,{style:{flexDirection:"row"},children:[(0,x.jsx)(Ce,{title:s("save"),onPress:function(){null==n||n(rn()(f+" "+v+":"+C+" "+y).toISOString()),T()}}),(0,x.jsx)(Ce,{title:s("cancel"),onPress:function(){null==n||n(void 0),T()}})]})]})}function pn(e,t){return e.year()!=t.year()?e.format("YYYY.MM"):e.month()!=t.month()||e.date()!=t.date()?e.format("MM.DD"):e.format("HH:mm")}function yn(e){return rn()(e).format("YYYY.MM.DD HH:mm")}var xn=function(e){var t=rn()(e.data.created),n=rn()(e.data.timer),r=t.diff(e.now)/t.diff(n);return(0,x.jsx)(K.default,{onPress:function(){return e.setExpand(e.isExpand?void 0:e.data.id)},children:(0,x.jsxs)($.default,{style:{backgroundColor:"lightgray",borderRadius:20,overflow:"hidden",margin:5},children:[(0,x.jsx)($.default,{style:{backgroundColor:"darkgray",position:"absolute",width:100*r+"%",height:"100%"}}),e.isExpand?(0,x.jsxs)($.default,{style:{paddingVertical:5,paddingHorizontal:5,maxWidth:270},children:[(0,x.jsxs)($.default,{style:{flexDirection:"row"},children:[(0,x.jsx)(ut,{name:e.data.name,userId:e.data.user,size:20}),(0,x.jsx)($.default,{style:{paddingHorizontal:5},children:(0,x.jsx)(xe,{children:e.data.name})})]}),e.data.timer&&(0,x.jsxs)($.default,{style:{flexDirection:"row",alignItems:"stretch"},children:[(0,x.jsx)(xe,{children:"\u231a"}),(0,x.jsx)(xe,{selectable:!0,children:yn(e.data.timer)})]}),(0,x.jsx)(tt.default,{linkDefault:!0,style:{wordBreak:"break-word"},linkStyle:{color:"#12b886"},children:(0,x.jsx)(xe,{selectable:!0,children:e.data.message_set[0].content})})]}):(0,x.jsxs)($.default,{style:{paddingVertical:5,paddingHorizontal:5,flexDirection:"row"},children:[(0,x.jsx)(ut,{name:e.data.name,userId:e.data.user,size:20}),(0,x.jsx)($.default,{style:{paddingHorizontal:5},children:(0,x.jsx)(xe,{children:pn(n,e.now)})})]})]})})};const mn=function(e){var t=function(e){var t=(0,C.useQueryClient)(),n=(0,C.useQuery)(["TimerMessageContentList",e],(0,S.default)((function*(){return yield(0,P.getTimerMessageContentList)(e,rn()().toISOString())})),{refetchOnReconnect:!1,refetchOnWindowFocus:!1}).data,r=R().lastJsonMessage;(0,o.useEffect)((function(){null!=r&&r.data.channel==e&&("next_message"==r.type&&r.data.timer&&rn()()<rn()(r.data.timer)&&t.setQueryData(["TimerMessageContentList",e],(function(e){return[].concat((0,O.default)(e||[]),[r.data])})),"update_message"==r.type&&t.setQueryData(["TimerMessageContentList",e],(function(e){return(0,O.default)((null==e?void 0:e.filter((function(e){return e.id!=r.data.id||null!=r.data.timer&&!r.data.is_archive})))||[])})))}),[r]);var i=(0,o.useMemo)((function(){return null==n?void 0:n.sort((function(e,t){return(e.timer||"")>(t.timer||"")?1:-1}))}),[n]);return(0,o.useEffect)((function(){var n;if(null!=i&&null!=(n=i[0])&&n.timer){var r=i[0].id,o=Math.min(rn()(i[0].timer).diff(rn()()),Number.MAX_VALUE),a=setTimeout((function(){t.setQueryData(["TimerMessageContentList",e],(function(e){return(e||[]).filter((function(e){return e.id!=r||rn()(e.timer).diff(rn()())>0}))}))}),o);return function(){return clearTimeout(a)}}}),[i]),i}(e.channel_id),n=(0,o.useState)(rn()()),i=(0,r.default)(n,2),a=i[0],s=i[1],l=(0,o.useState)(),c=(0,r.default)(l,2),u=c[0],d=c[1];return(0,o.useEffect)((function(){var e=setTimeout((function(){s(rn()())}),2e3);return function(){return clearTimeout(e)}}),[a]),(0,x.jsx)($.default,{style:{flexDirection:"row",paddingTop:5,paddingHorizontal:20},children:null==t?void 0:t.map((function(e,t){return(0,x.jsx)(xn,{data:e,now:a,isExpand:e.id==u,setExpand:d},t)}))})};function bn(e){var t=e.id,n=e.content,r=e.isOwner,o=e.isTimer,i=(0,Z.default)().lang,a=Qe().setModal,s=(0,de.default)(),l=Le(),c=function(){a(bn,null)};return $e(c,[]),(0,x.jsxs)(Je,{children:[(0,x.jsxs)(me,{style:{flexDirection:"row",width:"100%"},children:[(0,x.jsx)(me,{style:{flex:1,flexDirection:"row"},children:(0,x.jsx)(te.TouchableOpacity,{onPress:c,children:(0,x.jsx)(ne.Ionicons,{size:20,name:"arrow-back",color:ie[s].text})})}),(0,x.jsx)(me,{style:{flex:1},children:(0,x.jsx)(xe,{style:{fontSize:20,textAlign:"center"},children:i("Message")})}),(0,x.jsx)(me,{style:{flex:1}})]}),(0,x.jsx)(me,{style:{marginBottom:20,height:1,width:"100%"},lightColor:"#ddd",darkColor:"rgba(255,255,255, 0.3)"}),(0,x.jsx)(Ce,{style:{height:40,width:"100%",maxWidth:320,justifyContent:"center"},title:i("copy"),onPress:function(){$t.default.setString(n),c()}}),r&&o&&(0,x.jsx)(Ce,{style:{height:40,width:"100%",maxWidth:320,justifyContent:"center"},textStyle:{color:"red"},title:i("delete timer"),onPress:function(){l.patch({id:t,timer:null}),c()}}),r&&(0,x.jsx)(Ce,{style:{height:40,width:"100%",maxWidth:320,justifyContent:"center"},textStyle:{color:"red"},title:i("delete"),onPress:function(){l.patch({id:t,is_archive:!0}),c()}})]})}function jn(e){var t=e.id,n=e.member_id,i=e.type,a=(0,Z.default)().lang,s=(0,N.default)().auth,l=Qe().setModal,c=A(s),u=W(),d=F(),f=null==c?void 0:c.find((function(e){return e.id==t})),h=(0,o.useState)(""),g=(0,r.default)(h,2),p=g[0],y=g[1],m=(0,o.useState)(""),b=(0,r.default)(m,2),j=b[0],v=b[1],w=function(){l(jn,null)};return(0,o.useEffect)((function(){if(f){var e=ct(f,s.user).name;y(e),v((null==f?void 0:f.description)||"")}}),[null==f?void 0:f.id]),$e(w,[]),(0,x.jsx)(Ye,{children:(0,x.jsxs)(me,{style:{justifyContent:"space-between",flex:1,width:"100%"},children:[(0,x.jsxs)(me,{style:{width:"100%"},children:[(0,x.jsx)(xe,{style:{fontSize:20},children:a(t?"Chat Setting":"New chat")}),(0,x.jsx)(me,{style:vn.separator,lightColor:"#ddd",darkColor:"rgba(255,255,255, 0.3)"}),(0,x.jsx)(Bt,{name:a("Channel Name"),value:p,setValue:y,width:"60%"}),(0,x.jsx)(Bt,{name:a("Description"),value:j,setValue:v,multiline:!0,width:"60%"})]}),(0,x.jsxs)(me,{style:{width:"100%",flexDirection:"row"},children:[n&&(0,x.jsx)(me,{style:{flexDirection:"row",justifyContent:"flex-start"},children:(0,x.jsx)(Ce,{title:a("leave"),style:{marginHorizontal:5},textStyle:{color:"red"},onPress:function(){return d.leave(n).then(w)}})}),(0,x.jsxs)(me,{style:{flex:1,flexDirection:"row",justifyContent:"flex-end"},children:[(0,x.jsx)(Ce,{title:a("save"),onPress:function(){var e;if(null!=s&&null!=(e=s.user)&&e.id&&s.groupId){var n,r={id:t,name:p,description:j,type:i,owner:null==s||null==(n=s.user)?void 0:n.id,group:s.groupId};(t?u.update(r):u.create(r)).then((function(e){return jr("Main",{screen:"messenger"==e.type?"ChatScreen":"BoardScreen",params:{id:e.id}})}))}}}),(0,x.jsx)(Ce,{title:a("cancel"),style:{marginHorizontal:5},onPress:w})]})]})]})})}var vn=q.default.create({field:{width:"50%",flexDirection:"row",padding:10},separator:{marginBottom:20,height:1,width:"100%"}}),wn=function(e){return(0,x.jsxs)($.default,{style:{backgroundColor:"lightgray",borderRadius:20,overflow:"hidden",margin:5},children:[(0,x.jsx)($.default,{style:{backgroundColor:"darkgray",position:"absolute",width:100*(e.data.progress||0)+"%",height:"100%"}}),(0,x.jsxs)($.default,{style:{paddingVertical:5,paddingHorizontal:5,flexDirection:"row"},children:[(0,x.jsx)(xe,{children:"\ud83d\udce4"}),(0,x.jsx)($.default,{style:{paddingHorizontal:5},children:(0,x.jsx)(xe,{children:e.data.filename})})]})]})};const On=function(e){var t,n=Te().upload,i=(0,o.useState)(),a=(0,r.default)(i,2),s=a[0],l=a[1];return(0,x.jsx)($.default,{style:{flexDirection:"row",paddingTop:5,paddingHorizontal:20},children:null==(t=n[e.channel_id])?void 0:t.map((function(e,t){return(0,x.jsx)(wn,{data:e,index:t,isExpand:t==s,setExpand:l},t)}))})};function Sn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Cn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Sn(Object(n),!0).forEach((function(t){(0,w.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Sn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Pn=o.memo((function(e){for(var t,n=(0,nt.default)(),r=Qe().setModal,o=e.next;null!=(i=o)&&i.next&&0==o.current.length;){var i;o=o.next}var a=null==(t=o)?void 0:t.current[0];return(0,x.jsx)($.default,{style:{flexDirection:"column-reverse"},children:e.current.map((function(t,o){var i=o+1<e.current.length?e.current[o+1]:a,s=t.created.slice(0,16),l=s.slice(0,10),c=null==t.user,u=void 0==i||t.user!=i.user||s!=i.created.slice(0,16),d=e.ownerId==t.user,f=void 0==i||l!=i.created.slice(0,10),h=t.message_set[0];return c?(0,x.jsx)($.default,{style:{flexDirection:"row",justifyContent:"center",width:"100%",marginVertical:5},children:(0,x.jsx)(xe,{children:h.content})},t.id):(0,x.jsxs)($.default,{children:[f?(0,x.jsx)($.default,{style:{flexDirection:"row",justifyContent:"center",width:"100%"},children:(0,x.jsx)(xe,{children:l})}):void 0,(0,x.jsxs)($.default,{style:{flexDirection:"row",justifyContent:d?"space-between":"flex-start",width:"100%"},children:[u&&!d?(0,x.jsx)($.default,{style:{marginTop:3,marginLeft:12},children:(0,x.jsx)(ut,{name:t.name,userId:t.user,size:36})}):(0,x.jsx)($.default,{style:{width:48}}),(0,x.jsx)(be,{autoScale:!0,outerContainerStyle:{maxWidth:"90%"},title:u?t.name:void 0,titleStyle:{flex:void 0},bodyStyle:{padding:10},subtitle:""+s.slice(11),children:(0,x.jsxs)(K.default,{onLongPress:function(){return r(bn,{id:t.id,content:h.content,isOwner:d,isTimer:!!t.timer})},children:[t.timer&&(0,x.jsxs)($.default,{style:{flexDirection:"row",alignItems:"stretch"},children:[(0,x.jsx)(xe,{style:{fontSize:12},children:"\u231a"}),(0,x.jsx)(xe,{style:{fontSize:12},selectable:!n,children:yn(t.timer)})]}),(0,x.jsx)($.default,{style:{width:"100%"},children:(0,x.jsx)(tt.default,{linkDefault:!0,style:{wordBreak:"break-word"},linkStyle:{color:"#12b886"},children:(0,x.jsx)(xe,{selectable:!n,style:{textAlign:d?"right":"left"},children:h.content})})}),t.attatchment_set.map((function(e,t){return"file"==e.type?(0,x.jsx)(Mt,{file:e,isMobile:n,showBorder:!1},t):"link"==e.type?(0,x.jsx)(ot,{link:e,isMobile:n},t):void 0}))]})})]},t.id)]},t.id)}))})}));var kn=n(14999),Dn=n(84953);function En(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Mn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?En(Object(n),!0).forEach((function(t){(0,w.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):En(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const _n=function(e){return(0,x.jsxs)($.default,{style:{width:"100%",height:135,justifyContent:"space-evenly",alignItems:"center"},children:[(0,x.jsx)(ut,Mn(Mn({},e),{},{size:75})),(0,x.jsx)(xe,{style:{fontWeight:"bold",fontSize:15},children:e.name}),(0,x.jsx)(xe,{style:{fontWeight:"normal",fontSize:14},children:e.username})]})};function Tn(e){var t,n=e.id,r=(0,Z.default)().lang,i=(0,de.default)(),a=(0,N.default)().auth,s=Qe().setModal,l=_t(a),c=null==l?void 0:l.find((function(e){return e.id==n})),u=a.user&&c&&(null==(t=a.user)?void 0:t.id)==(null==c?void 0:c.id),d=W(),f=function(){s(Tn,null)};return(0,o.useEffect)((function(){n&&c||!l||f()}),[l]),$e(f,[]),c?(0,x.jsxs)(Je,{children:[(0,x.jsxs)(me,{style:{flexDirection:"row",width:"100%"},children:[(0,x.jsx)(me,{style:{flex:1,flexDirection:"row"},children:(0,x.jsx)(te.TouchableOpacity,{onPress:f,children:(0,x.jsx)(ne.Ionicons,{size:20,name:"arrow-back",color:ie[i].text})})}),(0,x.jsx)(me,{style:{flex:1},children:(0,x.jsx)(xe,{style:{fontSize:20,textAlign:"center"},children:r("profile")})}),(0,x.jsx)(me,{style:{flex:1}})]}),(0,x.jsx)(me,{style:{marginBottom:20,height:1,width:"100%"},lightColor:"#ddd",darkColor:"rgba(255,255,255, 0.3)"}),(0,x.jsx)(_n,{username:c.username,name:c.name,userId:c.id}),(0,x.jsx)(Ce,{title:r(u?"Chat with me":"1:1 Chat"),onPress:function(){var e;if(null!=a&&null!=(e=a.user)&&e.id&&a.groupId){var t,n={name:"",type:"messenger",owner:null==a||null==(t=a.user)?void 0:t.id,group:a.groupId,subowner:u?void 0:c.id};d.direct(n).then((function(e){return jr("Main",{screen:"ChatScreen",params:{id:e.id}})}))}}})]}):(0,x.jsx)(x.Fragment,{})}var zn=n(31675),In=(n(93708),n(22362));function Rn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ln(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Rn(Object(n),!0).forEach((function(t){(0,w.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Rn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Bn=n(84417),An=Bn.messagingSenderId,Hn=D.FCM_API_KEY.split("").map((function(e,t){return(e.charCodeAt(0)^An.charCodeAt(t)).toString(16).padStart(2,"0")})).join(""),Wn=zn.default.initializeApp(Ln(Ln({},Bn),{},{apiKey:D.FCM_API_KEY})),Vn=zn.default.messaging(Wn);Vn.onMessage((function(e){if("Notification"in window){if("granted"===Notification.permission){var t=JSON.parse(e.data.message_set)[0];new Notification(e.data.channel_name,{body:e.data.name+": "+t.content})}}else alert("This browser does not support desktop notification")}));var Fn=function(){var e=(0,S.default)((function*(){if("granted"===(yield Notification.requestPermission())){var e=yield navigator.serviceWorker.register("/tokki-tok/firebase-messaging-sw.js?"+Hn);console.log("[SW]: SCOPE: ",e.scope);var t=yield Vn.getToken({serviceWorkerRegistration:e,vapidKey:D.FCM_PUBLIC_VAPID_KEY}).catch((0,S.default)((function*(){return yield Vn.getToken({serviceWorkerRegistration:e,vapidKey:D.FCM_PUBLIC_VAPID_KEY})})));if(window.addEventListener("beforeunload",(function(t){t.preventDefault(),e.unregister()})),t)return t}return null}));return function(){return e.apply(this,arguments)}}(),Un=(0,o.createContext)({setEnable:function(){}}),Nn=function(e){var t=e.user,n=e.children,i=(0,o.useRef)(),a=(0,o.useState)(),s=(0,r.default)(a,2),l=s[0],c=s[1],u=(0,o.useMemo)((function(){return void 0===l?void 0:!(null==l||!l.token)}),[l]);return(0,o.useEffect)((function(){var e=!0;return t&&(void 0===i.current&&(i.current=null,Fn().then((function(t){i.current=t,l&&(0,In.putNotification)(Ln(Ln({},l),{},{token:i.current})).then((function(t){e&&c(t)}))}))),void 0===l?(0,In.getNotification)(t.id).then((function(t){e&&c(t||null)})):null===l?(0,In.postNotification)({user:t.id,type:"WEB",token:null}).then((function(t){e&&c(t)})):l.token&&i.current&&i.current!=l.token&&(0,In.putNotification)(Ln(Ln({},l),{},{token:i.current})).then((function(t){e&&c(t)}))),function(){e=!1}}),[t,l]),(0,x.jsx)(Un.Provider,{value:{enable:u,setEnable:function(e){t&&l&&(0,In.putNotification)(Ln(Ln({},l),{},{token:e?void 0==i.current?null:i.current:null})).then((function(e){c(e)}))}},children:(void 0!=u||null===t)&&n})};var Gn=function(e){var t=(0,Z.default)().lang;return e.message?(0,x.jsx)(me,{style:Yn.form_error,children:(0,x.jsx)(xe,{style:Yn.form_error_text,children:t(e.message)})}):(0,x.jsx)(x.Fragment,{})};function Qn(e){var t=e.id,n=(0,Z.default)().lang,i=(0,N.default)().auth,a=Qe().setModal,s=(0,o.useState)(""),l=(0,r.default)(s,2),c=l[0],u=l[1],d=(0,o.useState)(""),f=(0,r.default)(d,2),h=f[0],g=f[1],p=(0,o.useState)(""),y=(0,r.default)(p,2),m=y[0],b=y[1],j=(0,o.useState)(""),v=(0,r.default)(j,2),w=v[0],O=v[1],S=(0,o.useState)(!1),k=(0,r.default)(S,2),D=k[0],E=(k[1],(0,o.useState)({})),M=(0,r.default)(E,2),_=M[0],T=M[1],z=_t(i),I=Tt(c),R=function(){var e=(0,C.useQueryClient)(),t=(0,N.default)(),n=t.auth,r=t.dispatch,o=(0,C.useMutation)(P.postUser,{onSuccess:function(){e.invalidateQueries("UserMembershipList")}}),i=(0,C.useMutation)(P.patchUser,{onSuccess:function(t,o){var i;o.id==(null==(i=n.user)?void 0:i.id)?o.username&&o.password?r({type:"LOGIN_REQUEST",username:o.username,password:o.password}):r({type:"REFRESH"}):e.invalidateQueries("UserMembershipList")}}),a=(0,C.useMutation)(P.deleteUser,{onSuccess:function(t,o){var i;e.invalidateQueries("UserMembershipList"),o==(null==(i=n.user)?void 0:i.id)&&r({type:"LOGOUT_REQUEST"})}});return{create:o.mutateAsync,update:i.mutateAsync,delete:a.mutateAsync}}(),L=null==z?void 0:z.find((function(e){return e.id==t})),B=L&&!1===L.is_guest;(0,o.useEffect)((function(){L&&(u(L.username),g(L.name))}),[null==L?void 0:L.id]);var A=function(){a(Qn,null)};return(0,x.jsx)(Ye,{children:(0,x.jsxs)(me,{style:{justifyContent:"space-between",flex:1,width:"100%"},children:[(0,x.jsxs)(me,{style:{flex:1,width:"100%"},children:[(0,x.jsx)(xe,{style:{fontSize:20},children:n(B?"Edit User":"Create User")}),(0,x.jsx)(me,{style:Yn.separator,lightColor:"#ddd",darkColor:"rgba(255,255,255, 0.3)"}),(0,x.jsxs)(It,{name:n("Username"),width:"60%",children:[B?(0,x.jsx)(xe,{style:{fontSize:16},children:c}):(0,x.jsx)(zt,{value:c,setValue:function(e){return u(e)},keyboardType:"email-address"}),(0,x.jsx)(Gn,{message:_.username})]}),(0,x.jsxs)(It,{name:n("Name"),width:"60%",children:[(0,x.jsx)(zt,{value:h,setValue:function(e){return g(e)}}),(0,x.jsx)(Gn,{message:_.name})]}),(0,x.jsxs)(It,{name:n("Password"),width:"60%",children:[(0,x.jsx)(zt,{value:m,secureTextEntry:!0,setValue:function(e){return b(e)}}),(0,x.jsx)(Gn,{message:_.password})]}),(0,x.jsxs)(It,{name:n("Check Password"),width:"60%",children:[(0,x.jsx)(zt,{value:w,secureTextEntry:!0,setValue:function(e){return O(e)}}),(0,x.jsx)(Gn,{message:_.checkPassword})]})]}),(0,x.jsxs)(me,{style:{width:"100%",flexDirection:"row"},children:[t&&(0,x.jsx)(me,{style:{flexDirection:"row",justifyContent:"flex-start"},children:(0,x.jsx)(Ce,{title:n("delete account"),style:{marginHorizontal:5},textStyle:{color:"red"},onPress:function(){return R.delete(t).then(A)}})}),(0,x.jsxs)(me,{style:{flex:1,flexDirection:"row",justifyContent:"flex-end"},children:[(0,x.jsx)(Ce,{title:n("save"),onPress:function(){var e={};((null==I?void 0:I.length)||0)>0&&!B&&(e.username="The username is already in use."),(c.length<10||c.length>64)&&(e.username="Set 10-64 characters."),(h.length<1||h.length>64)&&(e.name="Set 1-64 characters."),/^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*#?&])[A-Za-z\d@$!%*#?&]{10,64}$/.test(m)||B&&0==m.length||(e.password="Set 10-64 characters with a combination of letters/numbers/valid special characters."),m!=w&&(e.checkPassword="Incorrect between password and check password."),Object.keys(e).length>0?T(e):t?R.update({id:t,name:h,username:B?void 0:c,is_guest:!1,password:m.length>0?m:void 0}).then((function(){var e;(t!=(null==(e=i.user)?void 0:e.id)||(null==L?void 0:L.is_guest))&&A()})):(null==i?void 0:i.groupId)&&R.create({username:c,name:h,password:m,is_guest:!1,is_staff:D,inviteGroupId:i.groupId}).then(A)}}),(0,x.jsx)(Ce,{title:n("cancel"),style:{marginHorizontal:5},onPress:A})]})]})]})})}var Yn=q.default.create({form_error:{height:22,width:"100%"},form_error_text:{textAlignVertical:"center",color:"red",fontSize:13},separator:{marginBottom:20,height:1,width:"100%"}}),Jn=function(e){var t=e.title,n=e.children,r=(0,de.default)(),o=ie[r].text;return(0,x.jsxs)(be,{bodyStyle:{alignItems:"flex-start",backgroundColor:"light"==r?"transparent":"black"},children:[(0,x.jsx)(Y.default,{style:{fontSize:20,color:o,fontWeight:"600"},children:t}),n]})};const Kn=function(){var e,t=(0,Z.default)(),n=t.lang,i=t.locale,s=t.setLocale,l=Qe().setModal,c=(0,N.default)().auth,u=(0,de.default)(),d=(0,a.useColorScheme)(),f=function(){var e=(0,o.useContext)(Un);return{enable:e.enable,setEnable:e.setEnable}}(),h=f.enable,g=f.setEnable,p=ie[u].text;return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(Jn,{title:n("* Notification Settings"),children:(0,x.jsx)($.default,{style:{flexDirection:"row"},children:[[n("On"),!0],[n("Off"),!1]].map((function(e){var t=(0,r.default)(e,2),n=t[0],o=t[1];return(0,x.jsx)(He,{title:n||"",textStyle:{fontSize:16,color:p,textDecorationLine:h==o?"underline":"none"},style:{borderRadius:20},onPress:function(){g(o)}},n)}))})}),(0,x.jsx)(Jn,{title:n("* Language Settings"),children:(0,x.jsx)($.default,{style:{flexDirection:"row"},children:[[n("Auto"),"auto"],["\ud55c\uad6d\uc5b4","ko"],["English","en"]].map((function(e){var t=(0,r.default)(e,2),n=t[0],o=t[1];return(0,x.jsx)(He,{title:n||"",textStyle:{fontSize:16,color:p,textDecorationLine:i==o?"underline":"none"},style:{borderRadius:20},onPress:function(){return s(o)}},n)}))})}),(0,x.jsx)(Jn,{title:n("* Skin Settings"),children:(0,x.jsx)($.default,{style:{flexDirection:"row"},children:[[n("Auto"),"no-preference"],[n("Light"),"light"],[n("Dark"),"dark"]].map((function(e){var t=(0,r.default)(e,2),n=t[0],o=t[1];return(0,x.jsx)(He,{title:n,textStyle:{fontSize:16,color:p,textDecorationLine:d==o?"underline":"none"},style:{borderRadius:20},onPress:function(){return(0,de.setColorScheme)(o)}},n)}))})}),!(null!=(e=c.user)&&e.is_guest)&&(0,x.jsx)(be,{bodyStyle:{alignItems:"flex-start",backgroundColor:"light"==u?"transparent":"black"},children:(0,x.jsx)(He,{title:n("> Account Settings"),textStyle:{fontSize:20,color:p},style:{paddingLeft:0,borderRadius:20},onPress:function(){var e;return l(Qn,{id:null==(e=c.user)?void 0:e.id})}})})]})};var $n=function(){var e=(0,N.default)().auth,t=(0,de.default)(),n=Qe().setModal,r=_t(e),i=o.useMemo((function(){return r&&r.map((function(e,t){return(0,x.jsx)(Kt,{member:e,onPress:function(){return n(Tn,{id:e.id})}},t)}))}),[r]);return(0,x.jsx)(kn.default,{style:{flex:1,backgroundColor:ie[t].background},children:i})},qn=function(){var e=(0,N.default)().auth,t=H(e),n=(0,de.default)(),r=(new Date).toISOString().slice(0,10);return(0,x.jsx)(kn.default,{style:{flex:1,backgroundColor:ie[n].background},children:null==t?void 0:t.map((function(t,o){var i,a,s,l,c=ct(t,e.user),u=c.avatar,d=c.name,f=null==(i=t.last_message)?void 0:i.created.slice(0,10),h=(null==(a=t.last_message)?void 0:a.preview_content)||(null==(s=t.last_message)?void 0:s.content)||"";return(0,x.jsxs)(Yt,{bodyStyle:{flexDirection:"row",justifyContent:"space-between"},onPress:function(){return jr("ChatScreen",{id:t.id})},children:[(0,x.jsxs)($.default,{style:{flexDirection:"row",flexShrink:1},children:[u?(0,x.jsx)($.default,{style:{marginRight:20},children:(0,x.jsx)(ut,{name:u.name,size:44,userId:u.id})}):(0,x.jsx)(ne.FontAwesome,{size:40,color:ie[n].iconColor,style:{marginBottom:-3,marginRight:20},name:"users"}),(0,x.jsxs)($.default,{children:[(0,x.jsxs)($.default,{style:{flexDirection:"row"},children:[(0,x.jsx)(xe,{style:{fontSize:18},children:d}),(0,x.jsx)(xe,{style:{fontSize:18,opacity:.4,paddingLeft:5},children:t.member_count})]}),(0,x.jsx)(xe,{style:{fontSize:16,opacity:.4},children:h.replaceAll("\n"," ")})]})]}),(0,x.jsxs)($.default,{children:[(0,x.jsx)(xe,{style:{fontSize:14,opacity:.4,textAlign:"right"},children:f==r?null==(l=t.last_message)?void 0:l.created.slice(11,16):f}),(0,x.jsx)(xe,{style:{fontSize:14,textAlign:"right"},children:t.unread_count?t.unread_count:" "})]})]},o)}))})},Zn=function(){var e=(0,de.default)();return(0,x.jsx)(kn.default,{style:{flex:1,backgroundColor:ie[e].background},children:(0,x.jsx)(Kn,{})})},Xn=function(e){var t=ie[e].iconColor;return{OneTab:{title:"member",component:$n,icon:(0,x.jsx)(ne.MaterialCommunityIcons,{size:32,color:t,style:{marginBottom:-3},name:"account"})},TwoTab:{title:"chat",component:qn,icon:(0,x.jsx)(ne.Ionicons,{size:30,color:t,style:{marginBottom:-3},name:"chatbox"})},FourTab:{title:"config",component:Zn,icon:(0,x.jsx)(ne.SimpleLineIcons,{size:30,color:t,style:{marginBottom:-3},name:"options"})}}};var er={HomeScreen:{title:"home",component:function(e){var t,n=e.navigation,i=e.route,a=(0,Z.default)(),s=a.lang,l=a.locale,c=v(),u=(0,de.default)(),d=Qe().setModal,f=(0,N.default)().auth,h=(0,o.useState)("landscape"==c),g=(0,r.default)(h,2),p=g[0],y=g[1],m=ie[u].text,b=[{title:s("member"),headerRight:function(){return(0,x.jsx)(et,{extra:[{title:s("create"),onPress:function(){var e;return d(Qn,null!=(e=f.user)&&e.is_guest?{id:f.user.id}:{})}}]})}},{title:s("chat"),headerRight:function(){return(0,x.jsx)(et,{extra:[{title:s("create"),onPress:function(){return d(jn,{type:"messenger"})}}]})}},{title:s("config"),headerRight:function(){return(0,x.jsx)(et,{})}}];return(0,o.useLayoutEffect)((function(){var e,t=0|(null==i||null==(e=i.params)?void 0:e.tab);n.setOptions("portrait"==c?b[t]:{title:s("home"),headerRight:function(){return(0,x.jsx)(et,{})}})}),[n,i,c,l]),(0,o.useEffect)((function(){y("landscape"==c)}),[c]),p?(0,x.jsxs)(kn.default,{contentContainerStyle:{flex:1,alignItems:"center"},children:[(0,x.jsxs)($.default,{style:{flexGrow:1,width:"80%",marginTop:72},children:[(0,x.jsx)(Dn.default,{style:{fontSize:32,color:m},children:"Tokki Tok"}),(0,x.jsx)($.default,{style:{backgroundColor:ie.borderColor,height:1,width:"100%"}}),(0,x.jsx)($.default,{style:{height:24}}),(0,x.jsx)(be,{bodyStyle:{alignItems:"flex-start",backgroundColor:"light"==u?"transparent":"black"},children:(0,x.jsx)(He,{title:s("+ New chat"),textStyle:{fontSize:20,color:m},style:{paddingLeft:0,borderRadius:20},onPress:function(){return d(jn,{type:"messenger"})}})}),(0,x.jsx)(Kn,{})]}),(0,x.jsx)(se,{theme:u})]}):(0,x.jsx)(Qt,{tabs:Xn(u),tabBarPosition:"bottom",index:parseInt((null==(t=i.params)?void 0:t.tab)||0),onTab:function(e){n.setParams({tab:e})}})},path:"home"},ChatScreen:{title:"chat",component:function(e){var t,n,i=e.navigation,a=e.route,s=(0,Z.default)(),l=s.lang,c=s.locale,u=(0,nt.default)(),d=null==a||null==(t=a.params)?void 0:t.id,f=(0,o.useRef)(0),h=(0,o.useRef)(null),g=(0,N.default)().auth,p=Qe().setModal,y=null==(n=A(g))?void 0:n.find((function(e){return e.id==parseInt(d)})),m=y?ct(y,g.user):void 0,b=function(e){var t=(0,C.useQueryClient)(),n=(0,C.useInfiniteQuery)(["MessengerContentList",e],function(){var t=(0,S.default)((function*(t){var n=t.pageParam;return(0,P.getMessengerContentList)(e,n).then((function(e){return{current:e}}))}));return function(e){return t.apply(this,arguments)}}(),{select:function(e){return e.pages.length>1&&(e.pages[e.pages.length-2].next=e.pages[e.pages.length-1]),e},getNextPageParam:function(e){return null!=e&&e.current.length?e.current[e.current.length-1].id:void 0},refetchOnReconnect:!1,refetchOnWindowFocus:function(n){var r=new Date(n.state.dataUpdatedAt).toISOString(),o=Ie({},n.state.data);return(0,P.getNewMessengerContentList)(e,r).then((function(n){if(o.pages){var r=o.pages[0].current[0].id||0,i=n.filter((function(e){return e.id>r&&0==e.is_archive})),a=n.filter((function(e){return e.id<=r})),s=i.findIndex((function(e){return e.timer}))>=0||a.length>0;o.pages[0].current=[].concat((0,O.default)(i),(0,O.default)(o.pages[0].current)),Re(o.pages,a),s&&t.invalidateQueries(["TimerMessageContentList",e])}})),!1}}),r=n.data,i=n.fetchNextPage,a=R().lastJsonMessage;return(0,o.useEffect)((function(){null!=a&&a.data.channel==e&&("next_message"==a.type&&t.setQueryData(["MessengerContentList",e],(function(e){return null!=e&&e.pages[0].current&&(null==e?void 0:e.pages[0].current[0].id)!=a.data.id&&(e.pages[0].current=[a.data].concat((0,O.default)(null==e?void 0:e.pages[0].current))),Ie({},e||{pages:[],pageParams:[]})})),"update_message"==a.type&&t.setQueryData(["MessengerContentList",e],(function(e){return(null==e?void 0:e.pages)&&Re(e.pages,[a.data]),Ie({},e||{pages:[],pageParams:[]})})))}),[a]),{data:r,fetchNextPage:i}}(d),j=b.data,w=b.fetchNextPage,k=V(d),D=(0,o.useMemo)((function(){var e;return null==k||null==(e=k.find((function(e){var t;return e.user==(null==(t=g.user)?void 0:t.id)})))?void 0:e.id}),[g,k]),E=v(),M=(0,o.useState)(""),_=(0,r.default)(M,2),T=_[0],z=_[1],I=(0,o.useState)(),L=(0,r.default)(I,2),B=L[0],H=L[1],W=(0,o.useState)(null),F=(0,r.default)(W,2),U=F[0],G=F[1],Q=(0,o.useState)(!1),Y=(0,r.default)(Q,2),J=Y[0],K=Y[1],q=(0,o.useState)(!1),X=(0,r.default)(q,2),re=X[0],oe=X[1],ae=(0,o.useMemo)((function(){return re?1:T.split("\n").length}),[T,re]),se=(0,de.default)(),le=function(){var e;T.length>0&&(ce.create({channel:d,user:null==(e=g.user)?void 0:e.id,content:T,timer:B}),z(""),H(void 0),oe(!1),G(!0))},ce=Le();(0,o.useLayoutEffect)((function(){i.setOptions({headerRight:function(){return(0,x.jsx)(et,{extra:[{title:l("invite"),onPress:function(){return p(tn,{id:d})}},{title:l("setting"),onPress:function(){return p(jn,{id:d,type:"messenger",member_id:D})}}]})},title:null==m?void 0:m.name})}),[i,a,D,c]);var ue,fe=(0,o.useCallback)((function(e){var t,n=e.item;e.index;return(0,x.jsx)(Pn,Cn(Cn({},n),{},{ownerId:null==(t=g.user)?void 0:t.id}))}),[g]),he=function(){i.canGoBack()?i.goBack():i.navigate("HomeScreen",{tab:2})};return(0,o.useEffect)((function(){p(null,null),d||he()}),[a]),(0,o.useEffect)((function(){(null===k||void 0!=k&&void 0==k.find((function(e){var t;return e.user==(null==(t=g.user)?void 0:t.id)})))&&he()}),[k]),(0,o.useEffect)((function(){U&&(h.current.focus(),G(!1))}),[U]),(0,o.useEffect)((function(){if(null==U&&!u){var e=setTimeout((function(){return G(!0)}),500);return function(){return clearTimeout(e)}}})),(0,x.jsxs)($.default,{style:[{flex:1,alignItems:"center"},"landscape"==E?{flexDirection:"row-reverse",minWidth:480}:{flexDirection:"column"}],children:[(0,x.jsx)(Dt,{channel_id:d,setDisable:function(e){return K(!e)},disable:!J}),(0,x.jsxs)($.default,{style:[J?{flexShrink:1}:{flex:1},"landscape"==E?{minWidth:320,height:"100%"}:{width:"100%"}],children:[(0,x.jsx)(te.FlatList,{style:{flexDirection:"column-reverse"},contentContainerStyle:{padding:10,flexGrow:1,flexDirection:"column-reverse"},data:null==j?void 0:j.pages,renderItem:fe,onScroll:function(e){e.nativeEvent.contentOffset.y+e.nativeEvent.contentSize.height-f.current<1&&w()},onLayout:function(e){f.current=e.nativeEvent.layout.height}}),(0,x.jsxs)($.default,{style:{position:"absolute",flexDirection:"row"},children:[(0,x.jsx)(On,{channel_id:d}),(0,x.jsx)(mn,{channel_id:d})]}),(0,x.jsxs)(me,{style:{bottom:0,width:"100%",paddingTop:15,paddingBottom:10,paddingHorizontal:19},children:[(0,x.jsxs)($.default,{style:{alignItems:"center",width:"100%",flexDirection:"row"},children:[(0,x.jsx)(Ce,{title:"",style:{height:"100%",paddingTop:8,borderTopRightRadius:0,borderBottomRightRadius:0,justifyContent:"center"},onPress:function(){return oe(!re)},children:(0,x.jsx)($.default,{style:{top:-2},children:(0,x.jsx)(ne.Entypo,{name:re?"cross":"plus",size:24,color:ie[se].text})})}),B&&(0,x.jsx)(Ce,{style:{height:"100%",paddingTop:8,borderRadius:0},title:"\u231a"+(ue=B,pn(rn()(ue),rn()())),onPress:function(){p(gn,{datetime:B,callback:function(e){return H(e)}}),oe(!1)}}),(0,x.jsx)(te.TextInput,{ref:h,value:T,onChangeText:z,onKeyPress:function(e){if(!u){var t=e;t.shiftKey||"Enter"!==t.key||(le(),t.preventDefault())}},style:{flex:1,borderWidth:1,minHeight:40,borderColor:ie.borderColor,backgroundColor:ie[se].background,color:ie[se].text},onFocus:function(){return oe(!1)},multiline:!0,numberOfLines:ae}),(0,x.jsx)(Ce,{style:{height:"100%",paddingTop:8,borderTopLeftRadius:0,borderBottomLeftRadius:0,justifyContent:"center"},title:"\ud83d\udcac",onPress:le})]}),re&&(0,x.jsxs)($.default,{style:{alignItems:"center",width:"100%",flexDirection:"row",paddingTop:15,paddingBottom:5},children:[(0,x.jsx)(Ce,{style:{height:80,flex:1,justifyContent:"center",marginRight:15},title:"\ud83d\udce4\n "+l("File"),onPress:function(){return new Promise((function(e,t){if("web"==ee.default.OS){var n=document.createElement("input");n.type="file",n.onchange=function(t){e(t.target.files[0])},n.onabort=t,n.onerror=t,n.click()}else e(void 0)})).then((function(e){var t;ce.create({channel:d,user:null==(t=g.user)?void 0:t.id,content:"",file:e}),oe(!1)}))}}),(0,x.jsx)(Ce,{style:{height:80,flex:1,justifyContent:"center",marginRight:15},title:"\u231a\n "+l("Timer"),onPress:function(){p(gn,{datetime:B,callback:function(e){return H(e)}}),oe(!1)}}),(0,x.jsx)(Ce,{style:{height:80,flex:1,justifyContent:"center"},title:"\ud83d\udcf9\n "+l("Video Call"),onPress:function(){K(!J),oe(!1)},disabled:J})]})]})]})]})},path:"chat"}},tr={LoginScreen:{path:"login",title:"Sign in",component:function(e){var t=e.navigation,n=(e.route,(0,Z.default)().lang),i=(0,o.useState)(""),a=(0,r.default)(i,2),s=a[0],l=a[1],c=(0,o.useState)(""),u=(0,r.default)(c,2),d=u[0],f=u[1],h=(0,N.default)(),g=h.error,p=h.dispatch,y=function(){return p({type:"LOGIN_REQUEST",username:s,password:d})};return(0,o.useEffect)((function(){t.setOptions({headerRight:void 0})}),[t]),(0,x.jsxs)($.default,{style:ce.login_container,children:[(0,x.jsxs)($.default,{style:ce.login_wrapper,children:[(0,x.jsxs)($.default,{style:ce.form,children:[g&&(0,x.jsx)($.default,{style:ce.form_error,children:(0,x.jsx)(Y.default,{style:ce.form_error_text,children:n(g)})}),(0,x.jsx)(J.default,{style:ce.form_input,value:s,placeholder:n("Username"),onChangeText:function(e){return l(e)},autoCapitalize:"none",keyboardType:"email-address",onSubmitEditing:y}),(0,x.jsx)(J.default,{style:ce.form_input,value:d,placeholder:n("Password"),secureTextEntry:!0,onChangeText:function(e){return f(e)},onSubmitEditing:y}),(0,x.jsx)(K.default,{onPress:y,children:(0,x.jsx)($.default,{style:ce.button,children:(0,x.jsx)(Y.default,{style:ce.button_label,children:n("Sign in")})})}),(0,x.jsx)(K.default,{onPress:function(){return p({type:"LOGIN_GUEST"})},children:(0,x.jsx)(Y.default,{style:ce.guest_footer_text,children:n("Sign in as guest")})})]}),(0,x.jsxs)($.default,{style:ce.login_social,children:[(0,x.jsxs)($.default,{style:ce.login_social_separator,children:[(0,x.jsx)($.default,{style:ce.login_social_separator_line}),(0,x.jsx)(Y.default,{style:ce.login_social_separator_text,children:"*"}),(0,x.jsx)($.default,{style:ce.login_social_separator_line})]}),(0,x.jsx)($.default,{style:ce.login_social_buttons})]})]}),(0,x.jsx)(se,{theme:"light"})]})}},DemoScreen:{title:"",component:function(e){var t=e.navigation,n=(0,N.default)().dispatch;return(0,o.useLayoutEffect)((function(){t.setOptions({headerRight:void 0}),n({type:"LOGIN_GUEST"})}),[]),(0,x.jsx)(x.Fragment,{})},path:"demo"}},nr={},rr=n(89212);function or(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ir(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?or(Object(n),!0).forEach((function(t){(0,w.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):or(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ar="tokki-tok";Object.values(nr).forEach((function(e){return e.path=ar+"/"+e.path}));const sr={prefixes:[rr.makeUrl("/")],config:{screens:ir({Main:{screens:ir(ir(ir({},er),tr),{},{NotFound:"*"}),path:ar}},nr)}};function lr(e){var t=e.navigation,n=(0,Z.default)().lang,r=(0,N.default)().auth;return(0,x.jsxs)($.default,{style:cr.container,children:[(0,x.jsx)(Y.default,{style:cr.title,children:n("This screen doesn't exist.")}),(0,x.jsx)(K.default,{onPress:function(){return t.replace(r.user?"HomeScreen":"LoginScreen")},style:cr.link,children:(0,x.jsx)(Y.default,{style:cr.linkText,children:n("Go to home screen!")})})]})}var cr=q.default.create({container:{flex:1,backgroundColor:"#fff",alignItems:"center",justifyContent:"center",padding:20},title:{fontSize:20,fontWeight:"bold"},link:{marginTop:15,paddingVertical:15},linkText:{fontSize:14,color:"#2e78b7"}}),ur=n(70434),dr=function(){var e=(0,N.default)().auth,t=Qe().setModal,n=_t(e);return(0,x.jsx)($.default,{style:{flex:1},children:null==n?void 0:n.map((function(e,n){return(0,x.jsx)(Yt,{containerStyle:{marginHorizontal:0},bodyStyle:{alignItems:"flex-start"},onPress:function(){return t(Tn,{id:e.id})},children:(0,x.jsx)(xe,{style:{marginLeft:20},children:e.name})},n)}))})},fr=function(){var e=(0,N.default)().auth,t=H(e);return(0,x.jsx)($.default,{style:{flex:1},children:null==t?void 0:t.map((function(t,n){var r=ct(t,e.user).name;return(0,x.jsx)(Yt,{containerStyle:{marginHorizontal:0},bodyStyle:{alignItems:"flex-start"},onPress:function(){return jr("ChatScreen",{id:t.id})},children:(0,x.jsx)(xe,{style:{marginLeft:20},children:r})},n)}))})};const hr=function(e){var t=e.auth,n=(0,ur.default)().colors,i=(0,de.default)(),a=v(),s=H(t),l=(0,o.useState)(),c=(0,r.default)(l,2),u=c[0],d=c[1],f=Qe().setModal,h=[function(){var e;return f(Qn,null!=(e=t.user)&&e.is_guest?{id:t.user.id}:{})},function(){return f(jn,{type:"messenger"})}],g=function(e){var t=ie[e].iconColor;return{MemberTab:{title:"member",component:dr,icon:(0,x.jsx)(ne.MaterialCommunityIcons,{size:32,color:t,style:{marginBottom:-3},name:"account"})},ChatTab:{title:"chat",component:fr,icon:(0,x.jsx)(ne.Ionicons,{size:30,color:t,style:{marginBottom:-3},name:"chatbox"})}}}(i);return(0,o.useEffect)((function(){void 0===u&&s&&d(s.length>0?1:0)}),[s]),(0,x.jsx)($.default,{style:"landscape"==a?[gr.tabBar,{backgroundColor:ie[i].background,borderTopColor:n.border}]:{width:0},pointerEvents:"auto",children:"landscape"==a&&t.user&&void 0!==u&&(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(_n,{userId:t.user.id,username:t.user.username,name:t.user.name}),(0,x.jsx)($.default,{style:{flexDirection:"row-reverse"},children:(0,x.jsx)(He,{title:"+",textStyle:{fontSize:20},style:{borderRadius:20},onPress:h[u]})}),(0,x.jsx)($.default,{accessibilityRole:"tablist",style:gr.content,children:Object.keys(g).length>1?(0,x.jsx)(Qt,{tabs:g,tabBarPosition:"top",onTab:d,index:u}):(0,x.jsx)($.default,{style:{borderTopWidth:1,flex:1,borderColor:n.border},children:Object.values(g).map((function(e){var t=e.component;return(0,x.jsx)(t,{},e.title)}))})})]})})};var gr=q.default.create({tabBar:{width:240,elevation:8,borderRightWidth:1,borderColor:ie.borderColor},content:{flex:1,flexDirection:"row"},tab:{flex:1,alignItems:"center"},label:{textAlign:"center",backgroundColor:"transparent"}});const pr=[tn,Tn,jn,qe,gn,bn,Qn];var yr=(0,d.default)();const xr=function(){var e=v(),t=(0,nt.default)(),n=(0,N.default)().auth,i=(0,de.default)(),a=(0,Z.default)(),s=a.lang,l=a.locale,c=(0,o.useMemo)((function(){return void 0===n.user?[]:(console.log("current user: ",n.user),Object.entries(null===n.user?tr:er))}),[n,l]),u=(0,o.useMemo)((function(){return void 0===n.user||null===n.user?[]:pr}),[n]),d="light"==i?{}:{backgroundColor:"#010409"};return void 0!==n.user?(0,x.jsx)($.default,{style:{flexDirection:"row",flex:1},children:(0,x.jsx)(_e,{children:(0,x.jsxs)(Ge,{modals:u,children:[n.user?(0,x.jsx)(hr,{auth:n}):void 0,(0,x.jsx)($.default,{style:[{flex:1},d],children:(0,x.jsx)(I,{disable:null===n.user||void 0===n.user,children:(0,x.jsx)(Nn,{user:n.user,children:(0,x.jsxs)(yr.Navigator,{screenOptions:function(n){var r=n.navigation,o=n.route;return{headerStyle:{backgroundColor:ie[i].header,height:t?50:void 0},headerTitleStyle:{color:ie[i].text},headerLeft:function(){return function(e,t,n,r,o){var i=-1==["HomeScreen","LoginScreen"].findIndex((function(e){return e==t.name})),a=function(){e.canGoBack()?e.goBack():i&&e.replace("HomeScreen")};return"portrait"==n&&i?(0,x.jsx)(te.TouchableOpacity,{onPress:a,disabled:!o,children:(0,x.jsx)(Ce,{title:"",color:o?ie[r].buttonBackgroundColor:ie[r].hoverColor,onPress:a,disabled:o,style:{width:32,height:32,margin:16,paddingVertical:1,paddingHorizontal:4},children:(0,x.jsx)(ne.Ionicons,{size:24,color:ie[r].iconColor,name:"arrow-back"})})}):null}(r,o,e,i,t)},headerRight:function(){return(0,x.jsx)(et,{})},headerLeftContainerStyle:{backgroundColor:ie[i].header,borderBottomWidth:1,borderColor:ie[i].headerBottomColor},cardStyle:[{flexShrink:1},d],animationEnabled:"portrait"==e,cardStyleInterpolator:f.forHorizontalIOS}},children:[c.map((function(e){var t=(0,r.default)(e,2),n=t[0],o=t[1];return(0,x.jsx)(yr.Screen,{name:n,component:o.component,options:{title:s(o.title)}},n)})),(0,x.jsx)(yr.Screen,{name:"NotFound",component:lr,options:{title:"Oops!"}})]})})})})]})})}):(0,x.jsx)(x.Fragment,{})};(0,s.enableScreens)();var mr,br=o.createRef();function jr(e,t){var n,r;t&&(null==(n=br.current)||n.navigate(e,t)),null==(r=br.current)||r.navigate(e)}try{var vr,wr;mr=null==(vr=process)||null==(wr=vr.versions)?void 0:wr.electron}catch(Dr){mr=void 0}function Or(){var e=(0,i.default)(),t=(0,a.useColorScheme)(),n="no-preference"==t?e:t;return(0,x.jsx)(l.default,{ref:br,documentTitle:{formatter:function(e,t){return"TOKKI TOK"}},linking:mr?void 0:sr,theme:"dark"===n?c.default:u.default,children:(0,x.jsx)(j,{children:(0,x.jsx)(Cr,{})})})}var Sr=(0,d.default)();function Cr(){var e=v();return Q(),(0,x.jsxs)(Sr.Navigator,{mode:"modal",headerMode:"screen",screenOptions:{cardStyle:{backgroundColor:"white"},animationEnabled:!0,cardStyleInterpolator:f.forVerticalIOS},children:[(0,x.jsx)(Sr.Screen,{name:"Main",component:xr,options:{headerShown:!1}}),Object.entries(nr).map((function(t){var n=(0,r.default)(t,2),o=n[0],i=n[1];return(0,x.jsx)(Sr.Screen,{name:o,component:i.component,options:{title:i.title,gestureDirection:"landscape"==e?"vertical-inverted":"vertical"}},o)}))]})}!function(e){if(void 0!==e&&"/"===e.search[1]){var t=e.search.slice(1).split("&").map((function(e){return e.replace(/~and~/g,"&")})).join("?");window.history.replaceState(null,"",e.pathname.slice(0,-1)+t+e.hash)}}(window.location),function(e){if(void 0!==e&&e.pathname.endsWith("/invitee")){var t=e.search.slice(1).split("&").filter((function(e){return e.startsWith("id=")}));t.length>0&&(U=parseInt(t[0].split("=")[1])),window.history.replaceState(null,"",e.href.split("invitee")[0])}}(window.location);var Pr=["setNativeProps","useNativeDriver"],kr=console.warn;console.warn=function(e){var t=!0;(e instanceof Object||Pr.some((function(t){return e.includes(t)})))&&(t=!1),t&&kr(e)}},84417:e=>{firebaseConfig={authDomain:"virtual-metrics-355712.firebaseapp.com",projectId:"virtual-metrics-355712",storageBucket:"virtual-metrics-355712.appspot.com",messagingSenderId:"76003576924",appId:"1:76003576924:web:c8c8a006d07918bbc02a99",measurementId:"G-SEL35L4N5R"},e.exports=firebaseConfig},24654:()=>{}}]);
//# sourceMappingURL=787.1d023d97.chunk.js.map