(this.webpackJsonp=this.webpackJsonp||[]).push([[6],{249:function(e,t,n){"use strict";n.r(t),n.d(t,"useThemeColor",(function(){return b})),n.d(t,"Text",(function(){return g})),n.d(t,"View",(function(){return p}));var r=n(65),a=n.n(r),o=n(242),l=n.n(o),i=n(0),c=n(248),u=n(36),s=n(251),d=n(112),f=["style","lightColor","darkColor"],m=["style","lightColor","darkColor"];function b(e,t){var n=Object(d.default)(),r=e[n];return r||s.default[n][t]}function g(e){var t=e.style,n=e.lightColor,r=e.darkColor,o=l()(e,f),u=b({light:n,dark:r},"text");return i.createElement(c.default,a()({style:[{color:u},t]},o))}function p(e){var t=e.style,n=e.lightColor,r=e.darkColor,o=l()(e,m),c=b({light:n,dark:r},"background");return i.createElement(u.default,a()({style:[{backgroundColor:c},t]},o))}},251:function(e,t,n){"use strict";n.r(t);t.default={light:{text:"#000",background:"#fff",tint:"#2f95dc",tabIconDefault:"#ccc",tabIconSelected:"#2f95dc",hoverColor:"rgb(242,242,242)",buttonBackgroundColor:"#f6f8fa",header:"#f6f8fa",headerBottomColor:"rgb(216, 216, 216)",buttonBorderColor:"rgba(27,31,36,0.15)",iconColor:"black"},dark:{text:"#fff",background:"#000",tint:"#fff",tabIconDefault:"#ccc",tabIconSelected:"#fff",hoverColor:"#010409",buttonBackgroundColor:"#010409",header:"#010409",headerBottomColor:"rgb(40, 40, 40)",buttonBorderColor:"rgba(229,225,220,0.15)",iconColor:"white"},borderColor:"#d0d7de",focus:"#0065A4"}},257:function(e,t,n){"use strict";n.r(t),n.d(t,"ModalsProvider",(function(){return b}));var r=n(27),a=n.n(r),o=n(13),l=n.n(o),i=n(0),c=n.n(i),u=n(777),s=n(265);function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach((function(t){a()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var m=Object(i.createContext)({setModal:function(){}}),b=function(e){var t=e.children,n=e.modals,r=Object(i.useState)([]),a=l()(r,2),o=a[0],d=a[1],b=Object(s.default)(),g=Object(i.useState)("none"),p=l()(g,2),h=p[0],y=p[1];return Object(i.useEffect)((function(){0==o.filter((function(e){return e.visible})).length&&y("landscape"==b?"fade":"slide")}),[b]),Object(i.useEffect)((function(){d(n.map((function(e){return{Component:e,props:null,visible:!1}})))}),[n]),c.a.createElement(m.Provider,{value:{setModal:function(e,t){var n=o.map((function(n){return null==e?f(f({},n),{},{visible:!1}):n.Component==e?{Component:e,props:null!==t?t:n.props,visible:null!==t}:n}));d(n)}}},t,o.map((function(e,t){var n=e.Component,r=e.props,a=e.visible;return c.a.createElement(u.default,{key:t,animationType:h,visible:a,transparent:!0},c.a.createElement(n,r))})))};t.default=function(){return Object(i.useContext)(m)}},259:function(e,t,n){"use strict";n.r(t);var r=n(27),a=n.n(r),o=n(13),l=n.n(o),i=n(0),c=n.n(i),u=n(248),s=n(30),d=n(405),f=n(251),m=n(112);function b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(Object(n),!0).forEach((function(t){a()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var p=function(e){var t=Object(i.useState)(!1),n=l()(t,2),r=n[0],a=n[1];return c.a.createElement(d.default,{onPress:function(){return e.onPress()},onHoverIn:function(){return a(!0)},onHoverOut:function(){return a(!1)},disabled:e.disabled,style:[{paddingVertical:5,paddingHorizontal:16},e.style,r||e.disabled?{backgroundColor:e.color,borderColor:e.borderColor}:{}]},e.children?e.children:c.a.createElement(u.default,{selectable:!1,style:[{fontSize:14},e.textStyle]},e.title))};t.default=function(e){var t=Object(m.default)(),n=g(g({color:f.default[t].hoverColor,borderColor:"light"==t?f.default[t].buttonBorderColor:"#7d8590"},e),{},{style:[h.style,{backgroundColor:f.default[t].buttonBackgroundColor,borderColor:f.default[t].buttonBorderColor},e.style],textStyle:[h.text,{color:f.default[t].text},e.textStyle]});return c.a.createElement(p,n)};var h=s.default.create({style:{borderRadius:6,borderWidth:1},text:{textAlign:"center",fontWeight:"600"}})},265:function(e,t,n){"use strict";n.r(t),n.d(t,"ResizeContextProvider",(function(){return m})),n.d(t,"default",(function(){return b}));var r=n(13),a=n.n(r),o=n(0),l=n.n(o),i=n(50),c=n(361),u=n(156),s=n.n(u),d=function(e){return e.height>=e.width?"portrait":"landscape"},f=Object(o.createContext)(d(i.default.get("window"))),m=function(e){var t=e.children,n=s()(),r=Object(c.default)(),i=r.width,u=r.height,m=Object(o.useState)(d({width:i,height:u})),b=a()(m,2),g=b[0],p=b[1];return Object(o.useEffect)((function(){p(d({width:i,height:u}))}),[i,u]),l.a.createElement(f.Provider,{value:n.isMobile()?"portrait":g},t)};function b(){return Object(o.useContext)(f)}},283:function(e,t,n){"use strict";n.r(t),n.d(t,"BottomSheet",(function(){return i}));var r=n(0),a=n.n(r),o=n(290),l=n(265);t.default=function(e){var t=Object(l.default)();return a.a.createElement(o.default,{outerContainerStyle:{flex:1,alignSelf:"center",backgroundColor:"#8888",maxWidth:void 0,flexShrink:1},containerStyle:{flex:1,margin:0,justifyContent:"center",alignItems:"center"},bodyStyle:"landscape"==t?{width:"90%",height:"90%",padding:"5%"}:{width:"100%",height:"100%",maxWidth:1080}},e.children)};var i=function(e){return a.a.createElement(o.default,{outerContainerStyle:{flex:1,alignSelf:"center",backgroundColor:"#8888",maxWidth:void 0},containerStyle:{flex:1,margin:0,justifyContent:"flex-end"}},e.children)}},289:function(e,t,n){"use strict";n.r(t),n.d(t,"avatarFromChannel",(function(){return c}));var r=n(0),a=n.n(r),o=n(507),l=function(e,t,n){return Math.floor(e%(n-t)+t)},i=function(e){var t=function(e,t){for(var n=t||0,r=0;r<e.length;r++)n=e.charCodeAt(r)+((n<<5)-n);return n=Math.abs(n),"hsl("+l(n,0,360)+", "+l(n,0,100)+"%, "+l(n,25,75)+"%)"}(e.name,e.userId);return r.createElement(o.Avatar.Text,{style:{backgroundColor:t},size:e.size,label:e.name.split(" ").map((function(e){return e[0]})).join().toUpperCase()})};function c(e,t){var n,r=e.name;return e.member_count<3&&(n=1==e.member_count||(null==t?void 0:t.id)==e.subowner.id?e.owner:e.subowner,r=r.length>0?r:n.name),{avatar:n,name:r}}t.default=function(e){return a.a.createElement(i,e)}},290:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return i}));var r=n(0),a=n(249),o=n(30),l=n(251);function i(e){return r.createElement(a.View,{style:[c.outerContainer,e.outerContainerStyle]},r.createElement(a.View,{style:[c.container,e.containerStyle]},e.withSeparator?r.createElement(a.View,{style:c.separator,lightColor:"#ddd",darkColor:"rgba(255,255,255, 0.3)"}):void 0,e.title?r.createElement(a.View,{style:c.titleView},r.createElement(a.Text,{style:[c.title,e.titleStyle]},e.title),r.createElement(a.Text,{style:c.subtitle},e.subtitle)):void 0,r.createElement(a.View,{style:[c.bodyView,e.bodyStyle]},e.children)))}var c=o.default.create({outerContainer:{width:"100%",maxWidth:1080,alignItems:"stretch",backgroundColor:"transparent"},container:{marginHorizontal:20,marginVertical:10,backgroundColor:"transparent"},titleView:{width:"100%",flexDirection:"row",backgroundColor:"transparent",marginBottom:5},title:{flex:1,fontSize:16},subtitle:{flex:1,fontSize:12,textAlign:"right",marginTop:4},separator:{marginBottom:20,height:1,width:"100%"},bodyView:{width:"100%",padding:20,alignItems:"center",justifyContent:"center",borderWidth:1,borderColor:l.default.borderColor,borderRadius:6}})},291:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n(267);t.default=function(e,t){var n=Object(a.useNavigation)();Object(r.useEffect)((function(){var t=function(t){t.preventDefault(),e()};return n.addListener("beforeRemove",t),function(){n.removeListener("beforeRemove",t)}}),t)}},294:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return g})),n.d(t,"useMessengerChannelSorted",(function(){return p})),n.d(t,"useMessengerChannelMutation",(function(){return h}));var r=n(27),a=n.n(r),o=n(109),l=n.n(o),i=n(2),c=n.n(i),u=n(0),s=n(93),d=n(67),f=n(301);function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach((function(t){a()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function g(e){var t=Object(s.useQueryClient)(),n=Object(f.default)().lastJsonMessage,r=Object(s.useQuery)("MessengerChannelList",(function(){var t;return c.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:if(null==e||null==(t=e.user)||!t.id){n.next=6;break}return n.next=3,c.a.awrap(Object(d.getMessengerChannelList)(e.user.id));case 3:n.t0=n.sent,n.next=7;break;case 6:n.t0=[];case 7:return n.abrupt("return",n.t0);case 8:case"end":return n.stop()}}),null,null,null,Promise)})).data;return Object(u.useEffect)((function(){if(null!=n&&("enter"==n.type&&t.setQueryData("MessengerChannelList",(function(e){return(null!=e&&e.find((function(e){return e.id==n.data.id}))?e:[n.data].concat(l()(e||[]))).sort((function(e,t){return e.id-t.id}))})),"next_message"==n.type)){var e=n.data;t.setQueryData("MessengerChannelList",(function(t){return(t||[]).map((function(t){var n;return t.id==e.channel?b(b({},t),{},{last_message:{content:null==(n=e.message_set[0])?void 0:n.content,created:e.created}}):t}))}))}}),[n]),r}function p(e){var t=g(e);return null==t?void 0:t.sort((function(e,t){var n,r;return((null==(n=e.last_message)?void 0:n.created)||"")<((null==(r=t.last_message)?void 0:r.created)||"")?1:-1}))}function h(){var e=Object(s.useQueryClient)(),t=Object(s.useMutation)(d.postChannel,{onSuccess:function(){return e.invalidateQueries("MessengerChannelList")}}),n=Object(s.useMutation)(d.putChannel,{onSuccess:function(){return e.invalidateQueries("MessengerChannelList")}}),r=Object(s.useMutation)(d.postDirectChannel,{onSuccess:function(){return e.invalidateQueries("MessengerChannelList")}});return{create:t.mutateAsync,update:n.mutateAsync,direct:r.mutateAsync}}},300:function(e,t,n){"use strict";n.r(t),function(e){n.d(t,"navigate",(function(){return g})),n.d(t,"default",(function(){return p}));var r=n(512),a=n(470),o=n(119),l=n(0),i=n(517),c=n(779),u=n(605),s=n(97),d=n(265),f=n(479),m=n(466);Object(f.enableScreens)();var b=l.createRef();function g(e,t){var n,r;t&&(null==(n=b.current)||n.navigate(e,t)),null==(r=b.current)||r.navigate(e)}function p(){var t=Object(u.default)(),n=Object(s.useColorScheme)(),f="no-preference"==n?t:n;return l.createElement(r.default,{ref:b,documentTitle:{formatter:function(e,t){return"TOKKI TOK"}},linking:e.versions&&e.versions.electron?void 0:i.default,theme:"dark"===f?a.default:o.default},l.createElement(d.ResizeContextProvider,null,l.createElement(c.default,null)))}!function(e){if(void 0!==e&&"/"===e.search[1]){var t=e.search.slice(1).split("&").map((function(e){return e.replace(/~and~/g,"&")})).join("?");window.history.replaceState(null,"",e.pathname.slice(0,-1)+t+e.hash)}}(window.location),Object(m.replaceInviteeState)(window.location);var h=["ReactNativeFiberHostComponent"],y=function(){};n.e(8).then(n.t.bind(null,634,7)).then((function(e){y=e.clone(console)})),console.warn=function(e){var t=!0;e instanceof Object?t=!1:h.forEach((function(n){e.indexOf&&e.indexOf(n)<=-1&&(t=!1)})),t&&y.warn(e)}}.call(this,n(189))},301:function(e,t,n){"use strict";n.r(t),n.d(t,"WebSocketInternalProvider",(function(){return b})),n.d(t,"WebSocketProvider",(function(){return g}));var r=n(13),a=n.n(r),o=n(0),l=n.n(o),i=n(554),c=n.n(i),u=n(45),s=n(35),d=n(562),f={lastJsonMessage:void 0,sendJsonMessage:function(){}},m=Object(o.createContext)(f),b=function(e){var t=e.children,n=e.path,r=e.Context,i=e.useBackground,m=Object(o.useState)(null),b=a()(m,2),g=b[0],p=b[1],h=Object(o.useState)(i||"active"==d.default.currentState),y=a()(h,2),v=y[0],E=y[1],O=c()(u.websockerURL+"/"+n,{shouldReconnect:function(e){return!0},protocols:g?["Authorization",g]:void 0,onOpen:function(e){console.log("success websocket connection("+n+")")},onClose:function(e){console.log("closed websocket connection("+n+")")}},v&&null!=g),w=O.lastJsonMessage,j=O.sendJsonMessage;return Object(o.useEffect)((function(){s.default.getItem("Authorization").then(p);var e=function(e){return E(i||"active"==e)};return d.default.addEventListener("change",e),function(){return d.default.removeEventListener("change",e)}}),[]),l.a.createElement(r.Provider,{value:null!=g?{lastJsonMessage:w,sendJsonMessage:j}:f},t)},g=function(e){var t=e.disable,n=e.children;return t?l.a.createElement(l.a.Fragment,null,n):l.a.createElement(b,{path:"messenger/ws/",Context:m},n)};t.default=function(){return Object(o.useContext)(m)}},305:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return c})),n.d(t,"useUserMembershipMutation",(function(){return u}));var r=n(2),a=n.n(r),o=n(93),l=n(67),i=n(110);function c(e){return Object(o.useQuery)(["UserMembershipList",null==e?void 0:e.groupId],(function(){return a.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:if(null==e||!e.groupId){t.next=6;break}return t.next=3,a.a.awrap(Object(l.getUserMembershipList)(null==e?void 0:e.groupId));case 3:t.t0=t.sent,t.next=7;break;case 6:t.t0=[];case 7:return t.abrupt("return",t.t0);case 8:case"end":return t.stop()}}),null,null,null,Promise)})).data}function u(){var e=Object(o.useQueryClient)(),t=Object(i.default)(),n=t.auth,r=t.dispatch,a=Object(o.useMutation)(l.postUser,{onSuccess:function(){e.invalidateQueries("UserMembershipList")}}),c=Object(o.useMutation)(l.patchUser,{onSuccess:function(t,a){var o;e.invalidateQueries("UserMembershipList"),a.id==(null==(o=n.user)?void 0:o.id)&&r({type:"REFRESH"})}}),u=Object(o.useMutation)(l.deleteUser,{onSuccess:function(t,a){var o;e.invalidateQueries("UserMembershipList"),a==(null==(o=n.user)?void 0:o.id)&&r({type:"LOGOUT_REQUEST"})}});return{create:a.mutateAsync,update:c.mutateAsync,delete:u.mutateAsync}}},319:function(e,t,n){"use strict";n.r(t);var r=n(65),a=n.n(r),o=n(0),l=n.n(o),i=n(30),c=n(259);t.default=function(e){return l.a.createElement(c.default,a()({},e,{style:[u.style,e.style]}))};var u=i.default.create({style:{borderRadius:6,backgroundColor:"transparent",borderWidth:0}})},324:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return i})),n.d(t,"useMessengerMemberMutation",(function(){return c}));var r=n(2),a=n.n(r),o=n(93),l=n(67);function i(e){return Object(o.useQuery)(["MessengerMemberList",e],(function(){return a.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a.a.awrap(Object(l.getMessengerMemberList)(e));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),null,null,null,Promise)})).data}function c(){var e=Object(o.useQueryClient)(),t=Object(o.useMutation)(l.postBulkMessengerMember,{onSuccess:function(){e.invalidateQueries("MessengerMemberList")}}),n=Object(o.useMutation)(l.deleteMessengerMember,{onSuccess:function(){e.invalidateQueries("MessengerChannelList"),e.invalidateQueries("MessengerMemberList")}});return{invite:t.mutateAsync,leave:n.mutateAsync}}},327:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return E}));var r=n(13),a=n.n(r),o=n(0),l=n.n(o),i=n(30),c=n(249),u=n(259),s=n(110),d=n(300),f=n(294),m=n(456),b=n(257),g=n(111),p=n(283),h=n(324),y=n(289),v=n(291);function E(e){var t=e.id,n=e.member_id,r=e.type,i=Object(g.default)().lang,w=Object(s.default)().auth,j=Object(b.default)().setModal,x=Object(f.default)(w),S=Object(f.useMessengerChannelMutation)(),C=Object(h.useMessengerMemberMutation)(),k=null==x?void 0:x.find((function(e){return e.id==t})),P=Object(o.useState)(""),M=a()(P,2),T=M[0],D=M[1],_=Object(o.useState)(""),I=a()(_,2),z=I[0],R=I[1],V=function(){j(E,null)};return Object(o.useEffect)((function(){if(k){var e=Object(y.avatarFromChannel)(k,w.user).name;D(e),R((null==k?void 0:k.description)||"")}}),[k]),Object(v.default)(V,[]),l.a.createElement(p.default,null,l.a.createElement(c.View,{style:{justifyContent:"space-between",flex:1,width:"100%"}},l.a.createElement(c.View,{style:{width:"100%"}},l.a.createElement(c.Text,{style:{fontSize:20}},i(t?"Chat Setting":"New chat")),l.a.createElement(c.View,{style:O.separator,lightColor:"#ddd",darkColor:"rgba(255,255,255, 0.3)"}),l.a.createElement(m.default,{name:i("Channel Name"),value:T,setValue:D,width:"60%"}),l.a.createElement(m.default,{name:i("Description"),value:z,setValue:R,multiline:!0,width:"60%"})),l.a.createElement(c.View,{style:{width:"100%",flexDirection:"row"}},n&&l.a.createElement(c.View,{style:{flexDirection:"row",justifyContent:"flex-start"}},l.a.createElement(u.default,{title:i("leave"),style:{marginHorizontal:5},textStyle:{color:"red"},onPress:function(){return C.leave(n).then(V)}})),l.a.createElement(c.View,{style:{flex:1,flexDirection:"row",justifyContent:"flex-end"}},l.a.createElement(u.default,{title:i("save"),onPress:function(){var e;if(null!=w&&null!=(e=w.user)&&e.id&&w.groupId){var n,a={id:t,name:T,description:z,type:r,owner:null==w||null==(n=w.user)?void 0:n.id,group:w.groupId};(t?S.update(a):S.create(a)).then((function(e){return Object(d.navigate)("Main",{screen:"messenger"==e.type?"ChatScreen":"BoardScreen",params:{id:e.id}})}))}}}),l.a.createElement(u.default,{title:i("cancel"),style:{marginHorizontal:5},onPress:V})))))}var O=i.default.create({field:{width:"50%",flexDirection:"row",padding:10},separator:{marginBottom:20,height:1,width:"100%"}})},329:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return y}));var r=n(13),a=n.n(r),o=n(0),l=n.n(o),i=n(30),c=n(111),u=n(305),s=n(110),d=n(283),f=n(257),m=n(249),b=n(374),g=n(259),p=n(457),h=function(e){var t=Object(c.default)().lang;return e.message?l.a.createElement(m.View,{style:v.form_error},l.a.createElement(m.Text,{style:v.form_error_text},t(e.message))):l.a.createElement(l.a.Fragment,null)};function y(e){var t=e.id,n=Object(c.default)().lang,r=Object(s.default)().auth,i=Object(f.default)().setModal,E=Object(o.useState)(""),O=a()(E,2),w=O[0],j=O[1],x=Object(o.useState)(""),S=a()(x,2),C=S[0],k=S[1],P=Object(o.useState)(""),M=a()(P,2),T=M[0],D=M[1],_=Object(o.useState)(""),I=a()(_,2),z=I[0],R=I[1],V=Object(o.useState)(!1),L=a()(V,2),B=L[0],A=(L[1],Object(o.useState)({})),W=a()(A,2),H=W[0],F=W[1],U=Object(u.default)(r),N=Object(u.useUserMembershipMutation)(),G=null==U?void 0:U.find((function(e){return e.id==t}));Object(o.useEffect)((function(){G&&(j(G.username),k(G.name))}),[G]);var Q=function(){i(y,null)};return l.a.createElement(d.default,null,l.a.createElement(m.View,{style:{justifyContent:"space-between",flex:1,width:"100%"}},l.a.createElement(m.View,{style:{flex:1,width:"100%"}},l.a.createElement(m.Text,{style:{fontSize:20}},n("Create User")),l.a.createElement(m.View,{style:v.separator,lightColor:"#ddd",darkColor:"rgba(255,255,255, 0.3)"}),l.a.createElement(b.default,{name:n("Username"),width:"60%"},t?l.a.createElement(m.Text,{style:{fontSize:16}},w):l.a.createElement(p.default,{value:w,setValue:function(e){return j(e)},keyboardType:"email-address"}),l.a.createElement(h,{message:H.username})),l.a.createElement(b.default,{name:n("Name"),width:"60%"},l.a.createElement(p.default,{value:C,setValue:function(e){return k(e)}}),l.a.createElement(h,{message:H.name})),l.a.createElement(b.default,{name:n("Password"),width:"60%"},l.a.createElement(p.default,{value:T,secureTextEntry:!0,setValue:function(e){return D(e)}}),l.a.createElement(h,{message:H.password})),l.a.createElement(b.default,{name:n("Check Password"),width:"60%"},l.a.createElement(p.default,{value:z,secureTextEntry:!0,setValue:function(e){return R(e)}}),l.a.createElement(h,{message:H.checkPassword}))),l.a.createElement(m.View,{style:{width:"100%",flexDirection:"row"}},t&&l.a.createElement(m.View,{style:{flexDirection:"row",justifyContent:"flex-start"}},l.a.createElement(g.default,{title:n("delete account"),style:{marginHorizontal:5},textStyle:{color:"red"},onPress:function(){return N.delete(t).then(Q)}})),l.a.createElement(m.View,{style:{flex:1,flexDirection:"row",justifyContent:"flex-end"}},l.a.createElement(g.default,{title:n("save"),onPress:function(){var e={};null!=U&&U.find((function(e){return e.username==w}))&&!t&&(e.username="The username is already in use."),(w.length<10||w.length>64)&&(e.username="Set 10-64 characters."),(C.length<1||C.length>64)&&(e.name="Set 1-64 characters."),/^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*#?&])[A-Za-z\d@$!%*#?&]{10,64}$/.test(T)||t&&0==T.length||(e.password="Set 10-64 characters with a combination of letters/numbers/valid special characters."),T!=z&&(e.checkPassword="Incorrect between password and check password."),Object.keys(e).length>0?F(e):t?N.update({id:t,name:C,password:T.length>0?T:void 0}).then((function(){var e;t!=(null==(e=r.user)?void 0:e.id)&&Q()})):(null==r?void 0:r.groupId)&&N.create({username:w,name:C,password:T,is_guest:!1,is_staff:B,inviteGroupId:r.groupId}).then(Q)}}),l.a.createElement(g.default,{title:n("cancel"),style:{marginHorizontal:5},onPress:Q})))))}var v=i.default.create({form_error:{height:22,width:"100%"},form_error_text:{textAlignVertical:"center",color:"red",fontSize:13},separator:{marginBottom:20,height:1,width:"100%"}})},360:function(e,t,n){"use strict";n.r(t);var r=n(65),a=n.n(r),o=n(109),l=n.n(o),i=n(0),c=n.n(i),u=n(319),s=n(110),d=n(265),f=n(36),m=n(257),b=n(426),g=n(111),p=n(112),h=n(251);t.default=function(e){var t=Object(g.default)().lang,n=Object(p.default)(),r=Object(s.default)(),o=r.auth,i=r.dispatch,y=Object(m.default)().setModal,v=Object(d.default)(),E=[{title:t("sign out"),onPress:function(){var e;null!=o&&null!=(e=o.user)&&e.is_guest?y(b.default,{type:"GUEST_LOGOUT"}):i({type:"LOGOUT_REQUEST"})}}],O=(e.extra?[].concat(l()(e.extra),E):E).filter((function(e){return e.windowType==v||void 0==e.windowType}));return c.a.createElement(f.default,{style:{flexDirection:"row"}},O.map((function(e,t){return c.a.createElement(u.default,a()({key:t},e,{textStyle:{color:h.default[n].text},color:"#gray"}))})))}},374:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return i}));var r=n(0),a=n.n(r),o=n(249),l=n(265);function i(e){var t=Object(l.default)(),n=Object(r.useMemo)((function(){return"landscape"==t?{flexDirection:"row",alignItems:"center",justifyContent:"space-between"}:{flexDirection:"column",alignItems:"flex-start"}}),[t]);return a.a.createElement(o.View,{style:[{paddingVertical:"landscape"==t?15:5,width:"100%"},n]},a.a.createElement(o.Text,{style:["landscape"==t?{flex:1}:{width:"100%"},{paddingHorizontal:15,fontSize:16},e.textStyle]},e.name),a.a.createElement(o.View,{style:["landscape"==t?{flex:6}:{width:"100%"},{paddingHorizontal:15}]},a.a.createElement(o.View,{style:{width:e.width}},e.children)))}},375:function(e,t,n){"use strict";n.r(t);var r=n(65),a=n.n(r),o=n(27),l=n.n(o),i=n(109),c=n.n(i),u=n(13),s=n.n(u),d=n(0),f=n.n(d),m=n(774),b=n(251),g=n(112),p=n(111);t.default=function(e){var t=Object(p.default)().lang,n=f.a.useState(e.index||0),r=s()(n,2),o=r[0],i=r[1],u=Object(g.default)(),d=Object.entries(e.tabs),h=e.onTab,y=Object.assign.apply(Object,[{}].concat(c()(d.map((function(e){var t=s()(e,2),n=t[0],r=t[1];return l()({},n,r.icon)})))));return f.a.createElement(m.TabView,{renderTabBar:function(e){return f.a.createElement(m.TabBar,a()({},e,{indicatorStyle:{backgroundColor:"#2196F3"},style:{backgroundColor:b.default[u].background},activeColor:b.default[u].text,inactiveColor:b.default[u].text,renderIcon:function(e){return y[e.route.key]},onTabPress:function(e){return null==h?void 0:h(d.findIndex((function(t){var n=s()(t,2),r=n[0];n[1];return r==e.route.key})))}}))},navigationState:{index:o,routes:d.map((function(e){var n=s()(e,2),r=n[0],a=n[1];return{key:r,title:t(a.title)}}))},onIndexChange:i,renderScene:Object(m.SceneMap)(Object.assign.apply(Object,[{}].concat(c()(d.map((function(e){var t=s()(e,2),n=t[0],r=t[1];return l()({},n,r.component)})))))),tabBarPosition:e.tabBarPosition})}},376:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return s}));var r=n(13),a=n.n(r),o=n(0),l=n(249),i=n(30),c=n(405),u=n(251);function s(e){var t=o.useState(!1),n=a()(t,2),r=n[0],i=n[1];return o.createElement(c.default,{style:[d.outerContainer,e.outerContainerStyle,r?{backgroundColor:"rgb(242,242,242)"}:{}],onPressIn:function(){return i(!0)},onPress:function(){return null==e.onPress?void 0:e.onPress()},onPressOut:function(){return i(!1)}},o.createElement(l.View,{style:[d.container,e.containerStyle]},o.createElement(l.View,{style:[d.bodyView,e.bodyStyle]},o.createElement(o.Fragment,null,e.children))))}var d=i.default.create({outerContainer:{width:"100%",maxWidth:1080,alignItems:"stretch"},container:{marginHorizontal:20,backgroundColor:"transparent"},bodyView:{width:"100%",padding:10,minHeight:40,alignItems:"center",justifyContent:"center",borderBottomWidth:1,borderColor:u.default.borderColor,backgroundColor:"transparent"}})},377:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return E}));var r=n(0),a=n.n(r),o=n(463),l=n(110),i=n(305),c=n(294),u=n(259),s=n(300),d=n(257),f=n(249),m=n(111),b=n(114),g=n(270),p=n(251),h=n(112),y=n(283),v=n(291);function E(e){var t,n=e.id,O=Object(m.default)().lang,w=Object(h.default)(),j=Object(l.default)().auth,x=Object(d.default)().setModal,S=Object(i.default)(j),C=null==S?void 0:S.find((function(e){return e.id==n})),k=j.user&&C&&(null==(t=j.user)?void 0:t.id)==(null==C?void 0:C.id),P=Object(c.useMessengerChannelMutation)(),M=function(){x(E,null)};return Object(r.useEffect)((function(){n&&C||!S||M()}),[S]),Object(v.default)(M,[]),C?a.a.createElement(y.BottomSheet,null,a.a.createElement(f.View,{style:{flexDirection:"row",width:"100%"}},a.a.createElement(f.View,{style:{flex:1,flexDirection:"row"}},a.a.createElement(g.TouchableOpacity,{onPress:M},a.a.createElement(b.Ionicons,{size:20,name:"arrow-back",color:p.default[w].text}))),a.a.createElement(f.View,{style:{flex:1}},a.a.createElement(f.Text,{style:{fontSize:20,textAlign:"center"}},O("profile"))),a.a.createElement(f.View,{style:{flex:1}})),a.a.createElement(f.View,{style:{marginBottom:20,height:1,width:"100%"},lightColor:"#ddd",darkColor:"rgba(255,255,255, 0.3)"}),a.a.createElement(o.default,{username:C.username,name:C.name,userId:C.id}),a.a.createElement(u.default,{title:O(k?"Chat with me":"1:1 Chat"),onPress:function(){var e;if(null!=j&&null!=(e=j.user)&&e.id&&j.groupId){var t,n={name:"",type:"messenger",owner:null==j||null==(t=j.user)?void 0:t.id,group:j.groupId,subowner:k?void 0:C.id};P.direct(n).then((function(e){return Object(s.navigate)("Main",{screen:"ChatScreen",params:{id:e.id}})}))}}})):a.a.createElement(a.a.Fragment,null)}},425:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return p})),n.d(t,"useMessengerContentMutation",(function(){return h}));var r=n(109),a=n.n(r),o=n(27),l=n.n(o),i=n(2),c=n.n(i),u=n(0),s=n(93),d=n(67),f=n(301);function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach((function(t){l()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var g=function(e,t){var n=0;e.forEach((function(e){n!=t.length&&(e.current.forEach((function(e){n!=t.length&&e.id==t[n].id&&(e.timer=t[n].timer,e.is_archive=t[n].is_archive,n+=1)})),e.current=e.current.filter((function(e){return!e.is_archive})))}))};function p(e){var t=Object(s.useQueryClient)(),n=Object(s.useInfiniteQuery)(["MessengerContentList",e],(function(t){var n;return c.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return n=t.pageParam,r.abrupt("return",Object(d.getMessengerContentList)(e,n).then((function(e){return{current:e}})));case 2:case"end":return r.stop()}}),null,null,null,Promise)}),{select:function(e){return e.pages.length>1&&(e.pages[e.pages.length-2].next=e.pages[e.pages.length-1]),e},getNextPageParam:function(e){return null!=e&&e.current.length?e.current[e.current.length-1].id:void 0},refetchOnReconnect:!1,refetchOnWindowFocus:function(t){var n=new Date(t.state.dataUpdatedAt).toISOString(),r=b({},t.state.data);return Object(d.getNewMessengerContentList)(e,n).then((function(e){if(r.pages){var t=r.pages[0].current[0].id||0,n=e.filter((function(e){return e.id>t&&0==e.is_archive})),o=e.filter((function(e){return e.id<=t}));r.pages[0].current=[].concat(a()(n),a()(r.pages[0].current)),g(r.pages,o)}})),!1}}),r=n.data,o=n.fetchNextPage,l=Object(f.default)().lastJsonMessage;return Object(u.useEffect)((function(){null!=l&&l.data.channel==e&&("next_message"==l.type&&t.setQueryData(["MessengerContentList",e],(function(e){return null!=e&&e.pages[0].current&&(null==e?void 0:e.pages[0].current[0].id)!=l.data.id&&(e.pages[0].current=[l.data].concat(a()(null==e?void 0:e.pages[0].current))),b({},e||{pages:[],pageParams:[]})})),"update_message"==l.type&&t.setQueryData(["MessengerContentList",e],(function(e){return(null==e?void 0:e.pages)&&g(e.pages,[l.data]),b({},e||{pages:[],pageParams:[]})})))}),[l]),{data:r,fetchNextPage:o}}function h(e){var t=Object(s.useMutation)(d.postMessage,{onSuccess:function(){}}),n=Object(s.useMutation)(d.patchMessengerContent);return{create:t.mutate,patch:n.mutate}}},426:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return f}));var r=n(0),a=n.n(r),o=n(110),l=n(259),i=n(257),c=n(249),u=n(111),s=n(283),d=n(291);function f(e){var t=e.type,n=Object(u.default)().lang,r=Object(i.default)().setModal,m=Object(o.default)().dispatch,b=function(){r(f,null)},g={GUEST_LOGOUT:{message:"Guest users cannot reconnect after logging out. Please create an account or log in.",title:"sign out",onPress:function(){return m({type:"LOGOUT_REQUEST"})}}};return Object(d.default)(b,[]),a.a.createElement(s.BottomSheet,null,a.a.createElement(c.Text,null,n(g[t].message)),a.a.createElement(c.View,{style:{width:"100%",flexDirection:"row",justifyContent:"flex-end"}},a.a.createElement(l.default,{title:n(g[t].title),onPress:g[t].onPress}),a.a.createElement(l.default,{title:n("cancel"),onPress:function(){return b()}})))}},456:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return i}));var r=n(0),a=n.n(r),o=n(457),l=n(374);function i(e){return a.a.createElement(l.default,{name:e.name,width:e.width,textStyle:e.textStyle},a.a.createElement(o.default,e))}},457:function(e,t,n){"use strict";n.r(t);var r=n(13),a=n.n(r),o=n(0),l=n.n(o),i=n(271),c=n(251),u=n(112);t.default=function(e){var t=Object(o.useState)(),n=a()(t,2),r=n[0],s=n[1],d=e.minHeight||30,f=Object(u.default)();return l.a.createElement(i.default,{style:[{borderColor:"#d0d7de",fontSize:16,borderWidth:1,borderRadius:6,paddingHorizontal:10,paddingVertical:3,backgroundColor:c.default[f].background,color:c.default[f].text,height:e.multiline?r:d},e.style],placeholder:e.placeholder,editable:!e.disabled,keyboardType:e.keyboardType,secureTextEntry:e.secureTextEntry,value:e.value,onChangeText:e.setValue,onContentSizeChange:e.multiline?function(e){return s(Math.max(e.nativeEvent.contentSize.height,d)+2)}:void 0,onBlur:function(){return null==e.onBlur?void 0:e.onBlur(e.value)},onEndEditing:function(){return null==e.onEndEditing?void 0:e.onEndEditing(e.value)},multiline:e.multiline})}},458:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),o=n(376),l=n(289),i=n(249);t.default=function(e){var t=e.member,n=e.onPress;return a.a.createElement(o.default,{key:t.id,bodyStyle:{flexDirection:"row",justifyContent:"flex-start"},onPress:n},a.a.createElement(i.View,{style:{marginTop:4,marginRight:12}},a.a.createElement(l.default,{name:t.name,userId:t.id,size:44})),a.a.createElement(i.Text,{style:{fontSize:20,fontWeight:"400"}},t.name))}},461:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return D}));var r=n(27),a=n.n(r),o=n(13),l=n.n(o),i=n(109),c=n.n(i),u=n(0),s=n.n(u),d=n(259),f=n(257),m=n(249),b=n(111),g=n(114),p=n(270),h=n(251),y=n(112),v=n(283),E=n(306),O=n.n(E),w=n(291);function j(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function x(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?j(Object(n),!0).forEach((function(t){a()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):j(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var S=["AM","PM"].map((function(e){return{label:e,value:e}})),C=c()(Array(12).keys()).map((function(e,t){return(t+1).toString().padStart(2,"0")})).map((function(e){return{label:e,value:e}})),k=c()(Array(12).keys()).map((function(e,t){return(5*t).toString().padStart(2,"0")})).map((function(e){return{label:e,value:e}})),P=function(e){for(var t=e.clone().startOf("month").add(-1,"month"),n=e.clone().endOf("month").add(1,"month"),r=O()().startOf("day"),a=[];t<=n&&t<r;)a.push(t.format("YYYY-MM-DD")),t=t.add(1,"day");return a},M=s.a.lazy((function(){return Promise.all([n.e(5),n.e(10)]).then(n.bind(null,635))})),T=s.a.lazy((function(){return Promise.all([n.e(9),n.e(11)]).then(n.bind(null,770))}));function D(e){var t=e.datetime,n=e.callback,r=t?O()(t):function(){var e=O()(),t=parseInt(e.format("mm"))%5;return e.add(5-t,"minute")}(),a=Object(b.default)(),o=a.lang,i=a.locale,c=Object(y.default)(),E=Object(u.useState)(r.format("YYYY-MM-DD")),j=l()(E,2),_=j[0],I=j[1],z=Object(u.useState)(r.locale("en").format("A")),R=l()(z,2),V=R[0],L=R[1],B=Object(u.useState)(r.format("hh")),A=l()(B,2),W=A[0],H=A[1],F=Object(u.useState)(r.format("mm")),U=l()(F,2),N=U[0],G=U[1],Q=Object(u.useState)(P(r)),J=l()(Q,2),Y=J[0],K=J[1],$=Object(f.default)().setModal,q=function(){$(D,null)};return Object(w.default)(q,[]),s.a.createElement(v.BottomSheet,null,s.a.createElement(m.View,{style:{flexDirection:"row",width:"100%"}},s.a.createElement(m.View,{style:{flex:1,flexDirection:"row"}},s.a.createElement(p.TouchableOpacity,{onPress:q},s.a.createElement(g.Ionicons,{size:20,name:"arrow-back",color:h.default[c].text}))),s.a.createElement(m.View,{style:{flex:1}},s.a.createElement(m.Text,{style:{fontSize:20,textAlign:"center"}},o("Date & Time"))),s.a.createElement(m.View,{style:{flex:1}})),s.a.createElement(m.View,{style:{marginBottom:20,height:1,width:"100%"},lightColor:"#ddd",darkColor:"rgba(255,255,255, 0.3)"}),s.a.createElement(u.Suspense,{fallback:s.a.createElement(s.a.Fragment,null)},s.a.createElement(M,{locale:i,style:void 0,setDate:I,disableAllTouchEventsForDisabledDays:!0,onMonthChange:function(e){return K(P(O()(e.dateString)))},markedDates:x(x({},Y.reduce((function(e,t){return e[t]={disabled:!0},e}),{})),(_?[_]:[]).reduce((function(e,t){return e[t]={selected:!0},e}),{}))}),s.a.createElement(m.View,{style:{flexDirection:"row",paddingVertical:10,width:400,height:50}},s.a.createElement(T,{value:V,setValue:L,values:S}),s.a.createElement(m.Text,{style:{fontSize:20}}," "),s.a.createElement(T,{value:W,setValue:H,values:C}),s.a.createElement(m.Text,{style:{fontSize:20}}," : "),s.a.createElement(T,{value:N,setValue:G,values:k}))),s.a.createElement(m.View,{style:{flexDirection:"row"}},s.a.createElement(d.default,{title:o("save"),onPress:function(){null==n||n(O()(_+" "+W+":"+N+" "+V).toISOString()),q()}}),s.a.createElement(d.default,{title:o("cancel"),onPress:function(){null==n||n(void 0),q()}})))}},462:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return y}));var r=n(0),a=n.n(r),o=n(459),l=n.n(o),i=n(259),c=n(257),u=n(249),s=n(111),d=n(283),f=n(270),m=n(251),b=n(114),g=n(112),p=n(425),h=n(291);function y(e){var t=e.id,n=e.content,r=e.isOwner,o=e.isTimer,v=Object(s.default)().lang,E=Object(c.default)().setModal,O=Object(g.default)(),w=Object(p.useMessengerContentMutation)(),j=function(){E(y,null)};return Object(h.default)(j,[]),a.a.createElement(d.BottomSheet,null,a.a.createElement(u.View,{style:{flexDirection:"row",width:"100%"}},a.a.createElement(u.View,{style:{flex:1,flexDirection:"row"}},a.a.createElement(f.TouchableOpacity,{onPress:j},a.a.createElement(b.Ionicons,{size:20,name:"arrow-back",color:m.default[O].text}))),a.a.createElement(u.View,{style:{flex:1}},a.a.createElement(u.Text,{style:{fontSize:20,textAlign:"center"}},v("Message"))),a.a.createElement(u.View,{style:{flex:1}})),a.a.createElement(u.View,{style:{marginBottom:20,height:1,width:"100%"},lightColor:"#ddd",darkColor:"rgba(255,255,255, 0.3)"}),a.a.createElement(i.default,{style:{height:40,width:"100%",maxWidth:320,justifyContent:"center"},title:v("copy"),onPress:function(){l.a.setString(n),j()}}),r&&o&&a.a.createElement(i.default,{style:{height:40,width:"100%",maxWidth:320,justifyContent:"center"},textStyle:{color:"red"},title:v("delete timer"),onPress:function(){w.patch({id:t,timer:null}),j()}}),r&&a.a.createElement(i.default,{style:{height:40,width:"100%",maxWidth:320,justifyContent:"center"},textStyle:{color:"red"},title:v("delete"),onPress:function(){w.patch({id:t,is_archive:!0}),j()}}))}},463:function(e,t,n){"use strict";n.r(t);var r=n(65),a=n.n(r),o=n(0),l=n.n(o),i=n(36),c=n(249),u=n(289);t.default=function(e){return l.a.createElement(i.default,{style:{width:"100%",height:135,justifyContent:"space-evenly",alignItems:"center"}},l.a.createElement(u.default,a()({},e,{size:75})),l.a.createElement(c.Text,{style:{fontWeight:"bold",fontSize:15}},e.name),l.a.createElement(c.Text,{style:{fontWeight:"normal",fontSize:14}},e.username))}},464:function(e,t,n){"use strict";n.r(t),n.d(t,"FirebaseProvider",(function(){return w}));var r=n(13),a=n.n(r),o=n(27),l=n.n(o),i=n(2),c=n.n(i),u=n(0),s=n.n(u),d=n(602),f=(n(778),n(45)),m=n(100);function b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(Object(n),!0).forEach((function(t){l()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var p=n(604),h=p.messagingSenderId,y=f.FCM_API_KEY.split("").map((function(e,t){return(e.charCodeAt(0)^h.charCodeAt(t)).toString(16).padStart(2,"0")})).join(""),v=d.default.initializeApp(g(g({},p),{},{apiKey:f.FCM_API_KEY})),E=d.default.messaging(v);E.onMessage((function(e){if("Notification"in window){if("granted"===Notification.permission){var t=JSON.parse(e.data.message_set)[0];new Notification(e.data.channel_name,{body:e.data.name+": "+t.content})}}else alert("This browser does not support desktop notification")}));var O=Object(u.createContext)({setEnable:function(){}}),w=function(e){var t=e.user,n=e.children,r=Object(u.useRef)(),o=Object(u.useState)(),l=a()(o,2),i=l[0],d=l[1],b=Object(u.useMemo)((function(){return void 0===i?void 0:!(null==i||!i.token)}),[i]);return Object(u.useEffect)((function(){var e=!0;return t&&(void 0===r.current&&(r.current=null,function(){var e,t;return c.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,c.a.awrap(Notification.requestPermission());case 2:if("granted"!==n.sent){n.next=14;break}return n.next=6,c.a.awrap(navigator.serviceWorker.register("/tokki-tok/firebase-messaging-sw.js?"+y));case 6:return e=n.sent,console.log("[SW]: SCOPE: ",e.scope),n.next=10,c.a.awrap(E.getToken({serviceWorkerRegistration:e,vapidKey:f.FCM_PUBLIC_VAPID_KEY}).catch((function(){return c.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,c.a.awrap(E.getToken({serviceWorkerRegistration:e,vapidKey:f.FCM_PUBLIC_VAPID_KEY}));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),null,null,null,Promise)})));case 10:if(t=n.sent,window.addEventListener("beforeunload",(function(t){t.preventDefault(),e.unregister()})),!t){n.next=14;break}return n.abrupt("return",t);case 14:return n.abrupt("return",null);case 15:case"end":return n.stop()}}),null,null,null,Promise)}().then((function(t){r.current=t,i&&Object(m.putNotification)(g(g({},i),{},{token:r.current})).then((function(t){e&&d(t)}))}))),void 0===i?Object(m.getNotification)(t.id).then((function(t){e&&d(t||null)})):null===i?Object(m.postNotification)({user:t.id,type:"WEB",token:null}).then((function(t){e&&d(t)})):i.token&&r.current&&r.current!=i.token&&Object(m.putNotification)(g(g({},i),{},{token:r.current})).then((function(t){e&&d(t)}))),function(){e=!1}}),[t,i]),s.a.createElement(O.Provider,{value:{enable:b,setEnable:function(e){t&&i&&Object(m.putNotification)(g(g({},i),{},{token:e?void 0==r.current?null:r.current:null})).then((function(e){d(e)}))}}},(void 0!=b||null===t)&&n)};t.default=function(){var e=Object(u.useContext)(O);return{enable:e.enable,setEnable:e.setEnable}}},466:function(e,t,n){"use strict";n.r(t),n.d(t,"replaceInviteeState",(function(){return s}));var r,a=n(0),o=n(300),l=n(294),i=n(324),c=n(110),u=0,s=function(e){if(void 0!==e&&e.pathname.endsWith("/invitee")){var t=e.search.slice(1).split("&").filter((function(e){return e.startsWith("id=")}));t.length>0&&(r=parseInt(t[0].split("=")[1])),window.history.replaceState(null,"",e.href.split("invitee")[0])}};t.default=function(){var e=Object(c.default)().auth,t=Object(l.default)(e),n=Object(i.useMessengerMemberMutation)();Object(a.useEffect)((function(){if(e.user){if(r&&void 0!==t){var a=r,l=function(){return Object(o.navigate)("Main",{screen:"ChatScreen",params:{id:a}})};r=void 0,u=1,void 0===t.find((function(e){return e.id==a}))?(console.log("invite processing (channel:"+a+")"),n.invite({channel_id:a,user_ids:[e.user.id]}).then(l)):(console.log("already invite"),l())}}else 1==u&&(u=2)}),[e,t]),Object(a.useEffect)((function(){e.user&&2==u&&Object(o.navigate)("Main",{screen:"HomeScreen"})}),[e.user])}},508:function(e,t,n){"use strict";n.r(t),n.d(t,"main",(function(){return Fe})),n.d(t,"login",(function(){return Ue})),n.d(t,"modal",(function(){return Ne}));var r=n(13),a=n.n(r),o=n(0),l=n.n(o),i=n(248),c=n(271),u=n(272),s=n(36),d=n(30),f=n(110),m=n(111),b=n(318),g=n(15),p=n(270),h=n(114),y=n(251),v="web"==g.default.OS?function(e){location.href=e}:b.default.openURL,E=function(e){return l.a.createElement(s.default,{style:O.footer_buttons},l.a.createElement(p.TouchableOpacity,{style:O.footer_button,onPress:function(){return v("https://github.com/blacktokki/tokki-tok")}},l.a.createElement(h.AntDesign,{name:"github",size:24,color:y.default[e.theme].iconColor})),l.a.createElement(p.TouchableOpacity,{style:O.footer_button,onPress:function(){return b.default.openURL("mailto:ydh051541@naver.com")}},l.a.createElement(h.AntDesign,{name:"mail",size:24,color:y.default[e.theme].iconColor})))},O=d.default.create({footer_buttons:{width:"100%",flexDirection:"row",justifyContent:"flex-end",paddingBottom:20,paddingRight:20},footer_button:{alignItems:"center",justifyContent:"center",width:38,height:38,marginHorizontal:12,borderWidth:1,borderColor:"#E7E7E7",borderRadius:60}});var w=d.default.create({login_container:{flex:1,backgroundColor:"#FFF"},login_header:{alignItems:"center",paddingTop:30,paddingBottom:50,backgroundColor:"#208AEC"},login_header_logo:{width:220,resizeMode:"contain"},login_header_text:{marginTop:15,color:"#f0f0f0",fontSize:16},login_header_text_bold:{color:"#fff",fontWeight:"bold"},login_wrapper:{flex:1,justifyContent:"space-between",paddingTop:40,borderTopRightRadius:12,borderTopLeftRadius:12,backgroundColor:"#fff",alignItems:"center"},form:{width:"100%",maxWidth:320},form_error:{height:22,width:"100%"},form_error_text:{textAlignVertical:"center",color:"red",fontSize:13},form_input:{height:44,paddingHorizontal:20,marginBottom:20,backgroundColor:"#EDF0F7",borderRadius:50},button:{alignItems:"center",justifyContent:"center",height:44,backgroundColor:"#0065A4",borderRadius:50},button_label:{color:"#fff",fontSize:16},login_social:{width:"100%",maxWidth:280,marginTop:20},login_social_separator:{flexDirection:"row",alignItems:"center"},login_social_separator_line:{flex:1,width:"100%",height:1,backgroundColor:"#E0E0E0"},login_social_separator_text:{marginHorizontal:10,color:"#808080",fontSize:16},login_social_buttons:{flexDirection:"row",justifyContent:"center",marginTop:20},login_social_button:{alignItems:"center",justifyContent:"center",width:60,height:60,marginHorizontal:12,borderWidth:1,borderColor:"#E7E7E7",borderRadius:60},login_social_icon:{width:38,height:38,resizeMode:"contain"},login_social_facebook:{backgroundColor:"#4267B2",borderColor:"#4267B2"},login_footer_text:{flexDirection:"row",alignItems:"center",color:"#808080",fontSize:14},guest_footer_text:{flexDirection:"row",alignSelf:"center",color:"#808080",fontSize:15,margin:15},login_footer_link:{color:"#208AEC",fontSize:15,fontWeight:"bold"}}),j=n(65),x=n.n(j),S=n(290),C=n(259),k=n(425),P=n(360),M=n(324),T=n(112),D=n(249),_=n(515),I=n(294),z=n(120),R=n(275),V=function(e){var t=e.link,n=e.isMobile;return l.a.createElement(S.default,{containerStyle:{marginHorizontal:0},bodyStyle:{padding:0}},l.a.createElement(p.TouchableOpacity,{onPress:function(){return b.default.openURL(t.url)},onLongPress:function(){},style:{width:"100%",flexDirection:"row"}},t.image?l.a.createElement(R.default,{source:{uri:t.image},resizeMode:"cover",style:{width:"100%",maxWidth:n?120:150,maxHeight:n?120:150,borderWidth:1}}):void 0,l.a.createElement(D.View,{style:{flex:1,marginHorizontal:20}},l.a.createElement(D.Text,{style:{fontSize:18}},t.title),l.a.createElement(D.Text,{style:{fontSize:14}},t.description),l.a.createElement(D.Text,{style:{fontSize:12}},t.url))))},L=n(289),B=n(109),A=n.n(B),W=n(301),H=Object(o.createContext)({lastJsonMessage:void 0,sendJsonMessage:function(){}}),F=function(e){var t=e.disable,n=e.children;return t?l.a.createElement(l.a.Fragment,null):l.a.createElement(W.WebSocketInternalProvider,{path:"messenger/ws/rtc/",Context:H,useBackground:!0},n)},U=function(){return Object(o.useContext)(H)},N=n(455),G=n(2),Q=n.n(G),J=n(314),Y=n(45);console.log(Y.TURN_SERVER?"use turn server":"use stun server");var K={iceServers:[Y.TURN_SERVER?JSON.parse(Y.TURN_SERVER):{urls:"stun:stun.l.google.com:19302"}]},$={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0,VoiceActivityDetection:!0}},q={audio:!0,video:{framerate:30}},Z=function(e,t){var n=t.data.rtcMessage,r=new J.RTCIceCandidate(n);e&&(console.log("ICE candidate Added"),e.addIceCandidate(r))},X=function(e,t,n,r){e.candidate&&t({type:"ICEcandidate",receiver:n,data:{target:r,rtcMessage:e.candidate}})},ee=function(e){var t=e.sdp.split("\r\n");return t.forEach((function(e,n){/^a=fmtp:\d*/.test(e)?t[n]=e+";x-google-max-bitrate=8000;x-google-min-bitrate=8000;x-google-start-bitrate=8000":/^a=mid:(0|video)/.test(e)&&(t[n]+="\r\nb=AS:8000")})),new J.RTCSessionDescription({type:e.type,sdp:t.join("\r\n")})},te=function(e,t,n,r,a){var o;return Q.a.async((function(l){for(;;)switch(l.prev=l.next){case 0:return n&&e.pc.addStream(n),l.t0=ee,l.next=4,Q.a.awrap(e.pc.createOffer($));case 4:return l.t1=l.sent,o=(0,l.t0)(l.t1),l.next=8,Q.a.awrap(e.pc.setLocalDescription(o));case 8:t({type:"call",receiver:e.receiver,data:{target:r,name:null==a?void 0:a.name,rtcMessage:o}});case 9:case"end":return l.stop()}}),null,null,null,Promise)},ne=d.default.create({container:{flex:1},cam:{flex:1,height:"100%"},bottonContainer:{position:"absolute",bottom:0,justifyContent:"flex-end"},buttonBar:{flexDirection:"row",justifyContent:"space-around"},label:{backgroundColor:"#0008",color:"white",paddingHorizontal:5}}),re=function(e){var t,n=U(),r=n.lastJsonMessage,c=function(e){var t=Object(o.useRef)({}),n=Object(o.useState)(),r=a()(n,2),i=r[0],c=r[1],u=Object(o.useState)(),s=a()(u,2),d=s[0],f=s[1],m=Object(o.useMemo)((function(){return!!d}),[d]),b=Object(o.useCallback)(l.a.memo((function(e){var t=e.style;return d?l.a.createElement(J.RTCView,{stream:d,style:t,videoProps:{height:"100%"}}):l.a.createElement(l.a.Fragment,null)})),[d]);return{start:Object(o.useCallback)((function(n,r,o){var l;return Q.a.async((function(i){for(;;)switch(i.prev=i.next){case 0:if(console.log("start"),d&&void 0===o){i.next=28;break}if(i.prev=2,"camera"!=o){i.next=9;break}return i.next=6,Q.a.awrap(J.mediaDevices.getUserMedia(q));case 6:l=i.sent,i.next=21;break;case 9:if("display"!=o){i.next=15;break}return i.next=12,Q.a.awrap(J.mediaDevices.getDisplayMedia(q));case 12:l=i.sent,i.next=21;break;case 15:if(i.t0=r,i.t0){i.next=20;break}return i.next=19,Q.a.awrap(J.mediaDevices.getUserMedia(q).catch((function(e){return J.mediaDevices.getDisplayMedia(q)})));case 19:i.t0=i.sent;case 20:l=i.t0;case 21:f(l),Object.entries(t.current).map((function(t){var r=a()(t,2),o=(r[0],r[1]);te(o,e,l,"guest",n)})),i.next=28;break;case 25:i.prev=25,i.t1=i.catch(2),console.error(i.t1);case 28:case"end":return i.stop()}}),null,null,[[2,25]],Promise)}),[d]),stop:Object(o.useCallback)((function(){console.log("stop"),d&&(d.getTracks().map((function(e){return e.stop()})),f(void 0))}),[d]),websocketOnMessage:function(n,r){var a,o,l,i,u;return Q.a.async((function(s){for(;;)switch(s.prev=s.next){case 0:if("connection"==(a=n.type)&&c(n.data.channel_name),"start"==a&&"host"==n.data.target&&(console.log("1 start"),(o=new J.RTCPeerConnection(K)).addEventListener("icecandidate",(function(t){return X(t,e,n.sender,"guest")})),t.current[n.sender]={pc:o,receiver:n.sender},te(t.current[n.sender],e,d,"guest",r)),"answer"!=a||"host"!=n.data.target){s.next=9;break}return console.log("3 answer"),l=t.current[n.sender].pc,i=new J.RTCSessionDescription(n.data.rtcMessage),s.next=9,Q.a.awrap(l.setRemoteDescription(i));case 9:"ICEcandidate"==a&&"host"==n.data.target&&(u=t.current[n.sender].pc,Z(u,n));case 10:case"end":return s.stop()}}),null,null,null,Promise)},CustomRTCView:b,isPlay:m,sender:i}}(n.sendJsonMessage),u=c.start,d=c.stop,f=c.websocketOnMessage,m=c.CustomRTCView,b=c.isPlay;return Object(o.useEffect)((function(){e.user&&r&&f(r,e.user)}),[r,e.user]),Object(o.useEffect)((function(){return e.mode&&!b?e.user&&u(e.user,void 0,e.mode):null===e.mode&&b&&d(),function(){b&&d()}}),[b,e.user,e.mode]),l.a.createElement(s.default,{style:ne.container},l.a.createElement(m,{style:ne.cam}),l.a.createElement(s.default,{style:ne.bottonContainer},l.a.createElement(s.default,{style:ne.buttonBar}),l.a.createElement(s.default,{style:{flexDirection:"row"}},l.a.createElement(i.default,{style:ne.label},null==(t=e.user)?void 0:t.name)),l.a.createElement(s.default,{style:ne.buttonBar},void 0===e.mode&&!b&&l.a.createElement(N.default,{title:"Start",onPress:function(){return e.user&&u(e.user)}}),void 0===e.mode&&b&&l.a.createElement(N.default,{title:"Stop",onPress:d}))))},ae=function(e){var t=Object(o.useState)(""),n=a()(t,2),r=n[0],u=n[1],d=U(),f=d.lastJsonMessage,m=function(e){var t=Object(o.useRef)({}),n=Object(o.useState)(),r=a()(n,2),i=r[0],c=r[1],u=Object(o.useState)(),s=a()(u,2),d=s[0],f=s[1],m=Object(o.useCallback)(l.a.memo((function(e){return d?l.a.createElement(J.RTCView,{stream:d,style:e,videoProps:{height:"100%"}}):l.a.createElement(l.a.Fragment,null)})),[d]),b=Object(o.useMemo)((function(){return!!d}),[d]),g=Object(o.useCallback)((function(n){console.log("start"),t.current.pc||(t.current.pc=new J.RTCPeerConnection(K),t.current.receiver=n),d||e({type:"start",receiver:n,data:{target:"host"}})}),[d]),p=function(){console.log("stop"),t.current.pc&&(f(void 0),t.current.pc.close(),t.current.pc=void 0,t.current.receiver=void 0,clearInterval(t.current.statsInterval))};return{start:g,stop:p,websocketOnMessage:function(n){var r,a,o,l,u,s,m,b,g,h,y,v;return Q.a.async((function(E){for(;;)switch(E.prev=E.next){case 0:if("start"!=(u=n.type)||"guest"!=n.data.target||n.sender!=(null==(r=t.current)?void 0:r.receiver)){E.next=10;break}return console.log("(remote)1 start"),s=t.current.pc,c({name:n.data.name}),s.addEventListener("icecandidate",(function(t){return X(t,e,n.sender,"host")})),s.addEventListener("iceconnectionstatechange",(function(e){if("connected"==t.current.pc.iceConnectionState){var n=!1;t.current.statsInterval=setInterval((function(){var e,r,a;return Q.a.async((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,Q.a.awrap(t.current.pc.getStats(null));case 2:e=o.sent,r="",a=void 0,e.forEach((function(e){"inbound-rtp"===e.type&&"video"===e.kind&&(Object.keys(e).forEach((function(t){r+=t+": "+e[t]+"\n"})),a=e.framesPerSecond)})),console.log(n,a),void 0!=a?n=!0:n&&p(),console.log((new Date).toTimeString().split(" ")[0],r);case 9:case"end":return o.stop()}}),null,null,null,Promise)}),1e3)}else"failed"==t.current.pc.iceConnectionState&&p()})),s.addTransceiver("video",{direction:"recvonly"}),E.next=10,Q.a.awrap(te({pc:t.current.pc,receiver:n.sender},e,d,"host",i));case 10:if("answer"!=u||"guest"!=n.data.target||n.sender!=(null==(a=t.current)?void 0:a.receiver)){E.next=18;break}return console.log("(remote)3 answer"),m=new J.RTCSessionDescription(n.data.rtcMessage),E.next=15,Q.a.awrap(t.current.pc.setRemoteDescription(m));case 15:b=t.current.pc.getRemoteStreams(),f(b[b.length-1]),e({type:"end",receiver:t.current.receiver,data:{}});case 18:if("call"!=u||n.sender!=(null==(o=t.current)?void 0:o.receiver)){E.next=36;break}if(console.log("2 call"),g=t.current.pc,c({name:n.data.name}),g){E.next=24;break}return E.abrupt("return");case 24:return g.addEventListener("icecandidate",(function(t){return X(t,e,n.sender,"host")})),h=new J.RTCSessionDescription(n.data.rtcMessage),E.next=28,Q.a.awrap(g.setRemoteDescription(h));case 28:return E.next=30,Q.a.awrap(g.createAnswer($));case 30:return y=E.sent,E.next=33,Q.a.awrap(g.setLocalDescription(y));case 33:e({type:"answer",receiver:t.current.receiver,data:{target:"host",rtcMessage:g.localDescription}}),v=t.current.pc.getRemoteStreams(),f(v[v.length-1]);case 36:"ICEcandidate"==u&&"guest"==n.data.target&&n.sender==(null==(l=t.current)?void 0:l.receiver)&&Z(t.current.pc,n);case 37:case"end":return E.stop()}}),null,null,null,Promise)},CustomRTCView:m,user:i,isPlay:b}}(d.sendJsonMessage),b=m.start,g=m.stop,p=m.websocketOnMessage,h=m.CustomRTCView,y=m.isPlay,v=m.user;return Object(o.useEffect)((function(){f&&p(f)}),[f]),Object(o.useEffect)((function(){return e.receiver&&b(e.receiver),function(){return g()}}),[e.receiver]),l.a.createElement(s.default,{style:ne.container},l.a.createElement(h,{style:ne.cam}),l.a.createElement(s.default,{style:ne.bottonContainer},l.a.createElement(s.default,{style:ne.buttonBar}),l.a.createElement(s.default,{style:{flexDirection:"row"}},e.receiver||y?l.a.createElement(i.default,{style:ne.label},(null==v?void 0:v.name)||"loading..."):l.a.createElement(l.a.Fragment,null,l.a.createElement(i.default,{style:{borderWidth:1}},"Receiver:\xa0"),l.a.createElement(c.default,{style:{borderWidth:1,flex:1},value:r,onChangeText:u}))),l.a.createElement(s.default,{style:ne.buttonBar},void 0===e.receiver&&!y&&l.a.createElement(N.default,{title:"Start",onPress:function(){return b(r)}}),void 0===e.receiver&&y&&l.a.createElement(N.default,{title:"Stop",onPress:g}))))},oe=n(265),le=function(e){return l.a.createElement(s.default,{style:[{maxWidth:e.scale,maxHeight:e.scale,borderWidth:1,borderColor:y.default.borderColor,backgroundColor:"gray",flexDirection:"row",flexGrow:1},void 0==e.focusGuest||e.focusGuest==e.receiver?{height:"100%"}:{maxWidth:0,height:0}]},l.a.createElement(p.TouchableOpacity,{style:{flex:1},containerStyle:{flex:1,justifyContent:"center"},onPress:function(){return e.setFocusGuest(e.focusGuest?void 0:e.receiver)}},e.children))},ie=function(e){var t,n=e.channel_id,r=e.disable,i=e.setDisable,c=Object(f.default)().auth,u=Object(z.default)(),d=Object(o.useState)(null),m=a()(d,2),b=m[0],g=m[1],p=Object(o.useState)([]),v=a()(p,2),E=v[0],O=v[1],w=Object(o.useState)(),j=a()(w,2),x=j[0],S=j[1],k=Object(oe.default)(),P=U(),M=P.lastJsonMessage,T=P.sendJsonMessage;Object(o.useEffect)((function(){if(null!=M&&("connection"==M.type&&T({type:"broadcast",data:{channel_id:n}}),"broadcast_guest"!=M.type&&"broadcast_host"!=M.type||O([].concat(A()(E),[M.sender])),"broadcast_disconnect"==M.type)){var e=M.sender;E.find((function(t){return t==e}))&&O(E.filter((function(t){return t!=e})))}}),[M]);var _=x?"100%":100/Math.max(2,Math.ceil(Math.sqrt(E.length+1)))+"%",I=function(e){g(b!=e?e:null)};return void 0!==M?l.a.createElement(D.View,{style:[{aspectRatio:r?0:16/9,borderColor:y.default.borderColor,borderRadius:10},"landscape"==k?{flexShrink:1,flexGrow:0,height:"100%",borderLeftWidth:1,paddingBottom:65}:{maxHeight:"36%",width:"100%",borderBottomWidth:1}]},l.a.createElement(s.default,{style:{aspectRatio:x?void 0:16/9,backgroundColor:"white",flexWrap:"wrap",flexDirection:"row",width:"100%",height:"100%"}},E.map((function(e,t){return l.a.createElement(le,{scale:_,focusGuest:x,setFocusGuest:S,receiver:e},l.a.createElement(ae,{receiver:e}))})),l.a.createElement(le,{scale:_,focusGuest:x,setFocusGuest:S,receiver:null==(t=c.user)?void 0:t.name},l.a.createElement(re,{user:c.user,mode:b}))),l.a.createElement(D.View,{style:[{position:"absolute",alignItems:"center",justifyContent:"flex-end",width:"100%",flexDirection:"row"},"landscape"==k?{bottom:0,paddingTop:15,paddingBottom:10,paddingHorizontal:19}:{backgroundColor:"transparent"}]},l.a.createElement(C.default,{title:"\u23fa\ufe0f",style:{height:40,paddingTop:8},onPress:function(){return I("camera")}}),!u&&l.a.createElement(C.default,{title:"\ud83d\udda5\ufe0f",style:{height:40,paddingTop:8},onPress:function(){return I("display")}}),l.a.createElement(C.default,{title:"",style:{height:40,paddingTop:8},onPress:function(){return i(!0)}},l.a.createElement(h.Ionicons,{size:20,name:"arrow-back",color:"deepskyblue"})))):l.a.createElement(l.a.Fragment,null)},ce=l.a.memo((function(e){var t=e.channel_id,n=e.disable,r=e.setDisable;return l.a.createElement(F,{disable:n},l.a.createElement(ie,{channel_id:t,disable:n,setDisable:r}))}));var ue=function(e){var t=e.file,n=(e.isMobile,e.showBorder),r=Object(T.default)();return l.a.createElement(S.default,{containerStyle:{marginHorizontal:0},bodyStyle:n?{padding:10}:{borderWidth:0,padding:0}},l.a.createElement(p.TouchableOpacity,{onPress:function(){return b.default.openURL(t.file)},onLongPress:function(){},style:{flexDirection:"row",alignItems:"flex-start",width:"100%"}},l.a.createElement(h.FontAwesome,{name:"file-o",size:20,color:y.default[r].iconColor}),l.a.createElement(D.View,{style:{flex:1,marginHorizontal:10}},l.a.createElement(D.Text,{style:{fontSize:18}},t.filename),l.a.createElement(D.Text,{style:{fontSize:14}},function(e){var t=0==e?0:Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,t)).toFixed(2)+" "+["B","kB","MB","GB","TB"][t]}(t.filesize)))))},se=n(257),de=n(511),fe=n(461),me=n(306),be=n.n(me),ge=n(93),pe=n(67);function he(e,t){return e.year()!=t.year()?e.format("YYYY.MM"):e.month()!=t.month()||e.date()!=t.date()?e.format("MM.DD"):e.format("HH:mm")}function ye(e){return be()(e).format("YYYY.MM.DD HH:mm")}var ve=function(e){var t=be()(e.data.created),n=be()(e.data.timer),r=t.diff(e.now)/t.diff(n);return l.a.createElement(u.default,{onPress:function(){return e.setExpand(e.isExpand?void 0:e.data.id)}},l.a.createElement(s.default,{style:{backgroundColor:"lightgray",borderRadius:20,overflow:"hidden",margin:5}},l.a.createElement(s.default,{style:{backgroundColor:"darkgray",position:"absolute",width:100*r+"%",height:"100%"}}),e.isExpand?l.a.createElement(s.default,{style:{paddingVertical:5,paddingHorizontal:5,maxWidth:270}},l.a.createElement(s.default,{style:{flexDirection:"row"}},l.a.createElement(L.default,{name:e.data.name,userId:e.data.user,size:20}),l.a.createElement(s.default,{style:{paddingHorizontal:5}},l.a.createElement(D.Text,null,e.data.name))),e.data.timer&&l.a.createElement(s.default,{style:{flexDirection:"row",alignItems:"stretch"}},l.a.createElement(D.Text,null,"\u231a"),l.a.createElement(D.Text,{selectable:!0},ye(e.data.timer))),l.a.createElement(_.default,{linkDefault:!0,style:{wordBreak:"break-word"},linkStyle:{color:"#12b886"}},l.a.createElement(D.Text,{selectable:!0},e.data.message_set[0].content))):l.a.createElement(s.default,{style:{paddingVertical:5,paddingHorizontal:5,flexDirection:"row"}},l.a.createElement(L.default,{name:e.data.name,userId:e.data.user,size:20}),l.a.createElement(s.default,{style:{paddingHorizontal:5}},l.a.createElement(D.Text,null,he(n,e.now))))))},Ee=function(e){var t=function(e){var t=Object(ge.useQueryClient)(),n=Object(ge.useQuery)(["TimerMessageContentList",e],(function(){return Q.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Q.a.awrap(Object(pe.getTimerMessageContentList)(e,be()().toISOString()));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),null,null,null,Promise)})).data,r=Object(W.default)().lastJsonMessage;Object(o.useEffect)((function(){null!=r&&r.data.channel==e&&("next_message"==r.type&&r.data.timer&&be()()<be()(r.data.timer)&&t.setQueryData(["TimerMessageContentList",e],(function(e){return[].concat(A()(e||[]),[r.data])})),"update_message"==r.type&&t.setQueryData(["TimerMessageContentList",e],(function(e){return A()((null==e?void 0:e.filter((function(e){return e.id!=r.data.id||null!=r.data.timer&&!r.data.is_archive})))||[])})))}),[r]);var a=Object(o.useMemo)((function(){return null==n?void 0:n.sort((function(e,t){return(e.timer||"")>(t.timer||"")?1:-1}))}),[n]);return Object(o.useEffect)((function(){var n;if(null!=a&&null!=(n=a[0])&&n.timer){var r=a[0].id,o=Math.min(be()(a[0].timer).diff(be()()),Number.MAX_VALUE),l=setTimeout((function(){t.setQueryData(["TimerMessageContentList",e],(function(e){return(e||[]).filter((function(e){return e.id!=r||be()(e.timer).diff(be()())>0}))}))}),o);return function(){return clearTimeout(l)}}}),[a]),a}(e.channel_id),n=Object(o.useState)(be()()),r=a()(n,2),i=r[0],c=r[1],u=Object(o.useState)(),d=a()(u,2),f=d[0],m=d[1];return Object(o.useEffect)((function(){var e=setTimeout((function(){c(be()())}),2e3);return function(){return clearTimeout(e)}}),[i]),l.a.createElement(s.default,{style:{flexDirection:"row",paddingTop:5,paddingHorizontal:20}},null==t?void 0:t.map((function(e,t){return l.a.createElement(ve,{key:t,data:e,now:i,isExpand:e.id==f,setExpand:m})})))},Oe=n(462),we=n(327);var je=l.a.memo((function(e){for(var t,n=Object(z.default)(),r=Object(se.default)().setModal,a=e.next;null!=(o=a)&&o.next&&0==a.current.length;){var o;a=a.next}var i=null==(t=a)?void 0:t.current[0];return l.a.createElement(s.default,{style:{flexDirection:"column-reverse"}},e.current.map((function(t,a){var o=a+1<e.current.length?e.current[a+1]:i,c=t.created.slice(0,16),d=c.slice(0,10),f=null==t.user,m=void 0==o||t.user!=o.user||c!=o.created.slice(0,16),b=e.ownerId==t.user,g=void 0==o||d!=o.created.slice(0,10),p=t.message_set[0];return f?l.a.createElement(s.default,{key:t.id,style:{flexDirection:"row",justifyContent:"center",width:"100%",marginVertical:5}},l.a.createElement(D.Text,null,p.content)):l.a.createElement(s.default,{key:t.id},g?l.a.createElement(s.default,{style:{flexDirection:"row",justifyContent:"center",width:"100%"}},l.a.createElement(D.Text,null,d)):void 0,l.a.createElement(s.default,{key:t.id,style:{flexDirection:"row",justifyContent:b?"space-between":"flex-start",width:"100%"}},m&&!b?l.a.createElement(s.default,{style:{marginTop:3,marginLeft:12}},l.a.createElement(L.default,{name:t.name,userId:t.user,size:36})):l.a.createElement(s.default,{style:{width:48}}),l.a.createElement(S.default,{outerContainerStyle:{width:void 0,maxWidth:"90%"},title:m?t.name:void 0,titleStyle:{flex:void 0},bodyStyle:{padding:10},subtitle:""+c.slice(11)},l.a.createElement(u.default,{onLongPress:function(){return r(Oe.default,{id:t.id,content:p.content,isOwner:b,isTimer:!!t.timer})}},t.timer&&l.a.createElement(s.default,{style:{flexDirection:"row",alignItems:"stretch"}},l.a.createElement(D.Text,{style:{fontSize:12}},"\u231a"),l.a.createElement(D.Text,{style:{fontSize:12},selectable:!n},ye(t.timer))),l.a.createElement(s.default,{style:{width:"100%"}},l.a.createElement(_.default,{linkDefault:!0,style:{wordBreak:"break-word"},linkStyle:{color:"#12b886"}},l.a.createElement(D.Text,{selectable:!n,style:{textAlign:b?"right":"left"}},p.content))),t.file_set.map((function(e,r){return l.a.createElement(ue,{key:r,file:e,isMobile:n,showBorder:t.file_set.length>1||p.content.length>0})})),t.link_set.map((function(e,t){return l.a.createElement(V,{key:t,link:e,isMobile:n})}))))))})))}));var xe=n(281),Se=n(247),Ce=n(375),ke=n(319),Pe=n(305),Me=n(376),Te=n(458),De=n(377),_e=n(300),Ie=n(97),ze=n(464),Re=n(329),Ve=function(e){var t=e.title,n=e.children,r=Object(T.default)(),a=y.default[r].text;return l.a.createElement(S.default,{bodyStyle:{alignItems:"flex-start",backgroundColor:"light"==r?"transparent":"black"}},l.a.createElement(i.default,{style:{fontSize:20,color:a,fontWeight:"600"}},t),n)},Le=function(){var e,t=Object(m.default)(),n=t.lang,r=t.locale,o=t.setLocale,i=Object(se.default)().setModal,c=Object(f.default)().auth,u=Object(T.default)(),d=Object(Ie.useColorScheme)(),b=Object(ze.default)(),g=b.enable,p=b.setEnable,h=y.default[u].text;return l.a.createElement(l.a.Fragment,null,l.a.createElement(Ve,{title:n("* Notification Settings")},l.a.createElement(s.default,{style:{flexDirection:"row"}},[[n("On"),!0],[n("Off"),!1]].map((function(e){var t=a()(e,2),n=t[0],r=t[1];return l.a.createElement(ke.default,{key:n,title:n||"",textStyle:{fontSize:16,color:h,textDecorationLine:g==r?"underline":"none"},style:{borderRadius:20},onPress:function(){p(r)}})})))),l.a.createElement(Ve,{title:n("* Language Settings")},l.a.createElement(s.default,{style:{flexDirection:"row"}},[[n("Auto"),"auto"],["\ud55c\uad6d\uc5b4","ko"],["English","en"]].map((function(e){var t=a()(e,2),n=t[0],i=t[1];return l.a.createElement(ke.default,{key:n,title:n||"",textStyle:{fontSize:16,color:h,textDecorationLine:r==i?"underline":"none"},style:{borderRadius:20},onPress:function(){return o(i)}})})))),l.a.createElement(Ve,{title:n("* Skin Settings")},l.a.createElement(s.default,{style:{flexDirection:"row"}},[[n("Auto"),"no-preference"],[n("Light"),"light"],[n("Dark"),"dark"]].map((function(e){var t=a()(e,2),n=t[0],r=t[1];return l.a.createElement(ke.default,{key:n,title:n,textStyle:{fontSize:16,color:h,textDecorationLine:d==r?"underline":"none"},style:{borderRadius:20},onPress:function(){return Object(T.setColorScheme)(r)}})})))),!(null!=(e=c.user)&&e.is_guest)&&l.a.createElement(S.default,{bodyStyle:{alignItems:"flex-start",backgroundColor:"light"==u?"transparent":"black"}},l.a.createElement(ke.default,{title:n("> Account Settings"),textStyle:{fontSize:20,color:h},style:{paddingLeft:0,borderRadius:20},onPress:function(){var e;return i(Re.default,{id:null==(e=c.user)?void 0:e.id})}})))},Be=function(){var e=Object(f.default)().auth,t=Object(T.default)(),n=Object(se.default)().setModal,r=Object(Pe.default)(e),a=l.a.useMemo((function(){return r&&r.map((function(e,t){return l.a.createElement(Te.default,{key:t,member:e,onPress:function(){return n(De.default,{id:e.id})}})}))}),[r]);return l.a.createElement(xe.default,{style:{flex:1,backgroundColor:y.default[t].background}},a)},Ae=function(){var e=Object(f.default)().auth,t=Object(I.useMessengerChannelSorted)(e),n=Object(T.default)(),r=(new Date).toISOString().slice(0,10);return l.a.createElement(xe.default,{style:{flex:1,backgroundColor:y.default[n].background}},null==t?void 0:t.map((function(t,a){var o,i,c,u=Object(L.avatarFromChannel)(t,e.user),d=u.avatar,f=u.name,m=null==(o=t.last_message)?void 0:o.created.slice(0,10);return l.a.createElement(Me.default,{key:a,bodyStyle:{flexDirection:"row",justifyContent:"space-between"},onPress:function(){return Object(_e.navigate)("ChatScreen",{id:t.id})}},l.a.createElement(s.default,{style:{flexDirection:"row",flexShrink:1}},d?l.a.createElement(s.default,{style:{marginRight:20}},l.a.createElement(L.default,{name:d.name,size:44,userId:d.id})):l.a.createElement(h.FontAwesome,{size:40,color:y.default[n].iconColor,style:{marginBottom:-3,marginRight:20},name:"users"}),l.a.createElement(s.default,null,l.a.createElement(s.default,{style:{flexDirection:"row"}},l.a.createElement(D.Text,{style:{fontSize:18}},f),l.a.createElement(D.Text,{style:{fontSize:18,opacity:.4,paddingLeft:5}},t.member_count)),l.a.createElement(D.Text,{style:{fontSize:16,opacity:.4}},null==(i=t.last_message)?void 0:i.content))),l.a.createElement(s.default,null,l.a.createElement(D.Text,{style:{fontSize:14,opacity:.4,textAlign:"right"}},m==r?null==(c=t.last_message)?void 0:c.created.slice(11,16):m),l.a.createElement(D.Text,{style:{fontSize:14,textAlign:"right"}},t.unread_count?t.unread_count:" ")))})))},We=function(){var e=Object(T.default)();return l.a.createElement(xe.default,{style:{flex:1,backgroundColor:y.default[e].background}},l.a.createElement(Le,null))},He=function(e){var t=y.default[e].iconColor;return{OneTab:{title:"member",component:Be,icon:l.a.createElement(h.MaterialCommunityIcons,{size:32,color:t,style:{marginBottom:-3},name:"account"})},TwoTab:{title:"chat",component:Ae,icon:l.a.createElement(h.Ionicons,{size:30,color:t,style:{marginBottom:-3},name:"chatbox"})},FourTab:{title:"config",component:We,icon:l.a.createElement(h.SimpleLineIcons,{size:30,color:t,style:{marginBottom:-3},name:"options"})}}};var Fe={HomeScreen:{title:"home",component:function(e){var t,n=e.navigation,r=e.route,i=Object(m.default)(),c=i.lang,u=i.locale,d=Object(oe.default)(),f=Object(T.default)(),b=Object(se.default)().setModal,g=Object(o.useState)("landscape"==d),p=a()(g,2),h=p[0],v=p[1],O=y.default[f].text,w=[{title:c("member"),headerRight:function(){return l.a.createElement(P.default,{extra:[{title:c("create"),onPress:function(){return b(Re.default,{})}}]})}},{title:c("chat"),headerRight:function(){return l.a.createElement(P.default,{extra:[{title:c("create"),onPress:function(){return b(we.default,{type:"messenger"})}}]})}},{title:c("config"),headerRight:function(){return l.a.createElement(P.default,null)}}];return Object(o.useLayoutEffect)((function(){var e,t=0|(null==r||null==(e=r.params)?void 0:e.tab);n.setOptions("portrait"==d?w[t]:{title:c("home"),headerRight:function(){return l.a.createElement(P.default,null)}})}),[n,r,d,u]),Object(o.useEffect)((function(){v("landscape"==d)}),[d]),h?l.a.createElement(xe.default,{contentContainerStyle:{flex:1,alignItems:"center"}},l.a.createElement(s.default,{style:{flexGrow:1,width:"80%",marginTop:72}},l.a.createElement(Se.default,{style:{fontSize:32,color:O}},"Tokki Tok"),l.a.createElement(s.default,{style:{backgroundColor:y.default.borderColor,height:1,width:"100%"}}),l.a.createElement(s.default,{style:{height:24}}),l.a.createElement(S.default,{bodyStyle:{alignItems:"flex-start",backgroundColor:"light"==f?"transparent":"black"}},l.a.createElement(ke.default,{title:c("+ New chat"),textStyle:{fontSize:20,color:O},style:{paddingLeft:0,borderRadius:20},onPress:function(){return b(we.default,{type:"messenger"})}})),l.a.createElement(Le,null)),l.a.createElement(E,{theme:f})):l.a.createElement(Ce.default,{tabs:He(f),tabBarPosition:"bottom",index:parseInt((null==(t=r.params)?void 0:t.tab)||0),onTab:function(e){n.setParams({tab:e})}})},path:"home"},ChatScreen:{title:"chat",component:function(e){var t,n,r=e.navigation,i=e.route,c=Object(m.default)(),u=c.lang,d=c.locale,b=Object(z.default)(),v=null==i||null==(t=i.params)?void 0:t.id,E=Object(o.useRef)(0),O=Object(o.useRef)(null),w=Object(f.default)().auth,j=Object(se.default)().setModal,S=null==(n=Object(I.default)(w))?void 0:n.find((function(e){return e.id==parseInt(v)})),_=S?Object(L.avatarFromChannel)(S,w.user):void 0,R=Object(k.default)(v),V=R.data,B=R.fetchNextPage,A=Object(M.default)(v),W=Object(o.useMemo)((function(){var e;return null==A||null==(e=A.find((function(e){var t;return e.user==(null==(t=w.user)?void 0:t.id)})))?void 0:e.id}),[w,A]),H=Object(oe.default)(),F=Object(o.useState)(""),U=a()(F,2),N=U[0],G=U[1],Q=Object(o.useState)(),J=a()(Q,2),Y=J[0],K=J[1],$=Object(o.useState)(null),q=a()($,2),Z=q[0],X=q[1],ee=Object(o.useState)(!1),te=a()(ee,2),ne=te[0],re=te[1],ae=Object(o.useState)(!1),le=a()(ae,2),ie=le[0],ue=le[1],me=Object(T.default)(),ge=function(){var e;N.length>0&&(pe.create({channel:v,user:null==(e=w.user)?void 0:e.id,content:N,timer:Y}),G(""),K(void 0),ue(!1),X(!0))},pe=Object(k.useMessengerContentMutation)();Object(o.useLayoutEffect)((function(){r.setOptions({headerRight:function(){return l.a.createElement(P.default,{extra:[{title:u("invite"),onPress:function(){return j(de.default,{id:v})}},{title:u("setting"),onPress:function(){return j(we.default,{id:v,type:"messenger",member_id:W})}}]})},title:null==_?void 0:_.name})}),[r,i,W,d]);var ye,ve=Object(o.useCallback)((function(e){var t,n=e.item;e.index;return l.a.createElement(je,x()({},n,{ownerId:null==(t=w.user)?void 0:t.id}))}),[w]),Oe=function(){r.canGoBack()?r.goBack():r.navigate("HomeScreen",{tab:2})};return Object(o.useEffect)((function(){j(null,null),v||Oe()}),[i]),Object(o.useEffect)((function(){(null===A||void 0!=A&&void 0==A.find((function(e){var t;return e.user==(null==(t=w.user)?void 0:t.id)})))&&Oe()}),[A]),Object(o.useEffect)((function(){Z&&(O.current.focus(),X(!1))}),[Z]),Object(o.useEffect)((function(){if(null==Z&&!b){var e=setTimeout((function(){return X(!0)}),500);return function(){return clearTimeout(e)}}})),l.a.createElement(s.default,{style:[{flex:1,alignItems:"center"},"landscape"==H?{flexDirection:"row-reverse",minWidth:480}:{flexDirection:"column"}]},l.a.createElement(ce,{channel_id:v,setDisable:function(e){return re(!e)},disable:!ne}),l.a.createElement(s.default,{style:[{flex:ne?void 0:1,flexShrink:1},"landscape"==H?{minWidth:320,height:"100%"}:{width:"100%"}]},l.a.createElement(p.FlatList,{style:{flexDirection:"column-reverse"},contentContainerStyle:{padding:10,flexGrow:1,flexDirection:"column-reverse"},data:null==V?void 0:V.pages,renderItem:ve,onScroll:function(e){e.nativeEvent.contentOffset.y+e.nativeEvent.contentSize.height-E.current<1&&B()},onLayout:function(e){E.current=e.nativeEvent.layout.height}}),l.a.createElement(s.default,{style:{position:"absolute"}},l.a.createElement(Ee,{channel_id:v})),l.a.createElement(D.View,{style:{bottom:0,width:"100%",paddingTop:15,paddingBottom:10,paddingHorizontal:19}},l.a.createElement(s.default,{style:{alignItems:"center",width:"100%",flexDirection:"row"}},l.a.createElement(C.default,{title:"",style:{height:40,paddingTop:8,borderTopRightRadius:0,borderBottomRightRadius:0},onPress:function(){return ue(!ie)}},l.a.createElement(s.default,{style:{top:-2}},l.a.createElement(h.Entypo,{name:ie?"cross":"plus",size:24,color:y.default[me].text}))),Y&&l.a.createElement(C.default,{style:{height:40,paddingTop:8,borderRadius:0},title:"\u231a"+(ye=Y,he(be()(ye),be()())),onPress:function(){j(fe.default,{datetime:Y,callback:function(e){return K(e)}}),ue(!1)}}),l.a.createElement(p.TextInput,{ref:O,value:N,onChangeText:G,style:{flex:1,borderWidth:1,height:40,borderColor:y.default.borderColor,backgroundColor:y.default[me].background,color:y.default[me].text},onSubmitEditing:ge,blurOnSubmit:!0,onFocus:function(){return ue(!1)}}),l.a.createElement(C.default,{style:{height:40,paddingTop:8,borderTopLeftRadius:0,borderBottomLeftRadius:0},title:"\ud83d\udcac",onPress:ge})),ie&&l.a.createElement(s.default,{style:{alignItems:"center",width:"100%",flexDirection:"row",paddingTop:15,paddingBottom:5}},l.a.createElement(C.default,{style:{height:80,flex:1,justifyContent:"center",marginRight:15},title:"\ud83d\udce4\n "+u("File"),onPress:function(){return new Promise((function(e,t){if("web"==g.default.OS){var n=document.createElement("input");n.type="file",n.onchange=function(t){e(t.target.files[0])},n.onabort=t,n.onerror=t,n.click()}else e(void 0)})).then((function(e){var t;pe.create({channel:v,user:null==(t=w.user)?void 0:t.id,content:"",file:e}),ue(!1)}))}}),l.a.createElement(C.default,{style:{height:80,flex:1,justifyContent:"center",marginRight:15},title:"\u231a\n "+u("Timer"),onPress:function(){j(fe.default,{datetime:Y,callback:function(e){return K(e)}}),ue(!1)}}),l.a.createElement(C.default,{style:{height:80,flex:1,justifyContent:"center"},title:"\ud83d\udcf9\n "+u("Video Call"),onPress:function(){re(!ne),ue(!1)},disabled:ne})))))},path:"chat"}},Ue={LoginScreen:{path:"login",title:"Sign in",component:function(e){var t=e.navigation,n=e.route,r=Object(m.default)().lang,d=Object(o.useState)(""),b=a()(d,2),g=b[0],p=b[1],h=Object(o.useState)(""),y=a()(h,2),v=y[0],O=y[1],j=Object(f.default)(),x=j.error,S=j.dispatch,C=function(){return S({type:"LOGIN_REQUEST",username:g,password:v})};return Object(o.useLayoutEffect)((function(){t.setOptions({headerRight:void 0})}),[t,n]),l.a.createElement(s.default,{style:w.login_container},l.a.createElement(s.default,{style:w.login_wrapper},l.a.createElement(s.default,{style:w.form},x&&l.a.createElement(s.default,{style:w.form_error},l.a.createElement(i.default,{style:w.form_error_text},r(x))),l.a.createElement(c.default,{style:w.form_input,value:g,placeholder:r("Username"),onChangeText:function(e){return p(e)},autoCapitalize:"none",keyboardType:"email-address",onSubmitEditing:C}),l.a.createElement(c.default,{style:w.form_input,value:v,placeholder:r("Password"),secureTextEntry:!0,onChangeText:function(e){return O(e)},onSubmitEditing:C}),l.a.createElement(u.default,{onPress:C},l.a.createElement(s.default,{style:w.button},l.a.createElement(i.default,{style:w.button_label},r("Sign in")))),l.a.createElement(u.default,{onPress:function(){return S({type:"LOGIN_GUEST"})}},l.a.createElement(i.default,{style:w.guest_footer_text},r("Sign in as guest")))),l.a.createElement(s.default,{style:w.login_social},l.a.createElement(s.default,{style:w.login_social_separator},l.a.createElement(s.default,{style:w.login_social_separator_line}),l.a.createElement(i.default,{style:w.login_social_separator_text},"*"),l.a.createElement(s.default,{style:w.login_social_separator_line})),l.a.createElement(s.default,{style:w.login_social_buttons}))),l.a.createElement(E,{theme:"light"}))}}},Ne={}},511:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return W}));var r=n(109),a=n.n(r),o=n(13),l=n.n(o),i=n(0),c=n.n(i),u=n(249),s=n(110),d=n(305),f=n(259),m=n(324),b=n(257),g=n(2),p=n.n(g),h=n(93),y=n(67);var v=n(456),E=n(27),O=n.n(E);function w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function j(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w(Object(n),!0).forEach((function(t){O()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var x=function(e,t){switch(t.type){case"SEARCH":return j(j({},e),{},{keyword:t.keyword});case"ENABLE_SEARCH":return j(j({},e),{},{active:!0});case"DISABLE_SEARCH":return j(j({},e),{},{active:!1,keyword:""});default:throw new Error("Unhandled action type: "+t.type)}};var S=n(375),C=n(270),k=n(111),P=n(458),M=n(283),T=n(291),D=n(36),_=n(459),I=n.n(_),z=n(374),R=n(265);function V(e){var t=Object(k.default)().lang,n=Object(R.default)(),r=Object(i.useState)(!1),a=l()(r,2),o=a[0],s=a[1];return c.a.createElement(z.default,{name:e.name,width:e.width,textStyle:e.textStyle},c.a.createElement(D.default,{style:{flexDirection:"landscape"==n?"row":"column",justifyContent:"space-between"}},c.a.createElement(D.default,{style:{justifyContent:"center"}},c.a.createElement(u.Text,{style:{fontSize:16}},e.value)),c.a.createElement(D.default,null,c.a.createElement(f.default,{title:t("copy"),onPress:function(){I.a.setString(e.value),s(!0)}}),o&&c.a.createElement(u.Text,{style:{fontSize:12,alignSelf:"center",color:"red"}},t("copied")))))}var L=function(e){var t=Object(i.useState)(e.selectedRef.current.has(e.item.id)),n=l()(t,2),r=n[0],a=n[1];return c.a.createElement(u.View,{style:r?{borderWidth:1,borderColor:"blue"}:{}},c.a.createElement(P.default,{member:e.item,onPress:function(){r?(a(!1),e.selectedRef.current.delete(e.item.id)):(a(!0),e.selectedRef.current.add(e.item.id))}}))},B=function(e){var t,n=e.id,r=e.selectedRef,o=Object(k.default)().lang,g=Object(s.default)().auth,p=Object(b.default)().setModal,h=Object(d.default)(g),y=Object(m.default)(n),E=Object(m.useMessengerMemberMutation)(),O=function(e,t){var n=Object(i.useReducer)(x,{active:!1,keyword:""}),r=l()(n,2),a=r[0],o=r[1],c=Object(i.useMemo)((function(){return a.active?e.filter((function(e){return t(e,a.keyword)})):e}),[a,e]);return{searchState:a,dispatch:o,data:c}}(Object(i.useMemo)((function(){var e=new Set(null==y?void 0:y.map((function(e){return e.user})));return(null==h?void 0:h.filter((function(t){return!e.has(t.id)})))||[]}),[h,y]),(function(e,t){return e.username.includes(t)||e.name.includes(t)})),w=O.data,j=O.dispatch,S=O.searchState,P=function(){p(W,null)};return Object(T.default)(P,[]),c.a.createElement(u.View,{style:{alignItems:"center",flex:1}},c.a.createElement(u.View,{style:{width:"100%",flex:1}},c.a.createElement(v.default,{name:o("Username")+" & "+o("Name"),placeholder:null==(t=g.user)?void 0:t.name,value:S.keyword,setValue:function(e){(null==e?void 0:e.length)>0?(j({type:"ENABLE_SEARCH"}),j({type:"SEARCH",keyword:e})):j({type:"DISABLE_SEARCH"})},width:"80%"}),n&&w&&c.a.createElement(C.FlatList,{contentContainerStyle:{flexGrow:1},data:w,renderItem:function(e){var t=e.item;return c.a.createElement(L,{item:t,selectedRef:r})}})),c.a.createElement(u.View,{style:[{width:"100%",flexDirection:"row",padding:10},{justifyContent:"flex-end"}]},c.a.createElement(f.default,{title:o("invite"),onPress:function(){E.invite({channel_id:n,user_ids:a()(r.current)}).then(P)}}),c.a.createElement(f.default,{title:o("cancel"),onPress:P})))},A=function(e){var t,n=e.id,r=e.selectedRef,o=Object(k.default)().lang,d=Object(i.useState)(""),g=l()(d,2),E=g[0],O=g[1],w=Object(i.useState)(""),j=l()(w,2),x=j[0],S=j[1],P=Object(i.useState)(!1),M=l()(P,2),T=(M[0],M[1],Object(i.useRef)()),D=Object(s.default)().auth,_=Object(b.default)().setModal,I=Object(m.default)(n),z=function(e){return Object(h.useQuery)(["UserMembershipList",e],(function(){return p.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e){t.next=6;break}return t.next=3,p.a.awrap(Object(y.getExternalMembershipList)(e));case 3:t.t0=t.sent,t.next=7;break;case 6:t.t0=[];case 7:return t.abrupt("return",t.t0);case 8:case"end":return t.stop()}}),null,null,null,Promise)})).data}(x),R=Object(i.useMemo)((function(){var e=new Set(null==I?void 0:I.map((function(e){return e.user})));return(null==z?void 0:z.filter((function(t){return!e.has(t.id)})))||[]}),[z,I]),B=Object(m.useMessengerMemberMutation)();Object(i.useEffect)((function(){return T.current=setTimeout((function(){S(E)}),500),function(){T.current&&clearTimeout(T.current)}}),[E]);var A=function(){_(W,null)},H=location.href.replace("chat","invitee");return c.a.createElement(u.View,{style:{alignItems:"center",flex:1}},c.a.createElement(u.View,{style:{width:"100%",flex:1,paddingVertical:10}},c.a.createElement(V,{name:o("invite link"),width:"80%",value:H}),c.a.createElement(u.View,{style:{marginVertical:10,height:1,width:"100%"},lightColor:"#ddd",darkColor:"rgba(255,255,255, 0.3)"}),c.a.createElement(v.default,{name:o("Username"),placeholder:null==(t=D.user)?void 0:t.username,value:E,setValue:O,width:"80%"}),n&&R&&c.a.createElement(C.FlatList,{contentContainerStyle:{flexGrow:1},data:R,renderItem:function(e){var t=e.item;return c.a.createElement(L,{item:t,selectedRef:r})}})),c.a.createElement(u.View,{style:[{width:"100%",flexDirection:"row",padding:10},{justifyContent:"flex-end"}]},c.a.createElement(f.default,{title:o("invite"),onPress:function(){B.invite({channel_id:n,user_ids:a()(r.current)}).then(A)}}),c.a.createElement(f.default,{title:o("cancel"),onPress:A})))};function W(e){var t=e.id,n=Object(k.default)().lang,r=Object(i.useRef)(new Set),a={group:{title:"Group",component:function(){return c.a.createElement(B,{id:t,selectedRef:r})},icon:c.a.createElement(c.a.Fragment,null)},external:{title:"External members",component:function(){return c.a.createElement(A,{id:t,selectedRef:r})},icon:c.a.createElement(c.a.Fragment,null)}};return c.a.createElement(M.default,null,c.a.createElement(u.View,{style:{flex:1,width:"100%"}},c.a.createElement(u.View,{style:{width:"100%"}},c.a.createElement(u.Text,{style:{fontSize:20}},n("invite")),c.a.createElement(u.View,{style:{marginBottom:20,height:1,width:"100%"},lightColor:"#ddd",darkColor:"rgba(255,255,255, 0.3)"})),c.a.createElement(S.default,{tabs:a,tabBarPosition:"top"})))}},517:function(e,t,n){"use strict";n.r(t);var r=n(27),a=n.n(r),o=n(775),l=n(508);function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}Object.values(l.modal).forEach((function(e){return e.path="tokki-tok/"+e.path})),t.default={prefixes:[o.makeUrl("/")],config:{screens:c({Main:{screens:c(c(c({},l.main),l.login),{},{NotFound:"*"}),path:"tokki-tok"}},l.modal)}}},528:function(e,t){},604:function(e,t,n){firebaseConfig={authDomain:"virtual-metrics-355712.firebaseapp.com",projectId:"virtual-metrics-355712",storageBucket:"virtual-metrics-355712.appspot.com",messagingSenderId:"76003576924",appId:"1:76003576924:web:c8c8a006d07918bbc02a99",measurementId:"G-SEL35L4N5R"},e.exports=firebaseConfig},779:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return X}));var r=n(13),a=n.n(r),o=n(467),l=n(776),i=n(0),c=n.n(i),u=n(36),s=n(114),d=n(265),f=n(30),m=n(248),b=n(272),g=n(110),p=n(111);function h(e){var t=e.navigation,n=Object(p.default)().lang,r=Object(g.default)().auth;return i.createElement(u.default,{style:y.container},i.createElement(m.default,{style:y.title},n("This screen doesn't exist.")),i.createElement(b.default,{onPress:function(){return t.replace(r.user?"HomeScreen":"LoginScreen")},style:y.link},i.createElement(m.default,{style:y.linkText},n("Go to home screen!"))))}var y=f.default.create({container:{flex:1,backgroundColor:"#fff",alignItems:"center",justifyContent:"center",padding:20},title:{fontSize:20,fontWeight:"bold"},link:{marginTop:15,paddingVertical:15},linkText:{fontSize:14,color:"#2e78b7"}}),v=n(508),E=n(193),O=n(463),w=n(319),j=n(251),x=n(375),S=n(257),C=n(327),k=n(376),P=n(249),M=n(294),T=n(300),D=n(289),_=n(112),I=n(329),z=n(305),R=n(377),V=function(){var e=Object(g.default)().auth,t=Object(S.default)().setModal,n=Object(z.default)(e);return c.a.createElement(u.default,{style:{flex:1}},null==n?void 0:n.map((function(e,n){return c.a.createElement(k.default,{key:n,containerStyle:{marginHorizontal:0},bodyStyle:{alignItems:"flex-start"},onPress:function(){return t(R.default,{id:e.id})}},c.a.createElement(P.Text,{style:{marginLeft:20}},e.name))})))},L=function(){var e=Object(g.default)().auth,t=Object(M.useMessengerChannelSorted)(e);return c.a.createElement(u.default,{style:{flex:1}},null==t?void 0:t.map((function(t,n){var r=Object(D.avatarFromChannel)(t,e.user).name;return c.a.createElement(k.default,{key:n,containerStyle:{marginHorizontal:0},bodyStyle:{alignItems:"flex-start"},onPress:function(){return Object(T.navigate)("ChatScreen",{id:t.id})}},c.a.createElement(P.Text,{style:{marginLeft:20}},r))})))},B=function(e){var t=e.auth,n=Object(E.default)().colors,r=Object(_.default)(),o=Object(d.default)(),l=Object(M.useMessengerChannelSorted)(t),f=Object(i.useState)(),m=a()(f,2),b=m[0],g=m[1],p=Object(S.default)().setModal,h=[function(){return p(I.default,{})},function(){return p(C.default,{type:"messenger"})}],y=function(e){var t=j.default[e].iconColor;return{MemberTab:{title:"member",component:V,icon:c.a.createElement(s.MaterialCommunityIcons,{size:32,color:t,style:{marginBottom:-3},name:"account"})},ChatTab:{title:"chat",component:L,icon:c.a.createElement(s.Ionicons,{size:30,color:t,style:{marginBottom:-3},name:"chatbox"})}}}(r);return Object(i.useEffect)((function(){void 0===b&&void 0!=l&&g(l.length>0?1:0)}),[l]),c.a.createElement(u.default,{style:"landscape"==o?[A.tabBar,{backgroundColor:j.default[r].background,borderTopColor:n.border}]:{width:0},pointerEvents:"auto"},"landscape"==o&&t.user&&void 0!==b&&c.a.createElement(c.a.Fragment,null,c.a.createElement(O.default,{userId:t.user.id,username:t.user.username,name:t.user.name}),c.a.createElement(u.default,{style:{flexDirection:"row-reverse"}},c.a.createElement(w.default,{title:"+",textStyle:{fontSize:20},style:{borderRadius:20},onPress:h[b]})),c.a.createElement(u.default,{accessibilityRole:"tablist",style:A.content},Object.keys(y).length>1?c.a.createElement(x.default,{tabs:y,tabBarPosition:"top",onTab:g,index:b}):c.a.createElement(u.default,{style:{borderTopWidth:1,flex:1,borderColor:n.border}},Object.values(y).map((function(e){var t=e.component;return c.a.createElement(t,{key:e.title})}))))))},A=f.default.create({tabBar:{width:240,elevation:8,borderRightWidth:1,borderColor:j.default.borderColor},content:{flex:1,flexDirection:"row"},tab:{flex:1,alignItems:"center"},label:{textAlign:"center",backgroundColor:"transparent"}}),W=n(301),H=n(360),F=n(270),U=n(464),N=n(120),G=n(511),Q=n(426),J=n(461),Y=n(462),K=[G.default,R.default,C.default,Q.default,J.default,Y.default,I.default],$=n(259),q=n(466),Z=Object(o.default)();function X(){var e=Object(d.default)();return Object(q.default)(),c.a.createElement(Z.Navigator,{mode:"modal",headerMode:"screen",screenOptions:{cardStyle:{backgroundColor:"white"},animationEnabled:!0,cardStyleInterpolator:l.CardStyleInterpolators.forVerticalIOS}},c.a.createElement(Z.Screen,{name:"Main",component:te,options:{headerShown:!1}}),Object.entries(v.modal).map((function(t){var n=a()(t,2),r=n[0],o=n[1];return c.a.createElement(Z.Screen,{key:r,name:r,component:o.component,options:{title:o.title,gestureDirection:"landscape"==e?"vertical-inverted":"vertical"}})})))}var ee=Object(o.default)();var te=function(){var e=Object(d.default)(),t=Object(N.default)(),n=Object(g.default)().auth,r=Object(_.default)(),o=Object(p.default)(),f=o.lang,m=o.locale,b=Object(i.useMemo)((function(){return void 0===n.user?[]:(console.log("current user: ",n.user),Object.entries(null===n.user?v.login:v.main))}),[n,m]),y=Object(i.useMemo)((function(){return void 0===n.user||null===n.user?[]:K}),[n]),E="light"==r?{}:{backgroundColor:"#010409"};return void 0!==n.user?c.a.createElement(u.default,{style:{flexDirection:"row",flex:1}},c.a.createElement(S.ModalsProvider,{modals:y},n.user?c.a.createElement(B,{auth:n}):void 0,c.a.createElement(u.default,{style:[{flex:1},E]},c.a.createElement(W.WebSocketProvider,{disable:null===n.user||void 0===n.user},c.a.createElement(U.FirebaseProvider,{user:n.user},c.a.createElement(ee.Navigator,{screenOptions:function(n){var a=n.navigation,o=n.route;return{headerStyle:{backgroundColor:j.default[r].header,height:t?50:void 0},headerTitleStyle:{color:j.default[r].text},headerLeft:function(){return function(e,t,n,r,a){var o=-1==["HomeScreen","LoginScreen"].findIndex((function(e){return e==t.name})),l=function(){e.canGoBack()?e.goBack():o&&e.replace("HomeScreen")};return"portrait"==n&&o?c.a.createElement(F.TouchableOpacity,{onPress:l,disabled:!a},c.a.createElement($.default,{title:"",color:a?j.default[r].buttonBackgroundColor:j.default[r].hoverColor,onPress:l,disabled:a,style:{width:32,height:32,margin:16,paddingVertical:1,paddingHorizontal:4}},c.a.createElement(s.Ionicons,{size:24,color:j.default[r].iconColor,name:"arrow-back"}))):null}(a,o,e,r,t)},headerRight:function(){return c.a.createElement(H.default,null)},headerLeftContainerStyle:{backgroundColor:j.default[r].header,borderBottomWidth:1,borderColor:j.default[r].headerBottomColor},cardStyle:[{flexShrink:1},E],animationEnabled:"portrait"==e,cardStyleInterpolator:l.CardStyleInterpolators.forHorizontalIOS}}},b.map((function(e){var t=a()(e,2),n=t[0],r=t[1];return c.a.createElement(ee.Screen,{key:n,name:n,component:r.component,options:{title:f(r.title)}})})),c.a.createElement(ee.Screen,{name:"NotFound",component:h,options:{title:"Oops!"}}))))))):c.a.createElement(c.a.Fragment,null)}}}]);
//# sourceMappingURL=6.fa5fc1be.chunk.js.map