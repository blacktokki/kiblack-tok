{"version":3,"sources":["src/screens/NotFoundScreen.tsx","src/navigation/Drawer.tsx","src/modals/index.ts","src/navigation/MainNavigator.tsx","src/components/Themed.tsx","src/constants/Colors.ts","src/hooks/useModalsContext.tsx","src/hooks/useResizeContext.tsx","src/components/CommonButton.tsx","src/hooks/lists/useMessengerChannelList.ts","src/components/ModalSection.tsx","src/lib/react-native-paper/Avatar.tsx","src/components/Avatar.tsx","src/components/CommonSection.tsx","src/hooks/useModalEffect.ts","src/navigation/index.tsx","src/hooks/useWebsocketContext.tsx","src/hooks/lists/useUserMembershipList.ts","src/modals/RegistrationModal.tsx","src/hooks/lists/useMessengerMemberList.ts","src/components/CommonItem.tsx","src/components/TextButton.tsx","src/modals/ChannelEditModal.tsx","src/hooks/lists/useMessengerContentList.ts","src/hooks/useUploadContext.tsx","src/components/EditorHtml.tsx","src/components/RowField.tsx","src/components/TabView.tsx","src/components/HeaderRight.tsx","src/modals/ProfileModal.tsx","src/components/ContractFooter.tsx","src/screens/login/LoginScreen.tsx","src/lib/react-native-webrtc/useWebsocketContext.tsx","src/lib/react-native-webrtc/webrtc/p2p.tsx","src/lib/react-native-webrtc/webrtc/index.ts","src/lib/react-native-webrtc/LocalCam.tsx","src/lib/react-native-webrtc/RemoteCam.tsx","src/screens/main/ChatScreen/VideoCallSection.tsx","src/components/Messages/UploadTags.tsx","src/screens/main/CommonChatSection.tsx","src/hooks/useChatSection.tsx","src/screens/main/HomeScreen/ConfigSections.tsx","src/screens/main/HomeScreen/index.tsx","src/lib/tinymce/Editor.tsx","src/components/Editor.tsx","src/screens/main/NoteScreen/EditorSection.tsx","src/screens/index.ts","src/screens/main/ChatScreen/index.tsx","src/screens/main/NoteScreen/index.tsx","src/screens/login/DemoScreen.tsx","src/modals/DateTimePickerModal.tsx","src/components/Messages/MessageContentView.tsx","src/modals/MessageModal.tsx","src/modals/NotePickerModal.tsx","src/hooks/lists/useExternalMembershipList.ts","src/components/TextField.tsx","src/components/CommonTextInput.tsx","src/components/MemberItem.tsx","src/modals/AlertModal.tsx","src/components/Profile.tsx","src/hooks/useFirebaseContext.tsx","src/components/Messages/LinkPreview.tsx","src/components/Messages/FilePreview.tsx","src/components/Messages/EditorPreview.tsx","src/components/Messages/index.tsx","src/hooks/lists/useMessengerViewerList.ts","src/hooks/useLocalSearch.ts","src/components/CopyField.tsx","src/modals/InviteModal.tsx","src/components/Messages/TimerTags.tsx","src/hooks/lists/useTimerMessageContent.ts","src/hooks/useInvitee.ts","web/firebase-config.js","web/editor-config.js","src/navigation/LinkingConfiguration.ts"],"names":["NotFoundScreen","_ref","navigation","lang","useLangContext","auth","useAuthContext","_jsxs","View","style","styles","container","children","_jsx","Text","title","TouchableOpacity","onPress","replace","user","link","linkText","StyleSheet","create","flex","backgroundColor","alignItems","justifyContent","padding","fontSize","fontWeight","marginTop","paddingVertical","color","MemberTabView","setModal","useModalsContext","userList","useUserMembershipList","map","item","index","CommonItem","containerStyle","marginHorizontal","bodyStyle","ProfileModal","id","marginLeft","name","MessengerTabView","channelList","useMessengerChannelSorted","avatarFromChannel","navigate","NoteTabView","colors","useTheme","theme","useColorScheme","windowType","useResizeContext","_useState","useState","_useState2","_slicedToArray","setIndex","onAddList","_auth$user","RegistrationModal","is_guest","ChannelEditModal","type","drawerTabs","Colors","iconColor","MemberTab","component","icon","MaterialCommunityIcons","size","marginBottom","ChatTab","Ionicons","NoteTab","getDrawerTabs","useEffect","undefined","tabBar","background","borderTopColor","border","width","pointerEvents","_Fragment","Profile","userId","username","flexDirection","TextButton","textStyle","borderRadius","accessibilityRole","content","Object","keys","length","TabView","tabs","tabBarPosition","onTab","borderTopWidth","borderColor","values","drawerTab","Tab","elevation","borderRightWidth","tab","label","textAlign","InviteModal","AlertModal","DateTimePickerModal","NotePickerModal","MessageModal","Main","createStackNavigator","isMobile","useIsMobile","_useLangContext","locale","entries","useMemo","console","log","login","main","modalValues","modals","backgroundStyle","UploadContextProvider","ModalsProvider","Drawer","WebSocketProvider","disable","FirebaseProvider","Navigator","screenOptions","route","headerStyle","header","height","headerTitleStyle","text","headerLeft","canGOBackScreen","findIndex","v","goBack","canGoBack","disabled","CommonButton","buttonBackgroundColor","hoverColor","margin","paddingHorizontal","headerRight","HeaderRight","headerLeftContainerStyle","borderBottomWidth","headerBottomColor","cardStyle","flexShrink","animationEnabled","cardStyleInterpolator","CardStyleInterpolators","forHorizontalIOS","_ref2","_ref3","key","screen","Screen","options","useThemeColor","props","colorName","colorFromProps","lightColor","darkColor","otherProps","_objectWithoutProperties","_excluded","light","dark","DefaultText","_objectSpread","_excluded2","DefaultView","tint","tabIconDefault","tabIconSelected","buttonBorderColor","focus","ModalsContext","createContext","allModals","setModals","_useState3","_useState4","animationType","setAnimationType","filter","visible","Component","Provider","value","newModals","m","modal","Modal","transparent","useContext","getWindowType","window","ResizeContextContext","Dimensions","get","ResizeContextProvider","detectMobile","useMobileDetect","_useWindowDimensions","useWindowDimensions","setWindowType","DefaultButton","hover","setHover","Pressable","onHoverIn","onHoverOut","selectable","_props","borderWidth","useMessengerChannelList","queryClient","useQueryClient","lastJsonMessage","useWebsocketContext","data","useQuery","_asyncToGenerator","getChannelList","setQueryData","_data","find","concat","_toConsumableArray","sort","a","b","_data2$message_set$","channel","last_message","message_set","created","_a$last_message","_b$last_message","useMessengerChannelMutation","useMutation","postChannel","onSuccess","invalidateQueries","update","patchChannel","direct","postDirectChannel","mutateAsync","CommonSection","autoScale","outerContainerStyle","alignSelf","maxWidth","BottomSheet","normalizeHash","hash","min","max","Math","floor","str","initHash","i","charCodeAt","abs","stringToHSL","Avatar","split","join","toUpperCase","avatar","member_count","subowner","owner","outerContainer","outerContainerFill","withSeparator","separator","titleView","titleStyle","subtitle","bodyView","marginVertical","callback","deps","useNavigation","event","e","preventDefault","addListener","removeListener","enableScreens","electronVersion","navigationRef","React","params","_navigationRef$curren","_navigationRef$curren2","current","_process","_process$versions","process","versions","Navigation","defaultColorScheme","useDefaultColorScheme","userColorScheme","colorScheme","NavigationContainer","ref","documentTitle","formatter","linking","LinkingConfiguration","DarkTheme","DefaultTheme","RootNavigator","Root","useInvitee","mode","headerMode","forVerticalIOS","MainNavigator","headerShown","gestureDirection","replaceInviteeState","location","IGNORE_WERNINGS","warnLogger","warn","message","some","includes","defaultContext","sendJsonMessage","WebSocketContext","WebSocketInternalProvider","path","Context","useBackground","token","setToken","AppState","currentState","isActive","setIsActive","_useWebSocket","useWebSocket","websockerURL","shouldReconnect","closeEvent","protocols","onOpen","onClose","AsyncStorage","getItem","then","listener","addEventListener","nextState","remove","groupId","getUserMembershipList","useUserMembershipMutation","_useAuthContext","dispatch","_create","postUser","_update","patchUser","password","_delete","deleteUser","_auth$user2","delete","ErrorView","form_error","form_error_text","setUsername","setName","_useState5","_useState6","setPassword","_useState7","_useState8","checkPassword","setCheckPassword","_useState9","_useState10","isStaff","_useState11","_useState12","error","setError","externalMemberList","useExternalMembershipList","userMembershipMutation","usernameDisable","back","ModalSection","RowField","CommonTextInput","setValue","keyboardType","secureTextEntry","newError","test","is_staff","inviteGroupId","textAlignVertical","useMessengerMemberList","channel_id","getMessengerMemberList","useMessengerMemberMutation","invite","postBulkMessengerMember","leave","deleteMessengerMember","_React$useState","_React$useState2","press","setPress","onPressIn","onPressOut","minHeight","member_id","channelMutation","messengerMemberMutation","description","setDescription","_name","useModalEffect","TextField","multiline","newChannel","group","field","updateContnetPage","pages","updateMessages","update_i","forEach","page","timer","is_archive","useMessengerContentList","_useInfiniteQuery","useInfiniteQuery","pageParam","getMessengerContentList","_x","apply","arguments","select","next","getNextPageParam","lastPage","refetchOnReconnect","refetchOnWindowFocus","query","updated_gte","Date","state","dataUpdatedAt","toISOString","newData","getNewMessengerContentList","contents","lastMessageId","nextMessages","timerMessageRefetch","fetchNextPage","pageParams","useMessengerContentMutation","channelId","uploadDispatch","useUploadContext","postMessage","_patch","patchMessengerContent","mutate","patch","UploadContext","upload","uploadReducer","initialState","action","files","f","filename","progress","push","_defineProperty","_useReducer","useReducer","_useReducer2","RenderHTML","lazy","regexForStripHTML","memo","Suspense","fallback","replaceAll","defaultTextProps","contentWidth","source","baseStyle","rowStyle","icons","assign","k","renderTabBar","TabBar","indicatorStyle","labelStyle","whiteSpace","activeColor","inactiveColor","renderIcon","scene","onTabPress","_ref4","_ref5","navigationState","routes","_ref6","_ref7","onIndexChange","onSwipeStart","Platform","OS","getSelection","sel","removeAllRanges","renderScene","SceneMap","_ref8","_ref9","defaultButtonProps","buttonProps","extra","isSelf","_auth$user3","_auth$user4","_auth$user5","openURL","url","href","Linking","Styles","footer_buttons","footer_button","AntDesign","paddingBottom","paddingRight","login_container","login_header","paddingTop","login_header_logo","resizeMode","login_header_text","login_header_text_bold","login_wrapper","borderTopRightRadius","borderTopLeftRadius","form","form_input","button","button_label","login_social","login_social_separator","login_social_separator_line","login_social_separator_text","login_social_buttons","login_social_button","login_social_icon","login_social_facebook","login_footer_text","guest_footer_text","login_footer_link","TURN_SERVER","peerConstraints","iceServers","JSON","parse","urls","sessionConstraints","mandatory","OfferToReceiveAudio","OfferToReceiveVideo","VoiceActivityDetection","mediaConstraints","audio","video","framerate","onICEcandidate","pc","_message","rtcMessage","candidate","RTCIceCandidate","addIceCandidate","sendICEcandidate","sendMessage","receiver","target","createOffer","pcRefCurrent","stream","addStream","offerDescription","arr","sdp","RTCSessionDescription","optimizeSdp","setLocalDescription","_x2","_x3","_x4","_x5","camStyle","cam","bottonContainer","position","bottom","buttonBar","_props$user","_useWebsocketContext","_useLocalCam","pcRef","useRef","sender","setSender","_stream","setStream","isPlay","CustomRTCView","useCallback","RTCView","videoProps","start","newStream","mediaDevices","getUserMedia","getDisplayMedia","catch","_x6","_x7","_x8","stop","getTracks","track","websocketOnMessage","_websocketOnMessage","response","channel_name","peerConnection","RTCPeerConnection","answerDescription","setRemoteDescription","_x9","_x10","useLocalCam","Button","setReceiver","_useRemoteCam","setUser","close","clearInterval","statsInterval","_websocketOnMessage2","_pcRef$current","_pcRef$current2","_pcRef$current3","_pcRef$current4","iceConnectionState","activeStream","setInterval","stats","getStats","statsOutput","framePerSecond","report","kind","statName","framesPerSecond","toTimeString","addTransceiver","direction","streams","getRemoteStreams","createAnswer","localDescription","_x11","useRemoteCam","TextInput","onChangeText","VideoView","scale","maxHeight","flexGrow","focusGuest","setFocusGuest","VideoCallContainer","setDisable","videoMode","setVideoMode","guests","setGuests","_useRtcContext","useRtcContext","ceil","sqrt","toggleVideoMode","ThemedView","aspectRatio","borderLeftWidth","flexWrap","RemoteCam","LocalCam","RtcProvider","UploadTag","overflow","expand","setExpand","uploadData","isExpand","extraButtons","inputRef","editorValue","setEditorValue","setTimer","messageEvent","sendToScreen","bottomTab","setBottomTab","autoFocus","setAutoFocus","valueLines","contentMutation","postValue","Messages","reverse","UploadTags","TimerTags","borderBottomRightRadius","top","Entypo","timerFormat","datetime","onKeyPress","shiftKey","onFocus","numberOfLines","borderBottomLeftRadius","marginRight","Promise","resolve","reject","input","document","createElement","onchange","onabort","onerror","click","file","editor","parseInt","channelAvatar","memberList","_memberList$find","useLayoutEffect","setOptions","ConfigSection","setLocale","configTheme","useConfigColorScheme","_useFirebaseContext","useFirebaseContext","noti","enable","setNoti","setEnable","n","textDecorationLine","l","setColorScheme","memberItem","MemberItem","member","ScrollView","today","slice","_item$last_message","_item$last_message2","_item$last_message3","_item$last_message4","_avatarFromChannel","date","preview_content","FontAwesome","opacity","paddingLeft","unread_count","contentContainerStyle","_item$last_message5","_item$last_message6","flexBasis","wordBreak","ConfigTabView","ConfigSections","getBottomTabs","headerSetter","headerIndexRef","OneTab","TwoTab","ThreeTab","FourTab","SimpleLineIcons","INIT","require","Editor","tinymceScriptSrc","onInit","onReady","onEditorChange","init","setup","plugins","toolbar","skin","content_css","menubar","branding","statusbar","block_formats","fontsize_formats","forced_root_block_attrs","ready","setReady","active","editable","setEditable","onEdit","EditorHtml","onLongPress","HomeScreen","_route$params2","home","setHome","tempref","indexRef","measure","fx","fy","_","px","py","round","useHeaderSetter","_route$params","StyledText","ContractFooter","setParams","ChatScreen","useChatSection","minWidth","VideoCallSection","d","CommonChatSection","NoteScreen","editMode","setEditMode","EditorSection","LoginScreen","_login","placeholder","autoCapitalize","onSubmitEditing","DemoScreen","dayTypes","hours","Array","toString","padStart","minutes","getDisableDays","startDate","clone","startOf","add","endDate","endOf","dayjs","result","format","Calendar","CommonPicker","_dayjs","restMinute","defaultDayjs","setDate","dayType","setDayType","hour","setHour","minute","setMinute","disableDays","setDisableDays","disableAllTouchEventsForDisabledDays","onMonthChange","dateString","markedDates","reduce","p","c","selected","MessageContentView","Hyperlink","linkDefault","linkStyle","onPressLink","isOwner","Clipboard","setString","keyword","getExternalMembershipList","contentHeight","setContentHeight","onContentSizeChange","newHeight","nativeEvent","contentSize","onBlur","onEndEditing","messages","buttons","firebaseConfig","messagingSenderId","apiKeyEncrypted","FCM_API_KEY","app","firebase","initializeApp","apiKey","messaging","onMessage","payload","Notification","permission","body","alert","requestToken","requestPermission","serviceWorkerRegistration","navigator","serviceWorker","register","scope","currentToken","getToken","vapidKey","FCM_PUBLIC_VAPID_KEY","unregister","FirebaseContext","tokenRef","notification","setNotification","isMount","t","putNotification","getNotification","postNotification","_useContext","touchableRef","image_url","Image","uri","humanFileSize","pow","toFixed","showBorder","thumbnail","filesize","MessengerContentPageItem","_nextPage2","lastTouchRef","now","nextPage","_nextPage","nextContent","onTouchMove","index2","isSystem","isFirst","ownerId","dayChanged","getOnPress","timerToString","attatchment_set","attatchment","aIndex","EditorPreview","FilePreview","LinkPreview","useViewerContentList","_props$auth","_props$auth$user","renderItem","FlatList","onScroll","contentOffset","y","onLayout","layout","localSearchReducer","Error","CopyField","copied","setCopied","InviteItem","selectedRef","has","setSelected","GroupTabView","_useLocalSearch","compare","searchState","useLocalSearch","memberSet","Set","dispatchKeyword","user_ids","ExternalMembershipTabView","setKeyword","timeoutRef","setTimeout","clearTimeout","inviteLink","external","_timerFormat","year","month","TimerTag","end","ratio","diff","timerMessages","getTimerMessageContentList","sorted","_sorted$","ms","Number","MAX_VALUE","timeout","useTimerMessageContentList","setNow","invitee_id","invitee_state","pathname","endsWith","search","startsWith","history","replaceState","redirect","module","exports","editorConfig","ROOTPATH","prefixes","config","screens","NotFound"],"mappings":"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","file":"static/js/2.466311b3.chunk.js","sourcesContent":["import { StackScreenProps } from '@react-navigation/stack';\r\nimport * as React from 'react';\r\nimport { StyleSheet, Text, TouchableOpacity, View } from 'react-native';\r\nimport useAuthContext from '../hooks/useAuthContext';\r\nimport useLangContext from '../hooks/useLangContext';\r\n\r\nexport default function NotFoundScreen({\r\n  navigation,\r\n}: StackScreenProps<any, 'NotFound'>) {\r\n  const { lang } = useLangContext()\r\n  const { auth } = useAuthContext()\r\n  return (\r\n    <View style={styles.container}>\r\n      <Text style={styles.title}>{lang(\"This screen doesn't exist.\")}</Text>\r\n      <TouchableOpacity onPress={() => navigation.replace(auth.user?'HomeScreen':'LoginScreen')} style={styles.link}>\r\n        <Text style={styles.linkText}>{lang(\"Go to home screen!\")}</Text>\r\n      </TouchableOpacity>\r\n    </View>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    backgroundColor: '#fff',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    padding: 20,\r\n  },\r\n  title: {\r\n    fontSize: 20,\r\n    fontWeight: 'bold',\r\n  },\r\n  link: {\r\n    marginTop: 15,\r\n    paddingVertical: 15,\r\n  },\r\n  linkText: {\r\n    fontSize: 14,\r\n    color: '#2e78b7',\r\n  },\r\n});\r\n","import { useTheme } from '@react-navigation/native';\r\nimport React, { useEffect, useState } from 'react';\r\nimport { View, StyleSheet } from 'react-native';\r\nimport Profile from '../components/Profile';\r\nimport TextButton from '../components/TextButton';\r\nimport Colors from '../constants/Colors';\r\nimport useResizeContext from '../hooks/useResizeContext';\r\nimport TabView from '../components/TabView';\r\nimport { TabViewRecord, UserMembership } from '../types';\r\nimport useModalsContext from '../hooks/useModalsContext';\r\nimport ChannelEditModal from '../modals/ChannelEditModal';\r\nimport CommonItem from '../components/CommonItem';\r\nimport { Text } from '../components/Themed';\r\nimport useAuthContext, { Auth } from '../hooks/useAuthContext';\r\nimport { useMessengerChannelSorted } from '../hooks/lists/useMessengerChannelList';\r\nimport { navigate } from '.'\r\nimport { avatarFromChannel } from '../components/Avatar';\r\nimport useColorScheme from '../hooks/useColorScheme';\r\nimport { Ionicons, MaterialCommunityIcons } from '../lib/@expo/vector-icons';\r\nimport RegistrationModal from '../modals/RegistrationModal';\r\nimport useUserMembershipList from '../hooks/lists/useUserMembershipList';\r\nimport ProfileModal from '../modals/ProfileModal';\r\n\r\n\r\nconst MemberTabView = ()=>{\r\n  const {auth} = useAuthContext()\r\n  const { setModal } = useModalsContext()\r\n  const userList = useUserMembershipList(auth)\r\n  return <View style={{flex:1}}>\r\n    {userList?.map((item, index)=>{\r\n      return <CommonItem key={index} containerStyle={{marginHorizontal:0}} bodyStyle={{alignItems:'flex-start'}} onPress={()=>setModal(ProfileModal, {id:item.id})}>\r\n        <Text style={{marginLeft:20}}>{item.name}</Text>\r\n      </CommonItem>\r\n    })}\r\n  </View>\r\n}\r\n\r\nconst MessengerTabView = ()=>{\r\n  const {auth} = useAuthContext()\r\n  const channelList = useMessengerChannelSorted('messenger', auth);\r\n  return <View style={{flex:1}}>\r\n    {channelList?.map((item, index)=>{\r\n      const {name} = avatarFromChannel(item, auth.user)\r\n      return <CommonItem key={index} containerStyle={{marginHorizontal:0}} bodyStyle={{alignItems:'flex-start'}} onPress={()=>navigate(\"ChatScreen\", {id:item.id})}>\r\n        <Text style={{marginLeft:20}}>{name}</Text>\r\n      </CommonItem>\r\n    })}\r\n  </View>\r\n}\r\n\r\nconst NoteTabView = ()=>{\r\n  const {auth} = useAuthContext()\r\n  const channelList = useMessengerChannelSorted('mycontent', auth);\r\n  return <View style={{flex:1}}>\r\n    {channelList?.map((item, index)=>{\r\n      return <CommonItem key={index} containerStyle={{marginHorizontal:0}} bodyStyle={{alignItems:'flex-start'}} onPress={()=>navigate(\"NoteScreen\", {id:item.id})}>\r\n        <Text style={{marginLeft:20}}>{item.name}</Text>\r\n      </CommonItem>\r\n    })}\r\n  </View>\r\n}\r\nconst getDrawerTabs = (theme:'light'|'dark')=>{\r\n  const color = Colors[theme].iconColor\r\n  return {\r\n    MemberTab:{\r\n      title:'member',\r\n      component:MemberTabView,\r\n      icon:<MaterialCommunityIcons size={32} color={color} style={{ marginBottom: -3 }} name='account'/>,\r\n    },\r\n    ChatTab:{\r\n        title:'chat',\r\n        component:MessengerTabView,\r\n        icon:<Ionicons size={30} color={color} style={{ marginBottom: -3 }} name='chatbox'/>\r\n    },\r\n    NoteTab:{\r\n        title:'note',\r\n        component:NoteTabView,\r\n        icon:<MaterialCommunityIcons size={32} color={color} style={{ marginBottom: -3 }} name='pencil-box'/>\r\n    }\r\n  } as TabViewRecord\r\n}\r\n\r\nexport default ({auth}:{auth:Auth})=> {\r\n  const { colors } = useTheme();\r\n  const theme = useColorScheme();\r\n  const windowType = useResizeContext();\r\n  const [index, setIndex] = useState<number>();\r\n  const { setModal } = useModalsContext()\r\n  \r\n  const onAddList = [\r\n    ()=>setModal(RegistrationModal, auth.user?.is_guest?{id:auth.user.id}:{}),\r\n    ()=>setModal(ChannelEditModal, {type:'messenger'}),\r\n    ()=>setModal(ChannelEditModal, {type:'mycontent'}),\r\n  ]\r\n  const drawerTabs = getDrawerTabs(theme)\r\n\r\n  useEffect(()=>{\r\n    if(index===undefined){\r\n      setIndex(0)\r\n    }\r\n  }, [])\r\n  return <View style={windowType=='landscape'?[\r\n      styles.tabBar,\r\n      {\r\n        backgroundColor: Colors[theme].background,\r\n        borderTopColor: colors.border,\r\n      },\r\n      // tabBarStyle,\r\n    ]:{width:0}}\r\n    pointerEvents={false ? 'none' : 'auto'}\r\n  >\r\n    {windowType=='landscape' && auth.user && index!==undefined && <>\r\n      <Profile userId={auth.user.id} username={auth.user.username} name={auth.user.name}/>\r\n      <View style={{flexDirection:'row-reverse'}}>\r\n          <TextButton title='+' textStyle={{fontSize:20}} style={{borderRadius:20}} onPress={onAddList[index]}/>\r\n      </View>\r\n      <View accessibilityRole=\"tablist\" style={styles.content}>\r\n        {Object.keys(drawerTabs).length>1 ? \r\n          <TabView tabs={drawerTabs} tabBarPosition={\"top\"} onTab={setIndex} index={index}/>: \r\n          <View style={{borderTopWidth:1, flex:1, borderColor:colors.border}}>            \r\n            {Object.values(drawerTabs).map(drawerTab=>{const Tab = drawerTab.component; return <Tab key={drawerTab.title}/>})}\r\n          </View>\r\n        }\r\n      </View>\r\n    </>}\r\n  </View>\r\n}\r\n\r\n{/*<Text style={[styles.label, { color: d.isFocused ? colors.primary : '#222' }]}></Text> */}\r\n\r\nconst styles = StyleSheet.create({\r\n    tabBar: {\r\n      width:240,\r\n      elevation: 8,\r\n      borderRightWidth:1,\r\n      borderColor:Colors.borderColor\r\n    },\r\n    content: {\r\n      flex: 1,\r\n      flexDirection: 'row',\r\n    },\r\n    tab: {\r\n        flex: 1,\r\n        alignItems: 'center',\r\n    },\r\n    label: {\r\n        textAlign: 'center',\r\n        backgroundColor: 'transparent',\r\n      },\r\n  });","import InviteModal from \"./InviteModal\";\r\nimport ProfileModal from \"./ProfileModal\";\r\nimport ChannelEditModal from \"./ChannelEditModal\"\r\nimport AlertModal from \"./AlertModal\";\r\nimport DateTimePickerModal from \"./DateTimePickerModal\"\r\nimport MessageModal from \"./MessageModal\";\r\nimport RegistrationModal from \"./RegistrationModal\";\r\nimport NotePickerModal from \"./NotePickerModal\";\r\n\r\nexport default [\r\n    InviteModal,\r\n    ProfileModal,\r\n    ChannelEditModal,\r\n    AlertModal,\r\n    DateTimePickerModal,\r\n    NotePickerModal,\r\n    MessageModal,\r\n    RegistrationModal\r\n]","import { CardStyleInterpolators, createStackNavigator } from '@react-navigation/stack';\r\nimport React, {useMemo} from 'react';\r\nimport { View } from 'react-native';\r\nimport { Ionicons } from '../lib/@expo/vector-icons';\r\nimport useResizeContext from '../hooks/useResizeContext';\r\nimport NotFoundScreen from '../screens/NotFoundScreen';\r\nimport {main, login} from '../screens';\r\nimport Drawer from './Drawer';\r\nimport useAuthContext from '../hooks/useAuthContext';\r\nimport { WebSocketProvider } from '../hooks/useWebsocketContext';\r\nimport HeaderRight from '../components/HeaderRight'\r\nimport Colors from '../constants/Colors';\r\nimport { TouchableOpacity } from 'react-native-gesture-handler';\r\nimport { FirebaseProvider } from '../hooks/useFirebaseContext';\r\nimport useIsMobile from '../hooks/useIsMobile';\r\nimport useColorScheme from '../hooks/useColorScheme';\r\nimport { ModalsProvider } from '../hooks/useModalsContext';\r\nimport modals from '../modals';\r\nimport useLangContext from '../hooks/useLangContext';\r\nimport CommonButton from '../components/CommonButton';\r\nimport { UploadContextProvider } from '../hooks/useUploadContext';\r\n\r\nconst Main = createStackNavigator();\r\n\r\nfunction headerLeft(navigation:any, route:any, windowType:string, theme:'light'|'dark', isMobile:boolean){\r\n    const canGOBackScreen = ['HomeScreen', 'LoginScreen'].findIndex(v=>v == route.name) == -1\r\n    const goBack = ()=>{\r\n        if (navigation.canGoBack())\r\n            navigation.goBack()\r\n        else if (canGOBackScreen)\r\n            navigation.replace('HomeScreen')\r\n    }\r\n    if (windowType=='portrait' && canGOBackScreen)\r\n        return <TouchableOpacity onPress={goBack} disabled={!isMobile}>\r\n            <CommonButton title={''} color={isMobile?Colors[theme].buttonBackgroundColor:Colors[theme].hoverColor} onPress={goBack} disabled={isMobile} style={{width:32, height:32, margin:16, paddingVertical:1, paddingHorizontal:4}}>\r\n                <Ionicons size={24} color={Colors[theme].iconColor} name=\"arrow-back\"/>\r\n            </CommonButton>\r\n        </TouchableOpacity>\r\n    return null\r\n}\r\n\r\nexport default ()=>{\r\n    const windowType = useResizeContext();\r\n    const isMobile = useIsMobile()\r\n    const {auth} = useAuthContext()\r\n    const theme = useColorScheme()\r\n    const {lang, locale} = useLangContext()\r\n    const entries = useMemo(()=>{\r\n        if (auth.user === undefined)\r\n            return []\r\n        console.log('current user: ', auth.user)\r\n        return Object.entries(auth.user === null?login:main)\r\n    }, [auth, locale])\r\n    const modalValues = useMemo(()=>{\r\n        if (auth.user === undefined)\r\n            return []\r\n        return auth.user === null?[]:modals\r\n    }, [auth])\r\n    const backgroundStyle = theme=='light'?{}:{backgroundColor:'#010409'}\r\n    return (auth.user!==undefined?<View style={{flexDirection:'row', flex:1}}>\r\n        <UploadContextProvider>\r\n            <ModalsProvider modals={modalValues}>\r\n                {auth.user?<Drawer auth={auth}/>:undefined}\r\n                <View style={[{flex:1}, backgroundStyle]}>\r\n                    <WebSocketProvider disable={auth.user === null || auth.user === undefined}>\r\n                        <FirebaseProvider user={auth.user}>\r\n                            <Main.Navigator\r\n                                screenOptions={({navigation, route})=>({\r\n                                    headerStyle:{backgroundColor:Colors[theme].header, height:isMobile?50:undefined},\r\n                                    headerTitleStyle:{color:Colors[theme].text},\r\n                                    headerLeft:()=>headerLeft(navigation, route, windowType, theme, isMobile),\r\n                                    headerRight:()=><HeaderRight/>,\r\n                                    headerLeftContainerStyle:{backgroundColor:Colors[theme].header, borderBottomWidth:1, borderColor:Colors[theme].headerBottomColor},\r\n                                    cardStyle:[{flexShrink:1}, backgroundStyle],\r\n                                    animationEnabled:windowType=='portrait',\r\n                                    cardStyleInterpolator: CardStyleInterpolators.forHorizontalIOS\r\n                                })}\r\n                            >\r\n                                {entries.map(([key, screen])=><Main.Screen key={key} name={key} component={screen.component} options={{ title: lang(screen.title) }} />)}\r\n                                <Main.Screen name=\"NotFound\" component={NotFoundScreen} options={{ title: 'Oops!' }} />\r\n                            </Main.Navigator>\r\n                        </FirebaseProvider>\r\n                    </WebSocketProvider>\r\n                </View>\r\n            </ModalsProvider>\r\n        </UploadContextProvider>\r\n    </View>:<></>);\r\n}","/**\r\n * Learn more about Light and Dark modes:\r\n * https://docs.expo.io/guides/color-schemes/\r\n */\r\n\r\nimport * as React from 'react';\r\nimport { Text as DefaultText, View as DefaultView } from 'react-native';\r\n\r\nimport Colors from '../constants/Colors'\r\nimport useColorScheme from '../hooks/useColorScheme';\r\n\r\nexport function useThemeColor(\r\n  props: { light?: string; dark?: string },\r\n  colorName: keyof typeof Colors.light & keyof typeof Colors.dark\r\n) {\r\n  const theme = useColorScheme();\r\n  const colorFromProps = props[theme];\r\n\r\n  if (colorFromProps) {\r\n    return colorFromProps;\r\n  } else {\r\n    return Colors[theme][colorName];\r\n  }\r\n}\r\n\r\ntype ThemeProps = {\r\n  lightColor?: string;\r\n  darkColor?: string;\r\n};\r\n\r\nexport type TextProps = ThemeProps & DefaultText['props'];\r\nexport type ViewProps = ThemeProps & DefaultView['props'];\r\n\r\nexport function Text(props: TextProps) {\r\n  const { style, lightColor, darkColor, ...otherProps } = props;\r\n  const color = useThemeColor({ light: lightColor, dark: darkColor }, 'text');\r\n\r\n  return <DefaultText style={[{ color }, style]} {...otherProps} />;\r\n}\r\n\r\nexport function View(props: ViewProps) {\r\n  const { style, lightColor, darkColor, ...otherProps } = props;\r\n  const backgroundColor = useThemeColor({ light: lightColor, dark: darkColor }, 'background');\r\n\r\n  return <DefaultView style={[{ backgroundColor }, style]} {...otherProps} />;\r\n}\r\n","const tintColorLight = '#2f95dc';\r\nconst tintColorDark = '#fff';\r\n\r\nexport default {\r\n  light: {\r\n    text: '#000',\r\n    background: '#fff',\r\n    tint: tintColorLight,\r\n    tabIconDefault: '#ccc',\r\n    tabIconSelected: tintColorLight,\r\n    hoverColor:'rgb(242,242,242)',\r\n    buttonBackgroundColor: '#f6f8fa', //'rgba(9,30,66,0.08)',//rgb(242,242,242)\\\r\n    header:'#f6f8fa',\r\n    headerBottomColor:'rgb(216, 216, 216)',\r\n    buttonBorderColor:'rgba(27,31,36,0.15)',\r\n    iconColor: 'black'\r\n  },\r\n  dark: {\r\n    text: '#fff',\r\n    background: '#000',\r\n    tint: tintColorDark,\r\n    tabIconDefault: '#ccc',\r\n    tabIconSelected: tintColorDark,\r\n    hoverColor: '#010409',//'rgb(1,4,9)',\r\n    buttonBackgroundColor: '#010409',//'#282624',\r\n    header:'#010409',\r\n    headerBottomColor:'rgb(40, 40, 40)',\r\n    buttonBorderColor:'rgba(229,225,220,0.15)',\r\n    iconColor: 'white'\r\n  },\r\n  borderColor:'#d0d7de',\r\n  \r\n  focus:'#0065A4',\r\n};\r\n","import React, { useState, createContext, useContext, useEffect } from \"react\";\r\nimport { Modal } from \"react-native\";\r\nimport useResizeContext from \"./useResizeContext\";\r\n\r\ntype ModalProps = any\r\n\r\ntype ModalState = {\r\n  Component:React.ComponentType<ModalProps>,\r\n  props:any\r\n  visible:boolean\r\n}\r\ntype SetModal = (Component:ModalState[\"Component\"]|null, props:ModalProps|null)=>void\r\n\r\nconst ModalsContext = createContext<{setModal: SetModal}>({\r\n    setModal: () => {}\r\n});\r\n\r\nexport const ModalsProvider = ({children, modals:allModals}:{children:React.ReactNode, modals:React.ComponentType<ModalProps>[]}) => {\r\n    const [modals, setModals] = useState<ModalState[]>([]);\r\n    const windowType = useResizeContext();\r\n    const [animationType, setAnimationType] = useState('none')\r\n    const setModal:SetModal = (Component, props) => {\r\n        const newModals = modals.map(m=>{\r\n            if(Component==null || m.Component != Component){\r\n                return {\r\n                    ...m,\r\n                    visible:false\r\n                }\r\n            }\r\n            else if(m.Component == Component){\r\n                return {\r\n                    Component, \r\n                    props:props!==null?props:m.props,\r\n                    visible:props!==null\r\n                }\r\n            }\r\n            return m        \r\n        })\r\n        setModals(newModals);\r\n    }\r\n    useEffect(()=>{\r\n        if (modals.filter(v=>v.visible).length == 0)\r\n            setAnimationType(windowType == 'landscape'?'fade':'slide')\r\n    }, [windowType])\r\n    useEffect(()=>{\r\n        setModals(allModals.map((Component)=>({Component, props:null, visible:false})))\r\n    }, [allModals])\r\n    return <ModalsContext.Provider value={{setModal}}>\r\n        {children}\r\n        {modals.map((modal, index)=>{\r\n            const { Component, props, visible } = modal;\r\n            return <Modal key={index} animationType={animationType as any} visible={visible} transparent>\r\n                <Component {...props}/>\r\n            </Modal>\r\n        })}\r\n    </ModalsContext.Provider>\r\n}\r\n\r\nexport default ()=>{\r\n    const modalsContext = useContext(ModalsContext)\r\n    return modalsContext\r\n}\r\n\r\n","import React, { useState, useEffect, createContext, useContext, useMemo } from 'react';\r\nimport { Dimensions, ScaledSize, useWindowDimensions } from 'react-native';\r\n//@ts-ignore\r\nimport useMobileDetect from 'use-mobile-detect-hook';\r\n\r\ntype WindowType = 'portrait' | 'landscape'\r\n\r\nconst getWindowType = (window:{width:number, height:number})=> window.height >= window.width?'portrait':'landscape' as WindowType;\r\n\r\nconst ResizeContextContext = createContext<WindowType>(getWindowType(Dimensions.get('window')));\r\n\r\nexport const ResizeContextProvider = ({children}:{children:React.ReactNode})=>{\r\n  const detectMobile = useMobileDetect();\r\n  const {width, height} = useWindowDimensions()\r\n  const [windowType, setWindowType] = useState(getWindowType({width, height}))\r\n  useEffect(()=>{\r\n    setWindowType(getWindowType({width, height}))\r\n  }, [width, height])\r\n  return <ResizeContextContext.Provider value={detectMobile.isMobile()?'portrait':windowType}>\r\n    {children}\r\n  </ResizeContextContext.Provider>\r\n}\r\n\r\nexport default function useResizeContext() {\r\n  const windowType = useContext(ResizeContextContext)\r\n  return windowType\r\n}","import React, { useState } from 'react';\r\nimport { Text, StyleSheet, Pressable, StyleProp, ViewStyle} from 'react-native';\r\nimport Colors from '../constants/Colors';\r\nimport useColorScheme from '../hooks/useColorScheme';\r\nimport { CustomButtonProps } from '../types';\r\n\r\nconst DefaultButton = (props:CustomButtonProps & {borderColor:string})=>{\r\n    const [hover, setHover] = useState(false)\r\n    return <Pressable\r\n        onPress={()=>props.onPress()}\r\n        //@ts-ignore\r\n        onHoverIn={()=>setHover(true)}\r\n        onHoverOut={()=>setHover(false)}\r\n        disabled={props.disabled}\r\n        style={[\r\n            {\r\n                paddingVertical:5, \r\n                paddingHorizontal:16\r\n            },\r\n            props.style,\r\n            (hover || props.disabled)?{backgroundColor:props.color, borderColor:props.borderColor}:{}\r\n        ]}>\r\n            {props.children?props.children:\r\n            <Text selectable={false} style={[{fontSize:14}, props.textStyle]}>{props.title}</Text>}\r\n        </Pressable>\r\n}\r\n\r\nexport default (props:CustomButtonProps)=>{\r\n    const theme = useColorScheme()\r\n    const _props = {\r\n        color:Colors[theme].hoverColor,\r\n        borderColor:theme=='light'?Colors[theme].buttonBorderColor:'#7d8590',\r\n        ...props,\r\n        style:[\r\n            styles.style,\r\n            {\r\n                backgroundColor:Colors[theme].buttonBackgroundColor,\r\n                borderColor:Colors[theme].buttonBorderColor\r\n            },\r\n            props.style,\r\n        ] as StyleProp<ViewStyle>,\r\n        textStyle:[\r\n            styles.text, \r\n            {color:Colors[theme].text},\r\n            props.textStyle\r\n        ]\r\n    }\r\n    return <DefaultButton {..._props}/>\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n    style:{\r\n        borderRadius:6, \r\n        borderWidth:1, \r\n    },\r\n    text:{\r\n        textAlign:'center', \r\n        fontWeight:'600'\r\n    }\r\n});\r\n","import { useEffect } from \"react\";\r\nimport { useMutation, useQuery, useQueryClient } from \"react-query\";\r\nimport { getChannelList, postChannel, postDirectChannel, patchChannel } from \"../../services\";\r\nimport { MessengerChannel, MessengerContent } from \"../../types\";\r\nimport { Auth } from \"../useAuthContext\";\r\nimport useWebsocketContext from \"../useWebsocketContext\";\r\n\r\nexport default function useMessengerChannelList(type:string, auth?:Auth){\r\n  const queryClient = useQueryClient()\r\n  const {lastJsonMessage} = useWebsocketContext()\r\n  const { data } = useQuery([\"ChannelList\", type] , async()=>await getChannelList(type, auth?.user?.id))\r\n\r\n  useEffect(()=>{\r\n    if(lastJsonMessage !=null){\r\n      if(lastJsonMessage['type']=='enter'){\r\n        queryClient.setQueryData<MessengerChannel[]>([\"ChannelList\", type], (_data)=>{\r\n          return (_data?.find(v=>v.id==lastJsonMessage['data']['id'])?_data:[lastJsonMessage['data'] , ...(_data|| [])]).sort((a, b)=>a.id - b.id)\r\n        })\r\n      }\r\n      if (lastJsonMessage['type']=='next_message'){\r\n        const data:MessengerContent = lastJsonMessage['data']\r\n        queryClient.setQueryData<MessengerChannel[]>([\"ChannelList\", type], (_data)=>(_data || []).map(v=>{\r\n          if (v.id == data.channel){\r\n            return {...v, last_message:{content:data.message_set[0]?.content, created:data.created}}\r\n          }\r\n          return v\r\n        }))\r\n      }\r\n      // if(lastJsonMessage['type']=='leave'){\r\n      //   queryClient.setQueryData<Channel[]>([\"MessengerChannelList\", type], (_data)=>_data?.filter(v=>v.id!=lastJsonMessage['data']['channel_id']) || [])\r\n      // }\r\n    }\r\n  }, [lastJsonMessage])\r\n  return data\r\n}\r\n\r\nexport function useMessengerChannelSorted(type:string, auth?:Auth){\r\n  const channelList = useMessengerChannelList(type, auth);\r\n  return channelList?.sort((a, b)=>(a.last_message?.created || '') < (b.last_message?.created || '')?1:-1)\r\n}\r\nexport function useMessengerChannelMutation(type:string){\r\n  const queryClient = useQueryClient()\r\n\r\n  const create = useMutation(postChannel, {\r\n    onSuccess: ()=>queryClient.invalidateQueries([\"ChannelList\", type])\r\n  });\r\n\r\n  const update = useMutation(patchChannel, {\r\n    onSuccess: () => queryClient.invalidateQueries([\"ChannelList\", type])\r\n  })\r\n\r\n  const direct = useMutation(postDirectChannel, {\r\n    onSuccess: () => queryClient.invalidateQueries([\"ChannelList\", type])\r\n  })\r\n\r\n  return { create:create.mutateAsync, update:update.mutateAsync, direct:direct.mutateAsync}\r\n}","import React from 'react'\r\nimport CommonSection from \"./CommonSection\";\r\nimport useResizeContext from '../hooks/useResizeContext';\r\n\r\nexport default (props:{children?: React.ReactNode})=>{\r\n    const windowType = useResizeContext();\r\n    return <CommonSection\r\n        autoScale\r\n        outerContainerStyle={{flex:1, alignSelf:'center', backgroundColor:'#8888', flexShrink:1, width:'100%'}}\r\n        containerStyle={{flex:1, margin:0, justifyContent:'center', alignItems:'center'}}\r\n        bodyStyle={windowType=='landscape'?{width:'90%', height:'90%', padding:'5%'}:{width:'100%', height:'100%', maxWidth:1080}}\r\n    >\r\n        {props.children}\r\n    </CommonSection>\r\n}\r\n\r\nexport const BottomSheet = (props:{children?: React.ReactNode})=><CommonSection\r\n    autoScale\r\n    outerContainerStyle={{flex:1, alignSelf:'center', backgroundColor:'#8888', width:'100%'}}\r\n    containerStyle={{flex:1, margin:0, justifyContent:'flex-end'}}\r\n>\r\n    {props.children}\r\n</CommonSection>","import * as React from 'react';\r\nimport { Avatar } from 'react-native-paper';\r\nimport { AvatarProps } from '../../types';\r\n\r\nconst normalizeHash = (hash: number, min: number, max: number) => {\r\n    return Math.floor((hash % (max - min)) + min);\r\n};\r\n\r\nconst stringToHSL = (str: string, initHash?:number) => {\r\n    let hash = initHash || 0;\r\n    for (let i = 0; i < str.length; i++) {\r\n      hash = str.charCodeAt(i) + ((hash << 5) - hash);\r\n    }\r\n    hash = Math.abs(hash);\r\n    return `hsl(${normalizeHash(hash, 0, 360)}, ${normalizeHash(hash, 0, 100)}%, ${normalizeHash(hash, 25, 75)}%)`;\r\n};\r\n\r\nexport default (props:AvatarProps) => {\r\n    const backgroundColor = stringToHSL(props.name, props.userId)\r\n    return <Avatar.Text style={{backgroundColor}} size={props.size} label={props.name.split(' ').map(v=>v[0]).join().toUpperCase()} />\r\n};","import React from 'react';\r\nimport Avatar from '../lib/react-native-paper/Avatar';\r\nimport { AvatarProps, MessengerChannel, User } from '../types';\r\n\r\nexport function avatarFromChannel(item:MessengerChannel, user?:User|null){\r\n    let avatar;\r\n    let name = item.name\r\n    if (item.member_count<3){\r\n        avatar = (item.member_count==1 || user?.id == item.subowner.id)?item.owner:item.subowner\r\n        name = name.length>0?name:avatar.name \r\n    }\r\n    return {avatar, name}\r\n}\r\n\r\nexport default (props:AvatarProps)=>{\r\n    return <Avatar {...props}/>\r\n}\r\n\r\n","import * as React from 'react';\r\nimport { View, Text } from './Themed';\r\nimport { StyleSheet, StyleProp, ViewStyle, TextStyle } from 'react-native';\r\nimport Colors from '../constants/Colors';\r\n\r\nexport type SectionParamList = {\r\n    title?: string,\r\n    titleStyle?:StyleProp<TextStyle>\r\n    outerContainerStyle?:StyleProp<TextStyle>\r\n    containerStyle?:StyleProp<ViewStyle>\r\n    bodyStyle?:StyleProp<ViewStyle>\r\n    subtitle?: string\r\n    withSeparator?: boolean\r\n    autoScale?:boolean\r\n    children?: React.ReactNode\r\n}\r\n\r\nexport default function CommonSection(props:SectionParamList){\r\n  return (\r\n    <View style={[styles.outerContainer, props.autoScale?{}:styles.outerContainerFill, props.outerContainerStyle]}>\r\n        <View style={[styles.container, props.containerStyle]}>\r\n            {props.withSeparator?<View style={styles.separator} lightColor=\"#ddd\" darkColor=\"rgba(255,255,255, 0.3)\" />:undefined}\r\n            {props.title?<View style={styles.titleView}>\r\n              <Text style={[styles.title, props.titleStyle]}>{props.title}</Text>\r\n              <Text style={styles.subtitle}>{props.subtitle}</Text>\r\n            </View>:undefined}\r\n            <View style={[styles.bodyView, props.bodyStyle]}>\r\n            {props.children}\r\n            </View>\r\n          </View>\r\n        </View>\r\n    )\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  outerContainer:{\r\n    alignItems:'stretch',\r\n    backgroundColor:'transparent'\r\n  },\r\n  outerContainerFill:{\r\n    width:'100%',\r\n    maxWidth:1080,\r\n  },\r\n  container: {\r\n      marginHorizontal:20,\r\n      marginVertical: 10,\r\n      backgroundColor:'transparent',\r\n    },\r\n    titleView:{\r\n      width: '100%',\r\n      flexDirection:'row',\r\n      backgroundColor:'transparent',\r\n      marginBottom:5,\r\n    },\r\n    title: {\r\n      flex:1,\r\n      fontSize: 16,\r\n    },\r\n    subtitle: {\r\n      flex:1,\r\n      fontSize: 12,\r\n      textAlign: 'right',\r\n      marginTop:4\r\n    },\r\n    separator: {\r\n      marginBottom: 0,\r\n      height: 1,\r\n      width: '100%',\r\n    },\r\n    bodyView:{\r\n      width: '100%',\r\n      padding: 20,\r\n      alignItems: 'center',\r\n      justifyContent: 'center',\r\n      borderWidth:1,\r\n      borderColor:Colors.borderColor,\r\n      borderRadius:6\r\n    }\r\n  });\r\n  ","import { DependencyList, useEffect } from \"react\";\r\nimport { EventArg, useNavigation } from \"@react-navigation/core\";\r\n\r\n\r\nexport default (callback:()=>void, deps?:DependencyList)=>{\r\n    const navigation = useNavigation()\r\n    useEffect(()=>{\r\n        const event = (e:EventArg<any, true, any>)=> {\r\n            e.preventDefault();\r\n            callback()\r\n        }\r\n        navigation.addListener('beforeRemove', event)\r\n        return () => {\r\n            navigation.removeListener('beforeRemove', event)\r\n        }\r\n  }, deps)\r\n}","/**\r\n * If you are not familiar with React Navigation, refer to the \"Fundamentals\" guide:\r\n * https://reactnavigation.org/docs/getting-started\r\n *\r\n */\r\nimport * as React from 'react';\r\nimport { useColorScheme as useDefaultColorScheme } from 'react-native';\r\nimport { useColorScheme as useColorScheme } from 'react-native-appearance';\r\nimport { enableScreens } from 'react-native-screens';\r\nimport { NavigationContainer, DefaultTheme, DarkTheme, NavigationContainerRef } from '@react-navigation/native';\r\nimport { CardStyleInterpolators, createStackNavigator } from '@react-navigation/stack';\r\n\r\nimport useResizeContext, { ResizeContextProvider } from '../hooks/useResizeContext';\r\nimport useInvitee, { replaceInviteeState } from '../hooks/useInvitee';\r\nimport { modal } from '../screens';\r\nimport LinkingConfiguration from './LinkingConfiguration';\r\nimport MainNavigator from './MainNavigator';\r\n\r\n\r\nenableScreens();\r\n\r\nconst navigationRef = React.createRef<NavigationContainerRef>();\r\n\r\nexport function navigate(name:string, params?:any) {\r\n  if (params)\r\n    navigationRef.current?.navigate(name, params);\r\n  navigationRef.current?.navigate(name);\r\n}\r\n\r\nlet electronVersion:string|undefined;\r\ntry{\r\n  electronVersion = process?.versions?.['electron']\r\n}\r\ncatch(e){\r\n  electronVersion = undefined\r\n}\r\n\r\nexport default function Navigation() {\r\n  const defaultColorScheme = useDefaultColorScheme()\r\n  const userColorScheme = useColorScheme()\r\n  const colorScheme = userColorScheme =='no-preference'?defaultColorScheme:userColorScheme\r\n  return <NavigationContainer\r\n    ref={navigationRef}\r\n    documentTitle={{formatter: (options, route) => {return `TOKKI TOK`}}}\r\n    linking={electronVersion?undefined:LinkingConfiguration}\r\n    theme={colorScheme === 'dark' ? DarkTheme : DefaultTheme}>\r\n        <ResizeContextProvider>\r\n          <RootNavigator />\r\n        </ResizeContextProvider>\r\n  </NavigationContainer>\r\n}\r\n\r\n\r\n// A root stack navigator is often used for displaying modals on top of all other content\r\n// Read more here: https://reactnavigation.org/docs/modal\r\nconst Root = createStackNavigator();\r\n\r\nfunction RootNavigator() {\r\n    const windowType = useResizeContext();\r\n    useInvitee()\r\n    return <Root.Navigator\r\n        mode= 'modal'\r\n        headerMode= 'screen'\r\n        screenOptions={{\r\n            cardStyle:{backgroundColor:\"white\"},\r\n            animationEnabled: true,\r\n            cardStyleInterpolator: CardStyleInterpolators.forVerticalIOS,\r\n        }}\r\n    >\r\n        <Root.Screen name=\"Main\" component={MainNavigator} options={{headerShown:false}}/>\r\n        {Object.entries(modal).map(([key, screen])=><Root.Screen key={key} name={key} component={screen.component} options={{\r\n            title: screen.title,\r\n            gestureDirection: windowType == 'landscape'?'vertical-inverted':'vertical'\r\n        }} />)}\r\n    </Root.Navigator>\r\n}\r\n\r\nreplaceInviteeState(window.location)\r\n\r\nconst IGNORE_WERNINGS:string[] = ['setNativeProps', 'useNativeDriver'];\r\n\r\nconst warnLogger = console.warn\r\n\r\nconsole.warn = (message: string|Object) => {\r\n    var warn = true;\r\n    if (message instanceof Object){\r\n      warn = false;\r\n    }\r\n    else if (IGNORE_WERNINGS.some(log=>message.includes(log))){\r\n      warn = false\r\n    };\r\n    if (warn){\r\n      warnLogger(message);\r\n    }\r\n    else{\r\n        // console.log(message)\r\n    }\r\n};\r\n","import React, { Context, createContext,  useContext, useEffect, useState } from \"react\"\r\nimport useWebSocket from \"react-use-websocket\"\r\nimport { SendJsonMessage } from \"react-use-websocket/dist/lib/types\"\r\nimport {websockerURL } from \"../constants/Envs\"\r\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\r\nimport { AppState, AppStateStatus } from \"react-native\";\r\n\r\ntype WebsocketContextType = {lastJsonMessage:any, sendJsonMessage:SendJsonMessage }\r\nconst defaultContext = {lastJsonMessage:undefined, sendJsonMessage:()=>{}}\r\nconst WebSocketContext = createContext<WebsocketContextType>(defaultContext);\r\n\r\nexport const WebSocketInternalProvider = ({children, path, Context, useBackground}:{children:React.ReactNode, path:string, Context:Context<WebsocketContextType>, useBackground?:boolean})=>{\r\n  const [token, setToken] = useState<string|null>(null)\r\n  const [isActive, setIsActive] = useState<boolean>(useBackground || AppState.currentState == 'active')\r\n  const { lastJsonMessage, sendJsonMessage } = useWebSocket(`${websockerURL}/${path}`,{\r\n    shouldReconnect: (closeEvent) => true,\r\n    protocols: token?['Authorization',  token]:undefined,\r\n    onOpen: (e)=>{console.log(`success websocket connection(${path})`)},\r\n    onClose: (e)=> {console.log(`closed websocket connection(${path})`)},\r\n  }, isActive && token!=null)\r\n  useEffect(()=>{\r\n    AsyncStorage.getItem('Authorization').then(setToken)\r\n    const onChange = (nextState:AppStateStatus)=>setIsActive(useBackground || nextState == 'active')\r\n    const listener = AppState.addEventListener(\"change\", onChange)\r\n    return ()=> listener.remove()\r\n  }, [])\r\n  return <Context.Provider value={token!=null?{lastJsonMessage, sendJsonMessage}:defaultContext}>\r\n      {children}\r\n    </Context.Provider>\r\n}\r\n\r\nexport const WebSocketProvider = ({disable, children}:{disable?:boolean, children:React.ReactNode})=>{\r\n  return disable?<>{children}</>:<WebSocketInternalProvider path={'messenger/ws/'} Context={WebSocketContext}>\r\n    {children}\r\n  </WebSocketInternalProvider>\r\n}\r\n\r\nexport default ()=>{\r\n  const webSocketContext = useContext(WebSocketContext)\r\n  return webSocketContext\r\n}\r\n\r\n","import { useMutation, useQuery, useQueryClient } from \"react-query\";\r\nimport { deleteUser, getUserMembershipList, patchUser, postUser } from \"../../services\";\r\nimport useAuthContext, { Auth } from \"../useAuthContext\";\r\n\r\nexport default function useUserMembershipList(auth?:Auth){\r\n  const { data } = useQuery([\"UserMembershipList\", auth?.groupId] , async()=>auth?.groupId?(await getUserMembershipList(auth?.groupId)):[])\r\n  return data\r\n}\r\n\r\nexport function useUserMembershipMutation(){\r\n  const queryClient = useQueryClient()\r\n  const { auth, dispatch } = useAuthContext()\r\n  const _create = useMutation(postUser, {\r\n    onSuccess: ()=>{\r\n      queryClient.invalidateQueries(\"UserMembershipList\")\r\n    }\r\n  })\r\n  const _update = useMutation(patchUser, {\r\n    onSuccess: (data, user)=>{\r\n      if (user.id == auth.user?.id)\r\n        if(user.username && user.password){\r\n          dispatch({type:'LOGIN_REQUEST', username:user.username, password:user.password})\r\n        }\r\n        else{\r\n          dispatch({type:\"REFRESH\"})\r\n        }\r\n      else{\r\n        queryClient.invalidateQueries(\"UserMembershipList\")\r\n      }\r\n    }\r\n  })\r\n  const _delete = useMutation(deleteUser, {\r\n    onSuccess: (data, id)=>{\r\n      queryClient.invalidateQueries(\"UserMembershipList\")\r\n      if (id == auth.user?.id)\r\n        dispatch({type:\"LOGOUT_REQUEST\"})\r\n    }\r\n  })\r\n  return {create:_create.mutateAsync, update:_update.mutateAsync, delete:_delete.mutateAsync}\r\n}","import React, { useState, useEffect } from \"react\";\r\nimport { StyleSheet, TextInput } from \"react-native\";\r\nimport useLangContext from \"../hooks/useLangContext\";\r\nimport useUserMembershipList, { useUserMembershipMutation } from \"../hooks/lists/useUserMembershipList\";\r\nimport useAuthContext from \"../hooks/useAuthContext\";\r\nimport ModalSection from \"../components/ModalSection\";\r\nimport useModalsContext from \"../hooks/useModalsContext\";\r\nimport { View, Text } from \"../components/Themed\";\r\nimport RowField from \"../components/RowField\";\r\nimport CommonButton from \"../components/CommonButton\";\r\nimport CommonTextInput from \"../components/CommonTextInput\";\r\nimport useExternalMembershipList from \"../hooks/lists/useExternalMembershipList\";\r\n// import TextButton from \"../components/TextButton\";\r\n// import Colors from \"../constants/Colors\";\r\n// import useColorScheme from \"../hooks/useColorScheme\";\r\n\r\ntype ErrorMessages = {\r\n    username?:string,\r\n    name?:string,\r\n    password?:string,\r\n    checkPassword?:string\r\n}\r\n\r\nconst ErrorView = (props:{message?:string})=>{\r\n  const { lang } = useLangContext()\r\n  return props.message?<View style={styles.form_error}>\r\n  <Text style={styles.form_error_text}>{lang(props.message)}</Text>\r\n</View>:<></>\r\n}\r\n\r\nexport default function RegistrationModal({id}:{id?:number}) {\r\n  const { lang } = useLangContext()\r\n  const {auth} = useAuthContext()\r\n  // const theme = useColorScheme()\r\n  // const color = Colors[theme].text\r\n  const { setModal } = useModalsContext()\r\n  const [username, setUsername] = useState(\"\");\r\n  const [name, setName] = useState(\"\")\r\n  const [password, setPassword] = useState(\"\");\r\n  const [checkPassword, setCheckPassword] = useState(\"\")\r\n  const [isStaff, setIsStaff] = useState(false)\r\n  const [error, setError] = useState<ErrorMessages>({})\r\n  const userList = useUserMembershipList(auth)\r\n  const externalMemberList = useExternalMembershipList(username)\r\n  const userMembershipMutation = useUserMembershipMutation()\r\n  const user = userList?.find(v=>v.id==id)\r\n  const usernameDisable = user && user.is_guest===false\r\n  useEffect(()=>{\r\n    if (user){\r\n      setUsername(user.username)\r\n      setName(user.name)\r\n    }\r\n  }, [user?.id])\r\n  const _register = ()=>{\r\n    let newError:ErrorMessages = {};\r\n    if ((externalMemberList?.length || 0) >0 && !usernameDisable) newError.username = \"The username is already in use.\"\r\n    if (username.length < 10 || username.length > 64) newError.username = \"Set 10-64 characters.\"\r\n    if (name.length < 1 || name.length > 64) newError.name = \"Set 1-64 characters.\"\r\n    if (!/^(?=.*[A-Za-z])(?=.*\\d)(?=.*[@$!%*#?&])[A-Za-z\\d@$!%*#?&]{10,64}$/.test(password) && !(usernameDisable && password.length==0)) newError.password = \"Set 10-64 characters with a combination of letters/numbers/valid special characters.\"\r\n    if (password != checkPassword) newError.checkPassword = \"Incorrect between password and check password.\"\r\n    if (Object.keys(newError).length > 0){\r\n        setError(newError)\r\n        return\r\n    }\r\n    if (id){\r\n      userMembershipMutation.update({\r\n        id,\r\n        name,\r\n        username:usernameDisable?undefined:username,\r\n        is_guest:false,\r\n        password:password.length>0?password:undefined,\r\n      }).then(()=>{(id!=auth.user?.id || user?.is_guest) && back()})\r\n    }\r\n    else{\r\n      auth?.groupId && userMembershipMutation.create({\r\n          username,\r\n          name,\r\n          password,\r\n          is_guest:false,\r\n          is_staff:isStaff,\r\n          inviteGroupId:auth.groupId,\r\n\r\n      }).then(back)\r\n    }\r\n  }\r\n  const back = ()=>{\r\n    setModal(RegistrationModal, null)\r\n  }\r\n  return <ModalSection>\r\n    <View style={{justifyContent:'space-between', flex:1, width:'100%'}}>\r\n      <View style={{flex:1, width:'100%'}}>\r\n        <Text style={{fontSize:20}}>{usernameDisable?lang('Edit User'):lang('Create User')}</Text>\r\n        <View style={styles.separator} lightColor=\"#ddd\" darkColor=\"rgba(255,255,255, 0.3)\" />\r\n        <RowField name={lang('Username')} width={'60%'}>\r\n          {usernameDisable?<Text style={{fontSize:16}}>{username}</Text>:<CommonTextInput\r\n              value={username}\r\n              setValue={(text) => setUsername(text)}\r\n              keyboardType={'email-address'}\r\n          />}\r\n          <ErrorView message={error.username}/>\r\n        </RowField>\r\n        <RowField name={lang('Name')} width={'60%'}>\r\n          <CommonTextInput\r\n              value={name}\r\n              setValue={(text) => setName(text)}\r\n          />\r\n          <ErrorView message={error.name}/>\r\n        </RowField>\r\n        <RowField name={lang('Password')} width={'60%'}>\r\n          <CommonTextInput\r\n              value={password}\r\n              secureTextEntry\r\n              setValue={(text) => setPassword(text)}\r\n          />\r\n          <ErrorView message={error.password}/>\r\n        </RowField>\r\n        <RowField name={lang('Check Password')} width={'60%'}>\r\n          <CommonTextInput\r\n              value={checkPassword}\r\n              secureTextEntry\r\n              setValue={(text) => setCheckPassword(text)}\r\n          />\r\n          <ErrorView message={error.checkPassword}/>\r\n        </RowField>\r\n        {/* <RowField name={lang('Manager Permission')} width={'60%'}>\r\n          <View style={{flexDirection:'row'}}>\r\n            {[[lang('Yes'), true], [lang('No'), false]].map(([title, value])=><TextButton \r\n              key={title} title={title} textStyle={{fontSize:16, color, textDecorationLine:isStaff==value?'underline':'none'}} style={{borderRadius:20}} onPress={(\r\n              )=>setIsStaff(value)}/>)}\r\n          </View>\r\n        </RowField> */}\r\n      </View>\r\n      <View style={{width:'100%', flexDirection:'row'}}>\r\n        {id && <View style={{flexDirection:'row', justifyContent:'flex-start'}}>\r\n          <CommonButton title={lang('delete account')} style={{marginHorizontal:5}} textStyle={{color:'red'}} onPress={()=>userMembershipMutation.delete(id).then(back)}/>\r\n        </View>}\r\n        <View style={{flex:1, flexDirection:'row', justifyContent:'flex-end'}}>\r\n          <CommonButton title={lang('save')} onPress={_register}/>\r\n          <CommonButton title={lang('cancel')} style={{marginHorizontal:5}} onPress={back}/>\r\n        </View>\r\n      </View>\r\n    </View>\r\n  </ModalSection>\r\n};\r\n\r\nconst styles = StyleSheet.create({\r\n  form_error: {\r\n    height: 22,\r\n    width:'100%',\r\n  },\r\n  form_error_text:{\r\n    textAlignVertical:'center',\r\n    color:'red',\r\n    fontSize:13,\r\n  },\r\n  separator: {\r\n    marginBottom: 20,\r\n    height: 1,\r\n    width: '100%',\r\n  },\r\n});","import { useMutation, useQuery, useQueryClient } from \"react-query\";\r\nimport { postBulkMessengerMember, deleteMessengerMember, getMessengerMemberList } from \"../../services\";\r\n\r\nexport default function useMessengerMemberList(channel_id:number){\r\n  const { data } = useQuery([\"MessengerMemberList\", channel_id] , async()=>await getMessengerMemberList(channel_id))\r\n  return data\r\n}\r\n\r\n\r\nexport function useMessengerMemberMutation(){\r\n  const queryClient = useQueryClient()\r\n  const invite = useMutation(postBulkMessengerMember, {\r\n    onSuccess: ()=>{\r\n      queryClient.invalidateQueries(\"MessengerMemberList\")\r\n    }\r\n  })\r\n\r\n  const leave = useMutation(deleteMessengerMember, {\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries(\"ChannelList\")\r\n      queryClient.invalidateQueries(\"MessengerMemberList\")\r\n    }\r\n  })\r\n  return {invite:invite.mutateAsync, leave:leave.mutateAsync}\r\n}","import * as React from 'react';\r\nimport { View } from './Themed';\r\nimport { StyleSheet, StyleProp, ViewStyle, TextStyle, Pressable } from 'react-native';\r\nimport Colors from '../constants/Colors';\r\n\r\nexport type ItemParamList = {\r\n    outerContainerStyle?:StyleProp<TextStyle>\r\n    containerStyle?:StyleProp<ViewStyle>\r\n    bodyStyle?:StyleProp<ViewStyle>\r\n    children?: React.ReactNode\r\n    onPress?: ()=>void\r\n}\r\n\r\nexport default function CommonItem(props:ItemParamList){\r\n  // const [hover, setHover] = React.useState(false)\r\n  const [press, setPress] = React.useState(false)\r\n  return (\r\n    <Pressable\r\n      style={[styles.outerContainer ,props.outerContainerStyle, (press)?{backgroundColor:'rgb(242,242,242)'}:{}]}\r\n      onPressIn={()=>setPress(true)}\r\n      onPress={()=>props.onPress?.()}\r\n      onPressOut={()=>setPress(false)}\r\n      //  //@ts-ignore\r\n      //  onHoverIn={()=>setHover(true)}\r\n      //  onHoverOut={()=>setHover(false)}\r\n    >\r\n        <View style={[styles.container ,props.containerStyle]}>\r\n            <View style={[styles.bodyView, props.bodyStyle]}>\r\n                <>{props.children}</>\r\n            </View>\r\n      </View>\r\n    </Pressable>\r\n    )\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  outerContainer:{\r\n    width:'100%',\r\n    maxWidth:1080,\r\n    alignItems:'stretch',\r\n  },  \r\n  container: {\r\n      marginHorizontal:20,\r\n      backgroundColor:'transparent'\r\n    },\r\n    bodyView:{\r\n      width: '100%',\r\n      padding: 10,\r\n      minHeight: 40,\r\n      alignItems: 'center',\r\n      justifyContent: 'center',\r\n      borderBottomWidth:1,\r\n      borderColor:Colors.borderColor,\r\n      backgroundColor:'transparent'\r\n    }\r\n  });\r\n  ","import React, { useState } from 'react';\r\nimport { StyleSheet} from 'react-native';\r\nimport { CustomButtonProps } from '../types';\r\nimport CommonButton from './CommonButton';\r\n\r\nexport default (props:CustomButtonProps)=>{\r\n    return <CommonButton {...props} style={[styles.style, props.style]}/>\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n    style:{\r\n        borderRadius:6, \r\n        backgroundColor: 'transparent',\r\n        borderWidth:0\r\n    },\r\n});\r\n","import React, {useState, useEffect } from 'react';\r\nimport { StyleSheet } from 'react-native';\r\nimport { View, Text } from '../components/Themed';\r\nimport CommonButton from '../components/CommonButton';\r\nimport useAuthContext from '../hooks/useAuthContext';\r\nimport { navigate } from '../navigation';\r\nimport { Channel } from '../types';\r\nimport useMessengerChannelList, { useMessengerChannelMutation } from '../hooks/lists/useMessengerChannelList';\r\nimport TextField from '../components/TextField';\r\nimport useModalsContext from '../hooks/useModalsContext';\r\nimport useLangContext from '../hooks/useLangContext';\r\nimport ModalSection from '../components/ModalSection';\r\nimport { useMessengerMemberMutation } from '../hooks/lists/useMessengerMemberList';\r\nimport { avatarFromChannel } from '../components/Avatar';\r\nimport useModalEffect from '../hooks/useModalEffect';\r\n\r\nexport default function ChannelEditModal({id, member_id, type}: {id?:number, member_id?:number, type:string}) {\r\n  const { lang } = useLangContext()\r\n  const {auth} = useAuthContext()\r\n  const { setModal } = useModalsContext()\r\n  const channelList = useMessengerChannelList(type, auth)\r\n  const channelMutation = useMessengerChannelMutation(type)\r\n  const messengerMemberMutation = useMessengerMemberMutation()\r\n  const channel = channelList?.find(v=>v.id==id)\r\n  const title = type=='messenger'?\r\n    (id?lang('Chat Setting'):lang('New chat')):\r\n    (id?lang('Channel Setting'):lang('New Channel'))\r\n  const [name, setName] = useState('')\r\n  const [description, setDescription] = useState<string|undefined>('')\r\n  const back = ()=>{\r\n    setModal(ChannelEditModal, null)\r\n  }\r\n\r\n  useEffect(()=>{\r\n    if (channel){\r\n      const {name:_name} = avatarFromChannel(channel, auth.user)\r\n      setName(_name)\r\n      setDescription(type=='messenger'?(channel?.description || ''):undefined)\r\n    }\r\n  }, [channel?.id])\r\n  useModalEffect(back, [])\r\n\r\n  return <ModalSection>\r\n    <View style={{justifyContent:'space-between', flex:1, width:'100%'}}>\r\n      <View style={{width:'100%'}}>\r\n        <Text style={{fontSize:20}}>{title}</Text>\r\n        <View style={styles.separator} lightColor=\"#ddd\" darkColor=\"rgba(255,255,255, 0.3)\" />\r\n        <TextField name={lang('Channel Name')} value={name} setValue={setName} width={'60%'}/>\r\n        {type=='messenger' && <TextField name={lang('Description')} value={description} setValue={setDescription} multiline width={'60%'}/>}\r\n      </View>\r\n      <View style={{width:'100%', flexDirection:'row'}}>\r\n        {member_id &&<View style={{flexDirection:'row', justifyContent:'flex-start'}}>\r\n          <CommonButton title={lang('leave')} style={{marginHorizontal:5}} textStyle={{color:'red'}} onPress={()=>messengerMemberMutation.leave(member_id).then(back)}/>\r\n        </View>}\r\n        <View style={{flex:1, flexDirection:'row', justifyContent:'flex-end'}}>\r\n          <CommonButton title={lang('save')} onPress={()=>{\r\n            if(auth?.user?.id && auth.groupId){\r\n              const newChannel:Channel = {id, name, description, type, owner:auth?.user?.id, group:auth.groupId};\r\n              (id?channelMutation.update(newChannel):channelMutation.create(newChannel)).then(v=>navigate(\"Main\", {\r\n                screen:v.type == 'messenger'?'ChatScreen':'NoteScreen',\r\n                params:{id:v.id}\r\n              }))\r\n            }\r\n          }}/>\r\n          <CommonButton title={lang('cancel')} style={{marginHorizontal:5}} onPress={back}/>\r\n        </View>\r\n      </View>\r\n    </View>\r\n  </ModalSection>\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  field:{\r\n    width:'50%',\r\n    flexDirection:'row',\r\n    padding:10,\r\n  },\r\n  separator: {\r\n    marginBottom: 20,\r\n    height: 1,\r\n    width: '100%',\r\n  },\r\n})","import { useEffect } from \"react\"\r\nimport { InfiniteData, Query, QueryKey, useInfiniteQuery, useMutation, useQueryClient } from \"react-query\"\r\nimport { getMessengerContentList, postMessage, patchMessengerContent, getNewMessengerContentList } from \"../../services\"\r\nimport { EditMessage, MessengerContent } from \"../../types\"\r\nimport useWebsocketContext from \"../useWebsocketContext\"\r\nimport useUploadContext from \"../useUploadContext\"\r\n\r\nexport type MessengerContentPage = {\r\n  next?:MessengerContentPage\r\n  current:MessengerContent[]\r\n}\r\n\r\nconst updateContnetPage = (pages:MessengerContentPage[], updateMessages:MessengerContent[])=>{\r\n  let update_i = 0\r\n  pages.forEach(page=>{\r\n    if (update_i == updateMessages.length)\r\n      return\r\n    page.current.forEach(v=>{\r\n      if (update_i == updateMessages.length)\r\n        return\r\n      if (v.id==updateMessages[update_i].id){\r\n        v.timer = updateMessages[update_i].timer\r\n        v.is_archive = updateMessages[update_i].is_archive\r\n        update_i += 1\r\n      }\r\n    })\r\n    page.current = page.current.filter(v=>!v.is_archive)\r\n  })\r\n}\r\n\r\nexport default function useMessengerContentList(channel_id:number){  \r\n  const queryClient = useQueryClient()\r\n  const refetch = (query:Query<MessengerContentPage, unknown, InfiniteData<MessengerContentPage>, QueryKey>)=>{\r\n    const updated_gte = new Date(query.state.dataUpdatedAt).toISOString()\r\n    const newData = {...query.state.data}\r\n    getNewMessengerContentList(channel_id, updated_gte).then(contents=>{\r\n      if(newData.pages){\r\n        const lastMessageId = newData.pages[0].current[0].id || 0\r\n        const nextMessages = contents.filter(v=>v.id>lastMessageId && v.is_archive==false)\r\n        const updateMessages = contents.filter(v=>v.id<=lastMessageId)\r\n        const timerMessageRefetch = nextMessages.findIndex(v=>v.timer) >= 0 || updateMessages.length > 0\r\n        newData.pages[0].current = [...nextMessages, ...newData.pages[0].current]\r\n        updateContnetPage(newData.pages, updateMessages)\r\n        timerMessageRefetch && queryClient.invalidateQueries([\"TimerMessageContentList\", channel_id])\r\n      }\r\n    })\r\n    return false\r\n  }\r\n  const { data, fetchNextPage } = useInfiniteQuery<MessengerContentPage>(\r\n    [\"MessengerContentList\", channel_id], \r\n    async({pageParam})=>getMessengerContentList(channel_id, pageParam).then(current=>({current})), \r\n    {\r\n      select:data=>{\r\n        if(data.pages.length > 1)\r\n          data.pages[data.pages.length - 2].next = data.pages[data.pages.length - 1]\r\n        return data;\r\n      },\r\n      getNextPageParam:(lastPage)=>lastPage?.current.length?lastPage.current[lastPage.current.length - 1].id:undefined,\r\n      refetchOnReconnect:false,\r\n      refetchOnWindowFocus:refetch\r\n    }\r\n  )\r\n  const { lastJsonMessage } = useWebsocketContext()\r\n  useEffect(()=>{\r\n    if(lastJsonMessage !=null && lastJsonMessage['data']['channel'] == channel_id){\r\n      if(lastJsonMessage['type']=='next_message'){\r\n        queryClient.setQueryData<InfiniteData<MessengerContentPage>>([\"MessengerContentList\", channel_id], (_data)=>{\r\n          if(_data?.pages[0].current && _data?.pages[0].current[0].id != lastJsonMessage['data'].id)\r\n            _data.pages[0].current = [lastJsonMessage['data'], ..._data?.pages[0].current]\r\n          return {...(_data || {pages:[], pageParams:[]})}\r\n        })\r\n      }\r\n      if(lastJsonMessage['type']=='update_message'){\r\n        queryClient.setQueryData<InfiniteData<MessengerContentPage>>([\"MessengerContentList\", channel_id], (_data)=>{\r\n          _data?.pages && updateContnetPage(_data.pages, [lastJsonMessage['data']])\r\n          return {...(_data || {pages:[], pageParams:[]})}\r\n        })\r\n      }\r\n    }\r\n  }, [lastJsonMessage])\r\n  return { data, fetchNextPage }\r\n}\r\n\r\nexport function useMessengerContentMutation(channelId?:number){\r\n  // const queryClient = useQueryClient()\r\n  const {dispatch:uploadDispatch} = useUploadContext()\r\n  const create = useMutation((message:EditMessage)=>postMessage(message, uploadDispatch), {\r\n    onSuccess: () => {\r\n      // queryClient.setQueryData(['MessengerContentList'], (data:any) => ({\r\n      //   pages: data.pages.slice(0, 1),\r\n      //   pageParams: data.pageParams.slice(0, 1),\r\n      // }))\r\n      // queryClient.invalidateQueries(\"MessengerContentList\")\r\n    }\r\n  });\r\n  const _patch = useMutation(patchMessengerContent);\r\n  return { create:create.mutate, patch:_patch.mutate }\r\n}","import React, { createContext, useContext, Dispatch, useReducer } from 'react';\r\n\r\ntype UploadState = Record<number, {\r\n  filename: string,\r\n  progress?: number,\r\n}[]>\r\n\r\ntype UploadAction = {\r\n  channel:number,\r\n  filename:string,\r\n  progress?:number\r\n}\r\n\r\ntype UploadContextType = {\r\n  upload:UploadState,\r\n  dispatch:Dispatch<UploadAction>\r\n}\r\n\r\nconst UploadContext = createContext<UploadContextType>({upload:{} as UploadState, dispatch:()=>{}});\r\n\r\nconst uploadReducer =(initialState:UploadState, action:UploadAction)=>{\r\n  const files = [...(initialState[action.channel] || [])]\r\n  const index = files.findIndex(f=>f.filename==action.filename)\r\n  if (index >= 0){\r\n    files[index] = {filename:action.filename, progress:action.progress} \r\n  }\r\n  else{\r\n    files.push({filename:action.filename, progress:action.progress})\r\n  }\r\n  return {\r\n    ...initialState,\r\n    [action.channel] : files.filter(f=>(f.progress || 0)<1)\r\n  }\r\n}\r\n\r\nexport const UploadContextProvider = ({children}:{children:React.ReactNode})=>{\r\n  const [upload, dispatch] = useReducer(uploadReducer, {})\r\n  return <UploadContext.Provider value={{upload, dispatch}}>\r\n    {children}\r\n  </UploadContext.Provider>\r\n}\r\n\r\nexport default function useUploadContext() {\r\n  const upload = useContext(UploadContext)\r\n  return upload\r\n}","import React, { Suspense } from 'react'\r\nimport { View, Text } from \"./Themed\"\r\nimport useColorScheme from \"../hooks/useColorScheme\";\r\nimport Colors from \"../constants/Colors\";\r\n\r\nconst RenderHTML = React.lazy(()=> import('react-native-render-html'))\r\n\r\nexport const regexForStripHTML = /<\\/?[^>]*>/gi;\r\n\r\nexport default React.memo(({content}:{content:string})=>{\r\n    const theme = useColorScheme()\r\n    return <Suspense fallback={<Text>{content.replaceAll(regexForStripHTML, '')}</Text>}>\r\n        <RenderHTML defaultTextProps={{selectable:true}} contentWidth={320} source={{'html':content}} baseStyle={{color:Colors[theme].text}}/>\r\n    </Suspense>\r\n\r\n})","import React, { useMemo } from 'react';\r\n\r\nimport { TextProps, StyleProp } from 'react-native';\r\nimport {View, Text } from './Themed'\r\nimport useResizeContext from '../hooks/useResizeContext';\r\n\r\ntype Props = {\r\n  name: string,\r\n  width?:any,\r\n  children: React.ReactNode\r\n  textStyle?: StyleProp<TextProps>\r\n}\r\n\r\nexport default function RowField(props:Props) {\r\n  const windowType = useResizeContext()\r\n  const rowStyle = useMemo(()=>windowType=='landscape'?\r\n    {flexDirection:'row', alignItems: 'center', justifyContent:'space-between'}:\r\n    {flexDirection:'column', alignItems:'flex-start'} as any\r\n  , [windowType])\r\n  return (\r\n    <View style={[{paddingVertical:windowType=='landscape'?15:5, width:'100%'}, rowStyle]}>\r\n        <Text style={[windowType=='landscape'?{flex:1}:{width:'100%'},{paddingHorizontal: 15, fontSize:16}, props.textStyle]}>{props.name}</Text>\r\n        <View style={[windowType=='landscape'?{flex:6}:{width:'100%'},{paddingHorizontal: 15}]}>\r\n          <View style={{width:props.width}}>\r\n            {props.children}\r\n          </View>\r\n        </View>\r\n    </View>\r\n  )\r\n}","import React from 'react';\r\nimport { Platform } from 'react-native';\r\nimport { TabView, SceneMap,NavigationState, SceneRendererProps, TabBar } from 'react-native-tab-view';\r\nimport Colors from '../constants/Colors';\r\nimport useColorScheme from '../hooks/useColorScheme';\r\nimport useLangContext from '../hooks/useLangContext';\r\nimport { TabViewRecord } from '../types';\r\n\r\n\r\nexport default (props:{tabs:TabViewRecord, tabBarPosition:\"top\"|\"bottom\", index?:number, onTab?:(index:number)=>void})=>{\r\n  const { lang } = useLangContext()\r\n  const index = props.index || 0\r\n  const theme = useColorScheme()\r\n  const entries = Object.entries(props.tabs)\r\n  const onTab = props.onTab\r\n  const icons = Object.assign({}, ...entries.map(([k, v])=>({[k]:v.icon})))\r\n  return <TabView\r\n    renderTabBar={(props:SceneRendererProps & {navigationState: NavigationState<any>})=>{\r\n      return <TabBar\r\n        {...props}\r\n        indicatorStyle={{ backgroundColor: \"#2196F3\" }}\r\n        style={{ backgroundColor:Colors[theme].background}}\r\n        /* @ts-ignore */\r\n        labelStyle={{whiteSpace:\"nowrap\"}}\r\n        activeColor={Colors[theme].text}\r\n        inactiveColor={Colors[theme].text}\r\n        renderIcon={(scene)=>icons[scene.route.key]}\r\n        onTabPress={(scene)=>onTab?.(entries.findIndex(([k, v])=>k == scene.route.key))}\r\n      />\r\n    }}\r\n    navigationState={{ index, routes: entries.map(([k, v])=>({key:k, title:lang(v.title)}))}}\r\n    onIndexChange={(v)=>{onTab?.(v)}}\r\n    onSwipeStart={()=>{\r\n      if (Platform.OS === 'web') {\r\n        if (window.getSelection) {\r\n            var sel = window.getSelection();\r\n            sel?.removeAllRanges();\r\n        }\r\n    }\r\n    }}\r\n    renderScene={SceneMap(Object.assign({}, ...entries.map(([k, v])=>({[k]:v.component}))))}\r\n    tabBarPosition={props.tabBarPosition}\r\n  />\r\n}\r\n\r\n","import React from 'react'\r\nimport TextButton from \"./TextButton\"\r\nimport useAuthContext from \"../hooks/useAuthContext\"\r\nimport useResizeContext from '../hooks/useResizeContext'\r\nimport { View } from 'react-native'\r\nimport useModalsContext from '../hooks/useModalsContext'\r\nimport AlertModal from '../modals/AlertModal'\r\nimport useLangContext from '../hooks/useLangContext'\r\nimport useColorScheme from '../hooks/useColorScheme'\r\nimport Colors from '../constants/Colors'\r\n\r\ntype ButtonProps = {title:string, onPress:()=>void, windowType?:'landscape'|'portrait'}\r\n\r\nexport default (props:{extra?:ButtonProps[]})=>{\r\n    const { lang } = useLangContext()\r\n    const theme = useColorScheme()\r\n    const {auth, dispatch} = useAuthContext()\r\n    const { setModal } = useModalsContext()\r\n    const windowType = useResizeContext()\r\n    const defaultButtonProps:ButtonProps[] = [{title:lang('sign out'), onPress:()=>{\r\n        if (auth?.user?.is_guest){\r\n            setModal(AlertModal, {type:\"GUEST_LOGOUT\"})\r\n        }\r\n        else{\r\n            dispatch({type:\"LOGOUT_REQUEST\"})\r\n        }\r\n    }}]\r\n    const buttonProps = (props.extra?[...props.extra, ...defaultButtonProps]:defaultButtonProps).filter(v=>v.windowType==windowType || v.windowType == undefined)\r\n    return<View style={{flexDirection:'row'}}>\r\n        {buttonProps.map((v,k)=><TextButton key={k} {...v} textStyle={{color:Colors[theme].text}} color='#gray'/>)}\r\n    </View>\r\n}\r\n  ","import React, { useEffect } from 'react';\r\nimport Profile from '../components/Profile';\r\nimport useAuthContext from '../hooks/useAuthContext';\r\nimport useUserMembershipList from '../hooks/lists/useUserMembershipList';\r\nimport { useMessengerChannelMutation } from '../hooks/lists/useMessengerChannelList';\r\nimport CommonButton from '../components/CommonButton';\r\nimport { Channel } from '../types';\r\nimport { navigate } from '../navigation';\r\nimport useModalsContext from '../hooks/useModalsContext';\r\nimport { Text, View } from '../components/Themed';\r\nimport useLangContext from '../hooks/useLangContext';\r\nimport { Ionicons } from '../lib/@expo/vector-icons';\r\nimport { TouchableOpacity } from 'react-native-gesture-handler';\r\nimport Colors from '../constants/Colors';\r\nimport useColorScheme from '../hooks/useColorScheme';\r\nimport { BottomSheet } from '../components/ModalSection';\r\nimport useModalEffect from '../hooks/useModalEffect';\r\nimport RegistrationModal from './RegistrationModal';\r\n\r\nexport default function ProfileModal({id}:{id:number}) {\r\n  const { lang } = useLangContext()\r\n  const theme = useColorScheme()\r\n  const {auth} = useAuthContext()\r\n  const { setModal } = useModalsContext()\r\n  const userList = useUserMembershipList(auth)\r\n  const user = userList?.find(v=>v.id==id)\r\n  const isSelf = auth.user && user && (auth.user?.id==user?.id)\r\n  const channelMutation = useMessengerChannelMutation('messenger')\r\n  const back = ()=>{\r\n    setModal(ProfileModal, null)\r\n  }\r\n  useEffect(()=>{\r\n    if (!(id && user) && userList)\r\n      back()\r\n  }, [userList])\r\n  useModalEffect(back, [])\r\n  return user?<BottomSheet>\r\n    <View style={{flexDirection:'row', width:'100%'}}>\r\n      <View style={{flex:1, flexDirection:'row'}}>\r\n        <TouchableOpacity onPress={back}>\r\n          <Ionicons size={20} name=\"arrow-back\" color={Colors[theme].text}/>\r\n        </TouchableOpacity>\r\n      </View>\r\n      <View style={{flex:1}}>\r\n        <Text style={{fontSize:20, textAlign:'center'}}>{lang('profile')}</Text>\r\n      </View>\r\n      <View style={{flex:1}}/>\r\n    </View>\r\n    <View style={{marginBottom: 20, height: 1, width: '100%'}} lightColor=\"#ddd\" darkColor=\"rgba(255,255,255, 0.3)\" />\r\n    \r\n    <Profile username={user.username} name={user.name} userId={user.id} />\r\n    {isSelf?\r\n    (!auth.user?.is_guest && <CommonButton title={lang('Account Settings')} onPress={()=>{setModal(RegistrationModal, {id:auth.user?.id})}}/>):\r\n    <CommonButton title={lang('1:1 Chat')} onPress={()=>{\r\n      if(auth?.user?.id && auth.groupId){\r\n        const newChannel:Channel = {name:\"\", type:'messenger', owner:auth?.user?.id, group:auth.groupId, subowner:user.id};\r\n        channelMutation.direct(newChannel).then(v=>navigate(\"Main\", {screen:\"ChatScreen\", params: {id:v.id}}))\r\n      }\r\n    }}/>}\r\n  </BottomSheet>:<></>\r\n}\r\n","import React from 'react'\r\nimport { View, StyleSheet, Linking, Platform, TouchableOpacity  } from 'react-native'\r\nimport { } from 'react-native-gesture-handler'\r\nimport { AntDesign } from '../lib/@expo/vector-icons'; \r\nimport Colors from '../constants/Colors';\r\n\r\nconst openURL = Platform.OS=='web'?(url:string)=>{location.href=url}:Linking.openURL\r\n\r\nexport default (props:{theme:'light'|'dark'})=>{\r\n    return<View style={Styles.footer_buttons}>\r\n        <TouchableOpacity style={Styles.footer_button} onPress={()=>openURL(\"https://github.com/blacktokki/tokki-tok\")}>\r\n            <AntDesign name=\"github\" size={24} color={Colors[props.theme].iconColor} />\r\n        </TouchableOpacity>\r\n        <TouchableOpacity style={Styles.footer_button} onPress={()=>Linking.openURL(\"mailto:ydh051541@naver.com\")}>\r\n            <AntDesign name=\"mail\" size={24} color={Colors[props.theme].iconColor} />\r\n        </TouchableOpacity>\r\n    </View>\r\n}\r\n\r\nconst Styles = StyleSheet.create({\r\n      footer_buttons: {\r\n        width: '100%',\r\n        flexDirection: 'row',\r\n        justifyContent: 'flex-end',\r\n        paddingBottom: 20,\r\n        paddingRight: 20,\r\n      },\r\n      footer_button: {\r\n        alignItems: 'center',\r\n        justifyContent: 'center',\r\n        width: 38,\r\n        height: 38,\r\n        marginHorizontal: 12,\r\n        borderWidth: 1,\r\n        borderColor: '#E7E7E7',\r\n        borderRadius: 60,\r\n      },\r\n})","import React, {useEffect, useState} from 'react';\r\nimport {\r\n  Text,\r\n  TextInput,\r\n  TouchableOpacity,\r\n  View,\r\n  StyleSheet,\r\n} from 'react-native';\r\nimport { StackScreenProps } from '@react-navigation/stack';\r\nimport useAuthContext from '../../hooks/useAuthContext';\r\nimport useLangContext from '../../hooks/useLangContext';\r\nimport ContractFooter from '../../components/ContractFooter';\r\n\r\nexport default function LoginScreen({\r\n  navigation, route\r\n}: StackScreenProps<any, 'Login'>) {\r\n  const { lang } = useLangContext()\r\n  const [username, setUsername] = useState('');\r\n  const [password, setPassword] = useState('');\r\n  const {error, dispatch} = useAuthContext()\r\n  const _login = ()=>dispatch({type:'LOGIN_REQUEST', username, password})\r\n  useEffect(() => {\r\n    navigation.setOptions({\r\n      headerRight: undefined\r\n    });\r\n  }, [navigation]);\r\n\r\n  return (<View style={Styles.login_container}>\r\n    <View style={Styles.login_wrapper}>\r\n      <View style={Styles.form}>\r\n        {error && <View style={Styles.form_error}>\r\n          <Text style={Styles.form_error_text}>{lang(error)}</Text>\r\n        </View>}\r\n        <TextInput\r\n          style={Styles.form_input}\r\n          value={username}\r\n          placeholder={lang('Username')}\r\n          onChangeText={(text) => setUsername(text)}\r\n          autoCapitalize={'none'}\r\n          keyboardType={'email-address'}\r\n          onSubmitEditing={_login}\r\n        />\r\n        <TextInput\r\n          style={Styles.form_input}\r\n          value={password}\r\n          placeholder={lang('Password')}\r\n          secureTextEntry\r\n          onChangeText={(text) => setPassword(text)}\r\n          onSubmitEditing={_login}\r\n        />\r\n        <TouchableOpacity onPress={_login}>\r\n          <View style={Styles.button}>\r\n            <Text style={Styles.button_label}>{lang('Sign in')}</Text>\r\n          </View>\r\n        </TouchableOpacity>\r\n        <TouchableOpacity onPress={() => dispatch({type:\"LOGIN_GUEST\"})}>\r\n          <Text style={Styles.guest_footer_text}>\r\n            {lang(\"Sign in as guest\")}\r\n          </Text>\r\n        </TouchableOpacity>\r\n      </View>\r\n      <View style={Styles.login_social}>\r\n        <View style={Styles.login_social_separator}>\r\n          <View style={Styles.login_social_separator_line} />\r\n          <Text style={Styles.login_social_separator_text}>{'*'}</Text>\r\n          <View style={Styles.login_social_separator_line} />\r\n        </View>\r\n        <View style={Styles.login_social_buttons}>\r\n        </View>\r\n      </View>\r\n      {/* <>\r\n        <TouchableOpacity onPress={() => navigate(\"RegistrationScreen\")}>\r\n          <Text style={Styles.login_footer_text}>\r\n            {\"Don't have an account? \"}\r\n            <Text style={Styles.login_footer_link}>{'Sign up'}</Text>\r\n          </Text>\r\n        </TouchableOpacity>\r\n      </> */}\r\n    </View>\r\n    <ContractFooter theme='light'/>\r\n  </View>);\r\n};\r\n\r\nconst Styles = StyleSheet.create({\r\n    login_container: {\r\n      flex: 1,\r\n      backgroundColor: '#FFF',\r\n    },\r\n    login_header: {\r\n      alignItems: 'center',\r\n      paddingTop: 30,\r\n      paddingBottom: 50,\r\n      backgroundColor: '#208AEC',\r\n    },\r\n    login_header_logo: {\r\n      width: 220,\r\n      resizeMode: 'contain',\r\n    },\r\n    login_header_text: {\r\n      marginTop: 15,\r\n      color: '#f0f0f0',\r\n      fontSize: 16,\r\n    },\r\n    login_header_text_bold: {\r\n      color: '#fff',\r\n      fontWeight: 'bold',\r\n    },\r\n    login_wrapper: {\r\n      flex: 1,\r\n      justifyContent: 'space-between',\r\n      paddingTop: 40,\r\n      borderTopRightRadius: 12,\r\n      borderTopLeftRadius: 12,\r\n      backgroundColor: '#fff',\r\n      alignItems: 'center',\r\n    },\r\n    form: {\r\n      width: '100%',\r\n      maxWidth: 320,\r\n    },\r\n    form_error: {\r\n      height: 22,\r\n      width:'100%',\r\n    },\r\n    form_error_text:{\r\n      textAlignVertical:'center',\r\n      color:'red',\r\n      fontSize:13,\r\n    },\r\n    form_input: {\r\n      height: 44,\r\n      paddingHorizontal: 20,\r\n      marginBottom: 20,\r\n      backgroundColor: '#EDF0F7',\r\n      borderRadius: 50,\r\n    },\r\n    button: {\r\n      alignItems: 'center',\r\n      justifyContent: 'center',\r\n      height: 44,\r\n      backgroundColor: '#0065A4',\r\n      borderRadius: 50,\r\n    },\r\n    button_label: {\r\n      color: '#fff',\r\n      fontSize: 16,\r\n    },\r\n    login_social: {\r\n      width: '100%',\r\n      maxWidth: 280,\r\n      marginTop: 20,\r\n    },\r\n    login_social_separator: {\r\n      flexDirection: 'row',\r\n      alignItems: 'center',\r\n    },\r\n    login_social_separator_line: {\r\n      flex: 1,\r\n      width: '100%',\r\n      height: 1,\r\n      backgroundColor: '#E0E0E0',\r\n    },\r\n    login_social_separator_text: {\r\n      marginHorizontal: 10,\r\n      color: '#808080',\r\n      fontSize: 16,\r\n    },\r\n    login_social_buttons: {\r\n      flexDirection: 'row',\r\n      justifyContent: 'center',\r\n      marginTop: 20,\r\n    },\r\n    login_social_button: {\r\n      alignItems: 'center',\r\n      justifyContent: 'center',\r\n      width: 60,\r\n      height: 60,\r\n      marginHorizontal: 12,\r\n      borderWidth: 1,\r\n      borderColor: '#E7E7E7',\r\n      borderRadius: 60,\r\n    },\r\n    login_social_icon: {\r\n      width: 38,\r\n      height: 38,\r\n      resizeMode: 'contain',\r\n    },\r\n    login_social_facebook: {\r\n      backgroundColor: '#4267B2',\r\n      borderColor: '#4267B2',\r\n    },\r\n    login_footer_text: {\r\n      flexDirection: 'row',\r\n      alignItems: 'center',\r\n      color: '#808080',\r\n      fontSize: 14,\r\n    },\r\n    guest_footer_text: {\r\n      flexDirection: 'row',\r\n      alignSelf: 'center',\r\n      color: '#808080',\r\n      fontSize: 15,\r\n      margin: 15\r\n    },\r\n    login_footer_link: {\r\n      color: '#208AEC',\r\n      fontSize: 15,\r\n      fontWeight: 'bold',\r\n    },\r\n  });\r\n  ","import React, { createContext, useContext } from \"react\"\r\nimport { SendJsonMessage } from \"react-use-websocket/dist/lib/types\";\r\nimport { WebSocketInternalProvider } from \"../../hooks/useWebsocketContext\";\r\n\r\nconst WebSocketContext = createContext<{lastJsonMessage:any, sendJsonMessage:SendJsonMessage }>({lastJsonMessage:undefined, sendJsonMessage:()=>{}});\r\n\r\nexport const WebSocketProvider = ({disable, children}:{disable?:boolean, children:React.ReactNode})=>{\r\n  return disable?<></>:<WebSocketInternalProvider path={'messenger/ws/rtc/'} Context={WebSocketContext} useBackground>\r\n    {children}\r\n  </WebSocketInternalProvider>\r\n}\r\n\r\nexport default ()=>{\r\n  const webSocketContext = useContext(WebSocketContext)\r\n  return webSocketContext\r\n}\r\n\r\n","import React, { useCallback, useRef, useState, useMemo } from \"react\";\r\n//@ts-ignore\r\nimport { RTCView, mediaDevices, RTCPeerConnection, MediaStream, RTCSessionDescription, RTCIceCandidate } from \"react-native-webrtc-web-shim\";\r\nimport {TURN_SERVER} from \"../../../constants/Envs\"\r\n\r\n\r\nconsole.log(TURN_SERVER?\"use turn server\": \"use stun server\")\r\n\r\nexport const peerConstraints = {\r\n\ticeServers: [TURN_SERVER?JSON.parse(TURN_SERVER):{urls: 'stun:stun.l.google.com:19302'}]\r\n};\r\n\r\nexport const sessionConstraints = {\r\n\tmandatory: {\r\n\t\tOfferToReceiveAudio: true,\r\n\t\tOfferToReceiveVideo: true,\r\n\t\tVoiceActivityDetection: true\r\n\t}\r\n};\r\n\r\nconst mediaConstraints = {audio:true, video:{framerate:30}}\r\n\r\n//@ts-ignore\r\nexport {MediaStream, RTCPeerConnection, RTCSessionDescription} from \"react-native-webrtc-web-shim\";\r\n\r\nconst onICEcandidate = (pc:typeof RTCPeerConnection, message:any)=>{\r\n\tconst _message = message.data.rtcMessage\r\n\t\tconst candidate = new RTCIceCandidate(_message);\r\n\t\tif (pc) {\r\n\t\t\tconsole.log(\"ICE candidate Added\");\r\n\t\t\tpc.addIceCandidate(candidate);\r\n\t\t}\r\n}\r\n\r\nconst sendICEcandidate = (event:any, sendMessage:(data:any)=>void, receiver:string, target:string) => {\r\n\t// When you find a null candidate then there are no more candidates.\r\n\t// Gathering of candidates has finished.\r\n\tif ( !event.candidate ) { return; };\r\n\t// Send the event.candidate onto the person you're calling.\r\n\t// Keeping to Trickle ICE Standards, you should send the candidates immediately.\r\n\tsendMessage({type:'ICEcandidate', receiver, data:{target, rtcMessage:event.candidate}})\r\n  }\r\n\r\nconst BAND_WIDTH = 8000\r\n\r\nconst optimizeSdp = (offerDescription:RTCSessionDescription)=>{\r\n\tvar arr = offerDescription.sdp.split('\\r\\n');\r\n\tarr.forEach((str:string, i:number) => {\r\n\t\tif (/^a=fmtp:\\d*/.test(str)) {\r\n\t\t\tarr[i] = str + `;x-google-max-bitrate=${BAND_WIDTH};x-google-min-bitrate=${BAND_WIDTH};x-google-start-bitrate=${BAND_WIDTH}`;\r\n\t\t} else if (/^a=mid:(0|video)/.test(str)) { // if with audio then 0=>1\r\n\t\t\tarr[i] += `\\r\\nb=AS:${BAND_WIDTH}`;\r\n\t\t}\r\n\t});\r\n  \treturn new RTCSessionDescription({\r\n    \ttype: offerDescription.type,\r\n    \tsdp: arr.join('\\r\\n'),\r\n  \t})\r\n}\r\n\r\nconst createOffer = async(pcRefCurrent:{pc?:typeof RTCPeerConnection, receiver:string}, sendMessage:(data:any)=>void, stream:typeof MediaStream, target:string, user?:{name:string})=>{\r\n\tstream && pcRefCurrent.pc.addStream( stream );\r\n\tconst offerDescription = optimizeSdp((await pcRefCurrent.pc.createOffer( sessionConstraints )));\r\n\tawait pcRefCurrent.pc.setLocalDescription( offerDescription );\r\n\tsendMessage({type:'call', receiver:pcRefCurrent.receiver, data:{target, name:user?.name, rtcMessage:offerDescription}})\r\n}\r\n\r\nexport const useLocalCam = (sendMessage:(data:any)=>void)=>{\r\n\tconst pcRef = useRef<Record<number,{pc:typeof RTCPeerConnection, receiver:string}>>({})\r\n\tconst [sender, setSender] = useState<string>()\r\n\tconst [_stream, setStream] = useState<MediaStream>()\r\n\tconst isPlay = useMemo(()=>_stream?true:false, [_stream])\r\n\tconst CustomRTCView = useCallback(React.memo(({style}:{style:any})=>(_stream?<RTCView stream={_stream} style={style} videoProps={{height:'100%'}} />:<></>)) , [_stream])\r\n\tconst start = useCallback(async(user:{name:string}, stream?:typeof MediaStream, mode?:'camera'|'display')=>{\r\n\t\tconsole.log(\"start\");\r\n\t\tif (!_stream || mode!==undefined) {\r\n\t\t\ttry {\r\n\t\t\t\tlet newStream:typeof MediaStream;\r\n\t\t\t\tif(mode == 'camera'){\r\n\t\t\t\t\tnewStream = await mediaDevices.getUserMedia(mediaConstraints)\r\n\t\t\t\t}\r\n\t\t\t\telse if (mode == 'display'){\r\n\t\t\t\t\tnewStream = await mediaDevices.getDisplayMedia(mediaConstraints)\r\n\t\t\t\t}\r\n\t\t\t\telse{\r\n\t\t\t\t\tnewStream = stream || await mediaDevices.getUserMedia(mediaConstraints).catch((e:any)=>mediaDevices.getDisplayMedia(mediaConstraints));\r\n\t\t\t\t}\r\n\t\t\t\tsetStream(newStream)\r\n\t\t\t\tObject.entries(pcRef.current).map(([k, v])=>{\r\n\t\t\t\t\tcreateOffer(v, sendMessage, newStream, 'guest', user)\r\n\t\t\t\t})\r\n\t\t\t} catch (e) {\r\n\t\t\t\tconsole.error(e);\r\n\t\t\t}\r\n\t\t}\r\n\t}, [_stream])\r\n\tconst stop = useCallback(()=>{\r\n\t\tconsole.log(\"stop\");\r\n\t\tif(_stream){\r\n\t\t\t_stream.getTracks().map((track:any) => track.stop());\r\n\t\t\tsetStream(undefined)\r\n\t\t}\r\n\t}, [_stream])\r\n\treturn {\r\n\t\tstart,\r\n\t\tstop,\r\n\t\twebsocketOnMessage: async(response:any, user:{name:string})=>{\r\n\t\t\tlet type = response.type;\r\n\t\t\tif (type == 'connection'){\r\n\t\t\t\tsetSender(response.data.channel_name)\r\n\t\t\t}\r\n\t\t\tif (type == 'start' && response.data.target=='host'){\r\n\t\t\t  console.log('1 start')\r\n\t\t\t  const peerConnection = new RTCPeerConnection( peerConstraints );\r\n\t\t\t  peerConnection.addEventListener( 'icecandidate', (event:any) => sendICEcandidate(event, sendMessage, response.sender, 'guest'));\r\n\t\t\t  pcRef.current[response.sender] = {pc:peerConnection, receiver: response.sender}\r\n\t\t\t  createOffer(pcRef.current[response.sender], sendMessage, _stream, 'guest', user)\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (type == \"answer\" && response.data.target == 'host'){\r\n\t\t\t  console.log('3 answer')\r\n\t\t\t  const peerConnection = pcRef.current[response.sender].pc\r\n\t\t\t  const answerDescription = new RTCSessionDescription(response.data.rtcMessage);\r\n\t\t\t  await peerConnection.setRemoteDescription( answerDescription );\r\n\t\t\t  // const streams = pcRef.current.pc.getRemoteStreams()\r\n\t\t\t  // setMirrorStream(streams[streams.length - 1])\r\n\t\t\t}\r\n\t\t\tif (type == \"ICEcandidate\" && response.data.target=='host'){\r\n\t\t\t\tconst peerConnection = pcRef.current[response.sender].pc\r\n\t\t\t\tonICEcandidate(peerConnection, response)\r\n\t\t\t}\r\n\t\t},\r\n\t\tCustomRTCView,\r\n\t\tisPlay,\r\n\t\tsender,\r\n\t\t// renderMirrorView,\r\n\t}\r\n}\r\n\r\nexport const useRemoteCam = (sendMessage:(data:any)=>void)=>{\r\n\tconst pcRef = useRef<{pc?:RTCPeerConnection, receiver?:string, statsInterval?:any}>({})\r\n\tconst [user, setUser] = useState<{name:string}>()\r\n\tconst [_stream, setStream] = useState<MediaStream>()\r\n\tconst CustomRTCView = useCallback(React.memo((style:any)=>_stream?<RTCView stream={_stream} style={style} videoProps={{height:'100%'}} />:<></>), [_stream])\r\n\tconst isPlay = useMemo(()=>_stream?true:false, [_stream])\r\n\tconst start = useCallback((receiver:string)=>{\r\n\t\tconsole.log(\"start\");\r\n\t\tif (!pcRef.current.pc) {\r\n\t\t  pcRef.current.pc = new RTCPeerConnection( peerConstraints );\r\n\t\t  pcRef.current.receiver = receiver\r\n\t\t}\r\n\t\tif (!_stream){\r\n\t\t\tsendMessage({type:'start', receiver, data:{'target': 'host'}})\r\n\t\t}\r\n\t}, [_stream])\r\n\tconst stop = () => {\r\n\t\tconsole.log(\"stop\");\r\n\t\tif (pcRef.current.pc) {\r\n\t\t  // peerConnection._unregisterEvents();\r\n\t\t  setStream(undefined)\r\n\t\t  pcRef.current.pc.close();\r\n\t\t  pcRef.current.pc = undefined\r\n\t\t  pcRef.current.receiver = undefined\r\n\t\t  clearInterval(pcRef.current.statsInterval)\r\n\t\t}\r\n\t}\r\n\treturn {\r\n\t\tstart,\r\n\t\tstop,\r\n\t\twebsocketOnMessage: async(response:any)=>{\r\n\t\t\tlet type = response.type;\r\n\t\t\tif (type == 'start' && response.data.target=='guest' && response.sender == pcRef.current?.receiver){\r\n\t\t\t\tconsole.log('(remote)1 start')\r\n\t\t\t\tconst peerConnection = pcRef.current.pc\r\n\t\t\t\tsetUser({name: response.data.name})\r\n\t\t\t\tpeerConnection.addEventListener('icecandidate', (event:any) => sendICEcandidate(event, sendMessage, response.sender, 'host'));\r\n\t\t\t\tpeerConnection.addEventListener('iceconnectionstatechange', (e:any)=>{\r\n\t\t\t\t\tif (pcRef.current.pc.iceConnectionState == 'connected'){\r\n\t\t\t\t\t\tlet activeStream = false\r\n\t\t\t\t\t\tpcRef.current.statsInterval = setInterval(async()=>{\r\n\t\t\t\t\t\t\tconst stats = await pcRef.current.pc.getStats(null)\r\n\t\t\t\t\t\t\tlet statsOutput = \"\";\r\n\t\t\t\t\t\t\tlet framePerSecond = undefined\r\n\t\t\t\t\t\t\tstats.forEach((report:any) => {\r\n\t\t\t\t\t\t\t\tif (report.type === \"inbound-rtp\" && report.kind === \"video\") {\r\n\t\t\t\t\t\t\t\t\tObject.keys(report).forEach((statName) => {\r\n\t\t\t\t\t\t\t\t\t\tstatsOutput += `${statName}: ${report[statName]}\\n`;\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\tframePerSecond = report.framesPerSecond\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tconsole.log(activeStream, framePerSecond)\r\n\t\t\t\t\t\t\tif (framePerSecond != undefined){\r\n\t\t\t\t\t\t\t\tactiveStream = true\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse if (activeStream){\r\n\t\t\t\t\t\t\t\tstop()\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tconsole.log(new Date().toTimeString().split(' ')[0], statsOutput)\r\n\t\t\t\t\t\t}, 1000);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (pcRef.current.pc.iceConnectionState == 'failed'){\r\n\t\t\t\t\t\tstop()\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t// peerConnection.addTransceiver('audio', {\r\n\t\t\t\t// \tdirection: 'recvonly'\r\n\t\t\t\t// });\r\n\t\t\t\tpeerConnection.addTransceiver('video', {\r\n\t\t\t\t\tdirection: 'recvonly'\r\n\t\t\t\t});\r\n\t\t\t\tawait createOffer({pc:pcRef.current.pc, receiver:response.sender}, sendMessage, _stream, 'host', user)\r\n\t\t\t}  \r\n\t\t\tif (type == \"answer\" && response.data.target=='guest' && response.sender == pcRef.current?.receiver){\r\n\t\t\t\tconsole.log('(remote)3 answer')\r\n\t\t\t\tconst answerDescription = new RTCSessionDescription(response.data.rtcMessage);\r\n\t\t\t\tawait pcRef.current.pc.setRemoteDescription( answerDescription );\r\n\t\t\t\tconst streams = pcRef.current.pc.getRemoteStreams()\r\n\t\t\t\tsetStream(streams[streams.length - 1])\r\n\t\t\t\tsendMessage({type:'end', receiver:pcRef.current.receiver, data:{}})\r\n\t\t\t}\r\n\t\t\tif (type == \"call\" && response.sender == pcRef.current?.receiver){\r\n\t\t\t  console.log('2 call')\r\n\t\t\t  const peerConnection = pcRef.current.pc\r\n\t\t\t  setUser({name:response.data.name})\r\n\t\t\t  if (!peerConnection)\r\n\t\t\t\treturn\r\n\t\t\t  peerConnection.addEventListener( 'icecandidate', (event:any) => sendICEcandidate(event, sendMessage, response.sender, 'host'));\r\n\t\t\t  const offerDescription = new RTCSessionDescription(response.data.rtcMessage);\r\n\t\t\t  await peerConnection.setRemoteDescription( offerDescription );\r\n\t\t\t  const answerDescription = await peerConnection.createAnswer( sessionConstraints );\r\n\t\t\t  await peerConnection.setLocalDescription( answerDescription );\r\n\t\t\t  sendMessage({type:'answer', receiver:pcRef.current.receiver, data:{target:'host', rtcMessage:peerConnection.localDescription}})\r\n\t\t\t  // Here is a good place to process candidates.\r\n\t\t\t  const streams = pcRef.current.pc.getRemoteStreams()\r\n\t\t\t  setStream(streams[streams.length - 1])\r\n\t\t\t}\r\n\t\t\tif (type == \"ICEcandidate\" && response.data.target=='guest' && response.sender == pcRef.current?.receiver)\r\n\t\t\t  onICEcandidate(pcRef.current.pc, response)\r\n\t\t},\r\n\t\tCustomRTCView,\r\n\t\tuser,\r\n\t\tisPlay\r\n\t}\r\n}","import {StyleSheet} from \"react-native\";\r\nexport {useLocalCam, useRemoteCam} from \"./p2p\"\r\n\r\nexport const camStyle = StyleSheet.create({\r\n\tcontainer:{ flex: 1},\r\n\tcam:{ flex: 1, height:'100%'},\r\n\tbottonContainer: {position:\"absolute\", bottom:0, justifyContent:'flex-end'},\r\n\tbuttonBar: { flexDirection: \"row\", justifyContent: \"space-around\" },\r\n\tlabel: {backgroundColor:'#0008', color:'white', paddingHorizontal:5},\r\n})","import React, { useEffect } from \"react\";\r\nimport {Button, View, Text} from \"react-native\";\r\nimport useWebsocketContext from \"./useWebsocketContext\";\r\nimport { useLocalCam, camStyle} from \"./webrtc\";\r\n\r\n\r\nexport default (props:{user?:{name:string}|null, mode?:'camera'|'display'|null})=>{\r\n  const {lastJsonMessage, sendJsonMessage} = useWebsocketContext()\r\n  const {start, stop, websocketOnMessage, CustomRTCView, isPlay} = useLocalCam(sendJsonMessage)\r\n  useEffect(()=>{\r\n    props.user && lastJsonMessage && websocketOnMessage(lastJsonMessage, props.user)\r\n  }, [lastJsonMessage, props.user])\r\n  useEffect(()=>{\r\n    if(props.mode && !isPlay){\r\n      props.user && start(props.user, undefined, props.mode)\r\n    }\r\n    else if(props.mode===null && isPlay){\r\n      stop()\r\n    }\r\n    return ()=>{isPlay && stop()}\r\n  }, [isPlay, props.user, props.mode])\r\n  return (\r\n    <View style={camStyle.container}>\r\n      <CustomRTCView style={camStyle.cam}/>\r\n      <View style={camStyle.bottonContainer}>\r\n        <View style={camStyle.buttonBar}>  \r\n        </View>\r\n        <View style={{flexDirection:'row'}}><Text style={camStyle.label}>{props.user?.name}</Text></View>\r\n        <View style={camStyle.buttonBar}>\r\n          {props.mode === undefined && !isPlay && <Button title=\"Start\" onPress={()=>props.user && start(props.user)} />}\r\n          {props.mode === undefined && isPlay && <Button title=\"Stop\" onPress={stop} />}\r\n        </View>\r\n      </View>\r\n    </View>\r\n  );\r\n}\r\n","import React, { useState, useEffect, } from \"react\";\r\nimport {Button,Text, TextInput, View} from \"react-native\";\r\nimport useWebsocketContext from \"./useWebsocketContext\";\r\nimport { useRemoteCam, camStyle} from \"./webrtc\";\r\n\r\nexport default (props:{receiver?:string})=>{\r\n  const [receiver, setReceiver] = useState('')\r\n  const {lastJsonMessage, sendJsonMessage} = useWebsocketContext()\r\n  const {start, stop, websocketOnMessage, CustomRTCView, isPlay, user} = useRemoteCam(sendJsonMessage)\r\n  useEffect(()=>{\r\n    lastJsonMessage && websocketOnMessage(lastJsonMessage)\r\n  }, [lastJsonMessage])\r\n  useEffect(()=>{\r\n    if(props.receiver){\r\n      start(props.receiver)\r\n    }\r\n    return ()=>stop()\r\n  }, [props.receiver])\r\n  return (\r\n    <View style={camStyle.container}>\r\n      <CustomRTCView style={camStyle.cam}/>\r\n      <View style={camStyle.bottonContainer}>\r\n        <View style={camStyle.buttonBar}>\r\n        </View>\r\n        <View style={{flexDirection:'row'}}>{\r\n          (props.receiver || isPlay)?\r\n          <Text style={camStyle.label}>{user?.name || 'loading...'}</Text>:\r\n          <>\r\n            <Text style={{borderWidth:1}}>Receiver:&nbsp;</Text>\r\n            <TextInput style={{borderWidth:1, flex:1}} value={receiver} onChangeText={setReceiver}/>\r\n          </> \r\n        }</View>\r\n        <View style={camStyle.buttonBar}>\r\n          {props.receiver === undefined && !isPlay && <Button title=\"Start\" onPress={()=>start(receiver)} />}\r\n          {props.receiver === undefined && isPlay && <Button title=\"Stop\" onPress={stop} />}\r\n        </View>\r\n      </View>\r\n    </View>\r\n  );\r\n}\r\n\r\n","import React, {useEffect, useState} from 'react';\r\nimport { StyleSheet, View } from 'react-native';\r\nimport { View as ThemedView } from '../../../components/Themed' \r\nimport Colors from '../../../constants/Colors';\r\nimport {default as useRtcContext, WebSocketProvider as RtcProvider} from \"../../../lib/react-native-webrtc/useWebsocketContext\";\r\nimport LocalCam from '../../../lib/react-native-webrtc/LocalCam';\r\nimport RemoteCam from '../../../lib/react-native-webrtc/RemoteCam';\r\nimport useResizeContext from '../../../hooks/useResizeContext';\r\nimport useAuthContext from '../../../hooks/useAuthContext';\r\nimport { TouchableOpacity } from 'react-native-gesture-handler';\r\nimport CommonButton from '../../../components/CommonButton';\r\nimport { Ionicons } from '../../../lib/@expo/vector-icons';\r\nimport useIsMobile from '../../../hooks/useIsMobile';\r\n\r\ntype VideoType = 'camera'|'display'|null\r\ntype VideoCallProps = {channel_id:number, setDisable:(disable:boolean)=>void, disable?:boolean}\r\n\r\n\r\nconst VideoView = (props:{\r\n  scale:string,\r\n  focusGuest?:string,\r\n  setFocusGuest:(focusGuest?:string)=>void\r\n  receiver?:string\r\n  children:React.ReactNode\r\n})=>{\r\n  return <View style={[{maxWidth:props.scale, maxHeight:props.scale, borderWidth:1, borderColor:Colors.borderColor, backgroundColor:'gray', flexDirection:'row', flexGrow:1}, (props.focusGuest == undefined || props.focusGuest == props.receiver)?{height:'100%'}:{maxWidth:0, height:0}]}>\r\n    <TouchableOpacity style={{flex:1}} containerStyle={{flex:1, justifyContent:'center'}} onPress={()=>props.setFocusGuest(props.focusGuest?undefined:props.receiver)}>\r\n    {props.children}\r\n    </TouchableOpacity>\r\n  </View>\r\n    \r\n  \r\n}\r\n\r\nconst VideoCallContainer = ({channel_id, disable, setDisable}:VideoCallProps)=>{\r\n  const {auth} = useAuthContext()\r\n  const isMobile = useIsMobile()\r\n  const [videoMode, setVideoMode] = useState<VideoType>(null)\r\n  const [guests, setGuests] = useState<string[]>([])\r\n  const [focusGuest, setFocusGuest] = useState<string>()\r\n  const windowType = useResizeContext()\r\n  const { lastJsonMessage, sendJsonMessage } = useRtcContext()\r\n  useEffect(()=>{\r\n    if(lastJsonMessage !=null){\r\n      if(lastJsonMessage['type']=='connection'){\r\n        sendJsonMessage({'type':'broadcast', 'data':{'channel_id':channel_id}})\r\n      }\r\n      if(lastJsonMessage['type']=='broadcast_guest' || lastJsonMessage['type']=='broadcast_host'){\r\n        setGuests([...guests, lastJsonMessage['sender']])\r\n      }\r\n      if(lastJsonMessage['type']=='broadcast_disconnect'){\r\n        const channel_name = lastJsonMessage['sender']\r\n        const exist = guests.find(v=>v == channel_name)\r\n        exist && setGuests(guests.filter(v=>v != channel_name))\r\n      }\r\n    }\r\n  }, [lastJsonMessage])\r\n  const scale = focusGuest?'100%':`${100 / Math.max(2, Math.ceil(Math.sqrt(guests.length + 1)))}%`\r\n  const toggleVideoMode = (mode:VideoType)=>{\r\n    setVideoMode(videoMode!=mode?mode:null)\r\n  }\r\n  return lastJsonMessage !==undefined ?\r\n    <ThemedView style={[\r\n      {aspectRatio:!disable?16/9:0, borderColor:Colors.borderColor, borderRadius:10},\r\n      windowType=='landscape'?{flexShrink:1, flexGrow:0, height:'100%', borderLeftWidth:1, paddingBottom:65}:{maxHeight:'36%', width:'100%', borderBottomWidth:1}\r\n    ]}>\r\n      <View style={{aspectRatio:focusGuest?undefined:16/9, backgroundColor:'white', flexWrap:'wrap', flexDirection:'row', width:'100%', height:'100%'}}>\r\n        {guests.map((receiver, i)=><VideoView scale={scale} focusGuest={focusGuest} setFocusGuest={setFocusGuest} receiver={receiver}>\r\n          <RemoteCam receiver={receiver}/>\r\n        </VideoView>\r\n        )}\r\n        <VideoView scale={scale} focusGuest={focusGuest} setFocusGuest={setFocusGuest} receiver={auth.user?.name}>\r\n          <LocalCam user={auth.user} mode={videoMode}/>\r\n        </VideoView>\r\n      </View>\r\n      <ThemedView style={[\r\n          {position:'absolute', alignItems:'center', justifyContent:'flex-end', width:'100%',flexDirection:'row'},\r\n          windowType=='landscape'?{bottom:0, paddingTop:15, paddingBottom:10, paddingHorizontal:19}:{backgroundColor:'transparent'}\r\n        ]}>\r\n        <CommonButton title={'⏺️'} style={{height:40, paddingTop:8}} onPress={()=>toggleVideoMode('camera')}/>\r\n        {!isMobile && <CommonButton title={'🖥️'} style={{height:40, paddingTop:8}} onPress={()=>toggleVideoMode('display')}/>}\r\n        <CommonButton title={''} style={{height:40, paddingTop:8}} onPress={()=>setDisable(true)}>\r\n          <Ionicons size={20} name=\"arrow-back\" color={'deepskyblue'}/>\r\n        </CommonButton>\r\n      </ThemedView>\r\n    </ThemedView>:\r\n  <></>\r\n  }\r\n  \r\nexport default React.memo(({channel_id, disable, setDisable}:VideoCallProps)=>{\r\n  return <RtcProvider disable={disable}>\r\n    <VideoCallContainer channel_id={channel_id} disable={disable} setDisable={setDisable}/>\r\n  </RtcProvider>\r\n})\r\n","import React, {useState} from \"react\"\r\nimport {View, TouchableOpacity} from 'react-native'\r\nimport { Text } from \"../Themed\";\r\nimport useUploadContext from \"../../hooks/useUploadContext\";\r\n\r\nconst UploadTag = (props:{data:{filename:string, progress?:number}, index:number, isExpand:boolean, setExpand:(index?:number)=>void})=>{\r\n    return <View style={{backgroundColor:'lightgray', borderRadius:20, overflow:'hidden', margin:5}}>\r\n        <View style={{backgroundColor:'darkgray', position:'absolute', width:`${(props.data.progress || 0)*100}%`, height:'100%'}}/>\r\n        <View style={{paddingVertical:5, paddingHorizontal:5, flexDirection:'row'}}>\r\n            <Text>📤</Text>\r\n            <View style={{paddingHorizontal:5}}><Text>{props.data.filename}</Text></View>\r\n        </View>\r\n    </View>\r\n}\r\n\r\n\r\nexport default (props:{channel_id:number})=>{\r\n    const { upload } = useUploadContext()\r\n    const [expand, setExpand] = useState<number>()\r\n    const uploadData = upload[props.channel_id]\r\n    return <View style={{flexDirection:'row', paddingTop:5, paddingHorizontal:(uploadData?.length || 0)>0?20:0}}>\r\n        {uploadData?.map((f,i)=><UploadTag key={i} data={f} index={i} isExpand={i==expand} setExpand={setExpand}/>)}\r\n    </View>\r\n}","import React, { useEffect, useMemo, useRef, useState} from 'react';\r\nimport { Platform, StyleProp, View, ViewStyle } from 'react-native';\r\nimport { TextInput } from 'react-native-gesture-handler';\r\nimport CommonButton from '../../components/CommonButton';\r\nimport { useMessengerContentMutation } from '../../hooks/lists/useMessengerContentList';\r\nimport useAuthContext from '../../hooks/useAuthContext';\r\nimport Colors from '../../constants/Colors';\r\nimport useColorScheme from '../../hooks/useColorScheme';\r\nimport { View as ThemedView } from '../../components/Themed' \r\nimport useIsMobile from '../../hooks/useIsMobile';\r\nimport DateTimePickerModal from '../../modals/DateTimePickerModal'\r\nimport useLangContext from '../../hooks/useLangContext';\r\nimport { Entypo } from '../../lib/@expo/vector-icons';\r\nimport TimerTags, { timerFormat } from '../../components/Messages/TimerTags';\r\nimport UploadTags from '../../components/Messages/UploadTags';\r\nimport Messages from '../../components/Messages';\r\nimport useModalsContext from '../../hooks/useModalsContext';\r\nimport NotePickerModal from '../../modals/NotePickerModal';\r\n\r\nfunction uploadFile(){\r\n    return new Promise<Blob|undefined>((resolve, reject)=>{\r\n      if (Platform.OS == 'web'){\r\n        var input = document.createElement('input');\r\n        input.type = 'file';\r\n        input.onchange = e => { \r\n          resolve((e.target as any).files[0])\r\n        }\r\n        input.onabort = reject\r\n        input.onerror = reject\r\n        input.click();\r\n      }\r\n      else\r\n        resolve(undefined)\r\n    })\r\n  }\r\n\r\nexport default ({channel_id, style, extraButtons}:{channel_id:number, style?:StyleProp<ViewStyle>, extraButtons?:{title:string, onPress:()=>void, disabled?:boolean}[]})=>{\r\n    const theme = useColorScheme()\r\n    const { lang } = useLangContext()\r\n    const isMobile = useIsMobile()\r\n    const {auth} = useAuthContext()\r\n    const { setModal } = useModalsContext()\r\n    const inputRef = useRef<TextInput>(null)\r\n    const [value, setValue] = useState('')\r\n    const [editorValue, setEditorValue] = useState('')\r\n    const [timer, setTimer] = useState<string>()\r\n    const [messageEvent, sendToScreen] = useState<{value:string, editorValue:string}>()\r\n    const [bottomTab, setBottomTab] = useState<boolean>(false)\r\n    const [autoFocus, setAutoFocus] = useState<boolean|null>(null)\r\n    const valueLines = useMemo(()=>bottomTab?1:value.split(\"\\n\").length, [value, bottomTab])\r\n    const contentMutation = useMessengerContentMutation()\r\n    const postValue = ()=>{\r\n        if (value.length>0){\r\n          contentMutation.create({channel:channel_id, user:auth.user?.id, content:value, timer})\r\n          setTimer(undefined)\r\n          setBottomTab(false)\r\n          setValue('')\r\n          setAutoFocus(true)\r\n        }\r\n      }\r\n      const onKeyPress = (e:any) => {\r\n        if (!isMobile){\r\n          const event = e as KeyboardEvent;\r\n            if (!event.shiftKey && event.key === \"Enter\"){\r\n              postValue()\r\n              event.preventDefault()\r\n          }\r\n        }\r\n      }\r\n      \r\n      useEffect(()=>{\r\n        if(messageEvent){\r\n          setValue(value.concat(value.length>0?\"\\n\":\"\", messageEvent.value))\r\n          setEditorValue(editorValue.concat(\"\\r\\n\", messageEvent.editorValue))\r\n          sendToScreen(undefined)\r\n        }\r\n      }, [messageEvent, value, editorValue])\r\n      useEffect(()=>{\r\n        if(autoFocus){\r\n          (inputRef.current as any).focus?.()\r\n          setAutoFocus(false)\r\n        }\r\n      }, [autoFocus])\r\n      // useEffect(()=>{\r\n      //   if (autoFocus==null && !isMobile){\r\n      //     const timeout = setTimeout(()=>setAutoFocus(true), 500)\r\n      //     return ()=>clearTimeout(timeout)\r\n      //   }\r\n      // })\r\n\r\n\r\n    return <View style={style}>\r\n      <Messages channel_id={channel_id} auth={auth} reverse sendToScreen={sendToScreen}/>\r\n      <View style={{position:'absolute', flexDirection:'row'}}>\r\n        <UploadTags channel_id={channel_id}/>\r\n        <TimerTags channel_id={channel_id}/>\r\n      </View>\r\n      <ThemedView style={{bottom:0, width:'100%', paddingTop:15, paddingBottom:10, paddingHorizontal:19}}>\r\n        <View style={{alignItems:'center', width:'100%',flexDirection:'row'}}>\r\n          <CommonButton title={''} style={{height:'100%', paddingTop:8, borderTopRightRadius:0, borderBottomRightRadius:0, justifyContent:'center'}} onPress={()=>{setBottomTab(!bottomTab)}}>\r\n            <View style={{top:-2}}>\r\n              <Entypo name={bottomTab?\"cross\":\"plus\"} size={24} color={Colors[theme].text}/>\r\n            </View>\r\n          </CommonButton>\r\n          {timer && <CommonButton style={{height:'100%', paddingTop:8, borderRadius:0}} title={`⌚${timerFormat(timer)}`} onPress={()=>{setModal(DateTimePickerModal, {datetime:timer, callback:(datetime:string)=>setTimer(datetime)});setBottomTab(false)}}/>}\r\n          <TextInput\r\n              ref={inputRef}\r\n              value={value} \r\n              onChangeText={setValue}\r\n              onKeyPress={onKeyPress}\r\n              style={{flex:1, borderWidth:1, minHeight:41, borderColor:Colors.borderColor, backgroundColor:Colors[theme].background, color:Colors[theme].text, paddingVertical:1, paddingHorizontal:3}}\r\n              onFocus={()=>setBottomTab(false)}\r\n              multiline \r\n              numberOfLines={valueLines}/>\r\n          <CommonButton style={{height:'100%', paddingTop:8, borderTopLeftRadius:0, borderBottomLeftRadius:0, justifyContent:'center'}} title={'💬'} onPress={postValue}/>\r\n        </View>\r\n        {bottomTab && <View style={{alignItems:'center', width:'100%', flexDirection:'row', paddingTop:15, paddingBottom:5}}>\r\n          <CommonButton style={{height:80, flex:1, justifyContent:'center', marginRight:15}} title={`📤\\n ${lang('File')}`} onPress={()=>uploadFile().then(f=>{contentMutation.create({channel:channel_id, user:auth.user?.id, content:'', file:f});setBottomTab(false)})}/>\r\n          <CommonButton style={{height:80, flex:1, justifyContent:'center', marginRight:15}} title={`✏️\\n ${lang('Note')}`} onPress={()=>{setModal(NotePickerModal, {callback:(editor:number)=>{contentMutation.create({channel:channel_id, user:auth.user?.id, content:'', editor});setBottomTab(false)}})}}/>\r\n          <CommonButton style={{height:80, flex:1, justifyContent:'center', marginRight:15}} title={`⌚\\n ${lang('Timer')}`} onPress={()=>{setModal(DateTimePickerModal, {datetime:timer, callback:(datetime:string)=>setTimer(datetime)});setBottomTab(false)}}/>\r\n          {extraButtons?.map((v, k)=><CommonButton key={k} style={{height:80, flex:1, justifyContent:'center', marginRight:15}} title={v.title} onPress={()=>{v.onPress();setBottomTab(false)}} disabled={v.disabled}/>)}\r\n        </View>}\r\n      </ThemedView>\r\n    </View>\r\n}","import React, { useState,  useEffect,  useMemo,useLayoutEffect } from \"react\"\r\nimport useMessengerMemberList from './lists/useMessengerMemberList';\r\nimport useMessengerChannelList from './lists/useMessengerChannelList';\r\nimport { avatarFromChannel } from '../components/Avatar';\r\nimport useResizeContext from './useResizeContext';\r\nimport useModalsContext from './useModalsContext';\r\nimport InviteModal from '../modals/InviteModal';\r\nimport useLangContext from './useLangContext';\r\nimport useAuthContext from \"./useAuthContext\";\r\nimport { StackNavigationProp } from \"@react-navigation/stack\";\r\nimport { RouteProp } from \"@react-navigation/native\";\r\nimport HeaderRight from \"../components/HeaderRight\";\r\nimport ChannelEditModal from \"../modals/ChannelEditModal\";\r\n\r\nexport default (navigation:StackNavigationProp<any, any>, route:RouteProp<any, any>,channel_id:any, type:string, headerShown:boolean)=>{\r\n    const { lang, locale } = useLangContext()\r\n    const {auth} = useAuthContext()\r\n    const { setModal } = useModalsContext()\r\n    const windowType = useResizeContext()\r\n    const channelList = useMessengerChannelList(type, auth)\r\n    const channel = channelList?.find(v=>v.id==parseInt(channel_id))\r\n    const channelAvatar = channel?avatarFromChannel(channel, auth.user):undefined\r\n    const memberList = useMessengerMemberList(channel_id)\r\n    const member_id = useMemo(()=>memberList?.find(v=>v.user == auth.user?.id)?.id, [auth, memberList])\r\n\r\n\r\n    useLayoutEffect(() => {\r\n        navigation.setOptions({\r\n          headerRight: ()=> <HeaderRight extra={channel?.type=='messenger'?[\r\n            {title:lang('invite'), onPress:()=>setModal(InviteModal, {id:channel_id})},\r\n            {title:lang('setting'), onPress:()=>setModal(ChannelEditModal, {id:channel_id, type:channel?.type, member_id})}\r\n          ] : [\r\n            {title:lang('setting'), onPress:()=>setModal(ChannelEditModal, {id:channel_id, type:channel?.type, member_id})}\r\n          ]}/>,\r\n          title: channelAvatar?.name,\r\n          headerShown\r\n        });\r\n      }, [navigation, route, member_id, locale, windowType, headerShown, channel]);\r\n    \r\n      const back = ()=>{\r\n        if(navigation.canGoBack())\r\n            navigation.goBack()\r\n          else{\r\n            navigation.navigate('HomeScreen', {tab:2})\r\n          }\r\n      }\r\n      \r\n      useEffect(()=>{\r\n        setModal(null, null)\r\n        if (!channel_id)\r\n          back()\r\n      }, [route])\r\n      useEffect(()=>{\r\n        if (memberList===null || (memberList!=undefined && memberList.find(v=>v.user==auth.user?.id)==undefined))\r\n          back()\r\n      }, [memberList])\r\n      useEffect(()=>{\r\n        if(channelList===null || (channelList!=undefined && channel==undefined))\r\n            back()\r\n      }, [channelList])\r\n}","import React from \"react\"\r\nimport CommonSection from \"../../../components/CommonSection\"\r\nimport Colors from \"../../../constants/Colors\"\r\nimport useColorScheme, { setColorScheme } from \"../../../hooks/useColorScheme\"\r\nimport { StyleSheet, Text, View} from 'react-native';\r\nimport useLangContext from \"../../../hooks/useLangContext\";\r\nimport { useColorScheme as useConfigColorScheme} from 'react-native-appearance';\r\nimport useFirebaseContext from \"../../../hooks/useFirebaseContext\";\r\nimport TextButton from \"../../../components/TextButton\";\r\nimport useModalsContext from \"../../../hooks/useModalsContext\";\r\nimport RegistrationModal from \"../../../modals/RegistrationModal\";\r\nimport useAuthContext from \"../../../hooks/useAuthContext\";\r\n\r\n\r\nconst ConfigSection = ({title, children}:{title:string, children?: React.ReactNode})=>{\r\n  const theme = useColorScheme()\r\n  const color = Colors[theme].text\r\n  return <CommonSection bodyStyle={{alignItems:'flex-start', backgroundColor:theme=='light'?'transparent':\"black\"}}>\r\n    <Text style={{fontSize:20, color, fontWeight:'600'}}>{title}</Text>\r\n    {children}\r\n  </CommonSection>\r\n}\r\n\r\nexport default ()=>{\r\n  const { lang, locale, setLocale } = useLangContext()\r\n  const { setModal } = useModalsContext()\r\n  const {auth} = useAuthContext()\r\n  const theme = useColorScheme()\r\n  const configTheme = useConfigColorScheme()\r\n  const {enable:noti, setEnable:setNoti} = useFirebaseContext()\r\n  const color = Colors[theme].text\r\n  return <>\r\n    <ConfigSection title={lang('* Notification Settings')}>\r\n      <View style={{flexDirection:'row'}}>\r\n        {[[lang('On'), true], [lang('Off'), false]].map(([title, n])=><TextButton\r\n          key={title} title={title || ''} textStyle={{fontSize:16, color, textDecorationLine:noti==n?'underline':'none'}} style={{borderRadius:20}} onPress={()=>{setNoti(n)}}/>)}\r\n      </View>\r\n    </ConfigSection>\r\n    <ConfigSection title={lang('* Language Settings')}>\r\n    <View style={{flexDirection:'row'}}>\r\n        {[[lang('Auto'), 'auto'], ['한국어', 'ko'], ['English', 'en']].map(([title, l])=><TextButton \r\n          key={title} title={title || ''} textStyle={{fontSize:16, color, textDecorationLine:locale==l?'underline':'none'}} style={{borderRadius:20}} onPress={()=>setLocale(l)}/>)}\r\n      </View>\r\n    </ConfigSection>\r\n    <ConfigSection title={lang('* Skin Settings')}>\r\n      <View style={{flexDirection:'row'}}>\r\n        {[[lang('Auto'), 'no-preference'], [lang('Light'), 'light'], [lang('Dark'), 'dark']].map(([title, colorScheme])=><TextButton \r\n          key={title} title={title} textStyle={{fontSize:16, color, textDecorationLine:configTheme==colorScheme?'underline':'none'}} style={{borderRadius:20}} onPress={(\r\n            )=>setColorScheme(colorScheme)}/>)}\r\n      </View>\r\n    </ConfigSection>\r\n  </>\r\n}","import React, {useState, useEffect, useLayoutEffect, useRef} from 'react';\r\nimport { StackNavigationProp, StackScreenProps } from '@react-navigation/stack';\r\nimport { View, ScrollView, useWindowDimensions} from 'react-native';\r\nimport { Text as StyledText } from 'react-native-paper';\r\nimport { Text } from '../../../components/Themed'\r\nimport useResizeContext from '../../../hooks/useResizeContext';\r\nimport TabView from '../../../components/TabView';\r\nimport HeaderRight from '../../../components/HeaderRight';\r\nimport TextButton from '../../../components/TextButton';\r\nimport Colors from '../../../constants/Colors';\r\nimport useColorScheme  from '../../../hooks/useColorScheme';\r\nimport useModalsContext from '../../../hooks/useModalsContext';\r\nimport ChannelEditModal from '../../../modals/ChannelEditModal';\r\nimport useLangContext from '../../../hooks/useLangContext';\r\nimport ContractFooter from '../../../components/ContractFooter';\r\nimport { MessengerChannel, TabViewRecord, UserMembership } from '../../../types';\r\nimport useAuthContext from '../../../hooks/useAuthContext';\r\nimport useUserMembershipList from '../../../hooks/lists/useUserMembershipList';\r\nimport { FontAwesome, Ionicons, MaterialCommunityIcons, SimpleLineIcons } from '../../../lib/@expo/vector-icons';\r\nimport { useMessengerChannelSorted } from '../../../hooks/lists/useMessengerChannelList';\r\nimport CommonItem from '../../../components/CommonItem';\r\nimport MemberItem from '../../../components/MemberItem';\r\nimport ProfileModal from '../../../modals/ProfileModal';\r\nimport { navigate } from '../../../navigation';\r\nimport CommonSection from '../../../components/CommonSection';\r\nimport ConfigSections from './ConfigSections';\r\nimport Avatar, { avatarFromChannel } from '../../../components/Avatar';\r\nimport RegistrationModal from '../../../modals/RegistrationModal';\r\nimport { useNavigation } from '@react-navigation/native';\r\nimport { regexForStripHTML } from \"../../../components/EditorHtml\"\r\n\r\nconst useHeaderSetter = (options:any[]) =>{\r\n  const tempref = useRef<NodeJS.Timer>()\r\n  const indexRef = useRef<number>()\r\n  const {width } = useWindowDimensions()\r\n  const navigation = useNavigation()\r\n  useEffect(()=>{\r\n    return ()=>{\r\n      clearInterval(tempref.current)\r\n    }\r\n  }, [])\r\n  return (ref:any)=>{\r\n      clearInterval(tempref.current)\r\n      /*@ts-ignore */\r\n      tempref.current=setInterval(()=>{ref?.measure((fx, fy, _, height, px, py)=>{\r\n        const i = Math.round(-px/width)\r\n        if (indexRef.current != i){\r\n          indexRef.current = i\r\n          navigation.setOptions(options[i])\r\n        }\r\n      })\r\n    }, 300)\r\n  }\r\n}\r\n\r\nconst renderIndexDetector= (Component:React.ComponentType<any>, headerIndexRef:(ref:any)=>void)=>{\r\n  return (props:any)=><View style={{flex:1}} ref={headerIndexRef}>\r\n    <Component {...props}/>\r\n  </View>\r\n}\r\n\r\nconst MemberTabView = ()=>{\r\n  const {auth} = useAuthContext()\r\n  const theme = useColorScheme()\r\n  const { setModal } = useModalsContext()\r\n  const userList = useUserMembershipList(auth)\r\n  const memberItem = React.useMemo(\r\n      ()=>userList && userList.map((item, index)=><MemberItem key={index} member={item} onPress={()=>setModal(ProfileModal, {id:item.id})}/>), [userList])\r\n  return <ScrollView style={{flex:1, backgroundColor:Colors[theme].background}}>\r\n      {memberItem}\r\n  </ScrollView>\r\n}\r\n\r\nconst MessengerTabView = ()=>{\r\n  const {auth} = useAuthContext()\r\n  const channelList = useMessengerChannelSorted('messenger', auth)\r\n  const theme = useColorScheme()\r\n\r\n  const today = (new Date()).toISOString().slice(0, 10)\r\n  return <ScrollView style={{flex:1, backgroundColor:Colors[theme].background}}>\r\n      {channelList?.map((item, index)=>{\r\n          const {avatar, name} = avatarFromChannel(item, auth.user)\r\n          const date = item.last_message?.created.slice(0,10)\r\n          const content = item.last_message?.preview_content || item.last_message?.content || ''\r\n          return <CommonItem key={index} bodyStyle={{flexDirection:'row', justifyContent:'space-between'}} onPress={()=>navigate(\"ChatScreen\", {id:item.id})}>\r\n              <View style={{flexDirection:'row', flexShrink:1}}>\r\n                  {avatar?\r\n                    <View style={{ marginRight:20}}>\r\n                      <Avatar name={avatar.name} size={44} userId={avatar.id}/>\r\n                    </View>:\r\n                    <FontAwesome size={40} color={Colors[theme].iconColor} style={{ marginBottom: -3, marginRight:20 }} name='users'/>}\r\n                  <View>\r\n                      <View style={{flexDirection:'row'}}>\r\n                          <Text style={{fontSize:18}}>{name}</Text>\r\n                          {item.type=='messenger' && <Text style={{fontSize:18, opacity: 0.4, paddingLeft:5}}>{item.member_count}</Text>}\r\n                      </View>\r\n                      <Text style={{fontSize:16, opacity: 0.4}}>{content.replaceAll('\\n', ' ')}</Text>\r\n                  </View>\r\n              </View>\r\n              <View>\r\n                  <Text style={{fontSize:14, opacity: 0.4, textAlign:'right'}}>{date==today?item.last_message?.created.slice(11,16):date}</Text>\r\n                  <Text style={{fontSize:14, textAlign:'right'}}>{item.unread_count?item.unread_count:' '}</Text>\r\n              </View>\r\n          </CommonItem>\r\n      })}\r\n  </ScrollView>\r\n}\r\n\r\nconst NoteTabView = ()=>{\r\n  const {auth} = useAuthContext()\r\n  const channelList = useMessengerChannelSorted('mycontent', auth)\r\n  const theme = useColorScheme()\r\n\r\n  const today = (new Date()).toISOString().slice(0, 10)\r\n  return <ScrollView style={{flex:1, backgroundColor:Colors[theme].background}} contentContainerStyle={{flexWrap:'wrap', flexDirection:'row'}}>\r\n      {channelList?.map((item, index)=>{\r\n          const date = item.last_message?.created.slice(0,10)\r\n          const content = (item.description || '').replaceAll(/<hr \\/>\\n/gi, '').replaceAll(/&nbsp;/gi, ' ').replaceAll(/<br\\/>/gi, '\\r\\n').replaceAll(regexForStripHTML, '')\r\n          const onPress = ()=>navigate(\"NoteScreen\", {id:item.id})\r\n          return <CommonItem key={index} outerContainerStyle={{flexBasis:'50%'}} onPress={onPress}>\r\n              {/* @ts-ignore */}\r\n              <CommonItem containerStyle={{marginHorizontal:0}} bodyStyle={{aspectRatio:1/Math.sqrt(2), borderRadius:6, borderWidth:1, wordBreak:'break-word', justifyContent:'flex-start', alignItems:'flex-start', overflow:'hidden'}} onPress={onPress}>\r\n                <Text style={{fontSize:16, opacity: 0.4}}>{content}</Text>\r\n              </CommonItem>\r\n              <View style={{flexDirection:'row', marginTop:10, justifyContent:'space-between', alignItems:'center', width:'100%'}}>\r\n                <Text style={{fontSize:18}}>{item.name}</Text>\r\n                <Text style={{fontSize:14, opacity: 0.4, textAlign:'right'}}>{date==today?item.last_message?.created.slice(11,16):date}</Text>\r\n                  \r\n              </View>\r\n          </CommonItem>\r\n      })}\r\n  </ScrollView>\r\n}\r\n\r\n\r\nconst ConfigTabView = ()=>{\r\n  const theme = useColorScheme()\r\n  return <ScrollView style={{flex:1, backgroundColor:Colors[theme].background}}>\r\n    <ConfigSections/>\r\n  </ScrollView>\r\n}\r\n\r\nconst getBottomTabs = (theme:'light'|'dark', headerSetter:(ref:any)=>void)=>{\r\n  const color = Colors[theme].iconColor\r\n  return {\r\n    OneTab:{\r\n        title:'member',\r\n        component:renderIndexDetector(MemberTabView, headerSetter),\r\n        icon:<MaterialCommunityIcons size={32} color={color} style={{ marginBottom: -3 }} name='account'/>,\r\n    },\r\n    TwoTab:{\r\n        title:'chat',\r\n        component:MessengerTabView,\r\n        icon:<Ionicons size={30} color={color} style={{ marginBottom: -3 }} name='chatbox'/>\r\n    },\r\n    ThreeTab:{\r\n      title:'note',\r\n      component:NoteTabView,\r\n      icon:<MaterialCommunityIcons size={32} color={color} style={{ marginBottom: -3 }} name='pencil-box'/>\r\n  },\r\n    FourTab:{\r\n        title:'config',\r\n        component:ConfigTabView,\r\n        icon:<SimpleLineIcons size={30} color={color} style={{ marginBottom: -3 }} name='options'/>\r\n    }\r\n  } as TabViewRecord\r\n}\r\n\r\n\r\nexport default function HomeScreen({navigation, route}: StackScreenProps<any, 'Home'>) {\r\n  const { lang, locale } = useLangContext()\r\n  const windowType = useResizeContext();\r\n  const theme = useColorScheme()\r\n  const { setModal } = useModalsContext()\r\n  const {auth} = useAuthContext()\r\n  const [ home, setHome ] = useState(windowType == 'landscape')\r\n  const color = Colors[theme].text\r\n  const options = [\r\n    {title:lang('member'), headerRight:()=><HeaderRight extra={[{title:lang('create'), onPress:()=>setModal(RegistrationModal, auth.user?.is_guest?{id:auth.user.id}:{})}]}/>},\r\n    {title:lang('chat'), headerRight:()=><HeaderRight extra={[{title:lang('create'), onPress:()=>setModal(ChannelEditModal, {type:'messenger'})}]}/>},\r\n    {title:lang('note'), headerRight:()=><HeaderRight extra={[{title:lang('create'), onPress:()=>setModal(ChannelEditModal, {type:'mycontent'})}]}/>},\r\n    {title:lang('config'), headerRight:()=><HeaderRight/>}\r\n  ]\r\n  const headerSetter = useHeaderSetter(options)\r\n  \r\n  useLayoutEffect(() => {\r\n    const index = route?.params?.tab | 0\r\n    navigation.setOptions(windowType == 'portrait'?options[index]:{\r\n      title: lang('home'),\r\n      headerRight: ()=><HeaderRight/>\r\n    });\r\n  }, [navigation, route, windowType, locale]);\r\n  useEffect(()=>{\r\n    setHome(windowType == 'landscape')\r\n  }, [windowType])\r\n  return home?\r\n    <ScrollView contentContainerStyle={{flex:1, alignItems:'center'}}>\r\n      <View style={{flexGrow:1, width:'80%', marginTop:72}}>\r\n        <StyledText style={{fontSize:32, color}}>Tokki Tok</StyledText>\r\n        <View style={{backgroundColor:Colors.borderColor, height:1, width:'100%'}}/>\r\n        {/* <Text style={{fontSize:20, color:'gray'}}>Welcome! This is a messenger for teams.</Text>*/}\r\n        <View style={{height:24}}/>\r\n        <CommonSection bodyStyle={{alignItems:'flex-start', backgroundColor:theme=='light'?'transparent':\"black\"}}>\r\n          <TextButton title={lang('+ New chat')} textStyle={{fontSize:20, color}} style={{paddingLeft:0, borderRadius:20}} onPress={()=>setModal(ChannelEditModal, {type:'messenger'})}/>\r\n        </CommonSection>\r\n        <ConfigSections/>\r\n      </View>\r\n      <ContractFooter theme={theme}/>\r\n    </ScrollView>:\r\n    <TabView tabs={getBottomTabs(theme, headerSetter)} tabBarPosition=\"bottom\" index={parseInt(route.params?.['tab'] || 0)} onTab={(index)=>{navigation.setParams({tab:index})}}/>\r\n}\r\n\r\n","import React from 'react';\r\nimport { Editor } from '@tinymce/tinymce-react';\r\nimport { EditorProps } from '../../types';\r\nconst INIT = require('../../../web/editor-config')\r\nconst PATH = process.env.PUBLIC_URL + '/tinymce/tinymce.min.js'\r\n\r\nexport default (props:EditorProps) => {\r\n\treturn <Editor\r\n        tinymceScriptSrc={PATH}\r\n        onInit={(e, editor) => {props.onReady?.()}}\r\n        onEditorChange={props.setValue}\r\n        init={{\r\n          setup:INIT.setup,\r\n          plugins: INIT.plugins,\r\n          toolbar: INIT.toolbar,\r\n          height: '100%',\r\n          skin: props.theme=='light'?'oxide':'oxide-dark',\r\n          content_css: props.theme=='light'?'default':'dark',\r\n          menubar: false,\r\n          branding: false,\r\n          statusbar: false,\r\n          block_formats: '제목1=h2;제목2=h3;제목3=h4;본문=p;',\r\n          fontsize_formats: '8pt 10pt 12pt 14pt 16pt 18pt 24pt',\r\n          forced_root_block_attrs: {'style': 'font-size: 14pt'}\r\n        }}\r\n        value={props.value}\r\n    />\r\n};\r\n","import React, { useState, useEffect } from 'react';\r\nimport { View } from 'react-native';\r\nimport Editor from '../lib/tinymce/Editor';\r\n// import Editor from '../lib/tinymce/EditorView';\r\nimport { EditorProps } from '../types';\r\n\r\nexport default (props:EditorProps & {active:boolean, children?:React.ReactNode}) => {\r\n\tconst [ready, setReady] = useState<boolean>(false)\r\n  useEffect(()=>{\r\n    if(!props.active)\r\n      setReady(false)\r\n  }, [props.active])\r\n  return props.active?(\r\n        <View style={{flex:1, height:'100%'}}>\r\n        {!ready && props.children}\r\n    \t  <Editor\r\n          theme={props.theme}\r\n          value={props.value}\r\n          setValue={props.setValue}\r\n          onReady={()=>{\r\n            if(!ready){\r\n              setReady(true); props.onReady?.()\r\n            }\r\n          }}/>\r\n      </View>\r\n    ):<>{props.children}</>;\r\n};\r\n","import React, { useState, useEffect } from \"react\"\r\nimport { TouchableOpacity } from \"react-native\"\r\nimport { Ionicons, MaterialCommunityIcons } from '../../../lib/@expo/vector-icons';\r\nimport useAuthContext from \"../../../hooks/useAuthContext\"\r\nimport useMessengerChannelList, { useMessengerChannelMutation } from \"../../../hooks/lists/useMessengerChannelList\"\r\nimport { View as ThemedView } from '../../../components/Themed' \r\nimport Colors from \"../../../constants/Colors\"\r\nimport useResizeContext from \"../../../hooks/useResizeContext\"\r\nimport Editor from \"../../../components/Editor\"\r\nimport useColorScheme from \"../../../hooks/useColorScheme\"\r\nimport CommonButton from \"../../../components/CommonButton\"\r\nimport useLangContext from \"../../../hooks/useLangContext\"\r\nimport EditorHtml from \"../../../components/EditorHtml\"\r\n\r\n\r\nexport default React.memo(({channel_id, disable, setDisable}:{channel_id:number, setDisable:(disable:boolean)=>void, disable?:boolean})=>{\r\n    const theme = useColorScheme()\r\n    const {auth} = useAuthContext()\r\n    const { lang } = useLangContext()\r\n    const windowType = useResizeContext()\r\n    const channelList = useMessengerChannelList('mycontent', auth)\r\n    const channelMutation = useMessengerChannelMutation('mycontent')\r\n    const channel = channelList?.find(v=>v.id==channel_id)\r\n    const [editable, setEditable] = useState(false)\r\n    const [description, setDescription] = useState('')\r\n    useEffect(()=>{\r\n        if (channel){\r\n          setDescription(channel?.description || '')\r\n        }\r\n    }, [channel?.id])\r\n    const onEdit = (auth.user?.id== channel?.owner.id)?()=>setEditable(true):undefined\r\n    return disable?\r\n    <ThemedView style={[\r\n        { aspectRatio:1/1.414, borderColor:Colors.borderColor, borderRadius:10},\r\n        windowType=='landscape'?{flexShrink:1, flexGrow:0, height:'100%', borderLeftWidth:1, paddingBottom:65}:{maxHeight:'36%', width:'100%', borderBottomWidth:1}\r\n    ]}>\r\n        <ThemedView style={{margin:20, flex:1}}>\r\n            <EditorHtml content={description} />\r\n        </ThemedView>\r\n        <ThemedView style={[\r\n                {position:'absolute', alignItems:'center', justifyContent:'flex-end', width:'100%',flexDirection:'row'},\r\n                windowType=='landscape'?{bottom:0, paddingTop:15, paddingBottom:10, paddingHorizontal:19}:{backgroundColor:'transparent'}\r\n            ]}>\r\n            <CommonButton title={''} style={{height:40, paddingTop:8}} onPress={()=>setDisable(false)}>\r\n                <MaterialCommunityIcons size={20} style={{ marginBottom: -3 }} name='card-text'/>\r\n            </CommonButton>\r\n        </ThemedView>\r\n    </ThemedView>:\r\n    <ThemedView style={{width:\"100%\", height:\"100%\"}}>\r\n        {editable?<>\r\n            <Editor theme={theme} active={!disable} value={description} setValue={setDescription}/>\r\n            <CommonButton title={lang('save')} onPress={()=>{\r\n                if(auth?.user?.id && auth.groupId){\r\n                    channelMutation.update({id:channel_id, description}).then(()=>{\r\n                        setEditable(false)\r\n                    })\r\n                }\r\n                }}\r\n                style={{height:65, paddingVertical:20}}\r\n            /></>:\r\n            <>\r\n            <TouchableOpacity style={{margin:20, flex:1}} onPress={onEdit} onLongPress={onEdit}>\r\n                <EditorHtml content={description}/>\r\n            </TouchableOpacity>\r\n            <ThemedView style={[\r\n                {position:'absolute', alignItems:'center', justifyContent:'flex-end', width:'100%',flexDirection:'row'},\r\n                windowType=='landscape'?{bottom:0, paddingTop:15, paddingBottom:10, paddingHorizontal:19}:{backgroundColor:'transparent'}\r\n            ]}>\r\n            {onEdit && <CommonButton title={''} style={{height:40, paddingTop:8}} onPress={onEdit}>\r\n                <MaterialCommunityIcons size={20} style={{ marginBottom: -3 }} name='pencil-box'/>\r\n            </CommonButton>}\r\n            <CommonButton title={''} style={{height:40, paddingTop:8}} onPress={()=>setDisable(true)}>\r\n                <Ionicons size={20} style={{ marginBottom: -3 }} name='chatbox'/>\r\n            </CommonButton>\r\n        </ThemedView>\r\n            </>}\r\n    </ThemedView>\r\n  })","import LoginScreen from \"./login/LoginScreen\";\r\nimport DemoScreen from \"./login/DemoScreen\";\r\nimport ChatScreen from \"./main/ChatScreen\";\r\nimport HomeScreen from \"./main/HomeScreen\";\r\nimport NoteScreen from \"./main/NoteScreen\";\r\n// import BoardEditScreen from \"../lib/blacktokki-board/BoardEditScreen\";\r\nimport { Screens } from \"../types\";\r\n\r\nexport const main = {\r\n    HomeScreen:{\r\n        title:'home',\r\n        component:HomeScreen,\r\n        path:'home',\r\n    },\r\n    ChatScreen:{\r\n        title:'chat',\r\n        component:ChatScreen,\r\n        path:'chat'\r\n    },\r\n    NoteScreen:{\r\n        title:'note',\r\n        component:NoteScreen,\r\n        path:'mynote'\r\n    },\r\n} as Screens\r\n\r\nexport const login = {\r\n    LoginScreen:{\r\n        path: 'login',\r\n        title: 'Sign in',\r\n        component:LoginScreen\r\n    },\r\n    DemoScreen:{\r\n        title:'',\r\n        component:DemoScreen,\r\n        path:'demo'\r\n    }\r\n} as Screens\r\n\r\nexport const modal = {\r\n    // BoardEditScreen:{\r\n    //     title:'board',\r\n    //     component:BoardEditScreen,\r\n    //     path:'modal/board'\r\n    // },\r\n} as Screens","import React, { useState} from 'react';\r\nimport { StackScreenProps } from '@react-navigation/stack';\r\nimport { View } from 'react-native';\r\nimport VideoCallSection from './VideoCallSection';\r\nimport useResizeContext from '../../../hooks/useResizeContext';\r\nimport useLangContext from '../../../hooks/useLangContext';\r\nimport CommonChatSection from '../CommonChatSection';\r\nimport useChatSection from '../../../hooks/useChatSection';\r\n\r\n\r\nexport default function ChatScreen({navigation, route}: StackScreenProps<any, 'Chat'>) {\r\n  const channel_id = route?.params?.id\r\n  const windowType = useResizeContext()\r\n  const { lang } = useLangContext()\r\n  const [videoMode, setVideoMode] = useState<boolean>(false)\r\n  useChatSection(navigation, route, channel_id, 'messenger', true)\r\n  \r\n  return <View style={[\r\n    {flex:1, alignItems:'center'},\r\n    windowType=='landscape'?{flexDirection:'row-reverse', minWidth:480}:{flexDirection:'column'}\r\n  ]}>\r\n    <VideoCallSection channel_id={channel_id} setDisable={(d)=>setVideoMode(!d)} disable={!videoMode}/>\r\n    <CommonChatSection \r\n      channel_id={channel_id} \r\n      style={[videoMode?{flexShrink:1}:{flex:1}, windowType=='landscape'?{minWidth:320, height:'100%'}:{width:'100%'}]}\r\n      extraButtons={[{title:`📹\\n ${lang('Video Call')}`, onPress:()=>setVideoMode(!videoMode), disabled:videoMode}]}\r\n    />\r\n  </View>\r\n}","import React, { useState } from 'react';\r\nimport { View } from 'react-native';\r\nimport { StackScreenProps } from '@react-navigation/stack';\r\nimport useResizeContext from '../../../hooks/useResizeContext';\r\nimport CommonChatSection from '../CommonChatSection';\r\nimport useChatSection from '../../../hooks/useChatSection';\r\nimport EditorSection from './EditorSection';\r\n\r\n\r\nexport default function NoteScreen({navigation, route}: StackScreenProps<any, 'Chat'>) {\r\n  const channel_id = route?.params?.id\r\n  const windowType = useResizeContext()\r\n  const [editMode, setEditMode] = useState<boolean>(true)\r\n  useChatSection(navigation, route, channel_id, 'mycontent', true)\r\n  return <View style={[\r\n        {flex:1, alignItems:'center'},\r\n        windowType=='landscape'?{flexDirection:'row-reverse', minWidth:480}:{flexDirection:'column'}\r\n      ]}>\r\n    <EditorSection channel_id={channel_id}  setDisable={(d)=>setEditMode(!d)} disable={!editMode}/>\r\n    {editMode==false && <CommonChatSection\r\n        channel_id={channel_id}\r\n        style={[{flex:1}, windowType=='landscape'?{minWidth:320, height:'100%'}:{width:'100%'}]}\r\n    />}\r\n  </View>\r\n}","import React, { useLayoutEffect } from 'react';\r\n\r\nimport { StackScreenProps } from '@react-navigation/stack';\r\nimport useAuthContext from '../../hooks/useAuthContext';\r\n\r\nexport default function DemoScreen({navigation}: StackScreenProps<any, 'Demo'>) {\r\n    const {dispatch} = useAuthContext()\r\n    useLayoutEffect(() => {\r\n        navigation.setOptions({headerRight: undefined});\r\n        dispatch({type:\"LOGIN_GUEST\"})\r\n    }, []);\r\n  return <></>\r\n};","import React, { Suspense, useState } from 'react';\r\nimport CommonButton from '../components/CommonButton';\r\nimport useModalsContext from '../hooks/useModalsContext';\r\nimport { Text, View } from '../components/Themed';\r\nimport useLangContext from '../hooks/useLangContext';\r\nimport { Ionicons } from '../lib/@expo/vector-icons';\r\nimport { TouchableOpacity } from 'react-native-gesture-handler';\r\nimport Colors from '../constants/Colors';\r\nimport useColorScheme from '../hooks/useColorScheme';\r\nimport { BottomSheet } from '../components/ModalSection';\r\nimport dayjs from 'dayjs';\r\nimport useModalEffect from '../hooks/useModalEffect';\r\n\r\nconst dayTypes = ['AM', 'PM'].map(value=>({label:value, value}))\r\nconst hours = [...Array(12).keys()].map((value, index)=>(index + 1).toString().padStart(2, '0')).map(value=>({label:value, value}))\r\nconst minutes = [...Array(12).keys()].map((value, index)=>(index * 5).toString().padStart(2, '0')).map(value=>({label:value, value}))\r\n\r\n\r\nconst getDisableDays=(date:dayjs.Dayjs)=>{\r\n  let startDate = date.clone().startOf('month').add(-1, 'month')\r\n  const endDate = date.clone().endOf('month').add(1, 'month')\r\n  const today = dayjs().startOf('day')\r\n  const result = []\r\n  while(startDate<=endDate && startDate<today){\r\n    result.push(startDate.format('YYYY-MM-DD'))\r\n    startDate = startDate.add(1, 'day')\r\n  }\r\n  return result\r\n}\r\n\r\nconst defaultDayjs = ()=>{\r\n  const m = dayjs()\r\n  const restMinute = parseInt(m.format('mm')) % 5\r\n  return m.add(5-restMinute, 'minute')\r\n}\r\n\r\nconst Calendar = React.lazy(()=> import('../components/Calendar'))\r\nconst CommonPicker = React.lazy(()=>import('../components/CommonPicker'))\r\n\r\nexport default function DateTimePickerModal({datetime, callback}:{datetime?:string, callback:(datetime?:string)=>void}) {\r\n  const _dayjs = datetime?dayjs(datetime):defaultDayjs()\r\n  const { lang, locale } = useLangContext()\r\n  const theme = useColorScheme()\r\n  const [date, setDate] = useState(_dayjs.format('YYYY-MM-DD'));\r\n  const [dayType, setDayType] = useState(_dayjs.locale('en').format('A'))\r\n  const [hour, setHour] = useState(_dayjs.format('hh'))\r\n  const [minute, setMinute] = useState(_dayjs.format('mm'))\r\n  const [disableDays, setDisableDays] = useState<string[]>(getDisableDays(_dayjs))\r\n  const { setModal } = useModalsContext()\r\n  const back = ()=>{\r\n    setModal(DateTimePickerModal, null)\r\n  }\r\n  useModalEffect(back, [])\r\n  return <BottomSheet>\r\n    <View style={{flexDirection:'row', width:'100%'}}>\r\n      <View style={{flex:1, flexDirection:'row'}}>\r\n        <TouchableOpacity onPress={back}>\r\n          <Ionicons size={20} name=\"arrow-back\" color={Colors[theme].text}/>\r\n        </TouchableOpacity>\r\n      </View>\r\n      <View style={{flex:1}}>\r\n        <Text style={{fontSize:20, textAlign:'center'}}>{lang('Date & Time')}</Text>\r\n      </View>\r\n      <View style={{flex:1}}/>\r\n    </View>\r\n    <View style={{marginBottom: 20, height: 1, width: '100%'}} lightColor=\"#ddd\" darkColor=\"rgba(255,255,255, 0.3)\" />\r\n    <Suspense fallback={<></>}>\r\n      <Calendar\r\n        locale={locale}\r\n        style={undefined} \r\n        setDate={setDate}\r\n        disableAllTouchEventsForDisabledDays={true}\r\n        onMonthChange={(v)=>setDisableDays(getDisableDays(dayjs(v.dateString)))}\r\n        markedDates={{\r\n          ...disableDays.reduce((p, c)=>{p[c]={disabled:true};return p}, {} as Record<string, any>),\r\n          ...(date?[date]:[]).reduce((p, c)=>{p[c]={selected:true};return p}, {} as Record<string, any>)\r\n        }}\r\n      />\r\n      <View style={{flexDirection:'row', paddingVertical:10, width:400, height:50}}>\r\n        <CommonPicker value={dayType} setValue={setDayType} values={dayTypes}/>\r\n        <Text style={{fontSize:20}}> </Text>\r\n        <CommonPicker value={hour} setValue={setHour} values={hours}/>\r\n        <Text style={{fontSize:20}}> : </Text>\r\n        <CommonPicker value={minute} setValue={setMinute} values={minutes}/>\r\n      </View>\r\n    </Suspense>\r\n    <View style={{flexDirection:'row'}}>\r\n      <CommonButton title={lang('save')} onPress={()=>{\r\n        callback?.(dayjs(`${date} ${hour}:${minute} ${dayType}`).toISOString())\r\n        back()\r\n      }}/>\r\n      <CommonButton title={lang('cancel')} onPress={()=>{\r\n        callback?.(undefined)\r\n        back()\r\n      }}/>\r\n      \r\n    </View>\r\n  </BottomSheet>\r\n}\r\n","import React from \"react\"\r\nimport { StyleProp, TextStyle } from \"react-native\";\r\nimport Hyperlink from \"react-native-hyperlink\";\r\nimport { Text } from \"../Themed\";\r\n\r\ntype MessageContentProps = {textStyle?:StyleProp<TextStyle>, selectable?:boolean, onPressLink?:any}\r\n\r\nconst MessageContentView = (props:MessageContentProps  & {content?:string})=>{\r\n    /* @ts-ignore */\r\n    return <Hyperlink linkDefault={ true } style={{wordBreak:\"break-word\"}} linkStyle={{color: '#12b886'}} onPress={props.onPressLink}>\r\n        <Text selectable={props.selectable} style={props.textStyle}>{props.content}</Text>\r\n    </Hyperlink>\r\n}\r\n\r\nexport default MessageContentView","import React from 'react';\r\nimport Clipboard from '@react-native-clipboard/clipboard/dist';\r\nimport CommonButton from '../components/CommonButton';\r\nimport useModalsContext from '../hooks/useModalsContext';\r\nimport { Text, View } from '../components/Themed';\r\nimport useLangContext from '../hooks/useLangContext';\r\nimport { BottomSheet } from '../components/ModalSection';\r\nimport { TouchableOpacity } from 'react-native-gesture-handler';\r\nimport Colors from '../constants/Colors';\r\nimport { Ionicons } from '../lib/@expo/vector-icons';\r\nimport useColorScheme from '../hooks/useColorScheme';\r\nimport { useMessengerContentMutation } from '../hooks/lists/useMessengerContentList';\r\nimport useModalEffect from '../hooks/useModalEffect';\r\nimport { MessengerContent } from '../types';\r\n\r\n\r\n\r\nexport default function MessageModal({content, isOwner, sendToScreen}:{content:MessengerContent, isOwner:boolean, sendToScreen?:(e:{value:string, editorValue:string})=>void}) {\r\n  const message = content.message_set[0]\r\n  const { lang } = useLangContext()\r\n  const { setModal } = useModalsContext()\r\n  const theme = useColorScheme()\r\n  const contentMutation = useMessengerContentMutation()\r\n  const back = ()=>{\r\n    setModal(MessageModal, null)\r\n  }\r\n  useModalEffect(back, [])\r\n  return <BottomSheet>\r\n    <View style={{flexDirection:'row', width:'100%'}}>\r\n      <View style={{flex:1, flexDirection:'row'}}>\r\n        <TouchableOpacity onPress={back}>\r\n          <Ionicons size={20} name=\"arrow-back\" color={Colors[theme].text}/>\r\n        </TouchableOpacity>\r\n      </View>\r\n      <View style={{flex:1}}>\r\n        <Text style={{fontSize:20, textAlign:'center'}}>{lang('Message')}</Text>\r\n      </View>\r\n      <View style={{flex:1}}/>\r\n    </View>\r\n    <View style={{marginBottom: 20, height: 1, width: '100%'}} lightColor=\"#ddd\" darkColor=\"rgba(255,255,255, 0.3)\" />\r\n      <CommonButton style={{height:40, width:'100%', maxWidth:320, justifyContent:'center'}} title={lang('copy')} onPress={()=>{Clipboard.setString(message.content);back()}}/>\r\n      {isOwner && content.timer && <CommonButton style={{height:40, width:'100%', maxWidth:320, justifyContent:'center'}} textStyle={{color:'red'}} title={lang('delete timer')} onPress={()=>{contentMutation.patch({id:content.id, timer:null});back()}}/>}\r\n      {isOwner && <CommonButton style={{height:40, width:'100%', maxWidth:320, justifyContent:'center'}} textStyle={{color:'red'}} title={lang('delete')} onPress={()=>{contentMutation.patch({id:content.id, is_archive:true});back()}}/>}\r\n  </BottomSheet>\r\n}\r\n","import React from 'react';\r\nimport CommonButton from '../components/CommonButton';\r\nimport useModalsContext from '../hooks/useModalsContext';\r\nimport { Text, View } from '../components/Themed';\r\nimport useLangContext from '../hooks/useLangContext';\r\nimport { Ionicons } from '../lib/@expo/vector-icons';\r\nimport { TouchableOpacity } from 'react-native-gesture-handler';\r\nimport Colors from '../constants/Colors';\r\nimport useColorScheme from '../hooks/useColorScheme';\r\nimport { BottomSheet } from '../components/ModalSection';\r\nimport useModalEffect from '../hooks/useModalEffect';\r\nimport useAuthContext from '../hooks/useAuthContext';\r\nimport { useMessengerChannelSorted } from '../hooks/lists/useMessengerChannelList';\r\nimport CommonItem from '../components/CommonItem';\r\n\r\nexport default function NotePickerModal({callback}:{callback:(editor:number)=>void}) {\r\n  const { lang } = useLangContext()\r\n  const theme = useColorScheme()\r\n  const {auth} = useAuthContext()\r\n  const { setModal } = useModalsContext()\r\n  const channelList = useMessengerChannelSorted('mycontent', auth);\r\n  const back = ()=>{\r\n    setModal(NotePickerModal, null)\r\n  }\r\n  useModalEffect(back, [])\r\n  return <BottomSheet>\r\n    <View style={{flexDirection:'row', width:'100%'}}>\r\n      <View style={{flex:1, flexDirection:'row'}}>\r\n        <TouchableOpacity onPress={back}>\r\n          <Ionicons size={20} name=\"arrow-back\" color={Colors[theme].text}/>\r\n        </TouchableOpacity>\r\n      </View>\r\n      <View style={{flex:1}}>\r\n        <Text style={{fontSize:20, textAlign:'center'}}>{lang('Note')}</Text>\r\n      </View>\r\n      <View style={{flex:1}}/>\r\n    </View>\r\n    <View style={{marginBottom: 20, height: 1, width: '100%'}} lightColor=\"#ddd\" darkColor=\"rgba(255,255,255, 0.3)\" />\r\n    <View style={{flex:1}}>\r\n        {channelList?.map((item, index)=>{\r\n          return <CommonItem key={index} containerStyle={{marginHorizontal:0}} bodyStyle={{alignItems:'flex-start'}} onPress={()=>{\r\n            item.id && callback?.(item.id)\r\n            back()\r\n          }}>\r\n            <Text style={{marginLeft:20}}>{item.name}</Text>\r\n          </CommonItem>\r\n        })}\r\n      </View>\r\n    <View style={{flexDirection:'row'}}>\r\n      <CommonButton title={lang('cancel')} onPress={()=>{\r\n        back()\r\n      }}/>\r\n      \r\n    </View>\r\n  </BottomSheet>\r\n}\r\n","import { useQuery } from \"react-query\";\r\nimport { getExternalMembershipList } from \"../../services\";\r\n\r\nexport default function useExternalMembershipList(keyword?:string){\r\n  const { data } = useQuery([\"UserMembershipList\", keyword] , async()=>keyword?(await getExternalMembershipList(keyword)):[])\r\n  return data\r\n}","import React from 'react';\r\nimport { StyleProp, TextStyle } from 'react-native';\r\nimport { CustomTextInputProps } from '../types';\r\nimport CommonTextInput from './CommonTextInput';\r\nimport RowField from './RowField';\r\n\r\nexport default function TextField(props:CustomTextInputProps & {name: string, width?:any, textStyle?:StyleProp<TextStyle>}) {\r\n  return (\r\n    <RowField name={props.name} width={props.width} textStyle={props.textStyle}>\r\n      <CommonTextInput {...props} />\r\n   </RowField>\r\n  )\r\n}","import React, { useState } from 'react';\r\nimport { TextInput } from 'react-native';\r\nimport Colors from '../constants/Colors';\r\nimport useColorScheme from '../hooks/useColorScheme';\r\nimport { CustomTextInputProps } from '../types';\r\n\r\nexport default (props:CustomTextInputProps)=>{\r\n    const [contentHeight, setContentHeight] = useState<number>()\r\n    const minHeight = props.minHeight || 30\r\n    const theme = useColorScheme()\r\n    return <TextInput style={[{\r\n            borderColor:'#d0d7de', \r\n            fontSize:16, \r\n            borderWidth:1, \r\n            borderRadius:6, \r\n            paddingHorizontal:10, \r\n            paddingVertical:3, \r\n            backgroundColor:Colors[theme].background,\r\n            color:Colors[theme].text,\r\n            height:props.multiline?contentHeight:minHeight,\r\n        }, props.style]}\r\n        placeholder={props.placeholder}\r\n        editable={!props.disabled} \r\n        keyboardType={props.keyboardType}\r\n        secureTextEntry={props.secureTextEntry}\r\n        value={props.value}\r\n        onChangeText={props.setValue}\r\n        onContentSizeChange={props.multiline?(e) => {\r\n            const newHeight = Math.max(e.nativeEvent.contentSize.height, minHeight) + 2\r\n            if(contentHeight==null || contentHeight +1 < newHeight){\r\n                setContentHeight(newHeight)\r\n            }\r\n        }:undefined}\r\n        \r\n        onBlur={()=>props.onBlur?.(props.value)}\r\n        onEndEditing={()=>props.onEndEditing?.(props.value)}\r\n        multiline={props.multiline}\r\n    />\r\n}","import React from \"react\"\r\nimport CommonItem from \"./CommonItem\"\r\nimport { UserMembership } from \"../types\"\r\nimport Avatar from \"./Avatar\"\r\nimport { Text, View } from \"./Themed\"\r\n\r\nexport default ({member:item, onPress}:{member:UserMembership, onPress?:()=>void})=> {\r\n    return <CommonItem key={item.id} bodyStyle={{flexDirection:'row', justifyContent:'flex-start'}} onPress={onPress}>\r\n        <View style={{marginTop:4, marginRight:12}}><Avatar name={item.name} userId={item.id} size={44}/></View>\r\n        <Text style={{fontSize:20, fontWeight:'400'}}>{item.name}</Text>\r\n    </CommonItem>\r\n}","import React from 'react';\r\nimport useAuthContext from '../hooks/useAuthContext';\r\nimport CommonButton from '../components/CommonButton';\r\nimport useModalsContext from '../hooks/useModalsContext';\r\nimport { Text, View } from '../components/Themed';\r\nimport useLangContext from '../hooks/useLangContext';\r\nimport { BottomSheet } from '../components/ModalSection';\r\nimport useModalEffect from '../hooks/useModalEffect';\r\nimport RegistrationModal from './RegistrationModal';\r\n\r\n\r\nexport default function AlertModal({type}:{type:string}) {\r\n  const { lang } = useLangContext()\r\n  const { setModal } = useModalsContext()\r\n  const {auth, dispatch} = useAuthContext()\r\n  const back = ()=>{\r\n    setModal(AlertModal, null)\r\n  }\r\n  const messages = {\r\n    \"GUEST_LOGOUT\":{\r\n      message: 'Guest users cannot reconnect after logging out. Please create an account or log in.',\r\n      buttons:[\r\n        {\r\n          title: 'Create User',\r\n          onPress: ()=>{\r\n            setModal(RegistrationModal, {id:auth.user?.id})\r\n          }\r\n        },\r\n        {\r\n          title: 'sign out',\r\n          onPress: ()=>dispatch({type:\"LOGOUT_REQUEST\"})\r\n        }\r\n      ]\r\n    }\r\n  } as Record<string, {message:string, buttons:{title:string, onPress:()=>void}[]}>\r\n\r\n  useModalEffect(back, [])\r\n  return <BottomSheet>\r\n    <Text>{lang(messages[type].message)}</Text>\r\n    <View style={{width:'100%', flexDirection:'row', justifyContent:'flex-end'}}>\r\n    {messages[type].buttons.map((button, i)=><CommonButton key={i} style={{marginRight:10}} title={lang(button.title)} onPress={button.onPress}/>)}\r\n    <CommonButton title={lang('cancel')} onPress={()=>back()}/>\r\n    </View>\r\n  </BottomSheet>\r\n}\r\n","import React from 'react';\r\nimport {View} from 'react-native'\r\nimport {Text} from './Themed';\r\nimport { ProfileProps } from '../types';\r\nimport Avatar from './Avatar';\r\n\r\nexport default (props:ProfileProps)=>{\r\n    return <View style={{width:'100%', height:135, justifyContent:'space-evenly', alignItems:'center'}}>\r\n        <Avatar {...props} size={75}/>\r\n        <Text style={{fontWeight:'bold', fontSize:15}}>{props.name}</Text>\r\n        <Text style={{fontWeight:'normal', fontSize:14}}>{props.username}</Text>\r\n    </View>\r\n}","import React, { useState,  useEffect, createContext, useMemo, useRef, useContext } from \"react\"\r\nimport firebase from \"firebase/app\";\r\nimport \"firebase/messaging\";\r\nimport {FCM_PUBLIC_VAPID_KEY, FCM_API_KEY} from \"../constants/Envs\"\r\nimport { Notification as NotificationType, UserMembership } from \"../types\";\r\nimport { getNotification, postNotification, putNotification } from \"../services/notification\";\r\n\r\nconst firebaseConfig = require(\"../../web/firebase-config.js\")\r\n// Initialize Firebase\r\nconst key = firebaseConfig.messagingSenderId\r\nconst apiKeyEncrypted = (FCM_API_KEY as string).split('').map((v, i)=> (v.charCodeAt(0) ^ key.charCodeAt(i)).toString(16).padStart(2, '0')).join('')\r\nconst app = firebase.initializeApp({...firebaseConfig, apiKey:FCM_API_KEY});\r\n// const analytics = getAnalytics(app);\r\nconst messaging = firebase.messaging(app);\r\n\r\nmessaging.onMessage((payload) => {\r\n  if (!(\"Notification\" in window)) {\r\n    alert(\"This browser does not support desktop notification\");\r\n  }\r\n  else if (Notification.permission === \"granted\") {\r\n    const message_set = JSON.parse(payload.data['message_set'])[0]\r\n    new Notification(payload.data.channel_name, { body: `${payload.data.name}: ${message_set.content}` });\r\n  }\r\n});\r\n\r\nconst requestToken = async()=>{\r\n  const permission = await Notification.requestPermission();\r\n  if (permission === 'granted') {\r\n    const serviceWorkerRegistration = await navigator.serviceWorker.register(`${process.env.PUBLIC_URL}/firebase-messaging-sw.js?${apiKeyEncrypted}`)\r\n    console.log('[SW]: SCOPE: ', serviceWorkerRegistration.scope);\r\n    const currentToken = await messaging.getToken({serviceWorkerRegistration, vapidKey: FCM_PUBLIC_VAPID_KEY }).catch(\r\n      async()=>await messaging.getToken({serviceWorkerRegistration, vapidKey: FCM_PUBLIC_VAPID_KEY })\r\n    )\r\n    window.addEventListener('beforeunload', (event:any) => {\r\n      event.preventDefault();\r\n      serviceWorkerRegistration.unregister()\r\n    });\r\n    if (currentToken)\r\n      return currentToken\r\n  }\r\n  return null\r\n}\r\n\r\nconst FirebaseContext = createContext<{enable?:boolean, setEnable:(enable:boolean)=>void}>({setEnable:()=>{}});\r\n\r\nexport const FirebaseProvider = ({user, children}:{user?:UserMembership|null, children:React.ReactNode})=>{\r\n  const tokenRef = useRef<string|null>()\r\n  const [notification, setNotification] = useState<NotificationType|null>()\r\n  const enable = useMemo(()=>notification===undefined?undefined:(notification?.token?true:false), [notification])\r\n  const setEnable = (enable:boolean)=>{\r\n    if(user && notification){\r\n      putNotification({...notification, token:enable?(tokenRef.current==undefined?null:tokenRef.current):null}).then((noti)=>{\r\n        setNotification(noti)\r\n      })\r\n    }\r\n  }\r\n  useEffect(()=>{\r\n    let isMount = true;\r\n    if(user){\r\n      if (tokenRef.current ===undefined){\r\n        tokenRef.current = null\r\n        requestToken().then((t)=>{\r\n          tokenRef.current = t\r\n          if (notification){\r\n            putNotification({...notification, token:tokenRef.current}).then((noti)=>{\r\n              if(isMount)setNotification(noti)\r\n            })\r\n          }\r\n        });\r\n      }\r\n      if (notification===undefined){\r\n        getNotification(user.id).then((noti)=>{\r\n          if(isMount)setNotification(noti || null)\r\n        })\r\n      }\r\n      else if(notification===null){\r\n        postNotification({user:user.id, type:'WEB', token:null}).then((noti)=>{\r\n          if(isMount)setNotification(noti)\r\n        })\r\n      }\r\n      else if (notification.token && tokenRef.current && tokenRef.current != notification.token){\r\n        putNotification({...notification, token:tokenRef.current}).then((noti)=>{\r\n          if(isMount)setNotification(noti)\r\n        })\r\n      }\r\n    }\r\n    return ()=>{isMount=false}\r\n  }, [user, notification])\r\n  return <FirebaseContext.Provider value={{enable, setEnable}}>\r\n    {(enable!=undefined || user===null) && children}\r\n  </FirebaseContext.Provider>\r\n}\r\n\r\nexport default ()=>{\r\n  const {enable, setEnable} = useContext(FirebaseContext)\r\n  return {enable, setEnable}\r\n}\r\n","import React, { MutableRefObject } from 'react'\r\nimport { Image, Linking } from \"react-native\"\r\nimport { TouchableOpacity } from \"react-native-gesture-handler\"\r\nimport CommonSection from \"../CommonSection\"\r\nimport { View, Text } from \"../Themed\"\r\nimport { Link } from \"../../types\"\r\n\r\n\r\n\r\nexport default ({link, isMobile, touchableRef}:{link:Link, isMobile:boolean, touchableRef:MutableRefObject<()=>boolean>})=>{\r\n    return <CommonSection containerStyle={{marginHorizontal:0}} bodyStyle={{padding:0}}>\r\n    <TouchableOpacity \r\n        onPress={()=>touchableRef.current() && Linking.openURL(link.url)}\r\n        onLongPress={()=>{}}\r\n        style={{width:'100%', flexDirection:'row'}}\r\n    >\r\n        {link.image_url?<Image source={{uri:link.image_url}} resizeMode=\"cover\" style={{ width:'100%', maxWidth:isMobile?120:150, maxHeight:isMobile?120:150, borderWidth:1}}/>:undefined}\r\n        <View style={{flex:1, marginHorizontal:20}}>\r\n            <Text style={{fontSize:18}}>{link.title}</Text>\r\n            <Text style={{fontSize:14}}>{link.description}</Text>\r\n            <Text style={{fontSize:12}}>{link.url}</Text>\r\n        </View>\r\n    </TouchableOpacity>\r\n    </CommonSection>\r\n}","import React, { MutableRefObject } from 'react'\r\nimport { Image, Linking } from \"react-native\"\r\nimport {TouchableOpacity} from \"react-native-gesture-handler\"\r\nimport CommonSection from \"../CommonSection\"\r\nimport { FontAwesome } from '../../lib/@expo/vector-icons'; \r\nimport { View, Text } from \"../Themed\"\r\nimport { File } from \"../../types\"\r\nimport useColorScheme from '../../hooks/useColorScheme';\r\nimport Colors from '../../constants/Colors';\r\n\r\nfunction humanFileSize(size:number) {\r\n    var i = size == 0 ? 0 : Math.floor(Math.log(size) / Math.log(1024));\r\n    return (size / Math.pow(1024, i)).toFixed(2) + ' ' + ['B', 'kB', 'MB', 'GB', 'TB'][i];\r\n  }\r\n  \r\n\r\nexport default ({file, isMobile, showBorder, touchableRef}:{file:File, isMobile:boolean, showBorder:ConstrainBoolean, touchableRef:MutableRefObject<()=>boolean>})=>{\r\n    const theme = useColorScheme()\r\n    return <CommonSection containerStyle={{marginHorizontal:0}} bodyStyle={showBorder?{padding:10}:{borderWidth:0, padding:0}}>\r\n    <TouchableOpacity \r\n        onPress={()=>touchableRef.current() && Linking.openURL(file.file)} \r\n        onLongPress={()=>{}}\r\n        style={{flexDirection:'row', alignItems:'flex-start', width:'100%'}} \r\n    >\r\n        {   file.thumbnail?\r\n            <Image source={{uri:file.thumbnail}} resizeMode=\"cover\" style={{width:isMobile?120:150, height:isMobile?120:150, borderWidth:1}}/>:\r\n            <FontAwesome name=\"file-o\" size={20} color={Colors[theme].iconColor} />}\r\n        <View style={{flex:1, marginHorizontal:10}}>\r\n            <Text style={{fontSize:18}}>{file.filename}</Text>\r\n            <Text style={{fontSize:14}}>{humanFileSize(file.filesize)}</Text>\r\n        </View>\r\n    </TouchableOpacity>\r\n    </CommonSection>\r\n}","import React, { MutableRefObject } from 'react'\r\nimport { TouchableOpacity } from \"react-native-gesture-handler\"\r\nimport CommonSection from \"../CommonSection\"\r\nimport { MaterialCommunityIcons } from '../../lib/@expo/vector-icons'; \r\nimport useColorScheme from '../../hooks/useColorScheme';\r\nimport Colors from '../../constants/Colors';\r\nimport { View, Text } from \"../Themed\"\r\nimport { EditorContent } from \"../../types\"\r\nimport { navigate } from '../../navigation';\r\nimport { regexForStripHTML } from '../EditorHtml'\r\n\r\n\r\nexport default ({editor, touchableRef}:{editor:EditorContent, touchableRef:MutableRefObject<()=>boolean>})=>{\r\n    const theme = useColorScheme()\r\n    return <CommonSection containerStyle={{marginHorizontal:0}} bodyStyle={{padding:0}}>\r\n    <TouchableOpacity \r\n        onPress={()=>touchableRef.current() && navigate(\"NoteScreen\", {id:editor.url})}\r\n        onLongPress={()=>{}}\r\n        style={{width:'100%', flexDirection:'row'}}\r\n    >\r\n        <MaterialCommunityIcons size={20} name='card-text'/>\r\n        <View style={{flex:1, marginHorizontal:20}}>\r\n            <Text style={{fontSize:18}}>{editor.title}</Text>\r\n            <Text style={{fontSize:14}}>{editor.description.replaceAll(regexForStripHTML, '')}</Text>\r\n        </View>\r\n    </TouchableOpacity>\r\n    </CommonSection>\r\n}","import React, {useCallback, useMemo, useRef} from \"react\"\r\nimport { View, TouchableOpacity } from 'react-native';\r\nimport { FlatList } from \"react-native-gesture-handler\";\r\nimport { Auth } from \"../../hooks/useAuthContext\";\r\nimport useMessengerContentList, { MessengerContentPage } from \"../../hooks/lists/useMessengerContentList\"\r\nimport useIsMobile from \"../../hooks/useIsMobile\"\r\nimport useModalsContext from \"../../hooks/useModalsContext\"\r\nimport { Text } from '../Themed' \r\nimport Avatar from '../Avatar';\r\nimport LinkPreview from './LinkPreview';\r\nimport FilePreview from './FilePreview';\r\nimport MessageModal from '../../modals/MessageModal';\r\nimport CommonSection from \"../CommonSection\";\r\nimport { timerToString } from \"./TimerTags\";\r\nimport useViewerContentList from \"../../hooks/lists/useMessengerViewerList\";\r\nimport EditorPreview from \"./EditorPreview\";\r\nimport { MessengerContent } from \"../../types\";\r\nimport MessageContentView from \"./MessageContentView\";\r\n\r\nconst MessengerContentPageItem = React.memo((props:MessengerContentPage & {ownerId?:number, reverse?:boolean, getOnPress?:(content:MessengerContent)=>()=>void})=>{\r\n    const lastTouchRef = useRef(Date.now()) \r\n    const touchableRef = useRef(()=>{\r\n      return Date.now() - lastTouchRef.current > 350\r\n    })\r\n    const isMobile = useIsMobile()\r\n    let nextPage = props.next;\r\n      while(nextPage?.next && nextPage.current.length==0){\r\n        nextPage = nextPage.next\r\n      }\r\n      const nextContent = nextPage?.current[0]\r\n      return <View \r\n        style={{flexDirection: props.reverse?'column-reverse':'column'}}\r\n        onTouchMove={()=>{lastTouchRef.current=Date.now()}}\r\n      >  \r\n        {props.current.map((content, index2)=>{\r\n          const next = index2 + 1 < props.current.length?props.current[index2+1]:nextContent\r\n          const created:string = content.created.slice(0, 16)\r\n          const date = created.slice(0, 10)\r\n          const isSystem = content.user == null\r\n          const isFirst = next==undefined || (content.user != next.user || created != next.created.slice(0, 16))\r\n          const isSelf = props.ownerId == content.user\r\n          const dayChanged = next==undefined || date != next.created.slice(0, 10)\r\n          const message = content.message_set[0]\r\n          if (isSystem)\r\n            return <View key={content.id} style={{flexDirection:'row', justifyContent:'center', width:'100%', marginVertical:5}}>\r\n              <Text>{message.content}</Text>\r\n            </View>\r\n          return <View key={content.id}>\r\n            {dayChanged?<View style={{flexDirection:'row', justifyContent:'center', width:'100%'}}><Text>{date}</Text></View>:undefined}\r\n            <View key={content.id} style={{flexDirection:'row', justifyContent:isSelf?'space-between':'flex-start', width:'100%'}}>\r\n              {isFirst && !isSelf? <View style={{marginTop:3, marginLeft:12}}><Avatar name={content.name} userId={content.user} size={36}/></View>:<View style={{width:48}}/>}\r\n              <CommonSection autoScale outerContainerStyle={{maxWidth:'90%'}} title={isFirst?content.name:undefined} titleStyle={{flex:undefined}} bodyStyle={{padding:10}} subtitle={`${created.slice(11)}`}>\r\n                <TouchableOpacity onLongPress={props.getOnPress?.(content)}>\r\n                  {content.timer && <View style={{flexDirection:'row', alignItems:'stretch'}}>\r\n                    <Text style={{fontSize:12}}>⌚</Text>\r\n                    <Text style={{fontSize:12}} selectable={!isMobile}>{timerToString(content.timer)}</Text>\r\n                  </View>}\r\n                  <MessageContentView selectable={!isMobile} textStyle={{textAlign:isSelf?'right':'left'}} onPressLink={touchableRef.current()?undefined:()=>{}} content={message.content}/>\r\n                  {\r\n                    content.attatchment_set.map((attatchment, aIndex)=>{\r\n                      if (attatchment.type=='editor')\r\n                        return <EditorPreview key={aIndex} editor={attatchment} touchableRef={touchableRef}/>\r\n                      if (attatchment.type=='file')\r\n                        return <FilePreview key={aIndex} file={attatchment} isMobile={isMobile} showBorder={false} touchableRef={touchableRef}/>\r\n                      if (attatchment.type=='link')\r\n                        return <LinkPreview key={aIndex} link={attatchment} isMobile={isMobile} touchableRef={touchableRef}/>\r\n                    })\r\n                  }\r\n                </TouchableOpacity>\r\n              </CommonSection>\r\n            </View>\r\n          </View>\r\n        })}\r\n      </View>\r\n  \r\n  })\r\n\r\nexport default (props:{channel_id:number, auth?:Auth, reverse?:boolean, sendToScreen?:(e:any)=>void})=>{\r\n    const height = useRef(0)\r\n    const {data, fetchNextPage } = props.auth?useMessengerContentList(props.channel_id):useViewerContentList(props.channel_id)\r\n    const ownerId = useMemo(()=>props.auth?.user?.id, [props.auth])\r\n    const { setModal } = useModalsContext()\r\n    const getOnPress = (content: MessengerContent)=>()=>setModal(MessageModal, {content, isOwner:ownerId == content.user, sendToScreen:props.sendToScreen})\r\n    const renderItem = useCallback(({item, index}:{item:MessengerContentPage, index:number})=><MessengerContentPageItem \r\n      {...item} \r\n      ownerId={ownerId} \r\n      reverse={props.reverse}\r\n      getOnPress={getOnPress}  \r\n    />, [ownerId])\r\n    return <FlatList\r\n        style={{flexDirection: props.reverse?'column-reverse':'column'}}\r\n        contentContainerStyle={{padding:10, flexGrow:1, flexDirection: props.reverse?'column-reverse':'column'}}\r\n        data={data?.pages}\r\n        renderItem={renderItem}\r\n        onScroll={(e)=>{\r\n          if (e.nativeEvent.contentSize.height - height.current + (props.reverse?1:-1)*e.nativeEvent.contentOffset.y < 1)\r\n            fetchNextPage()\r\n        }}\r\n        onLayout={(p)=>{height.current = p.nativeEvent.layout.height}}\r\n      />\r\n}","import { useInfiniteQuery } from \"react-query\"\r\nimport { getMessengerContentList } from \"../../services\"\r\nimport { MessengerContentPage } from \"./useMessengerContentList\"\r\n\r\n\r\nexport default function useViewerContentList(channel_id:number){  \r\n  const { data, fetchNextPage } = useInfiniteQuery<MessengerContentPage>(\r\n    [\"ViewerContentList\", channel_id], \r\n    async({pageParam})=>getMessengerContentList(channel_id, pageParam, true).then(current=>({current})), \r\n    {\r\n      select:data=>{\r\n        if(data.pages.length > 1)\r\n          data.pages[data.pages.length - 2].next = data.pages[data.pages.length - 1]\r\n        return data;\r\n      },\r\n      getNextPageParam:(lastPage)=>lastPage?.current.length?lastPage.current[lastPage.current.length - 1].id:undefined,\r\n      refetchOnReconnect:false,\r\n      refetchOnWindowFocus:false,\r\n    }\r\n  )\r\n  return { data, fetchNextPage }\r\n}\r\n","import { useMemo, useReducer } from \"react\"\r\n\r\ntype LocalSearchAction = {type:string, keyword?:string}\r\n\r\ntype LocalSearchState ={active:boolean, keyword:string}\r\n\r\n\r\n\r\nconst localSearchReducer =(initialState:LocalSearchState, action:LocalSearchAction)=>{\r\n    switch (action.type){\r\n        case 'SEARCH':\r\n          return {\r\n            ...initialState,\r\n            keyword: action.keyword\r\n          } as LocalSearchState\r\n        case 'ENABLE_SEARCH':\r\n          return {\r\n            ...initialState,\r\n            active:true,\r\n          }\r\n        case 'DISABLE_SEARCH':\r\n            return{\r\n                ...initialState,\r\n                active:false,\r\n                keyword: ''\r\n            }\r\n        default:\r\n            throw new Error( `Unhandled action type: ${action.type}`)\r\n    }\r\n  }\r\n\r\n\r\nexport default function useLocalSearch<T>(target:T[], compare:(value:T, keyword:string)=>boolean) {\r\n  const [searchState, dispatch] = useReducer(localSearchReducer, {active:false, keyword:''})\r\n  const data = useMemo(()=>searchState.active?target.filter(v=>compare(v, searchState.keyword)):target, [searchState, target])\r\n  return {searchState, dispatch, data}\r\n}","\r\nimport React, {useState} from 'react';\r\nimport { StyleProp, TextStyle, View } from 'react-native';\r\nimport Clipboard from '@react-native-clipboard/clipboard';\r\nimport useLangContext from '../hooks/useLangContext';\r\nimport { CustomTextInputProps } from '../types';\r\nimport CommonButton from './CommonButton';\r\nimport RowField from './RowField';\r\nimport { Text } from './Themed';\r\nimport useResizeContext from '../hooks/useResizeContext';\r\n\r\nexport default function CopyField(props:CustomTextInputProps & {name: string, width?:any, textStyle?:StyleProp<TextStyle>}) {\r\n  const { lang } = useLangContext()\r\n  const windowType = useResizeContext()\r\n  const [copied, setCopied] = useState(false)\r\n  return (\r\n    <RowField name={props.name} width={props.width} textStyle={props.textStyle}>\r\n      <View style={{flexDirection:windowType=='landscape'?'row':'column', justifyContent:'space-between'}}>\r\n        <View style={{justifyContent:'center'}}>\r\n          <Text style={{fontSize:16}}>{props.value}</Text>\r\n        </View>\r\n        <View>\r\n          <CommonButton title={lang('copy')} onPress={()=>{Clipboard.setString(props.value);setCopied(true)}}/>\r\n          {copied && <Text style={{fontSize:12, alignSelf:'center', color:'red'}}>{lang(\"copied\")}</Text>}\r\n        </View>\r\n      </View>\r\n   </RowField>\r\n  )\r\n}","import React, {useRef,MutableRefObject, useMemo, useState, useEffect } from 'react';\r\nimport { View, Text } from '../components/Themed';\r\nimport useAuthContext from '../hooks/useAuthContext';\r\nimport useUserMembershipList from '../hooks/lists/useUserMembershipList';\r\nimport { TabViewRecord, UserMembership } from '../types';\r\nimport CommonButton from '../components/CommonButton';\r\nimport useMessengerMemberList, { useMessengerMemberMutation } from '../hooks/lists/useMessengerMemberList';\r\nimport useModalsContext from '../hooks/useModalsContext';\r\nimport useExternalMembershipList from '../hooks/lists/useExternalMembershipList';\r\nimport TextField from '../components/TextField';\r\nimport useLocalSearch from '../hooks/useLocalSearch';\r\nimport TabView from '../components/TabView';\r\nimport { FlatList } from 'react-native-gesture-handler';\r\nimport useLangContext from '../hooks/useLangContext';\r\nimport MemberItem from '../components/MemberItem';\r\nimport ModalSection from '../components/ModalSection';\r\nimport useModalEffect from '../hooks/useModalEffect';\r\nimport CopyField from '../components/CopyField';\r\n\r\nconst InviteItem = (props:{item:UserMembership, selectedRef:MutableRefObject<Set<number>>})=>{\r\n  const [selected, setSelected] = useState(props.selectedRef.current.has(props.item.id))\r\n  return <View style={selected?{borderWidth:1, borderColor:'blue'}:{}}>\r\n    <MemberItem member={props.item} onPress={()=>{\r\n      if (selected){\r\n        setSelected(false)\r\n        props.selectedRef.current.delete(props.item.id)\r\n      }\r\n      else{\r\n        setSelected(true)\r\n        props.selectedRef.current.add(props.item.id)\r\n      }\r\n    }}/>\r\n  </View>\r\n\r\n}\r\ntype InviteTabViewProps = {\r\n  id:number,\r\n  selectedRef:MutableRefObject<Set<number>>\r\n}\r\n\r\nconst GroupTabView = ({id, selectedRef}:InviteTabViewProps)=>{\r\n  const { lang } = useLangContext()\r\n  const {auth} = useAuthContext()\r\n  const { setModal } = useModalsContext()\r\n  const userList = useUserMembershipList(auth)\r\n  const memberList = useMessengerMemberList(id)\r\n  const messengerMemberMutation = useMessengerMemberMutation()\r\n  const rawData = useMemo(()=>{\r\n    const memberSet = new Set(memberList?.map(v=>v.user))\r\n    return userList?.filter(v=>!memberSet.has(v.id)) || []\r\n  }, [userList, memberList])\r\n  const {data, dispatch:dispatchKeyword, searchState} = useLocalSearch(rawData, (v, keyword)=>(v.username.includes(keyword) || v.name.includes(keyword)))\r\n  const search = (k:string)=>{\r\n    if (k?.length>0){\r\n      dispatchKeyword({type:'ENABLE_SEARCH'})\r\n      dispatchKeyword({type:'SEARCH', keyword:k})\r\n    }\r\n    else{\r\n      dispatchKeyword({type:'DISABLE_SEARCH'})\r\n    }\r\n  }\r\n  const back = ()=>{\r\n    setModal(InviteModal, null)\r\n  }\r\n  useModalEffect(back, [])\r\n  return <View style={{alignItems:'center', flex:1}}>\r\n    <View style={{'width': '100%', flex:1}}>\r\n      <TextField name={`${lang('Username')} & ${lang('Name')}`} placeholder={auth.user?.name} value={searchState.keyword} setValue={search} width={'80%'}/>\r\n      {id && data && <FlatList contentContainerStyle={{flexGrow:1}} data={data} renderItem={({item})=><InviteItem item={item} selectedRef={selectedRef}/>}/>}\r\n    </View>\r\n    <View style={[{width:'100%', flexDirection:'row', padding:10,}, {justifyContent:'flex-end'}]}>\r\n      <CommonButton title={lang('invite')} onPress={()=>{\r\n        messengerMemberMutation.invite({\r\n          channel_id:id,\r\n          user_ids:[...selectedRef.current]\r\n        }).then(back)\r\n      }}/>\r\n      <CommonButton title={lang('cancel')} onPress={back}/>\r\n    </View>\r\n  </View>\r\n}\r\n\r\nconst DELAY = 500\r\n\r\nconst ExternalMembershipTabView = ({id, selectedRef}:InviteTabViewProps)=>{\r\n  const { lang } = useLangContext()\r\n  const [value, setValue] = useState('')\r\n  const [keyword, setKeyword] = useState('')\r\n  const timeoutRef = useRef<NodeJS.Timeout>()\r\n  const {auth} = useAuthContext()\r\n  const { setModal } = useModalsContext()\r\n  const memberList = useMessengerMemberList(id)\r\n  const externalMemberList = useExternalMembershipList(keyword)\r\n  const data = useMemo(()=>{\r\n    const memberSet = new Set(memberList?.map(v=>v.user))\r\n    return externalMemberList?.filter(v=>!memberSet.has(v.id)) || []\r\n  }, [externalMemberList, memberList])\r\n  const messengerMemberMutation = useMessengerMemberMutation()\r\n  useEffect(()=>{\r\n    timeoutRef.current = setTimeout(()=>{\r\n      setKeyword(value)\r\n    }, DELAY)\r\n    return ()=>{timeoutRef.current && clearTimeout(timeoutRef.current)}\r\n  }, [value])\r\n  const back = ()=>{\r\n    setModal(InviteModal, null)\r\n  }\r\n  const inviteLink = location.href.replace('chat', 'invitee')\r\n  return <View style={{alignItems:'center', flex:1}}>\r\n  <View style={{'width': '100%', flex:1, paddingVertical:10}}>\r\n    <CopyField name={lang('invite link')} width={'80%'} value={inviteLink}/>\r\n    <View style={{marginVertical: 10, height: 1, width: '100%'}} lightColor=\"#ddd\" darkColor=\"rgba(255,255,255, 0.3)\" />\r\n    <TextField name={lang('Username')} placeholder={auth.user?.username} value={value} setValue={setValue} width={'80%'}/>\r\n    {id && data && <FlatList contentContainerStyle={{flexGrow:1}} data={data} renderItem={({item})=><InviteItem item={item} selectedRef={selectedRef}/>}/>}\r\n  </View>\r\n  <View style={[{width:'100%', flexDirection:'row', padding:10,}, {justifyContent:'flex-end'}]}>\r\n    <CommonButton title={lang('invite')} onPress={()=>{\r\n      messengerMemberMutation.invite({\r\n        channel_id:id,\r\n        user_ids:[...selectedRef.current]\r\n      }).then(back)\r\n    }}/>\r\n    <CommonButton title={lang('cancel')} onPress={back}/>\r\n  </View>\r\n</View>\r\n}\r\n\r\nexport default function InviteModal({id}:{id:number}) {\r\n  const { lang } = useLangContext()\r\n  const selectedRef = useRef<Set<number>>(new Set())\r\n  const drawerTabs:TabViewRecord = {\r\n    group:{\r\n      title: 'Group',\r\n      component: ()=><GroupTabView id={id} selectedRef={selectedRef}/>,\r\n      icon: <></>\r\n    },\r\n    external:{\r\n      title: 'External members',\r\n      component: ()=><ExternalMembershipTabView id={id} selectedRef={selectedRef}/>,\r\n      icon: <></>\r\n    }\r\n  }\r\n  return <ModalSection>\r\n    <View style={{flex:1, width:'100%'}}>\r\n      <View style={{width:'100%'}}>\r\n        <Text style={{fontSize:20}}>{lang('invite')}</Text>\r\n        <View style={{marginBottom: 20, height: 1, width: '100%'}} lightColor=\"#ddd\" darkColor=\"rgba(255,255,255, 0.3)\" />\r\n      </View>\r\n      <TabView tabs={drawerTabs} tabBarPosition={\"top\"}/>\r\n    </View>\r\n  </ModalSection>\r\n}\r\n\r\n","import React, {useState, useEffect} from \"react\"\r\nimport dayjs from \"dayjs\";\r\nimport {View, TouchableOpacity} from 'react-native'\r\nimport { Text } from \"../Themed\";\r\nimport useTimerMessageContentList from \"../../hooks/lists/useTimerMessageContent\";\r\nimport { MessengerContent } from \"../../types\";\r\nimport Avatar from \"../Avatar\";\r\nimport MessageContentView from \"./MessageContentView\";\r\n\r\nexport function timerFormat(datetime:string){\r\n    return _timerFormat(dayjs(datetime), dayjs())\r\n}\r\n\r\nfunction _timerFormat(m:dayjs.Dayjs, now:dayjs.Dayjs){\r\n    if (m.year() != now.year()){\r\n        return m.format('YYYY.MM')\r\n    }\r\n    if(m.month()!= now.month() || m.date() != now.date()){\r\n        return m.format('MM.DD')\r\n    }\r\n    return m.format('HH:mm')\r\n  }\r\n\r\nexport function timerToString(timer:string){\r\n    return dayjs(timer).format('YYYY.MM.DD HH:mm')\r\n}\r\n\r\nconst TimerTag = (props:{data:MessengerContent, now:dayjs.Dayjs, isExpand:boolean, setExpand:(id?:number)=>void})=>{\r\n    const start = dayjs(props.data.created)\r\n    const end = dayjs(props.data.timer)\r\n    const ratio = (start.diff(props.now)/start.diff(end))\r\n    const message = props.data.message_set[0]\r\n    return <TouchableOpacity onPress={()=>props.setExpand(props.isExpand?undefined:props.data.id)}>\r\n        <View style={{backgroundColor:'lightgray', borderRadius:20, overflow:'hidden', margin:5}}>\r\n            <View style={{backgroundColor:'darkgray', position:'absolute', width:`${ratio*100}%`, height:'100%'}}/>\r\n            {props.isExpand?\r\n            <View style={{paddingVertical:5, paddingHorizontal:5, maxWidth:270}}>\r\n                <View style={{flexDirection:'row'}}>\r\n                    <Avatar name={props.data.name} userId={props.data.user} size={20}/>\r\n                    <View style={{paddingHorizontal:5}}><Text>{props.data.name}</Text></View>\r\n                </View>\r\n                {props.data.timer &&\r\n                <View style={{flexDirection:'row', alignItems:'stretch'}}>\r\n                    <Text>⌚</Text>\r\n                    <Text selectable>{timerToString(props.data.timer)}</Text>\r\n                </View>}\r\n                {/* @ts-ignore */}\r\n                <MessageContentView selectable content={message.preview_content || message.content}/>\r\n            </View>:    \r\n            <View style={{paddingVertical:5, paddingHorizontal:5, flexDirection:'row'}}>\r\n                <Avatar name={props.data.name} userId={props.data.user} size={20}/>\r\n                <View style={{paddingHorizontal:5}}><Text>{_timerFormat(end, props.now)}</Text></View>\r\n            </View>}\r\n        </View>\r\n    </TouchableOpacity>\r\n}\r\n\r\n\r\nexport default (props:{channel_id:number})=>{\r\n    const timerMessages = useTimerMessageContentList(props.channel_id)\r\n    const [now, setNow] = useState(dayjs())\r\n    const [expand, setExpand] = useState<number>()\r\n    useEffect(()=>{\r\n        const timeout = setTimeout(()=>{\r\n            setNow(dayjs())\r\n        }, 2000)\r\n        return ()=>clearTimeout(timeout)\r\n    }, [now])\r\n    return <View style={{flexDirection:'row', paddingTop:5, paddingHorizontal:20}}>\r\n        {timerMessages?.map((v,i)=><TimerTag key={i} data={v} now={now} isExpand={v.id==expand} setExpand={setExpand}/>)}\r\n    </View>\r\n}","import { useEffect, useMemo } from \"react\"\r\nimport { useQuery, useQueryClient } from \"react-query\"\r\nimport { getTimerMessageContentList } from \"../../services\"\r\nimport { MessengerContent } from \"../../types\"\r\nimport useWebsocketContext from \"../useWebsocketContext\"\r\nimport dayjs from \"dayjs\"\r\n\r\nexport default function useTimerMessageContentList(channel_id:number){  \r\n  const queryClient = useQueryClient()\r\n  const { data } = useQuery<MessengerContent[]>(\r\n    [\"TimerMessageContentList\", channel_id], \r\n    async()=>await getTimerMessageContentList(channel_id, dayjs().toISOString()), \r\n    {\r\n      refetchOnReconnect:false,\r\n      refetchOnWindowFocus:false\r\n    }\r\n  )\r\n  const { lastJsonMessage } = useWebsocketContext()\r\n  useEffect(()=>{\r\n    if(lastJsonMessage !=null && lastJsonMessage['data']['channel'] == channel_id){\r\n      if(lastJsonMessage['type']=='next_message'){\r\n        if(lastJsonMessage['data']['timer'] && dayjs() < dayjs(lastJsonMessage['data']['timer']))\r\n          queryClient.setQueryData<MessengerContent[]>([\"TimerMessageContentList\", channel_id], (_data)=>{\r\n            return [...(_data || []), lastJsonMessage['data']]\r\n          })\r\n      }\r\n      if(lastJsonMessage['type']=='update_message'){\r\n        queryClient.setQueryData<MessengerContent[]>([\"TimerMessageContentList\", channel_id], (_data)=>{\r\n          return [...(_data?.filter(v=>v.id!=lastJsonMessage['data'].id || (lastJsonMessage['data']['timer']!=null && !lastJsonMessage['data']['is_archive'])) || [])]\r\n        })\r\n      }\r\n    }\r\n  }, [lastJsonMessage])\r\n  const sorted = useMemo(()=>data?.sort((a, b)=>(a.timer || '') > (b.timer || '')?1:-1), [data])\r\n  useEffect(()=>{\r\n    if (sorted?.[0]?.timer){\r\n      const id = sorted[0].id\r\n      const ms = Math.min(dayjs(sorted[0].timer).diff(dayjs()), Number.MAX_VALUE)\r\n      let timeout = setTimeout(()=>{\r\n        queryClient.setQueryData<MessengerContent[]>([\"TimerMessageContentList\", channel_id], (_data)=>{\r\n          return (_data || []).filter(v=>v.id!=id || dayjs(v.timer).diff(dayjs()) > 0)\r\n        })\r\n      }, ms)\r\n      return ()=>clearTimeout(timeout)\r\n    }\r\n  },[sorted])\r\n  return sorted\r\n}\r\n","import { useEffect } from \"react\"\r\nimport { navigate } from \"../navigation\"\r\nimport useMessengerChannelList from \"./lists/useMessengerChannelList\"\r\nimport { useMessengerMemberMutation } from \"./lists/useMessengerMemberList\"\r\nimport useAuthContext from \"./useAuthContext\"\r\n\r\nlet invitee_id:number|undefined\r\nlet invitee_state:0|1|2=0\r\n\r\nexport const replaceInviteeState = (l:Location)=>{\r\n    if(l !==undefined && l.pathname.endsWith('/invitee')){\r\n        var params = l.search.slice(1).split('&').filter(v=>v.startsWith('id='))\r\n        if (params.length>0)\r\n            invitee_id = parseInt(params[0].split('=')[1])\r\n        window.history.replaceState(null, '', l.href.split('invitee')[0]\r\n        );\r\n    }\r\n}\r\n\r\nexport default ()=>{\r\n    const {auth} = useAuthContext()\r\n    const channelList = useMessengerChannelList(auth)\r\n    const messengerMemberMutation = useMessengerMemberMutation()\r\n    useEffect(()=>{\r\n        if (auth.user){\r\n            if (invitee_id && channelList){\r\n                var id = invitee_id;\r\n                var redirect = ()=>navigate(\"Main\", {screen:\"ChatScreen\", params: {id}})\r\n                invitee_id = undefined;\r\n                invitee_state = 1;\r\n                if(channelList.find(v=>v.id==id) === undefined){\r\n                    console.log(`invite processing (channel:${id})`)\r\n                    messengerMemberMutation.invite({\r\n                        channel_id:id,\r\n                        user_ids:[auth.user.id]\r\n                    }).then(redirect)\r\n                }\r\n                else{\r\n                    console.log('already invite')\r\n                    redirect()\r\n                }\r\n            }\r\n        }\r\n        else{\r\n            if (invitee_state == 1){\r\n                invitee_state=2\r\n            }\r\n        }\r\n    }, [auth, channelList])\r\n    useEffect(()=>{\r\n        if(auth.user && invitee_state==2){\r\n            navigate(\"Main\", {screen:\"HomeScreen\"})\r\n        }\r\n    }, [auth.user])\r\n}","firebaseConfig = {\n    \"authDomain\": \"virtual-metrics-355712.firebaseapp.com\",\n    \"projectId\": \"virtual-metrics-355712\",\n    \"storageBucket\": \"virtual-metrics-355712.appspot.com\",\n    \"messagingSenderId\": \"76003576924\",\n    \"appId\": \"1:76003576924:web:c8c8a006d07918bbc02a99\",\n    \"measurementId\": \"G-SEL35L4N5R\"\n}\nif (typeof module !== 'undefined') {\n    module.exports = firebaseConfig\n}\n","editorConfig = {\r\n    plugins: 'image link charmap advlist lists paste hr', //autoresize textcolor imagetools,\r\n    toolbar: 'fontsizeselect | bold italic underline strikethrough | undo redo | alignleft aligncenter alignright | bullist numlist | hr link', // charmap removeformat\r\n    setup: (editor)=>{\r\n    }\r\n}\r\nif (typeof module !== 'undefined') {\r\n    module.exports = editorConfig\r\n}\r\n","/**\r\n * Learn more about deep linking with React Navigation\r\n * https://reactnavigation.org/docs/deep-linking\r\n * https://reactnavigation.org/docs/configuring-links\r\n */\r\n\r\nimport { LinkingOptions } from '@react-navigation/native';\r\nimport * as Linking from 'expo-linking';\r\nimport {main, login, modal} from '../screens';\r\n\r\nconst ROOTPATH = 'tokki-tok'  // github repository name\r\n\r\nObject.values(modal).forEach(v=>v.path = ROOTPATH + '/' + v.path)\r\n\r\nexport default  {\r\n  prefixes: [Linking.makeUrl('/')],\r\n  config: {\r\n    screens: {\r\n      Main: {\r\n        screens:{\r\n          ...main,\r\n          ...login,\r\n          NotFound: '*',\r\n        },\r\n        path: ROOTPATH\r\n      },\r\n      ...modal\r\n    },\r\n  },\r\n} as LinkingOptions;\r\n"],"sourceRoot":""}