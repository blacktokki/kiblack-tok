(self.webpackChunkweb=self.webpackChunkweb||[]).push([[952],{45398:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>wn,navigate:()=>vn});var r=n(29439),i=n(95004),o=n(34785),a=n(75043),l=n(57018),s=n(35928),u=n(20925),c=n(59924),d=n(91321),f=n(47539),h=n(48469),g=n(4942),p=n(93433),x=n(15861),m=n(51641),y=n(98735),v=n(90270);function j(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?j(Object(n),!0).forEach((function(t){(0,g.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):j(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function w(e){var t=(0,m.useQueryClient)(),n=(0,v.default)().lastJsonMessage,r=(0,m.useQuery)("MessengerChannelList",(0,x.default)((function*(){var t;return yield(0,y.getMessengerChannelList)(null==e||null==(t=e.user)?void 0:t.id)}))).data;return(0,i.useEffect)((function(){if(null!=n&&("enter"==n.type&&t.setQueryData("MessengerChannelList",(function(e){return(null!=e&&e.find((function(e){return e.id==n.data.id}))?e:[n.data].concat((0,p.default)(e||[]))).sort((function(e,t){return e.id-t.id}))})),"next_message"==n.type)){var e=n.data;t.setQueryData("MessengerChannelList",(function(t){return(t||[]).map((function(t){var n;return t.id==e.channel?b(b({},t),{},{last_message:{content:null==(n=e.message_set[0])?void 0:n.content,created:e.created}}):t}))}))}}),[n]),r}function S(e){var t=w(e);return null==t?void 0:t.sort((function(e,t){var n,r;return((null==(n=e.last_message)?void 0:n.created)||"")<((null==(r=t.last_message)?void 0:r.created)||"")?1:-1}))}function O(){var e=(0,m.useQueryClient)(),t=(0,m.useMutation)(y.postChannel,{onSuccess:function(){return e.invalidateQueries("MessengerChannelList")}}),n=(0,m.useMutation)(y.putChannel,{onSuccess:function(){return e.invalidateQueries("MessengerChannelList")}}),r=(0,m.useMutation)(y.postDirectChannel,{onSuccess:function(){return e.invalidateQueries("MessengerChannelList")}});return{create:t.mutateAsync,update:n.mutateAsync,direct:r.mutateAsync}}function C(e){return(0,m.useQuery)(["MessengerMemberList",e],(0,x.default)((function*(){return yield(0,y.getMessengerMemberList)(e)}))).data}function P(){var e=(0,m.useQueryClient)(),t=(0,m.useMutation)(y.postBulkMessengerMember,{onSuccess:function(){e.invalidateQueries("MessengerMemberList")}}),n=(0,m.useMutation)(y.deleteMessengerMember,{onSuccess:function(){e.invalidateQueries("MessengerChannelList"),e.invalidateQueries("MessengerMemberList")}});return{invite:t.mutateAsync,leave:n.mutateAsync}}var k,E=n(94305),_=0;const D=function(){var e=(0,E.default)().auth,t=w(e),n=P();(0,i.useEffect)((function(){if(e.user){if(k&&t){var r=k,i=function(){return vn("Main",{screen:"ChatScreen",params:{id:r}})};k=void 0,_=1,void 0===t.find((function(e){return e.id==r}))?(console.log("invite processing (channel:"+r+")"),n.invite({channel_id:r,user_ids:[e.user.id]}).then(i)):(console.log("already invite"),i())}}else 1==_&&(_=2)}),[e,t]),(0,i.useEffect)((function(){e.user&&2==_&&vn("Main",{screen:"HomeScreen"})}),[e.user])};var T=n(1054),M=n(96591),R=n(45288),I=n(39385),V=n(66792),z=n(56675),L=n(25722),B=n(22152),A=n(29066),F=n(8070),U=n(40150),W=n(2629),H="web"==B.default.OS?function(e){location.href=e}:L.default.openURL;const G=function(e){return(0,W.jsxs)(I.default,{style:N.footer_buttons,children:[(0,W.jsx)(R.default,{style:N.footer_button,onPress:function(){return H("https://github.com/blacktokki/tokki-tok")},children:(0,W.jsx)(F.AntDesign,{name:"github",size:24,color:U.default[e.theme].iconColor})}),(0,W.jsx)(R.default,{style:N.footer_button,onPress:function(){return L.default.openURL("mailto:ydh051541@naver.com")},children:(0,W.jsx)(F.AntDesign,{name:"mail",size:24,color:U.default[e.theme].iconColor})})]})};var N=V.default.create({footer_buttons:{width:"100%",flexDirection:"row",justifyContent:"flex-end",paddingBottom:20,paddingRight:20},footer_button:{alignItems:"center",justifyContent:"center",width:38,height:38,marginHorizontal:12,borderWidth:1,borderColor:"#E7E7E7",borderRadius:60}});var Q=V.default.create({login_container:{flex:1,backgroundColor:"#FFF"},login_header:{alignItems:"center",paddingTop:30,paddingBottom:50,backgroundColor:"#208AEC"},login_header_logo:{width:220,resizeMode:"contain"},login_header_text:{marginTop:15,color:"#f0f0f0",fontSize:16},login_header_text_bold:{color:"#fff",fontWeight:"bold"},login_wrapper:{flex:1,justifyContent:"space-between",paddingTop:40,borderTopRightRadius:12,borderTopLeftRadius:12,backgroundColor:"#fff",alignItems:"center"},form:{width:"100%",maxWidth:320},form_error:{height:22,width:"100%"},form_error_text:{textAlignVertical:"center",color:"red",fontSize:13},form_input:{height:44,paddingHorizontal:20,marginBottom:20,backgroundColor:"#EDF0F7",borderRadius:50},button:{alignItems:"center",justifyContent:"center",height:44,backgroundColor:"#0065A4",borderRadius:50},button_label:{color:"#fff",fontSize:16},login_social:{width:"100%",maxWidth:280,marginTop:20},login_social_separator:{flexDirection:"row",alignItems:"center"},login_social_separator_line:{flex:1,width:"100%",height:1,backgroundColor:"#E0E0E0"},login_social_separator_text:{marginHorizontal:10,color:"#808080",fontSize:16},login_social_buttons:{flexDirection:"row",justifyContent:"center",marginTop:20},login_social_button:{alignItems:"center",justifyContent:"center",width:60,height:60,marginHorizontal:12,borderWidth:1,borderColor:"#E7E7E7",borderRadius:60},login_social_icon:{width:38,height:38,resizeMode:"contain"},login_social_facebook:{backgroundColor:"#4267B2",borderColor:"#4267B2"},login_footer_text:{flexDirection:"row",alignItems:"center",color:"#808080",fontSize:14},guest_footer_text:{flexDirection:"row",alignSelf:"center",color:"#808080",fontSize:15,margin:15},login_footer_link:{color:"#208AEC",fontSize:15,fontWeight:"bold"}}),K=n(14521),Y=n(40640);function J(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function q(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?J(Object(n),!0).forEach((function(t){(0,g.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):J(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const $=function(e){return(0,W.jsx)(K.default,q(q({},e),{},{style:[Z.style,e.style]}))};var Z=V.default.create({style:{borderRadius:6,backgroundColor:"transparent",borderWidth:0}}),X=n(83132),ee=n(26944),te=n(98307),ne=n(89134);function re(e){var t=e.type,n=(0,z.default)().lang,r=(0,X.default)().setModal,i=(0,E.default)().dispatch,o=function(){r(re,null)},a={GUEST_LOGOUT:{message:"Guest users cannot reconnect after logging out. Please create an account or log in.",title:"sign out",onPress:function(){return i({type:"LOGOUT_REQUEST"})}}};return(0,ne.default)(o,[]),(0,W.jsxs)(te.BottomSheet,{children:[(0,W.jsx)(ee.Text,{children:n(a[t].message)}),(0,W.jsxs)(ee.View,{style:{width:"100%",flexDirection:"row",justifyContent:"flex-end"},children:[(0,W.jsx)(K.default,{title:n(a[t].title),onPress:a[t].onPress}),(0,W.jsx)(K.default,{title:n("cancel"),onPress:function(){return o()}})]})]})}var ie=n(54243);function oe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ae(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?oe(Object(n),!0).forEach((function(t){(0,g.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):oe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const le=function(e){var t=(0,z.default)().lang,n=(0,ie.default)(),r=(0,E.default)(),i=r.auth,o=r.dispatch,a=(0,X.default)().setModal,l=(0,h.default)(),s=[{title:t("sign out"),onPress:function(){var e;null!=i&&null!=(e=i.user)&&e.is_guest?a(re,{type:"GUEST_LOGOUT"}):o({type:"LOGOUT_REQUEST"})}}],u=(e.extra?[].concat((0,p.default)(e.extra),s):s).filter((function(e){return e.windowType==l||void 0==e.windowType}));return(0,W.jsx)(I.default,{style:{flexDirection:"row"},children:u.map((function(e,t){return(0,W.jsx)($,ae(ae({},e),{},{textStyle:{color:U.default[n].text},color:"#gray"}),t)}))})};var se=n(78684),ue=n(22339),ce=(0,i.createContext)({lastJsonMessage:void 0,sendJsonMessage:function(){}}),de=function(e){var t=e.disable,n=e.children;return t?(0,W.jsx)(W.Fragment,{}):(0,W.jsx)(v.WebSocketInternalProvider,{path:"messenger/ws/rtc/",Context:ce,useBackground:!0,children:n})};const fe=function(){return(0,i.useContext)(ce)};var he=n(33693),ge=n(47280),pe=n(93141);console.log(pe.TURN_SERVER?"use turn server":"use stun server");var xe={iceServers:[pe.TURN_SERVER?JSON.parse(pe.TURN_SERVER):{urls:"stun:stun.l.google.com:19302"}]},me={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0,VoiceActivityDetection:!0}},ye={audio:!0,video:{framerate:30}},ve=function(e,t){var n=t.data.rtcMessage,r=new ge.RTCIceCandidate(n);e&&(console.log("ICE candidate Added"),e.addIceCandidate(r))},je=function(e,t,n,r){e.candidate&&t({type:"ICEcandidate",receiver:n,data:{target:r,rtcMessage:e.candidate}})},be=8e3,we=function(){var e=(0,x.default)((function*(e,t,n,r,i){n&&e.pc.addStream(n);var o=function(e){var t=e.sdp.split("\r\n");return t.forEach((function(e,n){/^a=fmtp:\d*/.test(e)?t[n]=e+";x-google-max-bitrate=8000;x-google-min-bitrate=8000;x-google-start-bitrate="+be:/^a=mid:(0|video)/.test(e)&&(t[n]+="\r\nb=AS:"+be)})),new ge.RTCSessionDescription({type:e.type,sdp:t.join("\r\n")})}(yield e.pc.createOffer(me));yield e.pc.setLocalDescription(o),t({type:"call",receiver:e.receiver,data:{target:r,name:null==i?void 0:i.name,rtcMessage:o}})}));return function(t,n,r,i,o){return e.apply(this,arguments)}}(),Se=V.default.create({container:{flex:1},cam:{flex:1,height:"100%"},bottonContainer:{position:"absolute",bottom:0,justifyContent:"flex-end"},buttonBar:{flexDirection:"row",justifyContent:"space-around"},label:{backgroundColor:"#0008",color:"white",paddingHorizontal:5}});const Oe=function(e){var t,n=fe(),o=n.lastJsonMessage,a=function(e){var t=(0,i.useRef)({}),n=(0,i.useState)(),o=(0,r.default)(n,2),a=o[0],l=o[1],s=(0,i.useState)(),u=(0,r.default)(s,2),c=u[0],d=u[1],f=(0,i.useMemo)((function(){return!!c}),[c]),h=(0,i.useCallback)(i.memo((function(e){var t=e.style;return c?(0,W.jsx)(ge.RTCView,{stream:c,style:t,videoProps:{height:"100%"}}):(0,W.jsx)(W.Fragment,{})})),[c]),g=(0,i.useCallback)(function(){var n=(0,x.default)((function*(n,i,o){if(console.log("start"),!c||void 0!==o)try{var a;a="camera"==o?yield ge.mediaDevices.getUserMedia(ye):"display"==o?yield ge.mediaDevices.getDisplayMedia(ye):i||(yield ge.mediaDevices.getUserMedia(ye).catch((function(e){return ge.mediaDevices.getDisplayMedia(ye)}))),d(a),Object.entries(t.current).map((function(t){var i=(0,r.default)(t,2),o=(i[0],i[1]);we(o,e,a,"guest",n)}))}catch(l){console.error(l)}}));return function(e,t,r){return n.apply(this,arguments)}}(),[c]);return{start:g,stop:(0,i.useCallback)((function(){console.log("stop"),c&&(c.getTracks().map((function(e){return e.stop()})),d(void 0))}),[c]),websocketOnMessage:function(){var n=(0,x.default)((function*(n,r){var i=n.type;if("connection"==i&&l(n.data.channel_name),"start"==i&&"host"==n.data.target){console.log("1 start");var o=new ge.RTCPeerConnection(xe);o.addEventListener("icecandidate",(function(t){return je(t,e,n.sender,"guest")})),t.current[n.sender]={pc:o,receiver:n.sender},we(t.current[n.sender],e,c,"guest",r)}if("answer"==i&&"host"==n.data.target){console.log("3 answer");var a=t.current[n.sender].pc,s=new ge.RTCSessionDescription(n.data.rtcMessage);yield a.setRemoteDescription(s)}if("ICEcandidate"==i&&"host"==n.data.target){var u=t.current[n.sender].pc;ve(u,n)}}));return function(e,t){return n.apply(this,arguments)}}(),CustomRTCView:h,isPlay:f,sender:a}}(n.sendJsonMessage),l=a.start,s=a.stop,u=a.websocketOnMessage,c=a.CustomRTCView,d=a.isPlay;return(0,i.useEffect)((function(){e.user&&o&&u(o,e.user)}),[o,e.user]),(0,i.useEffect)((function(){return e.mode&&!d?e.user&&l(e.user,void 0,e.mode):null===e.mode&&d&&s(),function(){d&&s()}}),[d,e.user,e.mode]),(0,W.jsxs)(I.default,{style:Se.container,children:[(0,W.jsx)(c,{style:Se.cam}),(0,W.jsxs)(I.default,{style:Se.bottonContainer,children:[(0,W.jsx)(I.default,{style:Se.buttonBar}),(0,W.jsx)(I.default,{style:{flexDirection:"row"},children:(0,W.jsx)(T.default,{style:Se.label,children:null==(t=e.user)?void 0:t.name})}),(0,W.jsxs)(I.default,{style:Se.buttonBar,children:[void 0===e.mode&&!d&&(0,W.jsx)(he.default,{title:"Start",onPress:function(){return e.user&&l(e.user)}}),void 0===e.mode&&d&&(0,W.jsx)(he.default,{title:"Stop",onPress:s})]})]})]})},Ce=function(e){var t=(0,i.useState)(""),n=(0,r.default)(t,2),o=n[0],a=n[1],l=fe(),s=l.lastJsonMessage,u=function(e){var t=(0,i.useRef)({}),n=(0,i.useState)(),o=(0,r.default)(n,2),a=o[0],l=o[1],s=(0,i.useState)(),u=(0,r.default)(s,2),c=u[0],d=u[1],f=(0,i.useCallback)(i.memo((function(e){return c?(0,W.jsx)(ge.RTCView,{stream:c,style:e,videoProps:{height:"100%"}}):(0,W.jsx)(W.Fragment,{})})),[c]),h=(0,i.useMemo)((function(){return!!c}),[c]),g=(0,i.useCallback)((function(n){console.log("start"),t.current.pc||(t.current.pc=new ge.RTCPeerConnection(xe),t.current.receiver=n),c||e({type:"start",receiver:n,data:{target:"host"}})}),[c]),p=function(){console.log("stop"),t.current.pc&&(d(void 0),t.current.pc.close(),t.current.pc=void 0,t.current.receiver=void 0,clearInterval(t.current.statsInterval))};return{start:g,stop:p,websocketOnMessage:function(){var n=(0,x.default)((function*(n){var r,i,o,s,u=n.type;if("start"==u&&"guest"==n.data.target&&n.sender==(null==(r=t.current)?void 0:r.receiver)){console.log("(remote)1 start");var f=t.current.pc;l({name:n.data.name}),f.addEventListener("icecandidate",(function(t){return je(t,e,n.sender,"host")})),f.addEventListener("iceconnectionstatechange",(function(e){if("connected"==t.current.pc.iceConnectionState){var n=!1;t.current.statsInterval=setInterval((0,x.default)((function*(){var e=yield t.current.pc.getStats(null),r="",i=void 0;e.forEach((function(e){"inbound-rtp"===e.type&&"video"===e.kind&&(Object.keys(e).forEach((function(t){r+=t+": "+e[t]+"\n"})),i=e.framesPerSecond)})),console.log(n,i),void 0!=i?n=!0:n&&p(),console.log((new Date).toTimeString().split(" ")[0],r)})),1e3)}else"failed"==t.current.pc.iceConnectionState&&p()})),f.addTransceiver("video",{direction:"recvonly"}),yield we({pc:t.current.pc,receiver:n.sender},e,c,"host",a)}if("answer"==u&&"guest"==n.data.target&&n.sender==(null==(i=t.current)?void 0:i.receiver)){console.log("(remote)3 answer");var h=new ge.RTCSessionDescription(n.data.rtcMessage);yield t.current.pc.setRemoteDescription(h);var g=t.current.pc.getRemoteStreams();d(g[g.length-1]),e({type:"end",receiver:t.current.receiver,data:{}})}if("call"==u&&n.sender==(null==(o=t.current)?void 0:o.receiver)){console.log("2 call");var m=t.current.pc;if(l({name:n.data.name}),!m)return;m.addEventListener("icecandidate",(function(t){return je(t,e,n.sender,"host")}));var y=new ge.RTCSessionDescription(n.data.rtcMessage);yield m.setRemoteDescription(y);var v=yield m.createAnswer(me);yield m.setLocalDescription(v),e({type:"answer",receiver:t.current.receiver,data:{target:"host",rtcMessage:m.localDescription}});var j=t.current.pc.getRemoteStreams();d(j[j.length-1])}"ICEcandidate"==u&&"guest"==n.data.target&&n.sender==(null==(s=t.current)?void 0:s.receiver)&&ve(t.current.pc,n)}));return function(e){return n.apply(this,arguments)}}(),CustomRTCView:f,user:a,isPlay:h}}(l.sendJsonMessage),c=u.start,d=u.stop,f=u.websocketOnMessage,h=u.CustomRTCView,g=u.isPlay,p=u.user;return(0,i.useEffect)((function(){s&&f(s)}),[s]),(0,i.useEffect)((function(){return e.receiver&&c(e.receiver),function(){return d()}}),[e.receiver]),(0,W.jsxs)(I.default,{style:Se.container,children:[(0,W.jsx)(h,{style:Se.cam}),(0,W.jsxs)(I.default,{style:Se.bottonContainer,children:[(0,W.jsx)(I.default,{style:Se.buttonBar}),(0,W.jsx)(I.default,{style:{flexDirection:"row"},children:e.receiver||g?(0,W.jsx)(T.default,{style:Se.label,children:(null==p?void 0:p.name)||"loading..."}):(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(T.default,{style:{borderWidth:1},children:"Receiver:\xa0"}),(0,W.jsx)(M.default,{style:{borderWidth:1,flex:1},value:o,onChangeText:a})]})}),(0,W.jsxs)(I.default,{style:Se.buttonBar,children:[void 0===e.receiver&&!g&&(0,W.jsx)(he.default,{title:"Start",onPress:function(){return c(o)}}),void 0===e.receiver&&g&&(0,W.jsx)(he.default,{title:"Stop",onPress:d})]})]})]})};var Pe=function(e){return(0,W.jsx)(I.default,{style:[{maxWidth:e.scale,maxHeight:e.scale,borderWidth:1,borderColor:U.default.borderColor,backgroundColor:"gray",flexDirection:"row",flexGrow:1},void 0==e.focusGuest||e.focusGuest==e.receiver?{height:"100%"}:{maxWidth:0,height:0}],children:(0,W.jsx)(A.TouchableOpacity,{style:{flex:1},containerStyle:{flex:1,justifyContent:"center"},onPress:function(){return e.setFocusGuest(e.focusGuest?void 0:e.receiver)},children:e.children})})},ke=function(e){var t,n=e.channel_id,o=e.disable,a=e.setDisable,l=(0,E.default)().auth,s=(0,se.default)(),u=(0,i.useState)(null),c=(0,r.default)(u,2),d=c[0],f=c[1],g=(0,i.useState)([]),x=(0,r.default)(g,2),m=x[0],y=x[1],v=(0,i.useState)(),j=(0,r.default)(v,2),b=j[0],w=j[1],S=(0,h.default)(),O=fe(),C=O.lastJsonMessage,P=O.sendJsonMessage;(0,i.useEffect)((function(){if(null!=C&&("connection"==C.type&&P({type:"broadcast",data:{channel_id:n}}),"broadcast_guest"!=C.type&&"broadcast_host"!=C.type||y([].concat((0,p.default)(m),[C.sender])),"broadcast_disconnect"==C.type)){var e=C.sender;m.find((function(t){return t==e}))&&y(m.filter((function(t){return t!=e})))}}),[C]);var k=b?"100%":100/Math.max(2,Math.ceil(Math.sqrt(m.length+1)))+"%",_=function(e){f(d!=e?e:null)};return void 0!==C?(0,W.jsxs)(ee.View,{style:[{aspectRatio:o?0:16/9,borderColor:U.default.borderColor,borderRadius:10},"landscape"==S?{flexShrink:1,flexGrow:0,height:"100%",borderLeftWidth:1,paddingBottom:65}:{maxHeight:"36%",width:"100%",borderBottomWidth:1}],children:[(0,W.jsxs)(I.default,{style:{aspectRatio:b?void 0:16/9,backgroundColor:"white",flexWrap:"wrap",flexDirection:"row",width:"100%",height:"100%"},children:[m.map((function(e,t){return(0,W.jsx)(Pe,{scale:k,focusGuest:b,setFocusGuest:w,receiver:e,children:(0,W.jsx)(Ce,{receiver:e})})})),(0,W.jsx)(Pe,{scale:k,focusGuest:b,setFocusGuest:w,receiver:null==(t=l.user)?void 0:t.name,children:(0,W.jsx)(Oe,{user:l.user,mode:d})})]}),(0,W.jsxs)(ee.View,{style:[{position:"absolute",alignItems:"center",justifyContent:"flex-end",width:"100%",flexDirection:"row"},"landscape"==S?{bottom:0,paddingTop:15,paddingBottom:10,paddingHorizontal:19}:{backgroundColor:"transparent"}],children:[(0,W.jsx)(K.default,{title:"\u23fa\ufe0f",style:{height:40,paddingTop:8},onPress:function(){return _("camera")}}),!s&&(0,W.jsx)(K.default,{title:"\ud83d\udda5\ufe0f",style:{height:40,paddingTop:8},onPress:function(){return _("display")}}),(0,W.jsx)(K.default,{title:"",style:{height:40,paddingTop:8},onPress:function(){return a(!0)},children:(0,W.jsx)(F.Ionicons,{size:20,name:"arrow-back",color:"deepskyblue"})})]})]}):(0,W.jsx)(W.Fragment,{})};const Ee=i.memo((function(e){var t=e.channel_id,n=e.disable,r=e.setDisable;return(0,W.jsx)(de,{disable:n,children:(0,W.jsx)(ke,{channel_id:t,disable:n,setDisable:r})})}));function _e(e){return(0,m.useQuery)(["UserMembershipList",null==e?void 0:e.groupId],(0,x.default)((function*(){return null!=e&&e.groupId?yield(0,y.getUserMembershipList)(null==e?void 0:e.groupId):[]}))).data}function De(e){return(0,m.useQuery)(["UserMembershipList",e],(0,x.default)((function*(){return e?yield(0,y.getExternalMembershipList)(e):[]}))).data}const Te=function(e){var t=(0,i.useState)(),n=(0,r.default)(t,2),o=n[0],a=n[1],l=e.minHeight||30,s=(0,ie.default)();return(0,W.jsx)(M.default,{style:[{borderColor:"#d0d7de",fontSize:16,borderWidth:1,borderRadius:6,paddingHorizontal:10,paddingVertical:3,backgroundColor:U.default[s].background,color:U.default[s].text,height:e.multiline?o:l},e.style],placeholder:e.placeholder,editable:!e.disabled,keyboardType:e.keyboardType,secureTextEntry:e.secureTextEntry,value:e.value,onChangeText:e.setValue,onContentSizeChange:e.multiline?function(e){return a(Math.max(e.nativeEvent.contentSize.height,l)+2)}:void 0,onBlur:function(){return null==e.onBlur?void 0:e.onBlur(e.value)},onEndEditing:function(){return null==e.onEndEditing?void 0:e.onEndEditing(e.value)},multiline:e.multiline})};function Me(e){var t=(0,h.default)(),n=(0,i.useMemo)((function(){return"landscape"==t?{flexDirection:"row",alignItems:"center",justifyContent:"space-between"}:{flexDirection:"column",alignItems:"flex-start"}}),[t]);return(0,W.jsxs)(ee.View,{style:[{paddingVertical:"landscape"==t?15:5,width:"100%"},n],children:[(0,W.jsx)(ee.Text,{style:["landscape"==t?{flex:1}:{width:"100%"},{paddingHorizontal:15,fontSize:16},e.textStyle],children:e.name}),(0,W.jsx)(ee.View,{style:["landscape"==t?{flex:6}:{width:"100%"},{paddingHorizontal:15}],children:(0,W.jsx)(ee.View,{style:{width:e.width},children:e.children})})]})}function Re(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ie(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Re(Object(n),!0).forEach((function(t){(0,g.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Re(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ve(e){return(0,W.jsx)(Me,{name:e.name,width:e.width,textStyle:e.textStyle,children:(0,W.jsx)(Te,Ie({},e))})}function ze(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Le(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ze(Object(n),!0).forEach((function(t){(0,g.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ze(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Be=function(e,t){switch(t.type){case"SEARCH":return Le(Le({},e),{},{keyword:t.keyword});case"ENABLE_SEARCH":return Le(Le({},e),{},{active:!0});case"DISABLE_SEARCH":return Le(Le({},e),{},{active:!1,keyword:""});default:throw new Error("Unhandled action type: "+t.type)}};var Ae=n(27617),Fe=n(36979),Ue=n(98149);function We(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function He(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?We(Object(n),!0).forEach((function(t){(0,g.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):We(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const Ge=function(e){var t=(0,z.default)().lang,n=i.useState(e.index||0),o=(0,r.default)(n,2),a=o[0],l=o[1],s=(0,ie.default)(),u=Object.entries(e.tabs),c=e.onTab,d=Object.assign.apply(Object,[{}].concat((0,p.default)(u.map((function(e){var t=(0,r.default)(e,2),n=t[0],i=t[1];return(0,g.default)({},n,i.icon)})))));return(0,W.jsx)(Ae.TabView,{renderTabBar:function(e){return(0,W.jsx)(Fe.TabBar,He(He({},e),{},{indicatorStyle:{backgroundColor:"#2196F3"},style:{backgroundColor:U.default[s].background},activeColor:U.default[s].text,inactiveColor:U.default[s].text,renderIcon:function(e){return d[e.route.key]},onTabPress:function(e){return null==c?void 0:c(u.findIndex((function(t){var n=(0,r.default)(t,2),i=n[0];n[1];return i==e.route.key})))}}))},navigationState:{index:a,routes:u.map((function(e){var n=(0,r.default)(e,2),i=n[0],o=n[1];return{key:i,title:t(o.title)}}))},onIndexChange:l,renderScene:(0,Ue.SceneMap)(Object.assign.apply(Object,[{}].concat((0,p.default)(u.map((function(e){var t=(0,r.default)(e,2),n=t[0],i=t[1];return(0,g.default)({},n,i.component)})))))),tabBarPosition:e.tabBarPosition})};var Ne=n(2840);function Qe(e){var t=i.useState(!1),n=(0,r.default)(t,2),o=n[0],a=n[1];return(0,W.jsx)(Ne.default,{style:[Ke.outerContainer,e.outerContainerStyle,o?{backgroundColor:"rgb(242,242,242)"}:{}],onPressIn:function(){return a(!0)},onPress:function(){return null==e.onPress?void 0:e.onPress()},onPressOut:function(){return a(!1)},children:(0,W.jsx)(ee.View,{style:[Ke.container,e.containerStyle],children:(0,W.jsx)(ee.View,{style:[Ke.bodyView,e.bodyStyle],children:(0,W.jsx)(W.Fragment,{children:e.children})})})})}var Ke=V.default.create({outerContainer:{width:"100%",maxWidth:1080,alignItems:"stretch"},container:{marginHorizontal:20,backgroundColor:"transparent"},bodyView:{width:"100%",padding:10,minHeight:40,alignItems:"center",justifyContent:"center",borderBottomWidth:1,borderColor:U.default.borderColor,backgroundColor:"transparent"}});const Ye=function(e){var t=e.member,n=e.onPress;return(0,W.jsxs)(Qe,{bodyStyle:{flexDirection:"row",justifyContent:"flex-start"},onPress:n,children:[(0,W.jsx)(ee.View,{style:{marginTop:4,marginRight:12},children:(0,W.jsx)(ue.default,{name:t.name,userId:t.id,size:44})}),(0,W.jsx)(ee.Text,{style:{fontSize:20,fontWeight:"400"},children:t.name})]},t.id)};var Je=n(93976);function qe(e){var t=(0,z.default)().lang,n=(0,h.default)(),o=(0,i.useState)(!1),a=(0,r.default)(o,2),l=a[0],s=a[1];return(0,W.jsx)(Me,{name:e.name,width:e.width,textStyle:e.textStyle,children:(0,W.jsxs)(I.default,{style:{flexDirection:"landscape"==n?"row":"column",justifyContent:"space-between"},children:[(0,W.jsx)(I.default,{style:{justifyContent:"center"},children:(0,W.jsx)(ee.Text,{style:{fontSize:16},children:e.value})}),(0,W.jsxs)(I.default,{children:[(0,W.jsx)(K.default,{title:t("copy"),onPress:function(){Je.default.setString(e.value),s(!0)}}),l&&(0,W.jsx)(ee.Text,{style:{fontSize:12,alignSelf:"center",color:"red"},children:t("copied")})]})]})})}var $e=function(e){var t=(0,i.useState)(e.selectedRef.current.has(e.item.id)),n=(0,r.default)(t,2),o=n[0],a=n[1];return(0,W.jsx)(ee.View,{style:o?{borderWidth:1,borderColor:"blue"}:{},children:(0,W.jsx)(Ye,{member:e.item,onPress:function(){o?(a(!1),e.selectedRef.current.delete(e.item.id)):(a(!0),e.selectedRef.current.add(e.item.id))}})})},Ze=function(e){var t,n=e.id,o=e.selectedRef,a=(0,z.default)().lang,l=(0,E.default)().auth,s=(0,X.default)().setModal,u=_e(l),c=C(n),d=P(),f=function(e,t){var n=(0,i.useReducer)(Be,{active:!1,keyword:""}),o=(0,r.default)(n,2),a=o[0],l=o[1],s=(0,i.useMemo)((function(){return a.active?e.filter((function(e){return t(e,a.keyword)})):e}),[a,e]);return{searchState:a,dispatch:l,data:s}}((0,i.useMemo)((function(){var e=new Set(null==c?void 0:c.map((function(e){return e.user})));return(null==u?void 0:u.filter((function(t){return!e.has(t.id)})))||[]}),[u,c]),(function(e,t){return e.username.includes(t)||e.name.includes(t)})),h=f.data,g=f.dispatch,x=f.searchState,m=function(){s(et,null)};return(0,ne.default)(m,[]),(0,W.jsxs)(ee.View,{style:{alignItems:"center",flex:1},children:[(0,W.jsxs)(ee.View,{style:{width:"100%",flex:1},children:[(0,W.jsx)(Ve,{name:a("Username")+" & "+a("Name"),placeholder:null==(t=l.user)?void 0:t.name,value:x.keyword,setValue:function(e){(null==e?void 0:e.length)>0?(g({type:"ENABLE_SEARCH"}),g({type:"SEARCH",keyword:e})):g({type:"DISABLE_SEARCH"})},width:"80%"}),n&&h&&(0,W.jsx)(A.FlatList,{contentContainerStyle:{flexGrow:1},data:h,renderItem:function(e){var t=e.item;return(0,W.jsx)($e,{item:t,selectedRef:o})}})]}),(0,W.jsxs)(ee.View,{style:[{width:"100%",flexDirection:"row",padding:10},{justifyContent:"flex-end"}],children:[(0,W.jsx)(K.default,{title:a("invite"),onPress:function(){d.invite({channel_id:n,user_ids:(0,p.default)(o.current)}).then(m)}}),(0,W.jsx)(K.default,{title:a("cancel"),onPress:m})]})]})},Xe=function(e){var t,n=e.id,o=e.selectedRef,a=(0,z.default)().lang,l=(0,i.useState)(""),s=(0,r.default)(l,2),u=s[0],c=s[1],d=(0,i.useState)(""),f=(0,r.default)(d,2),h=f[0],g=f[1],x=(0,i.useState)(!1),m=(0,r.default)(x,2),y=(m[0],m[1],(0,i.useRef)()),v=(0,E.default)().auth,j=(0,X.default)().setModal,b=C(n),w=De(h),S=(0,i.useMemo)((function(){var e=new Set(null==b?void 0:b.map((function(e){return e.user})));return(null==w?void 0:w.filter((function(t){return!e.has(t.id)})))||[]}),[w,b]),O=P();(0,i.useEffect)((function(){return y.current=setTimeout((function(){g(u)}),500),function(){y.current&&clearTimeout(y.current)}}),[u]);var k=function(){j(et,null)},_=location.href.replace("chat","invitee");return(0,W.jsxs)(ee.View,{style:{alignItems:"center",flex:1},children:[(0,W.jsxs)(ee.View,{style:{width:"100%",flex:1,paddingVertical:10},children:[(0,W.jsx)(qe,{name:a("invite link"),width:"80%",value:_}),(0,W.jsx)(ee.View,{style:{marginVertical:10,height:1,width:"100%"},lightColor:"#ddd",darkColor:"rgba(255,255,255, 0.3)"}),(0,W.jsx)(Ve,{name:a("Username"),placeholder:null==(t=v.user)?void 0:t.username,value:u,setValue:c,width:"80%"}),n&&S&&(0,W.jsx)(A.FlatList,{contentContainerStyle:{flexGrow:1},data:S,renderItem:function(e){var t=e.item;return(0,W.jsx)($e,{item:t,selectedRef:o})}})]}),(0,W.jsxs)(ee.View,{style:[{width:"100%",flexDirection:"row",padding:10},{justifyContent:"flex-end"}],children:[(0,W.jsx)(K.default,{title:a("invite"),onPress:function(){O.invite({channel_id:n,user_ids:(0,p.default)(o.current)}).then(k)}}),(0,W.jsx)(K.default,{title:a("cancel"),onPress:k})]})]})};function et(e){var t=e.id,n=(0,z.default)().lang,r=(0,i.useRef)(new Set),o={group:{title:"Group",component:function(){return(0,W.jsx)(Ze,{id:t,selectedRef:r})},icon:(0,W.jsx)(W.Fragment,{})},external:{title:"External members",component:function(){return(0,W.jsx)(Xe,{id:t,selectedRef:r})},icon:(0,W.jsx)(W.Fragment,{})}};return(0,W.jsx)(te.default,{children:(0,W.jsxs)(ee.View,{style:{flex:1,width:"100%"},children:[(0,W.jsxs)(ee.View,{style:{width:"100%"},children:[(0,W.jsx)(ee.Text,{style:{fontSize:20},children:n("invite")}),(0,W.jsx)(ee.View,{style:{marginBottom:20,height:1,width:"100%"},lightColor:"#ddd",darkColor:"rgba(255,255,255, 0.3)"})]}),(0,W.jsx)(Ge,{tabs:o,tabBarPosition:"top"})]})})}var tt=n(57438),nt=n.n(tt);function rt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function it(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?rt(Object(n),!0).forEach((function(t){(0,g.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):rt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ot=["AM","PM"].map((function(e){return{label:e,value:e}})),at=(0,p.default)(Array(12).keys()).map((function(e,t){return(t+1).toString().padStart(2,"0")})).map((function(e){return{label:e,value:e}})),lt=(0,p.default)(Array(12).keys()).map((function(e,t){return(5*t).toString().padStart(2,"0")})).map((function(e){return{label:e,value:e}})),st=function(e){for(var t=e.clone().startOf("month").add(-1,"month"),n=e.clone().endOf("month").add(1,"month"),r=nt()().startOf("day"),i=[];t<=n&&t<r;)i.push(t.format("YYYY-MM-DD")),t=t.add(1,"day");return i},ut=function(){var e=nt()(),t=parseInt(e.format("mm"))%5;return e.add(5-t,"minute")},ct=i.lazy((function(){return Promise.all([n.e(494),n.e(164)]).then(n.bind(n,61164))})),dt=i.lazy((function(){return n.e(88).then(n.bind(n,4088))}));function ft(e){var t=e.datetime,n=e.callback,o=t?nt()(t):ut(),a=(0,z.default)(),l=a.lang,s=a.locale,u=(0,ie.default)(),c=(0,i.useState)(o.format("YYYY-MM-DD")),d=(0,r.default)(c,2),f=d[0],h=d[1],g=(0,i.useState)(o.locale("en").format("A")),p=(0,r.default)(g,2),x=p[0],m=p[1],y=(0,i.useState)(o.format("hh")),v=(0,r.default)(y,2),j=v[0],b=v[1],w=(0,i.useState)(o.format("mm")),S=(0,r.default)(w,2),O=S[0],C=S[1],P=(0,i.useState)(st(o)),k=(0,r.default)(P,2),E=k[0],_=k[1],D=(0,X.default)().setModal,T=function(){D(ft,null)};return(0,ne.default)(T,[]),(0,W.jsxs)(te.BottomSheet,{children:[(0,W.jsxs)(ee.View,{style:{flexDirection:"row",width:"100%"},children:[(0,W.jsx)(ee.View,{style:{flex:1,flexDirection:"row"},children:(0,W.jsx)(A.TouchableOpacity,{onPress:T,children:(0,W.jsx)(F.Ionicons,{size:20,name:"arrow-back",color:U.default[u].text})})}),(0,W.jsx)(ee.View,{style:{flex:1},children:(0,W.jsx)(ee.Text,{style:{fontSize:20,textAlign:"center"},children:l("Date & Time")})}),(0,W.jsx)(ee.View,{style:{flex:1}})]}),(0,W.jsx)(ee.View,{style:{marginBottom:20,height:1,width:"100%"},lightColor:"#ddd",darkColor:"rgba(255,255,255, 0.3)"}),(0,W.jsxs)(i.Suspense,{fallback:(0,W.jsx)(W.Fragment,{}),children:[(0,W.jsx)(ct,{locale:s,style:void 0,setDate:h,disableAllTouchEventsForDisabledDays:!0,onMonthChange:function(e){return _(st(nt()(e.dateString)))},markedDates:it(it({},E.reduce((function(e,t){return e[t]={disabled:!0},e}),{})),(f?[f]:[]).reduce((function(e,t){return e[t]={selected:!0},e}),{}))}),(0,W.jsxs)(ee.View,{style:{flexDirection:"row",paddingVertical:10,width:400,height:50},children:[(0,W.jsx)(dt,{value:x,setValue:m,values:ot}),(0,W.jsx)(ee.Text,{style:{fontSize:20},children:" "}),(0,W.jsx)(dt,{value:j,setValue:b,values:at}),(0,W.jsx)(ee.Text,{style:{fontSize:20},children:" : "}),(0,W.jsx)(dt,{value:O,setValue:C,values:lt})]})]}),(0,W.jsxs)(ee.View,{style:{flexDirection:"row"},children:[(0,W.jsx)(K.default,{title:l("save"),onPress:function(){null==n||n(nt()(f+" "+j+":"+O+" "+x).toISOString()),T()}}),(0,W.jsx)(K.default,{title:l("cancel"),onPress:function(){null==n||n(void 0),T()}})]})]})}var ht=n(46563);function gt(e){var t=e.id,n=e.member_id,o=e.type,a=(0,z.default)().lang,l=(0,E.default)().auth,s=(0,X.default)().setModal,u=w(l),c=O(),d=P(),f=null==u?void 0:u.find((function(e){return e.id==t})),h=(0,i.useState)(""),g=(0,r.default)(h,2),p=g[0],x=g[1],m=(0,i.useState)(""),y=(0,r.default)(m,2),v=y[0],j=y[1],b=function(){s(gt,null)};return(0,i.useEffect)((function(){if(f){var e=(0,ue.avatarFromChannel)(f,l.user).name;x(e),j((null==f?void 0:f.description)||"")}}),[null==f?void 0:f.id]),(0,ne.default)(b,[]),(0,W.jsx)(te.default,{children:(0,W.jsxs)(ee.View,{style:{justifyContent:"space-between",flex:1,width:"100%"},children:[(0,W.jsxs)(ee.View,{style:{width:"100%"},children:[(0,W.jsx)(ee.Text,{style:{fontSize:20},children:a(t?"Chat Setting":"New chat")}),(0,W.jsx)(ee.View,{style:pt.separator,lightColor:"#ddd",darkColor:"rgba(255,255,255, 0.3)"}),(0,W.jsx)(Ve,{name:a("Channel Name"),value:p,setValue:x,width:"60%"}),(0,W.jsx)(Ve,{name:a("Description"),value:v,setValue:j,multiline:!0,width:"60%"})]}),(0,W.jsxs)(ee.View,{style:{width:"100%",flexDirection:"row"},children:[n&&(0,W.jsx)(ee.View,{style:{flexDirection:"row",justifyContent:"flex-start"},children:(0,W.jsx)(K.default,{title:a("leave"),style:{marginHorizontal:5},textStyle:{color:"red"},onPress:function(){return d.leave(n).then(b)}})}),(0,W.jsxs)(ee.View,{style:{flex:1,flexDirection:"row",justifyContent:"flex-end"},children:[(0,W.jsx)(K.default,{title:a("save"),onPress:function(){var e;if(null!=l&&null!=(e=l.user)&&e.id&&l.groupId){var n,r={id:t,name:p,description:v,type:o,owner:null==l||null==(n=l.user)?void 0:n.id,group:l.groupId};(t?c.update(r):c.create(r)).then((function(e){return vn("Main",{screen:"messenger"==e.type?"ChatScreen":"BoardScreen",params:{id:e.id}})}))}}}),(0,W.jsx)(K.default,{title:a("cancel"),style:{marginHorizontal:5},onPress:b})]})]})]})})}var pt=V.default.create({field:{width:"50%",flexDirection:"row",padding:10},separator:{marginBottom:20,height:1,width:"100%"}}),xt=n(47754),mt=function(e){return(0,W.jsxs)(I.default,{style:{backgroundColor:"lightgray",borderRadius:20,overflow:"hidden",margin:5},children:[(0,W.jsx)(I.default,{style:{backgroundColor:"darkgray",position:"absolute",width:100*(e.data.progress||0)+"%",height:"100%"}}),(0,W.jsxs)(I.default,{style:{paddingVertical:5,paddingHorizontal:5,flexDirection:"row"},children:[(0,W.jsx)(ee.Text,{children:"\ud83d\udce4"}),(0,W.jsx)(I.default,{style:{paddingHorizontal:5},children:(0,W.jsx)(ee.Text,{children:e.data.filename})})]})]})};const yt=function(e){var t,n=(0,xt.default)().upload,o=(0,i.useState)(),a=(0,r.default)(o,2),l=a[0],s=a[1];return(0,W.jsx)(I.default,{style:{flexDirection:"row",paddingTop:5,paddingHorizontal:20},children:null==(t=n[e.channel_id])?void 0:t.map((function(e,t){return(0,W.jsx)(mt,{data:e,index:t,isExpand:t==l,setExpand:s},t)}))})};var vt=n(1553),jt=n(77415),bt="/tokki-tok/editor.html";const wt=function(e){var t=(0,i.useRef)(!1),n=(0,i.useRef)(null),r=function(t){null!=t&&null==n.current&&(null==e.onReady||e.onReady()),n.current=t},o=function(r){if(!t.current)return t.current=!0,i=e.value,void(n.current&&("web"==B.default.OS?n.current.contentWindow.postMessage(i,void 0):n.current.postMessage(i)));var i;if("web"==B.default.OS)try{e.setValue(r.data)}catch(o){}else e.setValue(r.nativeEvent.data)};return(0,i.useEffect)((function(){if("web"==B.default.OS)return window.addEventListener("message",o),function(){return window.removeEventListener("message",o)}}),[]),"web"==B.default.OS?(0,W.jsx)("iframe",{ref:r,src:bt,height:"100%",width:"100%",style:{border:0,minHeight:320}}):(0,W.jsx)(jt.default,{ref:r,source:{uri:bt},originWhitelist:["*"],javaScriptEnabled:!0,mediaPlaybackRequiresUserAction:!1,javaScriptEnabledAndroid:!0,useWebkit:!0,startInLoadingState:!0,style:{flex:1},onMessage:o})},St=function(e){var t=(0,i.useState)(!1),n=(0,r.default)(t,2),o=n[0],a=n[1];return(0,i.useEffect)((function(){e.active||a(!1)}),[e.active]),e.active?(0,W.jsxs)(I.default,{style:{flex:1},children:[!o&&e.children,(0,W.jsx)(wt,{value:e.value,setValue:e.setValue,onReady:function(){o||(a(!0),null==e.onReady||e.onReady())}})]}):(0,W.jsx)(W.Fragment,{children:e.children})};var Ot=n(14999),Ct=n(84953);function Pt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function kt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Pt(Object(n),!0).forEach((function(t){(0,g.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Pt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const Et=function(e){return(0,W.jsxs)(I.default,{style:{width:"100%",height:135,justifyContent:"space-evenly",alignItems:"center"},children:[(0,W.jsx)(ue.default,kt(kt({},e),{},{size:75})),(0,W.jsx)(ee.Text,{style:{fontWeight:"bold",fontSize:15},children:e.name}),(0,W.jsx)(ee.Text,{style:{fontWeight:"normal",fontSize:14},children:e.username})]})};function _t(e){var t,n=e.id,r=(0,z.default)().lang,o=(0,ie.default)(),a=(0,E.default)().auth,l=(0,X.default)().setModal,s=_e(a),u=null==s?void 0:s.find((function(e){return e.id==n})),c=a.user&&u&&(null==(t=a.user)?void 0:t.id)==(null==u?void 0:u.id),d=O(),f=function(){l(_t,null)};return(0,i.useEffect)((function(){n&&u||!s||f()}),[s]),(0,ne.default)(f,[]),u?(0,W.jsxs)(te.BottomSheet,{children:[(0,W.jsxs)(ee.View,{style:{flexDirection:"row",width:"100%"},children:[(0,W.jsx)(ee.View,{style:{flex:1,flexDirection:"row"},children:(0,W.jsx)(A.TouchableOpacity,{onPress:f,children:(0,W.jsx)(F.Ionicons,{size:20,name:"arrow-back",color:U.default[o].text})})}),(0,W.jsx)(ee.View,{style:{flex:1},children:(0,W.jsx)(ee.Text,{style:{fontSize:20,textAlign:"center"},children:r("profile")})}),(0,W.jsx)(ee.View,{style:{flex:1}})]}),(0,W.jsx)(ee.View,{style:{marginBottom:20,height:1,width:"100%"},lightColor:"#ddd",darkColor:"rgba(255,255,255, 0.3)"}),(0,W.jsx)(Et,{username:u.username,name:u.name,userId:u.id}),(0,W.jsx)(K.default,{title:r(c?"Chat with me":"1:1 Chat"),onPress:function(){var e;if(null!=a&&null!=(e=a.user)&&e.id&&a.groupId){var t,n={name:"",type:"messenger",owner:null==a||null==(t=a.user)?void 0:t.id,group:a.groupId,subowner:c?void 0:u.id};d.direct(n).then((function(e){return vn("Main",{screen:"ChatScreen",params:{id:e.id}})}))}}})]}):(0,W.jsx)(W.Fragment,{})}var Dt=n(40820),Tt=n(31675),Mt=(n(93708),n(22362));function Rt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function It(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Rt(Object(n),!0).forEach((function(t){(0,g.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Rt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Vt=n(84417),zt=Vt.messagingSenderId,Lt=pe.FCM_API_KEY.split("").map((function(e,t){return(e.charCodeAt(0)^zt.charCodeAt(t)).toString(16).padStart(2,"0")})).join(""),Bt=Tt.default.initializeApp(It(It({},Vt),{},{apiKey:pe.FCM_API_KEY})),At=Tt.default.messaging(Bt);At.onMessage((function(e){if("Notification"in window){if("granted"===Notification.permission){var t=JSON.parse(e.data.message_set)[0];new Notification(e.data.channel_name,{body:e.data.name+": "+t.content})}}else alert("This browser does not support desktop notification")}));var Ft=function(){var e=(0,x.default)((function*(){if("granted"===(yield Notification.requestPermission())){var e=yield navigator.serviceWorker.register("/tokki-tok/firebase-messaging-sw.js?"+Lt);console.log("[SW]: SCOPE: ",e.scope);var t=yield At.getToken({serviceWorkerRegistration:e,vapidKey:pe.FCM_PUBLIC_VAPID_KEY}).catch((0,x.default)((function*(){return yield At.getToken({serviceWorkerRegistration:e,vapidKey:pe.FCM_PUBLIC_VAPID_KEY})})));if(window.addEventListener("beforeunload",(function(t){t.preventDefault(),e.unregister()})),t)return t}return null}));return function(){return e.apply(this,arguments)}}(),Ut=(0,i.createContext)({setEnable:function(){}}),Wt=function(e){var t=e.user,n=e.children,o=(0,i.useRef)(),a=(0,i.useState)(),l=(0,r.default)(a,2),s=l[0],u=l[1],c=(0,i.useMemo)((function(){return void 0===s?void 0:!(null==s||!s.token)}),[s]);return(0,i.useEffect)((function(){var e=!0;return t&&(void 0===o.current&&(o.current=null,Ft().then((function(t){o.current=t,s&&(0,Mt.putNotification)(It(It({},s),{},{token:o.current})).then((function(t){e&&u(t)}))}))),void 0===s?(0,Mt.getNotification)(t.id).then((function(t){e&&u(t||null)})):null===s?(0,Mt.postNotification)({user:t.id,type:"WEB",token:null}).then((function(t){e&&u(t)})):s.token&&o.current&&o.current!=s.token&&(0,Mt.putNotification)(It(It({},s),{},{token:o.current})).then((function(t){e&&u(t)}))),function(){e=!1}}),[t,s]),(0,W.jsx)(Ut.Provider,{value:{enable:c,setEnable:function(e){t&&s&&(0,Mt.putNotification)(It(It({},s),{},{token:e?void 0==o.current?null:o.current:null})).then((function(e){u(e)}))}},children:(void 0!=c||null===t)&&n})};var Ht=function(e){var t=(0,z.default)().lang;return e.message?(0,W.jsx)(ee.View,{style:Nt.form_error,children:(0,W.jsx)(ee.Text,{style:Nt.form_error_text,children:t(e.message)})}):(0,W.jsx)(W.Fragment,{})};function Gt(e){var t=e.id,n=(0,z.default)().lang,o=(0,E.default)().auth,a=(0,X.default)().setModal,l=(0,i.useState)(""),s=(0,r.default)(l,2),u=s[0],c=s[1],d=(0,i.useState)(""),f=(0,r.default)(d,2),h=f[0],g=f[1],p=(0,i.useState)(""),x=(0,r.default)(p,2),v=x[0],j=x[1],b=(0,i.useState)(""),w=(0,r.default)(b,2),S=w[0],O=w[1],C=(0,i.useState)(!1),P=(0,r.default)(C,2),k=P[0],_=(P[1],(0,i.useState)({})),D=(0,r.default)(_,2),T=D[0],M=D[1],R=_e(o),I=De(u),V=function(){var e=(0,m.useQueryClient)(),t=(0,E.default)(),n=t.auth,r=t.dispatch,i=(0,m.useMutation)(y.postUser,{onSuccess:function(){e.invalidateQueries("UserMembershipList")}}),o=(0,m.useMutation)(y.patchUser,{onSuccess:function(t,i){var o;i.id==(null==(o=n.user)?void 0:o.id)?i.username&&i.password?r({type:"LOGIN_REQUEST",username:i.username,password:i.password}):r({type:"REFRESH"}):e.invalidateQueries("UserMembershipList")}}),a=(0,m.useMutation)(y.deleteUser,{onSuccess:function(t,i){var o;e.invalidateQueries("UserMembershipList"),i==(null==(o=n.user)?void 0:o.id)&&r({type:"LOGOUT_REQUEST"})}});return{create:i.mutateAsync,update:o.mutateAsync,delete:a.mutateAsync}}(),L=null==R?void 0:R.find((function(e){return e.id==t})),B=L&&!1===L.is_guest;(0,i.useEffect)((function(){L&&(c(L.username),g(L.name))}),[null==L?void 0:L.id]);var A=function(){a(Gt,null)};return(0,W.jsx)(te.default,{children:(0,W.jsxs)(ee.View,{style:{justifyContent:"space-between",flex:1,width:"100%"},children:[(0,W.jsxs)(ee.View,{style:{flex:1,width:"100%"},children:[(0,W.jsx)(ee.Text,{style:{fontSize:20},children:n(B?"Edit User":"Create User")}),(0,W.jsx)(ee.View,{style:Nt.separator,lightColor:"#ddd",darkColor:"rgba(255,255,255, 0.3)"}),(0,W.jsxs)(Me,{name:n("Username"),width:"60%",children:[B?(0,W.jsx)(ee.Text,{style:{fontSize:16},children:u}):(0,W.jsx)(Te,{value:u,setValue:function(e){return c(e)},keyboardType:"email-address"}),(0,W.jsx)(Ht,{message:T.username})]}),(0,W.jsxs)(Me,{name:n("Name"),width:"60%",children:[(0,W.jsx)(Te,{value:h,setValue:function(e){return g(e)}}),(0,W.jsx)(Ht,{message:T.name})]}),(0,W.jsxs)(Me,{name:n("Password"),width:"60%",children:[(0,W.jsx)(Te,{value:v,secureTextEntry:!0,setValue:function(e){return j(e)}}),(0,W.jsx)(Ht,{message:T.password})]}),(0,W.jsxs)(Me,{name:n("Check Password"),width:"60%",children:[(0,W.jsx)(Te,{value:S,secureTextEntry:!0,setValue:function(e){return O(e)}}),(0,W.jsx)(Ht,{message:T.checkPassword})]})]}),(0,W.jsxs)(ee.View,{style:{width:"100%",flexDirection:"row"},children:[t&&(0,W.jsx)(ee.View,{style:{flexDirection:"row",justifyContent:"flex-start"},children:(0,W.jsx)(K.default,{title:n("delete account"),style:{marginHorizontal:5},textStyle:{color:"red"},onPress:function(){return V.delete(t).then(A)}})}),(0,W.jsxs)(ee.View,{style:{flex:1,flexDirection:"row",justifyContent:"flex-end"},children:[(0,W.jsx)(K.default,{title:n("save"),onPress:function(){var e={};((null==I?void 0:I.length)||0)>0&&!B&&(e.username="The username is already in use."),(u.length<10||u.length>64)&&(e.username="Set 10-64 characters."),(h.length<1||h.length>64)&&(e.name="Set 1-64 characters."),/^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*#?&])[A-Za-z\d@$!%*#?&]{10,64}$/.test(v)||B&&0==v.length||(e.password="Set 10-64 characters with a combination of letters/numbers/valid special characters."),v!=S&&(e.checkPassword="Incorrect between password and check password."),Object.keys(e).length>0?M(e):t?V.update({id:t,name:h,username:B?void 0:u,is_guest:!1,password:v.length>0?v:void 0}).then((function(){var e;(t!=(null==(e=o.user)?void 0:e.id)||(null==L?void 0:L.is_guest))&&A()})):(null==o?void 0:o.groupId)&&V.create({username:u,name:h,password:v,is_guest:!1,is_staff:k,inviteGroupId:o.groupId}).then(A)}}),(0,W.jsx)(K.default,{title:n("cancel"),style:{marginHorizontal:5},onPress:A})]})]})]})})}var Nt=V.default.create({form_error:{height:22,width:"100%"},form_error_text:{textAlignVertical:"center",color:"red",fontSize:13},separator:{marginBottom:20,height:1,width:"100%"}}),Qt=function(e){var t=e.title,n=e.children,r=(0,ie.default)(),i=U.default[r].text;return(0,W.jsxs)(Dt.default,{bodyStyle:{alignItems:"flex-start",backgroundColor:"light"==r?"transparent":"black"},children:[(0,W.jsx)(T.default,{style:{fontSize:20,color:i,fontWeight:"600"},children:t}),n]})};const Kt=function(){var e,t=(0,z.default)(),n=t.lang,o=t.locale,l=t.setLocale,s=(0,X.default)().setModal,u=(0,E.default)().auth,c=(0,ie.default)(),d=(0,a.useColorScheme)(),f=function(){var e=(0,i.useContext)(Ut);return{enable:e.enable,setEnable:e.setEnable}}(),h=f.enable,g=f.setEnable,p=U.default[c].text;return(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(Qt,{title:n("* Notification Settings"),children:(0,W.jsx)(I.default,{style:{flexDirection:"row"},children:[[n("On"),!0],[n("Off"),!1]].map((function(e){var t=(0,r.default)(e,2),n=t[0],i=t[1];return(0,W.jsx)($,{title:n||"",textStyle:{fontSize:16,color:p,textDecorationLine:h==i?"underline":"none"},style:{borderRadius:20},onPress:function(){g(i)}},n)}))})}),(0,W.jsx)(Qt,{title:n("* Language Settings"),children:(0,W.jsx)(I.default,{style:{flexDirection:"row"},children:[[n("Auto"),"auto"],["\ud55c\uad6d\uc5b4","ko"],["English","en"]].map((function(e){var t=(0,r.default)(e,2),n=t[0],i=t[1];return(0,W.jsx)($,{title:n||"",textStyle:{fontSize:16,color:p,textDecorationLine:o==i?"underline":"none"},style:{borderRadius:20},onPress:function(){return l(i)}},n)}))})}),(0,W.jsx)(Qt,{title:n("* Skin Settings"),children:(0,W.jsx)(I.default,{style:{flexDirection:"row"},children:[[n("Auto"),"no-preference"],[n("Light"),"light"],[n("Dark"),"dark"]].map((function(e){var t=(0,r.default)(e,2),n=t[0],i=t[1];return(0,W.jsx)($,{title:n,textStyle:{fontSize:16,color:p,textDecorationLine:d==i?"underline":"none"},style:{borderRadius:20},onPress:function(){return(0,ie.setColorScheme)(i)}},n)}))})}),!(null!=(e=u.user)&&e.is_guest)&&(0,W.jsx)(Dt.default,{bodyStyle:{alignItems:"flex-start",backgroundColor:"light"==c?"transparent":"black"},children:(0,W.jsx)($,{title:n("> Account Settings"),textStyle:{fontSize:20,color:p},style:{paddingLeft:0,borderRadius:20},onPress:function(){var e;return s(Gt,{id:null==(e=u.user)?void 0:e.id})}})})]})};var Yt=function(){var e=(0,E.default)().auth,t=(0,ie.default)(),n=(0,X.default)().setModal,r=_e(e),o=i.useMemo((function(){return r&&r.map((function(e,t){return(0,W.jsx)(Ye,{member:e,onPress:function(){return n(_t,{id:e.id})}},t)}))}),[r]);return(0,W.jsx)(Ot.default,{style:{flex:1,backgroundColor:U.default[t].background},children:o})},Jt=function(){var e=(0,E.default)().auth,t=S(e),n=(0,ie.default)(),r=(new Date).toISOString().slice(0,10);return(0,W.jsx)(Ot.default,{style:{flex:1,backgroundColor:U.default[n].background},children:null==t?void 0:t.map((function(t,i){var o,a,l,s,u=(0,ue.avatarFromChannel)(t,e.user),c=u.avatar,d=u.name,f=null==(o=t.last_message)?void 0:o.created.slice(0,10),h=(null==(a=t.last_message)?void 0:a.preview_content)||(null==(l=t.last_message)?void 0:l.content)||"";return(0,W.jsxs)(Qe,{bodyStyle:{flexDirection:"row",justifyContent:"space-between"},onPress:function(){return vn("ChatScreen",{id:t.id})},children:[(0,W.jsxs)(I.default,{style:{flexDirection:"row",flexShrink:1},children:[c?(0,W.jsx)(I.default,{style:{marginRight:20},children:(0,W.jsx)(ue.default,{name:c.name,size:44,userId:c.id})}):(0,W.jsx)(F.FontAwesome,{size:40,color:U.default[n].iconColor,style:{marginBottom:-3,marginRight:20},name:"users"}),(0,W.jsxs)(I.default,{children:[(0,W.jsxs)(I.default,{style:{flexDirection:"row"},children:[(0,W.jsx)(ee.Text,{style:{fontSize:18},children:d}),(0,W.jsx)(ee.Text,{style:{fontSize:18,opacity:.4,paddingLeft:5},children:t.member_count})]}),(0,W.jsx)(ee.Text,{style:{fontSize:16,opacity:.4},children:h.replaceAll("\n"," ")})]})]}),(0,W.jsxs)(I.default,{children:[(0,W.jsx)(ee.Text,{style:{fontSize:14,opacity:.4,textAlign:"right"},children:f==r?null==(s=t.last_message)?void 0:s.created.slice(11,16):f}),(0,W.jsx)(ee.Text,{style:{fontSize:14,textAlign:"right"},children:t.unread_count?t.unread_count:" "})]})]},i)}))})},qt=function(){var e=(0,ie.default)();return(0,W.jsx)(Ot.default,{style:{flex:1,backgroundColor:U.default[e].background},children:(0,W.jsx)(Kt,{})})},$t=function(e){var t=U.default[e].iconColor;return{OneTab:{title:"member",component:Yt,icon:(0,W.jsx)(F.MaterialCommunityIcons,{size:32,color:t,style:{marginBottom:-3},name:"account"})},TwoTab:{title:"chat",component:Jt,icon:(0,W.jsx)(F.Ionicons,{size:30,color:t,style:{marginBottom:-3},name:"chatbox"})},FourTab:{title:"config",component:qt,icon:(0,W.jsx)(F.SimpleLineIcons,{size:30,color:t,style:{marginBottom:-3},name:"options"})}}};var Zt={HomeScreen:{title:"home",component:function(e){var t,n=e.navigation,o=e.route,a=(0,z.default)(),l=a.lang,s=a.locale,u=(0,h.default)(),c=(0,ie.default)(),d=(0,X.default)().setModal,f=(0,E.default)().auth,g=(0,i.useState)("landscape"==u),p=(0,r.default)(g,2),x=p[0],m=p[1],y=U.default[c].text,v=[{title:l("member"),headerRight:function(){return(0,W.jsx)(le,{extra:[{title:l("create"),onPress:function(){var e;return d(Gt,null!=(e=f.user)&&e.is_guest?{id:f.user.id}:{})}}]})}},{title:l("chat"),headerRight:function(){return(0,W.jsx)(le,{extra:[{title:l("create"),onPress:function(){return d(gt,{type:"messenger"})}}]})}},{title:l("config"),headerRight:function(){return(0,W.jsx)(le,{})}}];return(0,i.useLayoutEffect)((function(){var e,t=0|(null==o||null==(e=o.params)?void 0:e.tab);n.setOptions("portrait"==u?v[t]:{title:l("home"),headerRight:function(){return(0,W.jsx)(le,{})}})}),[n,o,u,s]),(0,i.useEffect)((function(){m("landscape"==u)}),[u]),x?(0,W.jsxs)(Ot.default,{contentContainerStyle:{flex:1,alignItems:"center"},children:[(0,W.jsxs)(I.default,{style:{flexGrow:1,width:"80%",marginTop:72},children:[(0,W.jsx)(Ct.default,{style:{fontSize:32,color:y},children:"Tokki Tok"}),(0,W.jsx)(I.default,{style:{backgroundColor:U.default.borderColor,height:1,width:"100%"}}),(0,W.jsx)(I.default,{style:{height:24}}),(0,W.jsx)(Dt.default,{bodyStyle:{alignItems:"flex-start",backgroundColor:"light"==c?"transparent":"black"},children:(0,W.jsx)($,{title:l("+ New chat"),textStyle:{fontSize:20,color:y},style:{paddingLeft:0,borderRadius:20},onPress:function(){return d(gt,{type:"messenger"})}})}),(0,W.jsx)(Kt,{})]}),(0,W.jsx)(G,{theme:c})]}):(0,W.jsx)(Ge,{tabs:$t(c),tabBarPosition:"bottom",index:parseInt((null==(t=o.params)?void 0:t.tab)||0),onTab:function(e){n.setParams({tab:e})}})},path:"home"},ChatScreen:{title:"chat",component:function(e){var t,n,o=e.navigation,a=e.route,l=(0,z.default)(),s=l.lang,u=l.locale,c=(0,se.default)(),d=null==a||null==(t=a.params)?void 0:t.id,f=(0,i.useRef)(null),g=(0,E.default)().auth,p=(0,X.default)().setModal,x=null==(n=w(g))?void 0:n.find((function(e){return e.id==parseInt(d)})),m=x?(0,ue.avatarFromChannel)(x,g.user):void 0,y=C(d),v=(0,i.useMemo)((function(){var e;return null==y||null==(e=y.find((function(e){var t;return e.user==(null==(t=g.user)?void 0:t.id)})))?void 0:e.id}),[g,y]),j=(0,h.default)(),b=(0,i.useState)(""),S=(0,r.default)(b,2),O=S[0],P=S[1],k=(0,i.useState)(),_=(0,r.default)(k,2),D=_[0],T=_[1],M=(0,i.useState)(null),R=(0,r.default)(M,2),V=R[0],L=R[1],H=(0,i.useState)(!1),G=(0,r.default)(H,2),N=G[0],Q=G[1],J=(0,i.useState)(!1),q=(0,r.default)(J,2),$=q[0],Z=q[1],te=(0,i.useState)(!1),ne=(0,r.default)(te,2),re=ne[0],oe=ne[1],ae=(0,i.useMemo)((function(){return $?1:O.split("\n").length}),[O,$]),ce=(0,ie.default)(),de=function(){var e;O.length>0&&(fe.create({channel:d,user:null==(e=g.user)?void 0:e.id,content:O,timer:D,use_editor:re}),P(""),T(void 0),Z(!1),re?oe(!1):L(!0))},fe=(0,Y.useMessengerContentMutation)();(0,i.useLayoutEffect)((function(){o.setOptions({headerRight:function(){return(0,W.jsx)(le,{extra:[{title:s("invite"),onPress:function(){return p(et,{id:d})}},{title:s("setting"),onPress:function(){return p(gt,{id:d,type:"messenger",member_id:v})}}]})},title:null==m?void 0:m.name})}),[o,a,v,u]);var he=function(){o.canGoBack()?o.goBack():o.navigate("HomeScreen",{tab:2})};return(0,i.useEffect)((function(){p(null,null),d||he()}),[a]),(0,i.useEffect)((function(){(null===y||void 0!=y&&void 0==y.find((function(e){var t;return e.user==(null==(t=g.user)?void 0:t.id)})))&&he()}),[y]),(0,i.useEffect)((function(){V&&(null==f.current.focus||f.current.focus(),L(!1))}),[V]),(0,i.useEffect)((function(){if(null==V&&!c){var e=setTimeout((function(){return L(!0)}),500);return function(){return clearTimeout(e)}}})),(0,W.jsxs)(I.default,{style:[{flex:1,alignItems:"center"},"landscape"==j?{flexDirection:"row-reverse",minWidth:480}:{flexDirection:"column"}],children:[(0,W.jsx)(Ee,{channel_id:d,setDisable:function(e){return Q(!e)},disable:!N}),(0,W.jsxs)(I.default,{style:[N?{flexShrink:1}:{flex:1},"landscape"==j?{minWidth:320,height:"100%"}:{width:"100%"}],children:[(0,W.jsx)(vt.default,{channel_id:d,auth:g,reverse:!0}),(0,W.jsxs)(I.default,{style:{position:"absolute",flexDirection:"row"},children:[(0,W.jsx)(yt,{channel_id:d}),(0,W.jsx)(ht.default,{channel_id:d})]}),(0,W.jsxs)(ee.View,{style:{bottom:0,width:"100%",paddingTop:15,paddingBottom:10,paddingHorizontal:19},children:[(0,W.jsxs)(I.default,{style:{alignItems:"center",width:"100%",flexDirection:"row"},children:[(0,W.jsx)(K.default,{title:"",style:{height:"100%",paddingTop:8,borderTopRightRadius:0,borderBottomRightRadius:0,justifyContent:"center"},onPress:function(){Z(!$)},children:(0,W.jsx)(I.default,{style:{top:-2},children:(0,W.jsx)(F.Entypo,{name:$?"cross":"plus",size:24,color:U.default[ce].text})})}),D&&(0,W.jsx)(K.default,{style:{height:"100%",paddingTop:8,borderRadius:0},title:"\u231a"+(0,ht.timerFormat)(D),onPress:function(){p(ft,{datetime:D,callback:function(e){return T(e)}}),Z(!1)}}),(0,W.jsx)(St,{active:re,value:O,setValue:P,onReady:function(){return Z(!1)},children:(0,W.jsx)(A.TextInput,{ref:f,value:O,onChangeText:P,onKeyPress:function(e){if(!c){var t=e;t.shiftKey||"Enter"!==t.key||(de(),t.preventDefault())}},style:{flex:1,borderWidth:1,minHeight:40,borderColor:U.default.borderColor,backgroundColor:U.default[ce].background,color:U.default[ce].text},onFocus:function(){return Z(!1)},multiline:!0,numberOfLines:ae})}),(0,W.jsx)(K.default,{style:{height:"100%",paddingTop:8,borderTopLeftRadius:0,borderBottomLeftRadius:0,justifyContent:"center"},title:"\ud83d\udcac",onPress:de})]}),$&&(0,W.jsxs)(I.default,{style:{alignItems:"center",width:"100%",flexDirection:"row",paddingTop:15,paddingBottom:5},children:[(0,W.jsx)(K.default,{style:{height:80,flex:1,justifyContent:"center",marginRight:15},title:"\ud83d\udce4\n "+s("File"),onPress:function(){return new Promise((function(e,t){if("web"==B.default.OS){var n=document.createElement("input");n.type="file",n.onchange=function(t){e(t.target.files[0])},n.onabort=t,n.onerror=t,n.click()}else e(void 0)})).then((function(e){var t;fe.create({channel:d,user:null==(t=g.user)?void 0:t.id,content:"",file:e}),Z(!1)}))}}),(0,W.jsx)(K.default,{style:{height:80,flex:1,justifyContent:"center",marginRight:15},title:"\u270f\ufe0f\n "+s("Editor"),onPress:function(){oe(!re),re&&Z(!1)}}),(0,W.jsx)(K.default,{style:{height:80,flex:1,justifyContent:"center",marginRight:15},title:"\u231a\n "+s("Timer"),onPress:function(){p(ft,{datetime:D,callback:function(e){return T(e)}}),Z(!1)}}),(0,W.jsx)(K.default,{style:{height:80,flex:1,justifyContent:"center"},title:"\ud83d\udcf9\n "+s("Video Call"),onPress:function(){Q(!N),Z(!1)},disabled:N})]})]})]})]})},path:"chat"}},Xt={LoginScreen:{path:"login",title:"Sign in",component:function(e){var t=e.navigation,n=(e.route,(0,z.default)().lang),o=(0,i.useState)(""),a=(0,r.default)(o,2),l=a[0],s=a[1],u=(0,i.useState)(""),c=(0,r.default)(u,2),d=c[0],f=c[1],h=(0,E.default)(),g=h.error,p=h.dispatch,x=function(){return p({type:"LOGIN_REQUEST",username:l,password:d})};return(0,i.useEffect)((function(){t.setOptions({headerRight:void 0})}),[t]),(0,W.jsxs)(I.default,{style:Q.login_container,children:[(0,W.jsxs)(I.default,{style:Q.login_wrapper,children:[(0,W.jsxs)(I.default,{style:Q.form,children:[g&&(0,W.jsx)(I.default,{style:Q.form_error,children:(0,W.jsx)(T.default,{style:Q.form_error_text,children:n(g)})}),(0,W.jsx)(M.default,{style:Q.form_input,value:l,placeholder:n("Username"),onChangeText:function(e){return s(e)},autoCapitalize:"none",keyboardType:"email-address",onSubmitEditing:x}),(0,W.jsx)(M.default,{style:Q.form_input,value:d,placeholder:n("Password"),secureTextEntry:!0,onChangeText:function(e){return f(e)},onSubmitEditing:x}),(0,W.jsx)(R.default,{onPress:x,children:(0,W.jsx)(I.default,{style:Q.button,children:(0,W.jsx)(T.default,{style:Q.button_label,children:n("Sign in")})})}),(0,W.jsx)(R.default,{onPress:function(){return p({type:"LOGIN_GUEST"})},children:(0,W.jsx)(T.default,{style:Q.guest_footer_text,children:n("Sign in as guest")})})]}),(0,W.jsxs)(I.default,{style:Q.login_social,children:[(0,W.jsxs)(I.default,{style:Q.login_social_separator,children:[(0,W.jsx)(I.default,{style:Q.login_social_separator_line}),(0,W.jsx)(T.default,{style:Q.login_social_separator_text,children:"*"}),(0,W.jsx)(I.default,{style:Q.login_social_separator_line})]}),(0,W.jsx)(I.default,{style:Q.login_social_buttons})]})]}),(0,W.jsx)(G,{theme:"light"})]})}},DemoScreen:{title:"",component:function(e){var t=e.navigation,n=(0,E.default)().dispatch;return(0,i.useLayoutEffect)((function(){t.setOptions({headerRight:void 0}),n({type:"LOGIN_GUEST"})}),[]),(0,W.jsx)(W.Fragment,{})},path:"demo"}},en={},tn=n(89212);function nn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function rn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?nn(Object(n),!0).forEach((function(t){(0,g.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var on="tokki-tok";Object.values(en).forEach((function(e){return e.path=on+"/"+e.path}));const an={prefixes:[tn.makeUrl("/")],config:{screens:rn({Main:{screens:rn(rn(rn({},Zt),Xt),{},{NotFound:"*"}),path:on}},en)}};function ln(e){var t=e.navigation,n=(0,z.default)().lang,r=(0,E.default)().auth;return(0,W.jsxs)(I.default,{style:sn.container,children:[(0,W.jsx)(T.default,{style:sn.title,children:n("This screen doesn't exist.")}),(0,W.jsx)(R.default,{onPress:function(){return t.replace(r.user?"HomeScreen":"LoginScreen")},style:sn.link,children:(0,W.jsx)(T.default,{style:sn.linkText,children:n("Go to home screen!")})})]})}var sn=V.default.create({container:{flex:1,backgroundColor:"#fff",alignItems:"center",justifyContent:"center",padding:20},title:{fontSize:20,fontWeight:"bold"},link:{marginTop:15,paddingVertical:15},linkText:{fontSize:14,color:"#2e78b7"}}),un=n(70434),cn=function(){var e=(0,E.default)().auth,t=(0,X.default)().setModal,n=_e(e);return(0,W.jsx)(I.default,{style:{flex:1},children:null==n?void 0:n.map((function(e,n){return(0,W.jsx)(Qe,{containerStyle:{marginHorizontal:0},bodyStyle:{alignItems:"flex-start"},onPress:function(){return t(_t,{id:e.id})},children:(0,W.jsx)(ee.Text,{style:{marginLeft:20},children:e.name})},n)}))})},dn=function(){var e=(0,E.default)().auth,t=S(e);return(0,W.jsx)(I.default,{style:{flex:1},children:null==t?void 0:t.map((function(t,n){var r=(0,ue.avatarFromChannel)(t,e.user).name;return(0,W.jsx)(Qe,{containerStyle:{marginHorizontal:0},bodyStyle:{alignItems:"flex-start"},onPress:function(){return vn("ChatScreen",{id:t.id})},children:(0,W.jsx)(ee.Text,{style:{marginLeft:20},children:r})},n)}))})};const fn=function(e){var t=e.auth,n=(0,un.default)().colors,o=(0,ie.default)(),a=(0,h.default)(),l=S(t),s=(0,i.useState)(),u=(0,r.default)(s,2),c=u[0],d=u[1],f=(0,X.default)().setModal,g=[function(){var e;return f(Gt,null!=(e=t.user)&&e.is_guest?{id:t.user.id}:{})},function(){return f(gt,{type:"messenger"})}],p=function(e){var t=U.default[e].iconColor;return{MemberTab:{title:"member",component:cn,icon:(0,W.jsx)(F.MaterialCommunityIcons,{size:32,color:t,style:{marginBottom:-3},name:"account"})},ChatTab:{title:"chat",component:dn,icon:(0,W.jsx)(F.Ionicons,{size:30,color:t,style:{marginBottom:-3},name:"chatbox"})}}}(o);return(0,i.useEffect)((function(){void 0===c&&l&&d(l.length>0?1:0)}),[l]),(0,W.jsx)(I.default,{style:"landscape"==a?[hn.tabBar,{backgroundColor:U.default[o].background,borderTopColor:n.border}]:{width:0},pointerEvents:"auto",children:"landscape"==a&&t.user&&void 0!==c&&(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(Et,{userId:t.user.id,username:t.user.username,name:t.user.name}),(0,W.jsx)(I.default,{style:{flexDirection:"row-reverse"},children:(0,W.jsx)($,{title:"+",textStyle:{fontSize:20},style:{borderRadius:20},onPress:g[c]})}),(0,W.jsx)(I.default,{accessibilityRole:"tablist",style:hn.content,children:Object.keys(p).length>1?(0,W.jsx)(Ge,{tabs:p,tabBarPosition:"top",onTab:d,index:c}):(0,W.jsx)(I.default,{style:{borderTopWidth:1,flex:1,borderColor:n.border},children:Object.values(p).map((function(e){var t=e.component;return(0,W.jsx)(t,{},e.title)}))})})]})})};var hn=V.default.create({tabBar:{width:240,elevation:8,borderRightWidth:1,borderColor:U.default.borderColor},content:{flex:1,flexDirection:"row"},tab:{flex:1,alignItems:"center"},label:{textAlign:"center",backgroundColor:"transparent"}});const gn=[et,_t,gt,re,ft,n(30230).default,Gt];var pn=(0,d.default)();const xn=function(){var e=(0,h.default)(),t=(0,se.default)(),n=(0,E.default)().auth,o=(0,ie.default)(),a=(0,z.default)(),l=a.lang,s=a.locale,u=(0,i.useMemo)((function(){return void 0===n.user?[]:(console.log("current user: ",n.user),Object.entries(null===n.user?Xt:Zt))}),[n,s]),c=(0,i.useMemo)((function(){return void 0===n.user||null===n.user?[]:gn}),[n]),d="light"==o?{}:{backgroundColor:"#010409"};return void 0!==n.user?(0,W.jsx)(I.default,{style:{flexDirection:"row",flex:1},children:(0,W.jsx)(xt.UploadContextProvider,{children:(0,W.jsxs)(X.ModalsProvider,{modals:c,children:[n.user?(0,W.jsx)(fn,{auth:n}):void 0,(0,W.jsx)(I.default,{style:[{flex:1},d],children:(0,W.jsx)(v.WebSocketProvider,{disable:null===n.user||void 0===n.user,children:(0,W.jsx)(Wt,{user:n.user,children:(0,W.jsxs)(pn.Navigator,{screenOptions:function(n){var r=n.navigation,i=n.route;return{headerStyle:{backgroundColor:U.default[o].header,height:t?50:void 0},headerTitleStyle:{color:U.default[o].text},headerLeft:function(){return function(e,t,n,r,i){var o=-1==["HomeScreen","LoginScreen"].findIndex((function(e){return e==t.name})),a=function(){e.canGoBack()?e.goBack():o&&e.replace("HomeScreen")};return"portrait"==n&&o?(0,W.jsx)(A.TouchableOpacity,{onPress:a,disabled:!i,children:(0,W.jsx)(K.default,{title:"",color:i?U.default[r].buttonBackgroundColor:U.default[r].hoverColor,onPress:a,disabled:i,style:{width:32,height:32,margin:16,paddingVertical:1,paddingHorizontal:4},children:(0,W.jsx)(F.Ionicons,{size:24,color:U.default[r].iconColor,name:"arrow-back"})})}):null}(r,i,e,o,t)},headerRight:function(){return(0,W.jsx)(le,{})},headerLeftContainerStyle:{backgroundColor:U.default[o].header,borderBottomWidth:1,borderColor:U.default[o].headerBottomColor},cardStyle:[{flexShrink:1},d],animationEnabled:"portrait"==e,cardStyleInterpolator:f.forHorizontalIOS}},children:[u.map((function(e){var t=(0,r.default)(e,2),n=t[0],i=t[1];return(0,W.jsx)(pn.Screen,{name:n,component:i.component,options:{title:l(i.title)}},n)})),(0,W.jsx)(pn.Screen,{name:"NotFound",component:ln,options:{title:"Oops!"}})]})})})})]})})}):(0,W.jsx)(W.Fragment,{})};(0,l.enableScreens)();var mn,yn=i.createRef();function vn(e,t){var n,r;t&&(null==(n=yn.current)||n.navigate(e,t)),null==(r=yn.current)||r.navigate(e)}try{var jn,bn;mn=null==(jn=process)||null==(bn=jn.versions)?void 0:bn.electron}catch(kn){mn=void 0}function wn(){var e=(0,o.default)(),t=(0,a.useColorScheme)(),n="no-preference"==t?e:t;return(0,W.jsx)(s.default,{ref:yn,documentTitle:{formatter:function(e,t){return"TOKKI TOK"}},linking:mn?void 0:an,theme:"dark"===n?u.default:c.default,children:(0,W.jsx)(h.ResizeContextProvider,{children:(0,W.jsx)(On,{})})})}var Sn=(0,d.default)();function On(){var e=(0,h.default)();return D(),(0,W.jsxs)(Sn.Navigator,{mode:"modal",headerMode:"screen",screenOptions:{cardStyle:{backgroundColor:"white"},animationEnabled:!0,cardStyleInterpolator:f.forVerticalIOS},children:[(0,W.jsx)(Sn.Screen,{name:"Main",component:xn,options:{headerShown:!1}}),Object.entries(en).map((function(t){var n=(0,r.default)(t,2),i=n[0],o=n[1];return(0,W.jsx)(Sn.Screen,{name:i,component:o.component,options:{title:o.title,gestureDirection:"landscape"==e?"vertical-inverted":"vertical"}},i)}))]})}!function(e){if(void 0!==e&&e.pathname.endsWith("/invitee")){var t=e.search.slice(1).split("&").filter((function(e){return e.startsWith("id=")}));t.length>0&&(k=parseInt(t[0].split("=")[1])),window.history.replaceState(null,"",e.href.split("invitee")[0])}}(window.location);var Cn=["setNativeProps","useNativeDriver"],Pn=console.warn;console.warn=function(e){var t=!0;(e instanceof Object||Cn.some((function(t){return e.includes(t)})))&&(t=!1),t&&Pn(e)}},84417:e=>{firebaseConfig={authDomain:"virtual-metrics-355712.firebaseapp.com",projectId:"virtual-metrics-355712",storageBucket:"virtual-metrics-355712.appspot.com",messagingSenderId:"76003576924",appId:"1:76003576924:web:c8c8a006d07918bbc02a99",measurementId:"G-SEL35L4N5R"},e.exports=firebaseConfig},24654:()=>{}}]);
//# sourceMappingURL=952.1692ec7f.chunk.js.map